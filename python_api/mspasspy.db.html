<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mspasspy.db &mdash; MsPASS 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mspasspy.global_history" href="mspasspy.global_history.html" />
    <link rel="prev" title="mspasspy.client" href="mspasspy.client.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MsPASS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/run_mspass_with_docker.html">Run MsPASS with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_docker_compose.html">Deploy MsPASS with Docker Compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_on_HPC.html">Deploy MsPASS on HPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started_overview.html">MsPASS Setup In-Depth Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_object_design_concepts.html">Data Object Design Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/time_standard_constraints.html">Time Standard Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/obspy_interface.html">Using ObsPy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/database_concepts.html">Database Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/CRUD_operations.html">CRUD Operations in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/handling_errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_editing.html">Data Editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/header_math.html">Header (Metadata) Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/graphics.html">Graphics in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/processing_history_concepts.html">Processing History Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_processing.html">Parallel Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/normalization.html">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/adapting_algorithms.html">Adapting an Existing Algorithm to MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mspasspy.algorithms.html">mspasspy.algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.ccore.html">mspasspy.ccore</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.client.html">mspasspy.client</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">mspasspy.db</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.db.client">client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.client.DBClient"><code class="docutils literal notranslate"><span class="pre">DBClient</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.db.database">database</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.database.Database"><code class="docutils literal notranslate"><span class="pre">Database</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.database.read_distributed_data"><code class="docutils literal notranslate"><span class="pre">read_distributed_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.db.normalize">normalize</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.ArrivalDBMatcher"><code class="docutils literal notranslate"><span class="pre">ArrivalDBMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.ArrivalMatcher"><code class="docutils literal notranslate"><span class="pre">ArrivalMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.BasicMatcher"><code class="docutils literal notranslate"><span class="pre">BasicMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.DataFrameCacheMatcher"><code class="docutils literal notranslate"><span class="pre">DataFrameCacheMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.DatabaseMatcher"><code class="docutils literal notranslate"><span class="pre">DatabaseMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.DictionaryCacheMatcher"><code class="docutils literal notranslate"><span class="pre">DictionaryCacheMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.EqualityDBMatcher"><code class="docutils literal notranslate"><span class="pre">EqualityDBMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.EqualityMatcher"><code class="docutils literal notranslate"><span class="pre">EqualityMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.MiniseedDBMatcher"><code class="docutils literal notranslate"><span class="pre">MiniseedDBMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.MiniseedMatcher"><code class="docutils literal notranslate"><span class="pre">MiniseedMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.ObjectIdDBMatcher"><code class="docutils literal notranslate"><span class="pre">ObjectIdDBMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.ObjectIdMatcher"><code class="docutils literal notranslate"><span class="pre">ObjectIdMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.OriginTimeDBMatcher"><code class="docutils literal notranslate"><span class="pre">OriginTimeDBMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.OriginTimeMatcher"><code class="docutils literal notranslate"><span class="pre">OriginTimeMatcher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.bulk_normalize"><code class="docutils literal notranslate"><span class="pre">bulk_normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.normalize"><code class="docutils literal notranslate"><span class="pre">normalize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.normalize.normalize_mseed"><code class="docutils literal notranslate"><span class="pre">normalize_mseed()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.db.schema">schema</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.schema.DBSchemaDefinition"><code class="docutils literal notranslate"><span class="pre">DBSchemaDefinition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.schema.DatabaseSchema"><code class="docutils literal notranslate"><span class="pre">DatabaseSchema</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.schema.MDSchemaDefinition"><code class="docutils literal notranslate"><span class="pre">MDSchemaDefinition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.schema.MetadataSchema"><code class="docutils literal notranslate"><span class="pre">MetadataSchema</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.schema.SchemaBase"><code class="docutils literal notranslate"><span class="pre">SchemaBase</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.db.schema.SchemaDefinitionBase"><code class="docutils literal notranslate"><span class="pre">SchemaDefinitionBase</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.global_history.html">mspasspy.global_history</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.graphics.html">mspasspy.graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.history.html">mspasspy.history</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.reduce.html">mspasspy.reduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.util.html">mspasspy.util</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cxx_api/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mspass_schema/mspass_schema.html">MsPASS Schema</a></li>
</ul>

    <a href= "../genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Python API</a></li>
      <li class="breadcrumb-item active">mspasspy.db</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/mspass-team/mspass/blob/master/docs/source/python_api/mspasspy.db.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mspasspy-db">
<h1>mspasspy.db<a class="headerlink" href="#mspasspy-db" title="Permalink to this heading"></a></h1>
<section id="module-mspasspy.db.client">
<span id="client"></span><h2>client<a class="headerlink" href="#module-mspasspy.db.client" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.client.DBClient">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.client.</span></span><span class="sig-name descname"><span class="pre">DBClient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/client.html#DBClient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.client.DBClient" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/mongo_client.html#pymongo.mongo_client.MongoClient" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code></a></p>
<p>A client-side top-level handle into MongoDB.</p>
<p>MongoDB uses the client server model for transactions.   An instance
of this class must be created in any MsPASS job using the MongoDB
database to set up the communciation channels between the you
(the client) and an instance of the MongoDB server.
This class is a little more han a wrapper around the
<code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> created for convenience.
In most cases there is functionally little difference from
creating a MongoClient or the MsPASS DBClient (this class).</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.client.DBClient.get_database">
<span class="sig-name descname"><span class="pre">get_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_preference</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_concern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_concern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/client.html#DBClient.get_database"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.client.DBClient.get_database" title="Permalink to this definition"></a></dt>
<dd><p>Get a <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/database.html#pymongo.database.Database" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code></a> with the given name and
options.</p>
<p>Useful for creating a <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/database.html#pymongo.database.Database" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code></a> with
different codec options, read preference, and/or write concern from
this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">read_preference</span>
<span class="go">Primary()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db1</span><span class="o">.</span><span class="n">read_preference</span>
<span class="go">Primary()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">ReadPreference</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_database</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">read_preference</span><span class="o">=</span><span class="n">ReadPreference</span><span class="o">.</span><span class="n">SECONDARY</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db2</span><span class="o">.</span><span class="n">read_preference</span>
<span class="go">Secondary(tag_sets=None)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><cite>name</cite> (optional): The name of the database - a string. If <code class="docutils literal notranslate"><span class="pre">None</span></code>
(the default) the database named in the MongoDB connection URI is
returned.</p></li>
<li><p><cite>codec_options</cite> (optional): An instance of
<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/codec_options.html#bson.codec_options.CodecOptions" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CodecOptions</span></code></a>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">codec_options</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_preference</cite> (optional): The read preference to use. If
<code class="docutils literal notranslate"><span class="pre">None</span></code> (the default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_preference</span></code> of this
<code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is used. See <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/read_preferences.html#module-pymongo.read_preferences" title="(in PyMongo v4.3.3)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">read_preferences</span></code></a>
for options.</p></li>
<li><p><cite>write_concern</cite> (optional): An instance of
<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/write_concern.html#pymongo.write_concern.WriteConcern" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteConcern</span></code></a>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">write_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_concern</cite> (optional): An instance of
<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/read_concern.html#pymongo.read_concern.ReadConcern" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReadConcern</span></code></a>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.5: </span>The <cite>name</cite> parameter is now optional, defaulting to the database
named in the MongoDB connection URI.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.client.DBClient.get_default_database">
<span class="sig-name descname"><span class="pre">get_default_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codec_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_preference</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_concern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">read_concern</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/client.html#DBClient.get_default_database"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.client.DBClient.get_default_database" title="Permalink to this definition"></a></dt>
<dd><p>Get the database named in the MongoDB connection URI.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">uri</span> <span class="o">=</span> <span class="s1">&#39;mongodb://host/my_database&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_default_database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">db</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_database&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_database</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">db</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;my_database&#39;</span>
</pre></div>
</div>
<p>Useful in scripts where you want to choose which database to use
based only on the URI in a configuration file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><cite>default</cite> (optional): the database name to use if no database name
was provided in the URI.</p></li>
<li><p><cite>codec_options</cite> (optional): An instance of
<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/codec_options.html#bson.codec_options.CodecOptions" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">CodecOptions</span></code></a>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">codec_options</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_preference</cite> (optional): The read preference to use. If
<code class="docutils literal notranslate"><span class="pre">None</span></code> (the default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_preference</span></code> of this
<code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is used. See <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/read_preferences.html#module-pymongo.read_preferences" title="(in PyMongo v4.3.3)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">read_preferences</span></code></a>
for options.</p></li>
<li><p><cite>write_concern</cite> (optional): An instance of
<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/write_concern.html#pymongo.write_concern.WriteConcern" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">WriteConcern</span></code></a>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">write_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
<li><p><cite>read_concern</cite> (optional): An instance of
<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/read_concern.html#pymongo.read_concern.ReadConcern" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReadConcern</span></code></a>. If <code class="docutils literal notranslate"><span class="pre">None</span></code> (the
default) the <code class="xref py py-attr docutils literal notranslate"><span class="pre">read_concern</span></code> of this <code class="xref py py-class docutils literal notranslate"><span class="pre">MongoClient</span></code> is
used.</p></li>
</ul>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.8: </span>Undeprecated. Added the <code class="docutils literal notranslate"><span class="pre">default</span></code>, <code class="docutils literal notranslate"><span class="pre">codec_options</span></code>,
<code class="docutils literal notranslate"><span class="pre">read_preference</span></code>, <code class="docutils literal notranslate"><span class="pre">write_concern</span></code> and <code class="docutils literal notranslate"><span class="pre">read_concern</span></code>
parameters.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 3.5: </span>Deprecated, use <a class="reference internal" href="#mspasspy.db.client.DBClient.get_database" title="mspasspy.db.client.DBClient.get_database"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_database()</span></code></a> instead.</p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="module-mspasspy.db.database">
<span id="database"></span><h2>database<a class="headerlink" href="#module-mspasspy.db.database" title="Permalink to this heading"></a></h2>
<p>Tools for connecting to MongoDB.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.database.Database">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.database.</span></span><span class="sig-name descname"><span class="pre">Database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">md_schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/database.html#pymongo.database.Database" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database</span></code></a></p>
<p>MsPASS core database handle.  All MongoDB database operation in MsPASS
should utilize this object.  This object is a subclass of the
Database class of pymongo.  It extends the class in several ways
fundamental to the MsPASS framework:</p>
<ol class="arabic simple">
<li><p>It abstracts read and write operations for seismic data managed
by the framework.   Note reads and writes are for atomic objects.
Use the distributed read and write functions for parallel handling of
complete data sets.</p></li>
<li><p>It contains methods for managing the most common seismic Metadata
(namely source and receiver geometry and receiver response data).</p></li>
<li><p>It adds a schema that can (optionally) be used to enforce type
requirements and/or provide aliasing.</p></li>
<li><p>Manages error logging data.</p></li>
<li><p>Manages (optional) processing history data</p></li>
</ol>
<p>The class currently has only one constructor normally called with
a variant of the following:</p>
<blockquote>
<div><p>db=Database(dbclient,’mydatabase’)</p>
</div></blockquote>
<p>where dbclient is either a MongoDB database client instance or
(recommended) the MsPASS DBClient wrapper (a subclass of the
pymongo client).  The second argument is the database “name”
passed to the MongoDB server that defines your working database.
Optional parameters are:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_schema</strong> – Set the name for the database schema to use with this
handle.  Default is the MsPASS schema. (See User’s Manual for details)</p></li>
<li><p><strong>md_schema</strong> – Set the name for the Metadata schema.   Default is
the MsPASS definitions.  (see User’s Manual for details)</p></li>
</ul>
</dd>
</dl>
<p>As a subclass of pymongo Database the constructor accepts any
parameters defined for the base class (see pymongo documentation)</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.clean">
<span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">document_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">required_xref_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_missing_xref</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_missing_required</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.clean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.clean" title="Permalink to this definition"></a></dt>
<dd><p>This is the atomic level operation for cleaning a single database
document with one or more common fixes.  The clean_collection method
is mainly a loop that calls this method for each document it is asked to
handle.  Most users will likely not need or want to call this method
directly but use the clean_collection method instead.  See the docstring
for clean_collection for a less cyptic description of the options as
the options are identical.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>document_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – the value of the _id field in the document you want to clean</p></li>
<li><p><strong>collection</strong> – the name of collection saving the document. If not specified, use the default wf collection</p></li>
<li><p><strong>rename_undefined</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>) – Specify a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> of <code class="docutils literal notranslate"><span class="pre">{original_key:new_key}</span></code> to rename the undefined keys in the document.</p></li>
<li><p><strong>delete_undefined</strong> – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to delete undefined keys in the doc. <code class="docutils literal notranslate"><span class="pre">rename_undefined</span></code> will not work if this is <code class="docutils literal notranslate"><span class="pre">True</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>required_xref_list</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>) – a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of xref keys to be checked.</p></li>
<li><p><strong>delete_missing_xref</strong> – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to delete this document if any keys specified in <code class="docutils literal notranslate"><span class="pre">required_xref_list</span></code> is missing. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>delete_missing_required</strong> – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to delete this document if any required keys in the database schema is missing. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>verbose</strong> – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to print all the operations. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>verbose_keys</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a list of keys you want to added to better identify problems when error happens. It’s used in the print messages.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>number of fixes applied to each key</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.clean_collection">
<span class="sig-name descname"><span class="pre">clean_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">required_xref_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_missing_xref</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delete_missing_required</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.clean_collection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.clean_collection" title="Permalink to this definition"></a></dt>
<dd><p>This method can be used to fix a subset of common database problems
created during processing that can cause problems if the user tries to
read back data saved with such blemishes.   The subset of problems
are defined as those that are identified by the “dbverify” command
line tool or it’s Database equivalent (the verify method of this class).
This method is an alternative to the command line tool dbverify.  Use
this method for more surgical fixes that require a query to limit
the application of the fix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collection</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the collection you would like to clean. If not specified, use the default wf collection</p></li>
<li><p><strong>query</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>) – this is a python dict that is assumed to be a query
to MongoDB to limit suite of documents to which the requested cleanup
methods are applied.  The default will process the entire database
collection specified.</p></li>
<li><p><strong>rename_undefined</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>) – when set the options is assumed to contain
a python dict defining how to rename a set of attributes. Each member
of the dict is assumed to be of the form <code class="docutils literal notranslate"><span class="pre">{original_key:new_key}</span></code>
Each document handled will change the key from “original_key” to
“new_key”.</p></li>
<li><p><strong>delete_undefined</strong> – attributes undefined in the schema can
be problematic.  As a minimum they waste storage and memory if they
are baggage.  At worst they may cause a downstream process to abort
or mark some or all data dead.  On the other hand, undefined data may
contain important information you need that for some reason is
not defined in the schema.  In that case do not run this method to
clear these.  When set true all attributes matching the query will
have undefined attributes cleared.</p></li>
<li><p><strong>required_xref_list</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>) – in MsPASS we use “normalization” of some common
attributes for efficiency.  The stock ones currently are “source”, “site”,
and “channel”.  This list is a intimately linked to the
delete_missing_xref option.  When that is true this list is
enforced to clean debris.  Typical examples are [‘site_id’,’source_id’]
to require source and receiver geometry.</p></li>
<li><p><strong>delete_missing_xref</strong> – Turn this option on to impose a brutal
fix for data with missing (required) cross referencing data.  This
clean operation, for example, might be necessary to clean up a
data set with some channels that defy all attempts to find valid
receiver metadata (stationxml stuff for passive data, survey data for
active source data).  This clean method is a blunt instrument that
should be used as a last resort.  When true the is list of xref
keys defined by required_xref_list are tested any document that lacks
of the keys will be deleted from the database.</p></li>
<li><p><strong>delete_missing_required</strong> – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to delete this document if any required keys in the database schema is missing. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>verbose</strong> – Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to print all the operations. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>verbose_keys</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a list of keys you want to added to better identify problems when error happens. It’s used in the print messages.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.delete_data">
<span class="sig-name descname"><span class="pre">delete_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_unreferenced_files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clear_elog</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.delete_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.delete_data" title="Permalink to this definition"></a></dt>
<dd><p>Delete method for handling mspass data objects (TimeSeries and Seismograms).</p>
<p>Delete is one of the basic operations any database system should
support (the last letter of the acronymn CRUD is delete).  Deletion is
nontrivial with seismic data stored with the model used in MsPASS.
The reason is that the content of the objects are spread between
multiple collections and sometimes use storage in files completely
outside MongoDB.   This method, however, is designed to handle that
and when given the object id defining a document in one of the wf
collections, it will delete the wf document entry and manage the
waveform data.  If the data are stored in gridfs the deletion of
the waveform data will be immediate.  If the data are stored in
disk files the file will be deleted when there are no more references
in the wf collection for the exact combination of dir and dfile associated
an atomic deletion.  Error log and history data deletion linked to
a datum is optional.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – the wf object id you want to delete.</p></li>
<li><p><strong>object_type</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the object type you want to delete, must be one of [‘TimeSeries’, ‘Seismogram’]</p></li>
<li><p><strong>remove_unreferenced_files</strong> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, we will try to remove the file that no wf data is referencing. Default to be <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p><strong>clear_history</strong> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, we will clear the processing history of the associated wf object, default to be <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p><strong>clear_elog</strong> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, we will clear the elog entries of the associated wf object, default to be <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.get_response">
<span class="sig-name descname"><span class="pre">get_response</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.get_response"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.get_response" title="Permalink to this definition"></a></dt>
<dd><p>Returns an obspy Response object for seed channel defined by
the standard keys net, sta, chan, and loc and a time stamp.
Input time can be a UTCDateTime or an epoch time stored as a float.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> – mspasspy Database handle containing a channel collection
to be queried</p></li>
<li><p><strong>net</strong> – seed network code (required)</p></li>
<li><p><strong>sta</strong> – seed station code (required)</p></li>
<li><p><strong>chan</strong> – seed channel code (required)</p></li>
<li><p><strong>loc</strong> – seed net code.  If None loc code will not be
included in the query.  If loc is anything else it is passed
as a literal.  Sometimes loc codes are not defined by in the
seed data and are literal two ascii space characters.  If so
MongoDB translates those to “”.   Use loc=”” for that case or
provided the station doesn’t mix null and other loc codes use None.</p></li>
<li><p><strong>time</strong> – time stamp for which the response is requested.
seed metadata has a time range for validity this field is
required.   Can be passed as either a UTCDateTime object or
a raw epoch time stored as a python float.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.get_seed_channel">
<span class="sig-name descname"><span class="pre">get_seed_channel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.get_seed_channel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.get_seed_channel" title="Permalink to this definition"></a></dt>
<dd><p>The channel collection is assumed to have a one to one
mapping of net:sta:loc:chan:starttime - endtime.
This method uses a restricted query to match the
keys given and returns the document matching the specified keys.</p>
<p>The optional loc code is handled specially.  The reason is
that it is common to have the loc code empty.  In seed data that
puts two ascii blank characters in the 2 byte packet header
position for each miniseed blockette.  With pymongo that
can be handled one of three ways that we need to handle gracefully.
That is, one can either set a literal two blank character
string, an empty string (“”), or a MongoDB NULL.   To handle
that confusion this algorithm first queries for all matches
without loc defined.  If only one match is found that is
returned immediately.  If there are multiple matches we
search though the list of docs returned for a match to
loc being conscious of the null string oddity.</p>
<p>The (optional) time arg is used for a range match to find
period between the site startime and endtime.  If not used
the first occurence will be returned (usually ill adivsed)
Returns None if there is no match.  Although the time argument
is technically option it usually a bad idea to not include
a time stamp because most stations saved as seed data have
time variable channel metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net</strong> – network name to match</p></li>
<li><p><strong>sta</strong> – station name to match</p></li>
<li><p><strong>chan</strong> – seed channel code to match</p></li>
<li><p><strong>loc</strong> – optional loc code to made (empty string ok and common)</p></li>
</ul>
</dd>
</dl>
<p>default ignores loc in query.
:param time: epoch time for requested metadata
:param verbose:  When True (the default) this method will issue a</p>
<blockquote>
<div><p>print warning message when the match is ambiguous - multiple
docs match the specified keys.   When set False such warnings
will be suppressed.  Use false only if you know the duplicates
are harmless and you are running on a large data set and
you want to reduce the log size.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>handle to query return</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>MondoDB Cursor object of query result.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.get_seed_site">
<span class="sig-name descname"><span class="pre">get_seed_site</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NONE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.get_seed_site"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.get_seed_site" title="Permalink to this definition"></a></dt>
<dd><p>The site collection is assumed to have a one to one
mapping of net:sta:loc:starttime - endtime.
This method uses a restricted query to match the
keys given and returns the MongoDB document matching the keys.
The (optional) time arg is used for a range match to find
period between the site startime and endtime.
Returns None if there is no match.</p>
<p>An all to common metadata problem is to have duplicate entries in
site for the same data.   The default behavior of this method is
to print a warning whenever a match is ambiguous
(i.e. more than on document matches the keys).  Set verbose false to
silence such warnings if you know they are harmless.</p>
<p>An all to common metadata problem is to have duplicate entries in
site for the same data.   The default behavior of this method is
to print a warning whenever a match is ambiguous
(i.e. more than on document matches the keys).  Set verbose false to
silence such warnings if you know they are harmless.</p>
<p>The seed modifier in the name is to emphasize this method is
for data originating as the SEED format that use net:sta:loc:chan
as the primary index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net</strong> – network name to match</p></li>
<li><p><strong>sta</strong> – station name to match</p></li>
<li><p><strong>loc</strong> – optional loc code to made (empty string ok and common)</p></li>
</ul>
</dd>
</dl>
<p>default ignores loc in query.
:param time: epoch time for requested metadata.  Default undefined</p>
<blockquote>
<div><p>and will cause the function to simply return the first document
matching the name keys only.   (This is rarely what you want, but
there is no standard default for this argument.)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>verbose</strong> – When True (the default) this method will issue a
print warning message when the match is ambiguous - multiple
docs match the specified keys.   When set False such warnings
will be suppressed.  Use false only if you know the duplicates
are harmless and you are running on a large data set and
you want to reduce the log size.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>MongoDB doc matching query</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>python dict (document) of result.  None if there is no match.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.index_mseed_FDSN">
<span class="sig-name descname"><span class="pre">index_mseed_FDSN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">provider</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">day_of_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">network</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">station</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf_miniseed'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.index_mseed_FDSN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.index_mseed_FDSN" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.index_mseed_file">
<span class="sig-name descname"><span class="pre">index_mseed_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf_miniseed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segment_time_tears</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">elog_collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'elog'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.index_mseed_file"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.index_mseed_file" title="Permalink to this definition"></a></dt>
<dd><p>This is the first stage import function for handling the import of
miniseed data.  This function scans a data file defined by a directory
(dir arg) and dfile (file name) argument.  I builds an index
for the file and writes the index to mongodb
in the collection defined by the collection
argument (wf_miniseed by default).   The index is bare bones
miniseed tags (net, sta, chan, and loc) with a starttime tag.
The index is appropriate ONLY if the data on the file are created
by concatenating data with packets sorted by net, sta, loc, chan, time
AND the data are contiguous in time.   The original
concept for this function came from the need to handle large files
produced by concanentation of miniseed single-channel files created
by obpsy’s mass_downloader.   i.e. the basic model is the input
files are assumed to be something comparable to running the unix
cat command on a set of single-channel, contingous time sequence files.
There are other examples that do the same thing (e.g. antelope’s
miniseed2days).</p>
<p>We emphasize this function only builds an index - it does not
convert any data.   It has to scan the entire file deriving the
index from data retrieved from miniseed packets with libmseed so
for large data sets this can take a long time.</p>
<p>Actual seismic data stored as miniseed are prone to time tears.
That can happen at the instrument level in at least two common
ways: (1) dropped packets from telemetry issues, or (2) instrument
timing jumps when a clock loses external lock to gps or some
other standard and the rock is restored.  The behavior is this
function in gap handling is controlled by the input parameter
segment_time_tears.  When true a new index entry is created
any time the start time of a packet differs from that computed
from the endtime of the last packet by more than one sample
AND net:sta:chan:loc are constant.  The default for this
parameter is false because data with many dropped packets from
telemetry are common and can create overwhelming numbers of
index entries quickly.  When false the scan only creates a new
index record when net, sta, chan, or loc change between successive
packets.  Our reader has gap handling functions to handle
time tears.  Set segment_time_tears true only when you are
confident the data set does not contain a large number of dropped
packets.</p>
<p>Note to parallelize this function put a list of files in a Spark
RDD or a Dask bag and parallelize the call the this function.
That can work because MongoDB is designed for parallel operations
and we use the thread safe version of the libmseed reader.</p>
<p>Finally, note that cross referencing with the channel and/or
source collections should be a common step after building the
index with this function.  The reader found elsewhere in this
module will transfer linking ids (i.e. channel_id and/or source_id)
to TimeSeries objects when it reads the data from the files
indexed by this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dfile</strong> – file name of data to be indexed.  Asssumed to be
the leaf node of the path - i.e. it contains no directory information
but just the file name.</p></li>
<li><p><strong>dir</strong> – directory name.  This can be a relative path from the
current directory be be advised it will always be converted to an
fully qualified path.  If it is undefined (the default) the function
assumes the file is in the current working directory and will use
the result of the python getcwd command as the directory path
stored in the database.</p></li>
<li><p><strong>collection</strong> – is the mongodb collection name to write the
index data to.  The default is ‘wf_miniseed’.  It should be rare
to use anything but the default.</p></li>
<li><p><strong>segment_time_tears</strong> – boolean controlling handling of data gaps
defined by constant net, sta, chan, and loc but a discontinuity
in time tags for successive packets.  See above for a more extensive
discussion of how to use this parameter.  Default is False.</p></li>
<li><p><strong>elog_collection</strong> – name to write any error logs messages
from the miniseed reader.  Default is “elog”, which is the
same as for TimeSeries and Seismogram data, but the cross reference
keys here are keyed by “wf_miniseed_id”.</p></li>
<li><p><strong>return_ids</strong> – if set True the function will return a tuple
with two id lists.  The 0 entry is an array of ids from the
collection (wf_miniseed by default) of index entries saved and
the 1 entry will contain the ids in the elog_collection of
error log entry insertions.  The 1 entry will be empty if the
reader found no errors and the error log was empty (the hopefully
normal situation).  When this argument is False (the default) it
returns None.  Set true if you need to build some kind of cross
reference to read errors to build some custom cleaning method
for specialized processing that can be done more efficiently.
By default it is fast only to associate an error log entry with
a particular waveform index entry. (we store the saved index
MongoDB document id with each elog entry)</p></li>
<li><p><strong>normalize_channel</strong> – boolean controlling normalization with
the channel collection.   When set True (default is false) the
method will call the Database.get_seed_channel method, extract
the id from the result, and set the result as “channel_id” before
writing the wf_miniseed document.  Set this argument true if
you have a relatively complete channel collection assembled
before running a workflow to index a set of miniseed files
(a common raw data starting point).</p></li>
<li><p><strong>verbose</strong> – boolean passed to get_seed_channel.  This
argument has no effect unless normalize_channel is set True.
It is necessary because the get_seed_channel function has no
way to log errors except calling print.  A very common metadata
error is duplicate and/or time overlaps in channel metadata.
Those are usually harmless so the default for this parameter is
False.  Set this True if you are using inline normalization
(normalize_channel set True) and you aren’t certain your
channel collection has no serious inconsistencies.</p></li>
</ul>
</dd>
<dt class="field-even">Exception</dt>
<dd class="field-even"><p>This function can throw a range of error types for
a long list of possible io issues.   Callers should use a
generic handler to avoid aborts in a large job.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.index_mseed_s3_continuous">
<span class="sig-name descname"><span class="pre">index_mseed_s3_continuous</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">day_of_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">network</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">station</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">location</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf_miniseed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'s3_continuous'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.index_mseed_s3_continuous"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.index_mseed_s3_continuous" title="Permalink to this definition"></a></dt>
<dd><p>This is the first stage import function for handling the import of
miniseed data. However, instead of scanning a data file defined by a directory
(dir arg) and dfile (file name) argument, it reads the miniseed content from AWS s3.
It builds and index it writes to mongodb in the collection defined by the collection
argument (wf_miniseed by default). The index is bare bones
miniseed tags (net, sta, chan, and loc) with a starttime tag.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_client</strong> – s3 Client object given by user, which contains credentials</p></li>
<li><p><strong>year</strong> – year for the query mseed file(4 digit).</p></li>
<li><p><strong>day_of_year</strong> – day of year for the query of mseed file(3 digit [001-366])</p></li>
<li><p><strong>network</strong> – network code</p></li>
<li><p><strong>station</strong> – station code</p></li>
<li><p><strong>channel</strong> – channel code</p></li>
<li><p><strong>location</strong> – location code</p></li>
<li><p><strong>collection</strong> – is the mongodb collection name to write the
index data to.  The default is ‘wf_miniseed’.  It should be rare
to use anything but the default.</p></li>
</ul>
</dd>
<dt class="field-even">Exception</dt>
<dd class="field-even"><p>This function will do nothing if the obejct does not exist. For other
exceptions, it would raise a MsPASSError.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.index_mseed_s3_event">
<span class="sig-name descname"><span class="pre">index_mseed_s3_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">day_of_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf_miniseed'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.index_mseed_s3_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.index_mseed_s3_event" title="Permalink to this definition"></a></dt>
<dd><p>This is the first stage import function for handling the import of
miniseed data. However, instead of scanning a data file defined by a directory
(dir arg) and dfile (file name) argument, it reads the miniseed content from AWS s3.
It builds and index it writes to mongodb in the collection defined by the collection
argument (wf_miniseed by default). The index is bare bones
miniseed tags (net, sta, chan, and loc) with a starttime tag.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_client</strong> – s3 Client object given by user, which contains credentials</p></li>
<li><p><strong>year</strong> – year for the query mseed file(4 digit).</p></li>
<li><p><strong>day_of_year</strong> – day of year for the query of mseed file(3 digit [001-366])</p></li>
<li><p><strong>filename</strong> – SCSN catalog event id for the event</p></li>
<li><p><strong>collection</strong> – is the mongodb collection name to write the
index data to.  The default is ‘wf_miniseed’.  It should be rare
to use anything but the default.</p></li>
</ul>
</dd>
<dt class="field-even">Exception</dt>
<dd class="field-even"><p>This function will do nothing if the obejct does not exist. For other
exceptions, it would raise a MsPASSError.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.load_channel_metadata">
<span class="sig-name descname"><span class="pre">load_channel_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['serialized_channel_data']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.load_channel_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.load_channel_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Reads metadata from the channel collection and loads standard attributes in channel collection to the data passed as mspass_object.
The method will only work if mspass_object has the site_id attribute set to link it to a unique document in source.</p>
<p>Note the mspass_object can be either an atomic object (TimeSeries or Seismogram) with a Metadata container base class or an ensemble (TimeSeriesEnsemble
or SeismogramEnsemble).
Ensembles will have the site data posted to the ensemble Metadata and not the members.
This should be the stock way to assemble the generalization of a common-receiver gather of TimeSeries data for a common sensor component.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a>,
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>,
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeriesEnsemble</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.SeismogramEnsemble</span></code></a>.) – data where the metadata is to be loaded</p></li>
<li><p><strong>exclude_keys</strong> – list of attributes that should not normally be loaded.
Default excludes the serialized obspy class that is used to store response data.   Ignored if include_undefined is set <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>include_undefined</strong> – when <code class="docutils literal notranslate"><span class="pre">True</span></code> all data in the matching channel document are loaded</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – any detected errors will cause a MsPASSError to be thrown</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.load_event">
<span class="sig-name descname"><span class="pre">load_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source_id</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.load_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.load_event" title="Permalink to this definition"></a></dt>
<dd><p>Return a bson record of source data matching the unique id
defined by source_id.   The idea is that magic string would
be extraced from another document (e.g. in an arrival collection)
and used to look up the event with which it is associated in
the source collection.</p>
<p>This function is a relic and may be depricated.  I originally
had a different purpose.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.load_site_metadata">
<span class="sig-name descname"><span class="pre">load_site_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.load_site_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.load_site_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Reads metadata from the site collection and loads standard attributes in site collection to the data passed as mspass_object.
The method will only work if mspass_object has the site_id attribute set to link it to a unique document in source.</p>
<p>Note the mspass_object can be either an atomic object (TimeSeries or Seismogram) with a Metadata container base class or an ensemble (TimeSeriesEnsemble
or SeismogramEnsemble).
Ensembles will have the site data posted to the ensemble Metadata and not the members.
This should be the stock way to assemble the generalization of a common-receiver gather.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a>,
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>,
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeriesEnsemble</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.SeismogramEnsemble</span></code></a>.) – data where the metadata is to be loaded</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – list of attributes that should not normally be loaded.
Default is None.  Ignored if include_undefined is set <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>include_undefined</strong> – when <code class="docutils literal notranslate"><span class="pre">True</span></code> all data in the matching site document are loaded.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – any detected errors will cause a MsPASSError to be thrown</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.load_source_metadata">
<span class="sig-name descname"><span class="pre">load_source_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['serialized_event',</span> <span class="pre">'magnitude_type']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_undefined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.load_source_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.load_source_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Reads metadata from the source collection and loads standard attributes in source collection to the data passed as mspass_object.
The method will only work if mspass_object has the source_id attribute set to link it to a unique document in source.</p>
<p>Note the mspass_object can be either an atomic object (TimeSeries or Seismogram) with a Metadata container base class
or an ensemble (TimeSeriesEnsemble or SeismogramEnsemble).
Ensembles will have the source data posted to the ensemble Metadata and not the members.
This should be the stock way to assemble the generalization of a shot gather.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a>,
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>,
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeriesEnsemble</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.SeismogramEnsemble</span></code></a>.) – data where the metadata is to be loaded</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – list of attributes that should not normally be loaded.
Default are attributes not normally need that are loaded from QuakeML.  Ignored if include_undefined is set <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>include_undefined</strong> – when <code class="docutils literal notranslate"><span class="pre">True</span></code> all data in the matching source document are loaded.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – any detected errors will cause a MsPASSError to be thrown</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.read_data">
<span class="sig-name descname"><span class="pre">read_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">object_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'promiscuous'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'read_data'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">define_as_raw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retrieve_history_record</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_fill_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merge_interpolation_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aws_access_key_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aws_secret_access_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.read_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.read_data" title="Permalink to this definition"></a></dt>
<dd><p>This is the core MsPASS reader for constructing Seismogram or TimeSeries
objects from data managed with MondoDB through MsPASS.   It is the
core reader for serial processing where a typical algorithm would be:</p>
<blockquote>
<div><p>query= { … properly constructed MondoDB query or just ‘{}’}
cursor=db.collection.find(query)  # collection is wf_TimeSeries or wf_Seismogram
for doc in cursor:</p>
<blockquote>
<div><p>id=doc[‘_id’]
d=db.read_data(id)</p>
<blockquote>
<div><p>…   # additional processing here</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>The above loop will construct one Seismogram or TimeSeries (depending on
which collection is referenced) for handling within the for loop.
Use the read_distributed_data function to read a dataset for
parallel processing.  This function is designed to handle one atomic
object at a time.  It is, in fact, called in read_distributed_data
Optional parameters control read behavior and additional options
not always needed.  An important one for handling reads from a
a dataset saved partway through a workflow is data_tag.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object_id</strong> – MongoDB object id of the wf document to be constructed from
data defined in the database.  The object id is guaranteed unique and provides
a unique link to a unique document or nothing.   In the later case the
function will return a None.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – reading mode that controls how the function interacts with
the schema definition for the data type.   Must be one of
[‘promiscuous’,’cautious’,’pedantic’].   See user’s manual for a
detailed description of what the modes mean.  Default is ‘promiscuous’
which turns off all schema checks and loads all attributes defined for
each object read.</p></li>
<li><p><strong>normalize</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – list of collections that are to used for data
normalization. (see User’s manual and MongoDB documentation for
details on this concept)  Briefly normalization means common
metadata like source and receiver geometry are defined in separate
smaller collections that are linked through this mechanism
during reads. Default uses no normalization.</p></li>
<li><p><strong>load_history</strong> – boolean (True or False) switch used to enable or
disable object level history mechanism.   When set True each datum
will be tagged with its origin id that defines the leaf nodes of a
history G-tree.  See the User’s manual for additional details of this
feature.  Default is False.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Sometimes it is helpful to remove one or more
attributes stored in the database from the data’s Metadata (header)
so they will not cause problems in downstream processing.</p></li>
<li><p><strong>collection</strong> – Specify an alternate collection name to
use for reading the data.  The default sets the collection name
based on the data type and automatically loads the correct schema.
The collection listed must be defined in the schema and satisfy
the expectations of the reader.  This is an advanced option that
is indended only to simplify extensions to the reader.</p></li>
<li><p><strong>data_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The definition of a dataset can become ambiguous
when partially processed data are saved within a workflow.   A common
example would be windowing long time blocks of data to shorter time
windows around a particular seismic phase and saving the windowed data.
The windowed data can be difficult to distinguish from the original
with standard queries.  For this reason we make extensive use of “tags”
for save and read operations to improve the efficiency and simplify
read operations.   Default turns this off by setting the tag null (None).</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>define_as_raw</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – a boolean control whether we would like to set_as_origin when loading processing history</p></li>
<li><p><strong>retrieve_history_record</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – a boolean control whether we would like to load processing history</p></li>
<li><p><strong>method</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Methodology to handle overlaps/gaps of traces. Defaults to 0.
See <cite>__add__ &lt;https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.__add__.html#obspy.core.trace.Trace.__add__&gt;</cite> for details on methods 0 and 1,
see <cite>_cleanup &lt;https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream._cleanup.html#obspy.core.stream.Stream._cleanup&gt;</cite> for details on method -1.
Any merge operation performs a cleanup merge as a first step (method -1).</p></li>
<li><p><strong>fill_value</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code> or None) – Fill value for gaps. Defaults to None.</p></li>
<li><p><strong>interpolation_samples</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Used only for method=1. It specifies the number of samples
which are used to interpolate between overlapping traces. Default to 0.
If set to -1 all overlapping samples are interpolated.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a>
or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.read_ensemble_data">
<span class="sig-name descname"><span class="pre">read_ensemble_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objectid_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_metadata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'promiscuous'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'read_ensemble_data'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.read_ensemble_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.read_ensemble_data" title="Permalink to this definition"></a></dt>
<dd><p>Reads an subset of a dataset with some logical grouping into an Ensemble container.</p>
<p>Ensembles are a core concept in MsPASS that are a generalization of
fixed “gather” types frozen into every seismic reflection processing
system we know of.  This reader is driven by a python list of
MongoDB object ids.  The method calls the atomic read_data
method for object_id to assemble the members of the ensemble.
All arguments except the objectid_list and ensemble_metadata are
passed directly to the read_data method in that loop.  The read_data
method and the User’s manual have more information about how those
common arguments are used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>objectid_list</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>,
of the ids defining the ensemble members or a <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/cursor.html#pymongo.cursor.Cursor" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pymongo.cursor.Cursor</span></code></a></p></li>
<li><p><strong>ensemble_metadata</strong> (<em>python dict</em><em> or </em><em>any container that is iterable
and supports the</em><em> [</em><em>key</em><em>] </em><em>key associative array syntax will work.</em><em>
(</em><em>Note this means both Metadata containers</em><em> or </em><em>mongodb docs both can
be used</em><em>) </em><em>The type</em><em> of </em><em>this arg is not tested so you may get a
mysterious exception if the data the arg defines does no meet the
two rules.</em>) – is a dict or dict like container containing
metadata to be stored in the ensemble’s Metadata (common to the group)
container.  A common choice would be to post the query used to
define this ensemble, but there are not restictions.  The contents are
simply copied verbatim to the ensemble metadata container. The default
is an empty dict which translates to an empty ensemble metadata container.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – reading mode regarding schema checks, should be one of [‘promiscuous’,’cautious’,’pedantic’]</p></li>
<li><p><strong>normalize</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – normalized collection you want to read into a mspass object</p></li>
<li><p><strong>load_history</strong> – <code class="docutils literal notranslate"><span class="pre">True</span></code> to load object-level history into the mspasspy object.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the metadata attributes you want to exclude from being read.</p></li>
<li><p><strong>collection</strong> – the collection name in the database that the object is stored. If not specified, use the default wf collection in the schema.</p></li>
<li><p><strong>data_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a user specified “data_tag” key to filter the read. If not match, the record will be skipped.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeriesEnsemble</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.SeismogramEnsemble</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.read_inventory">
<span class="sig-name descname"><span class="pre">read_inventory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.read_inventory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.read_inventory" title="Permalink to this definition"></a></dt>
<dd><p>Loads an obspy inventory object limited by one or more
keys.   Default is to load the entire contents of the
site collection.   Note the load creates an obspy
inventory object that is returned.  Use load_stations
to return the raw data used to construct an Inventory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>net</strong> – network name query string.  Can be a single</p>
</dd>
</dl>
<p>unique net code or use MongoDB’s expression query
mechanism (e.g. “{‘$gt’ : 42}).  Default is all
:param sta: statoin name query string.  Can be a single
station name or a MongoDB query expression.
:param loc:  loc code to select.  Can be a single unique
location (e.g. ‘01’) or a MongoDB expression query.
:param time:   limit return to stations with
startime&lt;time&lt;endtime.  Input is assumed an
epoch time NOT an obspy UTCDateTime. Use a conversion
to epoch time if necessary.
:return:  obspy Inventory of all stations matching the
query parameters
:rtype:  obspy Inventory</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.save_catalog">
<span class="sig-name descname"><span class="pre">save_catalog</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.save_catalog"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.save_catalog" title="Permalink to this definition"></a></dt>
<dd><p>Save the contents of an obspy Catalog object to MongoDB
source collection.  All contents are saved even with
no checking for existing sources with duplicate
data.   Like the comparable save method for stations,
save_inventory, the assumption is pre or post cleanup
will be preformed if duplicates are a major issue.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cat</strong> – is the Catalog object to be saved</p></li>
<li><p><strong>verbose</strong> – Print informational data if true.</p></li>
</ul>
</dd>
</dl>
<p>When false (default) it does it’s work silently.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>integer count of number of items saved</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.save_data">
<span class="sig-name descname"><span class="pre">save_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'promiscuous'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gridfs'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'save_data'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.save_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.save_data" title="Permalink to this definition"></a></dt>
<dd><p>Use this method to save an atomic data object (TimeSeries or Seismogram)
to be managed with MongoDB.  The Metadata are stored as documents in
a MongoDB collection.  The waveform data can be stored in a conventional
file system or in MongoDB’s gridfs system.   At the time this docstring
was written testing was still in progress to establish the relative
performance of file system io versus gridfs, but our working hypothesis
is the answer of which is faster will be configuration dependent. In
either case the goal of this function is to make a save operation as
simple as possible by abstracting the complications involved in
the actual save.</p>
<p>Any errors messages held in the object being saved are always
written to documents in MongoDB is a special collection defined in
the schema.   Saving object level history is optional.</p>
<p>There are multiple options described below.  One worth emphasizing is
“data_tag”.   Such a tag is essential for intermediate saves of
a dataset if there is no other unique way to distinguish the
data in is current state from data saved earlier.  For example,
consider a job that did nothing but read waveform segments spanning
a long time period (e.g. day files),cutting out a shorter time window,
and then saving windowed data.  Crafting an unambiguous query to
find only the windowed data in that situation could be challenging
or impossible.  Hence, we recommend a data tag always be used for
most saves.</p>
<p>The mode parameter needs to be understood by all users of this
function.  All modes enforce a schema constraint for “readonly”
attributes.   An immutable (readonly) attribute by definition
should not be changed during processing.   During a save
all attributes with a key defined as readonly are tested
with a method in the Metadata container that keeps track of
any Metadata changes.  If a readonly attribute is found to
have been changed it will be renamed with the prefix
“<a href="#id8"><span class="problematic" id="id9">READONLYERROR_</span></a>”, saved, and an error posted (e.g. if you try
to alter site_lat (a readonly attribute) in a workflow when
you save the waveform you will find an entry with the key
READONERROR_site_lat.)   In the default ‘promiscuous’ mode
all other attributes are blindly saved to the database as
name value pairs with no safeties.  In ‘cautious’ mode we
add a type check.  If the actual type of an attribute does not
match what the schema expect, this method will try to fix the
type error before saving the data.  If the conversion is
successful it will be saved with a complaint error posted
to elog.  If it fails, the attribute will not be saved, an
additional error message will be posted, and the save
algorithm continues.  In ‘pedantic’ mode, in contrast, all
type errors are considered to invalidate the data.
Similar error messages to that in ‘cautious’ mode are posted
but any type errors will cause the datum passed as arg 0
to be killed. The lesson is saves can leave entries that
may need to be examined in elog and when really bad will
cause the datum to be marked dead after the save.</p>
<p>This method can throw an exception but only for errors in
usage (i.e. arguments defined incorrectly)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>) – the object you want to save.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – This parameter defines how attributes defined with
key-value pairs in MongoDB documents are to be handled on reading.
By “to be handled” we mean how strongly to enforce name and type
specification in the schema for the type of object being constructed.
Options are [‘promiscuous’,’cautious’,’pedantic’] with ‘promiscuous’
being the default.  See the User’s manual for more details on
the concepts and how to use this option.</p></li>
<li><p><strong>storage_mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Must be either “gridfs” or “file.  When set to
“gridfs” the waveform data are stored internally and managed by
MongoDB.  If set to “file” the data will be stored in a file system
with the dir and dfile arguments defining a file name.   The
default is “gridfs”.</p></li>
<li><p><strong>dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – file directory for storage.  This argument is ignored if
storage_mode is set to “gridfs”.  When storage_mode is “file” it
sets the directory in a file system where the data should be saved.
Note this can be an absolute or relative path.  If the path is
relative it will be expanded with the standard python library
path functions to a full path name for storage in the database
document with the attribute “dir”.  As for any io we remind the
user that you much have write permission in this directory.
The writer will also fail if this directory does not already
exist.  i.e. we do not attempt to</p></li>
<li><p><strong>dfile</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – file name for storage of waveform data.  As with dir
this parameter is ignored if storage_mode is “gridfs” and is
required only if storage_mode is “file”.   Note that this file
name does not have to be unique.  The writer always calls positions
the write pointer to the end of the file referenced and sets the
attribute “foff” to that position. That allows automatic appends to
files without concerns about unique names.</p></li>
<li><p><strong>format</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the format of the file. This can be one of the
<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.stream.Stream.write.html#supported-formats">supported formats</a>
of ObsPy writer. The default the python None which the method
assumes means to store the data in its raw binary form.  The default
should normally be used for efficiency.  Alternate formats are
primarily a simple export mechanism.  See the User’s manual for
more details on data export.  Used only for “file” storage mode.</p></li>
<li><p><strong>overwrite</strong> (<em>boolean</em>) – If true gridfs data linked to the original
waveform will be replaced by the sample data from this save.
Default is false, and should be the normal use.  This option
should never be used after a reduce operator as the parents
are not tracked and the space advantage is likely minimal for
the confusion it would cause.   This is most useful for light, stable
preprocessing with a set of map operators to regularize a data
set before more extensive processing.  It can only be used when
storage_mode is set to gridfs.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Metadata can often become contaminated with
attributes that are no longer needed or a mismatch with the data.
A type example is the bundle algorithm takes three TimeSeries
objects and produces a single Seismogram from them.  That process
can, and usually does, leave things like seed channel names and
orientation attributes (hang and vang) from one of the components
as extraneous baggage.   Use this of keys to prevent such attributes
from being written to the output documents.  Not if the data being
saved lack these keys nothing happens so it is safer, albeit slower,
to have the list be as large as necessary to eliminate any potential
debris.</p></li>
<li><p><strong>collection</strong> – The default for this parameter is the python
None.  The default should be used for all but data export functions.
The normal behavior is for this writer to use the object
data type to determine the schema is should use for any type or
name enforcement.  This parameter allows an alernate collection to
be used with or without some different name and type restrictions.
The most common use of anything other than the default is an
export to a diffrent format.</p></li>
<li><p><strong>data_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a user specified “data_tag” key.  See above and
User’s manual for guidance on how the use of this option.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Data object as saved (if killed it will be dead)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.save_dataframe">
<span class="sig-name descname"><span class="pre">save_dataframe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_to_one</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.save_dataframe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.save_dataframe" title="Permalink to this definition"></a></dt>
<dd><p>Tansfer a dataframe into a set of documents, and store them
in a specified collection. In one_to_one mode every row in the
dataframe will be saved into the mongodb, otherwise duplicates
would be discarded.
The dataframe will first call dropna to eliminate None values stored
in it, so that after it is transfered into a document, the memory
usage will be reduced.
:param df: Pandas.Dataframe object, the input to be transfered into mongodb
documents
:param collection:  MongoDB collection name to be used to save the
(often subsetted) tuples of filename as documents in this collection.
:param null_values:  is an optional dict defining null field values.
When used an == test is applied to each attribute with a key
defined in the null_vlaues python dict.  If == returns True, the
value will be set as None in dataframe. If your table has a lot of null
fields this option can save space, but readers must not require the null
field.  The default is None which it taken to mean there are no null
fields defined.
:param one_to_one: a boolean to control if the set should be filtered by
rows.  The default is True which means every row in the dataframe will
create a single MongoDB document. If False the (normally reduced) set
of attributes defined by attributes_to_use will be filtered with the
panda/dask dataframe drop_duplicates method before converting the
dataframe to documents and saving them to MongoDB.  That approach
is important, for example, to filter things like Antelope “site” or
“sitechan” attributes created by a join to something like wfdisc and
saved as a text file to be processed by this function.
:param parallel:  a boolean that determine if dask api will be used for
operations on the dataframe, default is false.
:return:  integer count of number of documents added to collection</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.save_ensemble_data">
<span class="sig-name descname"><span class="pre">save_ensemble_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ensemble_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'promiscuous'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gridfs'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dfile_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_objects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'save_ensemble_data'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.save_ensemble_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.save_ensemble_data" title="Permalink to this definition"></a></dt>
<dd><p>Save an Ensemble container of a group of data objecs to MongoDB.</p>
<p>Ensembles are a core concept in MsPASS that are a generalization of
fixed “gather” types frozen into every seismic reflection processing
system we know of.   This is is a writer for data stored in such a
container.  It is little more than a loop over each “member” of the
ensemble calling the Database.save_data method for each member.
For that reason most of the arguments are passed downstream directly
to save_data.   See the save_data method and the User’s manual for
more verbose descriptions of their behavior and expected use.</p>
<p>The only complexity in handling an ensemble is that our implementation
has a separate Metadata container associated with the overall group
that is assumed to be constant for every member of the ensemble.  For this
reason before entering the loop calling save_data on each member
the method calls the objects sync_metadata method that copies (overwrites if
previously defined) the ensemble attributes to each member.  That assure
atomic saves will not lose their association with a unique ensemble
indexing scheme.</p>
<p>A final feature of note is that an ensemble can be marked dead.
If the entire ensemble is set dead this function returns
immediately and does nothing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ensemble_object</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeriesEnsemble</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.SeismogramEnsemble</span></code></a>.) – the ensemble you want to save.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – reading mode regarding schema checks, should be one of [‘promiscuous’,’cautious’,’pedantic’]</p></li>
<li><p><strong>storage_mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – “gridfs” stores the object in the mongodb grid file system (recommended). “file” stores
the object in a binary file, which requires <code class="docutils literal notranslate"><span class="pre">dfile</span></code> and <code class="docutils literal notranslate"><span class="pre">dir</span></code>.</p></li>
<li><p><strong>dir_list</strong> – A <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of file directories if using “file” storage mode. File directory is <code class="docutils literal notranslate"><span class="pre">str</span></code> type.</p></li>
<li><p><strong>dfile_list</strong> – A <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of file names if using “file” storage mode. File name is <code class="docutils literal notranslate"><span class="pre">str</span></code> type.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the metadata attributes you want to exclude from being stored.</p></li>
<li><p><strong>exclude_objects</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>) – A list of indexes, where each specifies a object in the ensemble you want to exclude from being saved. Starting from 0.</p></li>
<li><p><strong>collection</strong> – the collection name you want to use. If not specified, use the defined collection in the metadata schema.</p></li>
<li><p><strong>data_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a user specified “data_tag” key to tag the saved wf document.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.save_inventory">
<span class="sig-name descname"><span class="pre">save_inventory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">networks_to_exclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['SY']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.save_inventory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.save_inventory" title="Permalink to this definition"></a></dt>
<dd><p>Saves contents of all components of an obspy inventory
object to documents in the site and channel collections.
The site collection is sufficient for Seismogram objects but
TimeSeries data will normally need to be connected to the
channel collection.   The algorithm used will not add
duplicates based on the following keys:</p>
<dl>
<dt>For site:</dt><dd><p>net
sta
chan
loc
starttime::endtime - this check is done cautiously with</p>
<blockquote>
<div><p>a 10 s fudge factor to avoid the issue of floating point
equal tests.   Probably overly paranoid since these
fields are normally rounded to a time at the beginning
of a utc day, but small cost to pay for stabilty because
this function is not expected to be run millions of times
on a huge collection.</p>
</div></blockquote>
</dd>
<dt>for channels:</dt><dd><p>net
sta
chan
loc
starttime::endtime - same approach as for site with same</p>
<blockquote>
<div><p>issues - note especially 10 s fudge factor.   This is
necessary because channel metadata can change more
frequently than site metadata (e.g. with a sensor
orientation or sensor swap)</p>
</div></blockquote>
</dd>
</dl>
<p>The channel collection can contain full response data
that can be obtained by extracting the data with the key
“serialized_inventory” and running pickle loads on the returned
string.</p>
<p>A final point of note is that not all Inventory objects are created
equally.   Inventory objects appear to us to be designed as an image
of stationxml data.  The problem is that stationxml, like SEED, has to
support a lot of complexity faced by data centers that end users
like those using this package do not need or want to know.   The
point is this method tries to untangle the complexity and aims to reduce the
result to a set of documents in the site and channel collection
that can be cross referenced to link the right metadata with all
waveforms in a dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>inv</strong> – is the obspy Inventory object of station data to save.</p>
</dd>
<dt class="field-even">Networks_to_exclude</dt>
<dd class="field-even"><p>should contain a list (or tuple) of
SEED 2 byte network codes that are to be ignored in
processing.   Default is SY which is used for synthetics.
Set to None if if all are to be loaded.</p>
</dd>
<dt class="field-odd">Verbose</dt>
<dd class="field-odd"><p>print informational lines if true.  If false</p>
</dd>
</dl>
<p>works silently)</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>tuple with
0 - integer number of site documents saved
1 -integer number of channel documents saved
2 - number of distinct site (net,sta,loc) items processed
3 - number of distinct channel items processed</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.save_textfile">
<span class="sig-name descname"><span class="pre">save_textfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'textfile'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'\\s+'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header_line</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attribute_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rename_attributes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_use</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">null_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">one_to_one</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">insert_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.save_textfile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.save_textfile" title="Permalink to this definition"></a></dt>
<dd><p>Import and parse a textfile into set of documents, and store them
into a mongodb collection. This function consists of two steps:
1. Textfile2Dataframe: Convert the input textfile into a Pandas dataframe
2. save_dataframe: Insert the documents in that dataframe into a mongodb
collection</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> – path to text file that is to be read to create the</p>
</dd>
</dl>
<p>table object that is to be processed (internally we use pandas or
dask dataframes)
:param collection:  MongoDB collection name to be used to save the
(often subsetted) tuples of filename as documents in this collection.
:param separator: The delimiter used for seperating fields,
the default is “s+”, which is the regular expression of “one or more
spaces”.</p>
<blockquote>
<div><p>For csv file, its value should be set to ‘,’.
This parameter will be passed into pandas.read_csv or dask.dataframe.read_csv.
To learn more details about the usage, check the following links:
<a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html</a>
<a class="reference external" href="https://docs.dask.org/en/latest/generated/dask.dataframe.read_csv.html">https://docs.dask.org/en/latest/generated/dask.dataframe.read_csv.html</a></p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>type_dict</strong> – pairs of each attribute and its type, usedd to validate</p>
</dd>
</dl>
<p>the type of each input item
:param header_line: defines the line to be used as the attribute names for
columns, if is &lt; 0, an attribute_names is required. Please note that if an
attribute_names is provided, the attributes defined in header_line will
always be override.
:param attribute_names: This argument must be either a list of (unique)
string names to define the attribute name tags for each column of the
input table.   The length of the array must match the number of
columns in the input table or this function will throw a MsPASSError
exception.   This argument is None by default which means the
function will assume the line specified by the “header_line” argument as
column headers defining the attribute name.  If header_line is less
than 0 this argument will be required.  When header_line is &gt;= 0
and this argument (attribute_names) is defined all the names in
this list will override those stored in the file at the specified
line number.
:param  rename_attributes:   This is expected to be a python dict
keyed by names matching those defined in the file or attribute_names
array (i.e. the panda/dataframe column index names) and values defining
strings to use to override the original names.   That usage, of course,
is most common to override names in a file.  If you want to change all
the name use a custom attributes_name array as noted above.  This
argument is mostly to rename a small number of anomalous names.
:param attributes_to_use:  If used this argument must define a list of
attribute names that define the subset of the dataframe dataframe
attributes that are to be saved.  For relational db users this is
effectively a “select” list of attribute names.  The default is
None which is taken to mean no selection is to be done.
:param one_to_one: is an important boolean use to control if the
output is or is not filtered by rows.  The default is True
which means every tuple in the input file will create a single row in
dataframe. (Useful, for example, to construct an wf_miniseed
collection css3.0 attributes.)  If False the (normally reduced) set
of attributes defined by attributes_to_use will be filtered with the
panda/dask dataframe drop_duplicates method.  That approach
is important, for example, to filter things like Antelope “site” or
“sitechan” attributes created by a join to something like wfdisc and
saved as a text file to be processed by this function.
:param parallel:  When true we use the dask dataframe operation.
The default is false meaning the simpler, identical api panda
operators are used.
:param insert_column: a dictionary of new columns to add, and their value(s).
If the content is a single value, it can be passedto define a constant value
for the entire column of data. The content can also be a list, in that case,
the list should contain values that are to be set, and it must be the same
length as the number of tuples in the table.
:return:  Integer count of number of documents added to collection</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.set_database_schema">
<span class="sig-name descname"><span class="pre">set_database_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.set_database_schema"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.set_database_schema" title="Permalink to this definition"></a></dt>
<dd><p>Use this method to change the database schema defined for this
instance of a database handle.  This method sets the database
schema (namespace for attributes saved in MongoDB).  Use metadata_schema
to change the in memory namespace.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>schema</strong> – an instance of :class:<a href="#id1"><span class="problematic" id="id2">`</span></a>mspsspy.db.schema.DatabaseSchema.
WARNING this is not a name - is a MsPASS object consructed from  aname.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.set_metadata_schema">
<span class="sig-name descname"><span class="pre">set_metadata_schema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.set_metadata_schema"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.set_metadata_schema" title="Permalink to this definition"></a></dt>
<dd><p>Use this method to change the metadata schema defined for this
instance of a database handle.  This method sets the metadata
schema (interal namespace).  Use set_database_schema to change
the stored data schema.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>schema</strong> – an instance of :class:<a href="#id3"><span class="problematic" id="id4">`</span></a>mspsspy.db.schema.MetadataSchema.
WARNING this is not a name - is a MsPASS object consructed from a name.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.update_data">
<span class="sig-name descname"><span class="pre">update_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cautious'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Database.update_data'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.update_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.update_data" title="Permalink to this definition"></a></dt>
<dd><p>Updates both metadata and sample data corresponding to an input data
object.</p>
<p>Since storage of data objects in MsPASS is broken into multiple
collections and storage methods, doing a full data update has some
complexity.   This method handles the problem differently for the
different pieces:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>An update is performed on the parent wf collection document.
That update makes use of the related Database method
called update_metadata.</p></li>
<li><p>If the error log is not empty it is saved.</p></li>
<li><p>If the history container has contents it is saved.</p></li>
<li><p>The sample data is the thorniest problem. Currently this
method will only do sample updates for data stored in
the mongodb gridfs system.   With files containing multiple
waveforms it would be necessary to append to the files and
this could create a blaat problem with large data sets so
we do not currently support that type of update.</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>) – the object you want to update.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a list of metadata attributes you want to exclude from being updated.</p></li>
<li><p><strong>force_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a list of metadata attributes you want to force
to be updated.   Normally this method will only update attributes
that have been marked as changed since creation of the parent data
object.  If data with these keys is found in the mspass_object they
will be added to the update record.</p></li>
<li><p><strong>collection</strong> – the collection name you want to use. If not specified, use the defined collection in the metadata schema.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – This parameter defines how attributes defines how
strongly to enforce schema constraints. As described above
‘promiscuous’ justs updates all changed values with no schema
tests.  ‘cautious’, the default, enforces type constraints and
tries to convert easily fixed type mismatches (e.g. int to floats
of vice versa).  Both ‘cautious’ and ‘pedantic’ may leave one or
more complaint message in the elog of mspass_object on how the
method did or did not fix mismatches with the schema.  Both
also will drop any key-value pairs where the value cannot be
converted to the type defined in the schema.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.
(defaults to ‘Database.update_data’ and should not normally need to be changed)</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>mspass_object data.  Normally this is an unaltered copy
of the data passed through mspass_object.  If there are errors,
however, the elog will contain new messages.  All such messages,
howevever, should be saved in the elog collection because elog
is the last collection updated.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.update_ensemble_metadata">
<span class="sig-name descname"><span class="pre">update_ensemble_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ensemble_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'promiscuous'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_objects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'update_ensemble_metadata'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.update_ensemble_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.update_ensemble_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Updates (or save if it’s new) the mspasspy ensemble object, including saving the processing history, elogs
and metadata attributes.</p>
<p>This method is a companion to save_ensemble_data. The relationship is
comparable to that between the save_data and update_metadata methods.
In particular, this method is mostly for internal use to save the
contents of the Metadata container in each ensemble member.  Like
save_ensemble_data it is mainly a loop over ensemble members calling
update_metadata on each member.  Also like update_metadata it is
advanced usage to use this method directly.  Most users will apply
it under the hood as part of calls to save_ensemble_data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ensemble_object</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeriesEnsemble</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.SeismogramEnsemble</span></code></a>.) – the ensemble you want to update.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – reading mode regarding schema checks, should be one of [‘promiscuous’,’cautious’,’pedantic’]</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – the metadata attributes you want to exclude from being updated.</p></li>
<li><p><strong>exclude_objects</strong> – a list of indexes, where each specifies a object in the ensemble you want to</p></li>
</ul>
</dd>
</dl>
<p>exclude from being saved. The index starts at 0.
:type exclude_objects: <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>
:param collection: the collection name you want to use. If not specified, use the defined collection in the metadata
schema.
:param ignore_metadata_changed_test: if specify as <code class="docutils literal notranslate"><span class="pre">True</span></code>, we do not check the whether attributes we want to update are in the Metadata.modified() set. Default to be <code class="docutils literal notranslate"><span class="pre">False</span></code>.
:param data_tag: a user specified “data_tag” key to tag the saved wf document.
:type data_tag: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.update_metadata">
<span class="sig-name descname"><span class="pre">update_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cautious'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Database.update_metadata'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.update_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.update_metadata" title="Permalink to this definition"></a></dt>
<dd><p>Use this method if you want to save the output of a processing algorithm
whose output is only posted to metadata.   That can be something as
simple as a little python function that does some calculations on other
metadata field, or as elaborate as a bound FORTRAN or C/C++ function
that computes something, posts the results to Metadata, but doesn’t
actually alter the sample data.   A type example of the later is an amplitude
calculation that posts the computed amplitude to some metadata key value.</p>
<p>This method will ONLY attempt to update Metadata attributes stored in the
data passed (mspass_object) that have been marked as having been
changed since creation of the data object.  The default mode will
check entries against the schema and attempt to fix any type
mismatches (mode==’cautious’ for this algorithm).  In cautious or
pedantic mode this method can end up posting a lot of errors in
elog for data object (mspass_object) being handled.  In
promiscuous mode there are no safeties and the any values
that are defined in Metadata as having been changed will be
posted as an update to the parent wf document to the data object.</p>
<p>A feature of the schema that is considered an unbreakable rule is
that any attribute marked “readonly” in the schema cannot by
definition be updated with this method.  It utilizes the same
method for handling this as the save_data method.  That is,
for all “mode” parameters if an key is defined in the schema as
readonly and it is listed as having been modified, it will
be save with a new key creating by adding the prefix
“<a href="#id10"><span class="problematic" id="id11">READONLYERROR_</span></a>” .  e.g. if we had a site_sta read as
‘AAK’ but we changed it to ‘XYZ’ in a workflow, when we tried
to save the data you will find an entry in the document
of {‘READONLYERROR_site_sta’ : ‘XYZ’}</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>) – the object you want to update.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a list of metadata attributes you want to exclude from being updated.</p></li>
<li><p><strong>force_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – a list of metadata attributes you want to force
to be updated.   Normally this method will only update attributes
that have been marked as changed since creation of the parent data
object.  If data with these keys is found in the mspass_object they
will be added to the update record.</p></li>
<li><p><strong>collection</strong> – the collection name you want to use. If not specified, use the defined collection in the metadata schema.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – This parameter defines how attributes defines how
strongly to enforce schema constraints. As described above
‘promiscuous’ justs updates all changed values with no schema
tests.  ‘cautious’, the default, enforces type constraints and
tries to convert easily fixed type mismatches (e.g. int to floats
of vice versa).  Both ‘cautious’ and ‘pedantic’ may leave one or
more complaint message in the elog of mspass_object on how the
method did or did not fix mismatches with the schema.  Both
also will drop any key-value pairs where the value cannot be
converted to the type defined in the schema.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>mspass_object data.  Normally this is an unaltered copy
of the data passed through mspass_object.  If there are errors,
however, the elog will contain new messages.  Note any such
messages are volatile and will not be saved to the database
until the save_data method is called.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.database.Database.verify">
<span class="sig-name descname"><span class="pre">verify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">document_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tests</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['xref',</span> <span class="pre">'type',</span> <span class="pre">'undefined']</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#Database.verify"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.Database.verify" title="Permalink to this definition"></a></dt>
<dd><p>This is an atomic-level operation to search for known issues in
Metadata stored in a database and needed to construct a valid
data set for starting a workflow.  By “atomic” we main the operation
is for a single document in MongoDB linked to an atomic data
object (currently that means TimeSeries or Seismogram objects).
The tests are the same as those available through the command
line tool dbverify.  See the man page for that tool and the
user’s manual for more details about the tests this method
enables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>document_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a> of document to be tested) – the value of the _id field in the document you want to verify</p></li>
<li><p><strong>collection</strong> – the name of collection to which document_id is
expected to provide a unique match.  If not specified, uses the default wf collection</p></li>
<li><p><strong>tests</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – this should be a python list of test to apply by
name keywords.  Test nams allowed are ‘xref’, ‘type’,
and ‘undefined’.   Default runs all tests.   Specify a subset of those
keywords to be more restrictive.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a python dict keyed by a problematic key.  The value in each
entry is the name of the failed test (i.e. ‘xref’, ‘type’, or ‘undefined’)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></p>
</dd>
<dt class="field-even">Excpetion</dt>
<dd class="field-even"><p>This method will throw a fatal error exception if the
id received does no match any document in the database.  That is
intentional as the method should normally appear in a loop over
ids found after query and the ids should then always be valid.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.db.database.read_distributed_data">
<span class="sig-prename descclassname"><span class="pre">mspasspy.db.database.</span></span><span class="sig-name descname"><span class="pre">read_distributed_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cursor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'promiscuous'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exclude_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dask'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npartitions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spark_context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_tag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aws_access_key_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aws_secret_access_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/database.html#read_distributed_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.database.read_distributed_data" title="Permalink to this definition"></a></dt>
<dd><p>This function should be used to read an entire dataset that is to be handled
by subsequent parallel operations.  The function can be thought of as
loading the entire data set into a parallel container (rdd for spark
implementations or bag for a dask implementatio).   It doesn’t really do
that to be scalable but conceptually the container that is the output of
this method is a handle to the entire data set defined by the input
cursor.   The normal use of this function is to construct a query of
the desired waveform collection with the MongoDB find operation.
MongoDB find returns the cursor object that is the expected input.
All other arguments are options that change behavior as described below.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<a class="reference internal" href="#mspasspy.db.database.Database" title="mspasspy.db.database.Database"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.db.database.Database</span></code></a>.) – the database from which the data are to be read.</p></li>
<li><p><strong>cursor</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/pymongo/cursor.html#pymongo.cursor.CursorType" title="(in PyMongo v4.3.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pymongo.cursor.CursorType</span></code></a>) – mongodb cursor defining what “the dataset” is.  It would
normally be the output of the find method with a workflow dependent
query.</p></li>
<li><p><strong>mode</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – reading mode that controls how the function interacts with
the schema definition for the data type.   Must be one of
[‘promiscuous’,’cautious’,’pedantic’].   See user’s manual for a
detailed description of what the modes mean.  Default is ‘promiscuous’
which turns off all schema checks and loads all attributes defined for
each object read.</p></li>
<li><p><strong>normalize</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – list of collections that are to used for data
normalization. (see User’s manual and MongoDB documentation for
details on this concept)  Briefly normalization means common
metadata like source and receiver geometry are defined in separate
smaller collections that are linked through this mechanism
during reads. Default uses no normalization.</p></li>
<li><p><strong>load_history</strong> – boolean (True or False) switch used to enable or
disable object level history mechanism.   When set True each datum
will be tagged with its origin id that defines the leaf nodes of a
history G-tree.  See the User’s manual for additional details of this
feature.  Default is False.</p></li>
<li><p><strong>exclude_keys</strong> (a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Sometimes it is helpful to remove one or more
attributes stored in the database from the data’s Metadata (header)
so they will not cause problems in downstream processing.</p></li>
<li><p><strong>format</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Set the format of the parallel container to define the
dataset.   Must be either “spark” or “dask” or the job will abort
immediately with an exception</p></li>
<li><p><strong>spark_context</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">pyspark.SparkContext</span></code>) – If using spark this argument is required.  Spark
defines the concept of a “context” that is a global control object that
manages schduling.  See online Spark documentation for details on
this concept.</p></li>
<li><p><strong>npartitions</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – The number of desired partitions for Dask or the number
of slices for Spark. By default Dask will use 100 and Spark will determine
it automatically based on the cluster.</p></li>
<li><p><strong>data_tag</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The definition of a dataset can become ambiguous
when partially processed data are saved within a workflow.   A common
example would be windowing long time blocks of data to shorter time
windows around a particular seismic phase and saving the windowed data.
The windowed data can be difficult to distinguish from the original
with standard queries.  For this reason we make extensive use of “tags”
for save and read operations to improve the efficiency and simplify
read operations.   Default turns this off by setting the tag null (None).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>container defining the parallel dataset.  A spark <cite>RDD</cite> if format
is “Spark” and a dask ‘bag’ if format is “dask”</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-mspasspy.db.normalize">
<span id="normalize"></span><h2>normalize<a class="headerlink" href="#module-mspasspy.db.normalize" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ArrivalDBMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">ArrivalDBMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'arrival'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['phase',</span> <span class="pre">'time']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ArrivalDBMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ArrivalDBMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DatabaseMatcher" title="mspasspy.db.normalize.DatabaseMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseMatcher</span></code></a></p>
<p>This is a class for matching a table of arrival times to input
waveform data objects.  Use this version if the table of arrivals
is huge and database query delays will not create a bottleneck
in your workflow.</p>
<p>Phase arrival time matching is a common need when waveform segments
are downloaded.  When data are assembled as miniseed files or
url downloads of miniseed data, the format has no way to hold
arrival time data.  This matcher can prove useful for matching
waveform segments with an origin as miniseed.</p>
<dl class="simple">
<dt>The algorithm it uses for matching is a logic and of two tests:</dt><dd><ol class="arabic simple">
<li><p>We first match all arrival times falling between the
sample range of an input MsPASS data object, d.  That is,
first component of the query is to find all arrival times,
t_a, that obey the relation:  d.t0 &lt;= t_a &lt;= d.endtime().</p></li>
<li><p>Match only data for which the (fixed) name “sta”
in arrival and the data match.   A secondary key match using
the “net” attribute is used only if “net” is defined with
the data.  That is done to streamline processing of css3.0
data where “net”  is not defined.</p></li>
</ol>
</dd>
</dl>
<p>Note the concept of an arrival time is also mixed as in
some contexts it means a time computed from an earth model and other
time a measured time that is “picked” by a human or computer algorithm.
This class does not distinguish model-based from measured times.  It
simply uses the time and station tag information with the algorithm
noted above to attempt a match.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – <p>Name of MongoDB collection that is to be queried
(default “arrival”, which is not currently part of the stock</p>
<blockquote>
<div><p>mspass schema.   Note it isn’t required to be in the schema
and illustrates flexibility’).</p>
</div></blockquote>
</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find_one will fail.
Default [“phase”,”time”].</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is None</p></li>
<li><p><strong>type</strong> – list of strings defining collection keys</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
<li><p><strong>require_unique_match</strong> (<em>boolean</em>) – boolean handling of ambiguous matches.
When True find_one will throw an error if an entry is tries to match
is not unique.  When False find_one returns the first document
found and logs a complaint message.  (default is False)</p></li>
<li><p><strong>query</strong> (<em>python dictionary</em><em> or </em><em>None.  None is equivalewnt to
passing an empty dictionary.  A TypeError will be thrown if this
argument is not None</em><em> or </em><em>a dict.</em>) – optional query predicate.  That is, if set the
interval query is appended to this query to build a more specific
query.   An example might be station code keys to match a
specific pick for a specific station like {“sta”:”AAK”}.
Another would be to limit arrivals to a specific phase name
like {“phase” : “ScS”}.  Default is None which reverts to no
query predicate.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ArrivalDBMatcher.query_generator">
<span class="sig-name descname"><span class="pre">query_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ArrivalDBMatcher.query_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ArrivalDBMatcher.query_generator" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementation of method required by superclass
DatabaseMatcher.</p>
<p>This generator implements the switching algorithm noted in the
class docstring.  That is, for atomic data the time span for
the interval query is determined from the range of the waveform
data received through mspass_object.   For ensembles the
algorithm fetches fields defined by self.startime_key and
self.endtime_key to define the time interval.</p>
<p>The interval test is overlaid on the self.query input.  i.e.
the query dict components derived are added to the self.query.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ArrivalMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">ArrivalMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_or_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'arrival'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['phase',</span> <span class="pre">'time']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_starttime_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'starttime'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_endtime_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'endtime'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arrival_time_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_null_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ArrivalMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ArrivalMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DataFrameCacheMatcher" title="mspasspy.db.normalize.DataFrameCacheMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrameCacheMatcher</span></code></a></p>
<p>This is a class for matching a table of arrival times to input
waveform data objects.  Use this version if the table of arrivals
is not huge enough to cause a memory problem.</p>
<p>Phase arrival time matching is a common need when waveform segments
are downloaded.  When data are assembled as miniseed files or
url downloads of miniseed data, the format has no way to hold
arrival time data.  This matcher can prove useful for matching
waveform segments with an origin as miniseed.</p>
<dl class="simple">
<dt>The algorithm it uses for matching is a logic and of two tests:</dt><dd><ol class="arabic simple">
<li><p>We first match all arrival times falling between the
sample range of an input MsPASS data object, d.  That is,
first component of the query is to find all arrival times,
t_a, that obey the relation:  d.t0 &lt;= t_a &lt;= d.endtime().</p></li>
<li><p>Match only data for which the (fixed) name “sta”
in arrival and the data match.   A secondary key match using
the “net” attribute is used only if “net” is defined with
the data.  That is done to streamline processing of css3.0
data where “net”  is not defined.</p></li>
</ol>
</dd>
</dl>
<p>Note the concept of an arrival time is also mixed as in
some contexts it means a time computed from an earth model and other
time a measured time that is “picked” by a human or computer algorithm.
This class does not distinguish model-based from measured times.  It
simply uses the time and station tag information with the algorithm
noted above to attempt a match.</p>
<p>This implementation caches the table of attributes desired to an
internal pandas DataFrame.   It is thus most appropriate for
arrival tables that are not huge.  Note it may be possible to
do appropriate preprocessing to manage the arrival table size.
e.g. the table can be grouped by station or in time blocks and
then processed in a loop updating waveform database records
in multiple passes.  The alternative for large arrival tables
is to use the DB version of this matcher.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – <p>Name of MongoDB collection that is to be queried
(default “arrival”, which is not currently part of the stock</p>
<blockquote>
<div><p>mspass schema.   Note it isn’t required to be in the schema
and illustrates flexibility’).</p>
</div></blockquote>
</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find_one will fail.
Default [“phase”,”time”].</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is None</p></li>
<li><p><strong>type</strong> – list of strings defining collection keyes</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
<li><p><strong>require_unique_match</strong> (<em>boolean</em>) – boolean handling of ambiguous matches.
When True find_one will throw an error if an entry is tries to match
is not unique.  When False find_one returns the first document
found and logs a complaint message.  (default is False)</p></li>
<li><p><strong>ensemble_starttime_key</strong> (<em>string</em>) – defines the key used to fetch a
start time for the interval test when processing with ensemble data.
Default is “starttime”.</p></li>
<li><p><strong>ensemble_endtime_key</strong> (<em>string</em>) – defines the key used to fetch a
end time for the interval test when processing with ensemble data.
Default is “endtime”.</p></li>
<li><p><strong>query</strong> (<em>python dictionary</em><em> or </em><em>None.  None is equivalewnt to
passing an empty dictionary.  A TypeError will be thrown if this
argument is not None</em><em> or </em><em>a dict.</em>) – optional query predicate.  That is, if set the
interval query is appended to this query to build a more specific
query.   An example might be station code keys to match a
specific pick for a specific station like {“sta”:”AAK”}.
Default is None.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ArrivalMatcher.subset">
<span class="sig-name descname"><span class="pre">subset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ArrivalMatcher.subset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ArrivalMatcher.subset" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementation of method required by superclass
DataFramematcher</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.BasicMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">BasicMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#BasicMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.BasicMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Base class defining the api for a generic matching capability for
MongoDB normalization.   The base class is a skeleton that
defines on required abstract methods and initializes a set of
universal attributes all matchers need.  It cannot be instatiated directly.</p>
<p>Matching is defined as one of two things:  (1)  a one-to-one
match algorithm is guaranteed to have each search yield either
exactly one match or none.  That is defined through a find_one
method following the same concept in MongoDB.  (2) some
matches are not unique and yield more than one document.
For that case use the find method.  Unlike the MongoDB
find method, however, find in this context returns a list of
Metadata containers holding the set of attributes requested
in lists defined on constuction.</p>
<p>Another way of viewing this interface, in fact, is an abstraction of
the find and find_one methods of MongoDB to a wider class of
algorithms that may or may not utilize MongoDB directly.
In particular, intermediate level classes defined below that implement
different cache data structures allow input either by
loading data from a MongoDB collection of from a pandas DataFrame.
That can potentially provide a wide variety of applications of
matching data to tabular data contained in files loaded into
pandas by any of long list of standard dataframe read methods.
Examples are any SQL database or antelope raw tables or views
loaded as text files.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.BasicMatcher.find">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#BasicMatcher.find"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.BasicMatcher.find" title="Permalink to this definition"></a></dt>
<dd><p>Abstraction of the MongoDB database find method with the
matching criteria defined when a concrete instance is instantiated.
Like the MongoDB method implementations it should return a list
of containers matching the keys found in the data passed through
the mspass_object.  A key difference from MongoDB, however, is
that instead of a MongoDB cursor we return a python list of Metadata
containers.   In some instances that is a
direct translation of a MongoDB cursor to a list of Metadata
objects.  The abstraction is useful to allow small collections
to be accessed faster with a generic cache algorithm (see below)
and loading of tables of data through a file-based subclass
of this base.  All can be treated through a common interface.
WE STRESS STRONGLY that the abstraction assumes returns are
always small enough to not cause a memory bloating problem.
If you need the big-memory model of a cursor use it directly.</p>
<p>All subclasses must implement this virtual
method to be concrete or they cannot be instantiated.
If the matching algorithm implemented is always expected to
be a unique one-to-one match applications may want to have this
method throw an exception as a use error.  That case should
use the find_one interface defined below.</p>
<p>All implementations should return a pair (2 component tuple).
0 is expected to hold a list of Metadata containers and
1 is expected to contain either a None type or an PyErrorLogger
object.   The PyErrorLogger is a convenient way to pass error
messages back to the caller in a manner that is easier to handle
with the MsPASS error system than an exception mechanism.
Callers should handle four cases that are possible for a return
(Noting [] means an empty list and […] a list with data)</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>[]  None  - notmatch found</p></li>
<li><p>[] ErrorLog - failure with an informational message in the</p></li>
</ol>
<blockquote>
<div><p>ErrorLog that should be preserved.  The presence of an error
should imply something went wrong and it was simply a null result.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>[…] None - all is good with no detected errors</p></li>
<li><p>[…] ErrorLog - valid data returned but there is a warning
or informational message posted.  In this case handlers
may want to examine the ErrorSeverity components of the log
and handle different levels differently  (e.g. Fatal and
Informational should always be treated differently)</p></li>
</ol>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.BasicMatcher.find_one">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#BasicMatcher.find_one"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.BasicMatcher.find_one" title="Permalink to this definition"></a></dt>
<dd><p>Abstraction of the MongoDB database find_one method with the
matching criteria defined when a concrete instance is instantiated.
Like the MongoDB method implementations should return the
unique document that the keys in mspass_object are expected
to define with the matching criteria defined by the instance.
A type example of an always unique match is ObjectIds.
When a match is found the result should be returned in a
Metadata container.  The attributes returned are normally
a subset of the document and are defined by the base class
attributes “attributes_to_load” and “load_if_defined”.
For database instances this is little more than copying
desired attributes from the matching document returned by
MongoDB, but for abstraction more may be involved.
e.g., implemented below is a generic cached algorithm that
stores a collection to be matched in memory for efficiency.
That implementation allows the “collection” to be loaded from
MongoDB or a pandas DataFrame.</p>
<p>All implementations should return a pair (2 component tuple).
0 is expected to hold a Metadata containers that was yielded by
the match.  It should be returned as None if there is no match.
1 is expected to contain either a None type or an PyErrorLogger
object.   The PyErrorLogger is a convenient way to pass error
messages back to the caller in a manner that is easier to handle
with the MsPASS error system than an exception mechanism.
Callers should handle four cases that are possible for a return:</p>
<blockquote>
<div><p>1, None  None  - no match found
2. None ErrorLog - failure with an informational message in the</p>
<blockquote>
<div><p>ErrorLog that the caller may want be preserved or convert to
an exception.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Metadata None - all is good with no detected errors</p></li>
<li><p>Metadata ErrorLog - valid data was returned but there is a warning
or informational message posted.  In this case handlers
may want to examine the ErrorSeverity components of the log
and handle different levels differently  (e.g. Fatal and
Informational should always be treated differently)</p></li>
</ol>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DataFrameCacheMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">DataFrameCacheMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_or_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_null_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DataFrameCacheMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DataFrameCacheMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.BasicMatcher" title="mspasspy.db.normalize.BasicMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicMatcher</span></code></a></p>
<p>Matcher implementing a caching method based on a Pandas DataFrame</p>
<p>This is an intermediate class for instances where the database collection
to be matched is small enough that the in-memory model is appropriate.
It should be used when the matching algorithm is readily cast into the
subsetting api of a pandas DataFrame.</p>
<p>The constructor of this intermediate class first calls the BasicMatcher
(base class) constructor to initialize some common attribute including
the critical lists of attributes to be loaded.   This constructor then
creates the internal DataFrame cache by one of two methods.
If arg0 is a MongoDB database handle it loads the data in the
named collection to a DataFrame created during construction.  If the
input is a DataFrame already it is simply copied selecting only
columns defined by the attributes_to_load and load_if_defined lists.
There is also an optional parameter, custom_null_values, that is a
python dictionary defining values in a field that should be treated
as a definition of a Null for that field.  The constuctor converts
such values to a standard pandas null field value.</p>
<p>This class implements generic find and find_one methods.
Subclasses of this class must implement a “subset” method to be
concrete.  A subset method is the abstract algorithm that defines
a match for that instance expressed as a pandas subset operation.
(For most algorithms there are multiple ways to skin that cat or is</p>
<blockquote>
<div><p>it a panda?)  See concrete subclasses for examples.</p>
</div></blockquote>
<p>This class cannot be instantiated because it is not concrete
(has abstract - virtual - methods that must be defined by subclasses)
See implementations for constructor argument definitions.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DataFrameCacheMatcher.find">
<span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DataFrameCacheMatcher.find"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DataFrameCacheMatcher.find" title="Permalink to this definition"></a></dt>
<dd><p>DataFrame generic implementation of find method.</p>
<p>This method uses content in any part of the mspass_object
(data object) to subset the internal DataFrame cache to
return subset of tuples matching some condition defined
computed through the abstract (virtual) methdod subset.
It then copies entries in attributes_to_load and when not
null load_if_defined into one Metadata container for each
row of the returned DataFrame.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DataFrameCacheMatcher.find_one">
<span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DataFrameCacheMatcher.find_one"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DataFrameCacheMatcher.find_one" title="Permalink to this definition"></a></dt>
<dd><p>DataFrame implementation of the find_one method.</p>
<p>This method is mostly a wrapper around the find method.
It calls the find method and then does one of two thing s
depending upon the value of self.require_unique_match.
When that boolean is True if the match is not unique it
creates an PyErrorLogger object, posts a message to the log,
and then returns a [Null,elog] pair.  If self.require_unique_match
is False and the match is not ambiguous, it again creates an
PyErrorLogger and posts a message, but it also takes the first
container in the list returned by find and returns in as
component 0 of the pair.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DataFrameCacheMatcher.subset">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">subset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DataFrameCacheMatcher.subset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DataFrameCacheMatcher.subset" title="Permalink to this definition"></a></dt>
<dd><p>Required method defining how the internal DataFrame cache is
to be subsetted using the contents of the data object
mspass_object.   Concrete implementation must implement this class.
The point of this abstract method is that the way one defines
how to get the information needed to define a match with the
cache is application dependent.  An implementation can use Metadata
attributes, data object attributes (e.g. TimeSeries t0 attribute),
or even sample data to compute a value to use in DataFrame
subset condition.   This simplifies writing a custom matcher to
implementing only this method as find and find_one use it.</p>
<p>Implementations should return a zero length DataFrame if the
subset condition yields a null result.  i.e. the test
len(return_result) should work and return 0 if the subset
produced no rows.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DatabaseMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">DatabaseMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DatabaseMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DatabaseMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.BasicMatcher" title="mspasspy.db.normalize.BasicMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicMatcher</span></code></a></p>
<p>Matcher using direct database queries to MongoDB.   Each call to
the find method of this class constructs a query, calls the MongoDB
database find method with that query, and extracts desired attributes
from the return in the form of a Metadata container.  The query
construction is abstracted by a virtual method called query_generator.
This is an intermediate class that cannot be instantiated directly
because it contains a virtual method.   User’s should consult
docstrings for constructors for subclasses of this intermediate class.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DatabaseMatcher.find">
<span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DatabaseMatcher.find"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DatabaseMatcher.find" title="Permalink to this definition"></a></dt>
<dd><p>Generic database implementation of the find method for this
abstraction.   It returns what the base class api specifies.
That is, normally it returns a tuple with component 0 being
a python list of Metadata containers.  Each container holds
the subset of attributes defined by attributes_to_load and
(if present) load_if_defined.  The list is the set of all
documents matching the query, which at this level of the class
structure is abstract.</p>
<p>The method dogmatically requires data for all keys
defined by attributes_to_load.  It will throw a MsPASSError
exception with a Fatal tag if any of the required attributes
are not defined in any of the documents.  The return matches
the API specification for BasicMatcher.</p>
<p>It also handles failures of the abstract query_generator
through the mechanism the base class api specified:  a None
return means the method could not create a valid query.
Failures in the query will always post a message to elog
tagging the result as “Invalid”.</p>
<p>It also handles the common problem of dead data or accidentally
receiving invalid data like a None.   The later may cause other
algorithms to abort, but we handle it here return [None,None].
We don’t return an PyErrorLogger in that situation as the assumption
is there is no place to put it and something else has gone really
wrong.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DatabaseMatcher.find_one">
<span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DatabaseMatcher.find_one"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DatabaseMatcher.find_one" title="Permalink to this definition"></a></dt>
<dd><p>Generic database implementation of the find_one method.  The tacit
assumption is that if you call find_one you are expecting a unique
match to the algorithm implemented.  The actual behavior for a
nonunique match is controlled by the class attribute
require_unique_match.  Subclasses that want to dogmatically enforce
uniqueness (appropriate for example with ObjectIds) should
set require_unique_match True.   In that case if a match is not
unique the method will throw an exception.  When False, which is
the default, an informational message is posted and the method
returns the first list element returned by find.  This method is
actually little more than a wrapper around find to handle that
uniqueness issue.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DatabaseMatcher.query_generator">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">query_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DatabaseMatcher.query_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DatabaseMatcher.query_generator" title="Permalink to this definition"></a></dt>
<dd><p>Subclasses of this intermediate class MUST implement this
method.  It should extract content from mspass_object and
use that content to generate a MongoDB query that is
passed directly to the find method of the MongoDB database
handle stored within this object (self) during
the class construction.  Since pymongo uses a
python dict for that purpose it must return a valid
query dict.  Implementations should return None if no
query could be generated.  Common, for example, if a key
required to generate the query is missing from mspass_object.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DictionaryCacheMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">DictionaryCacheMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_or_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dataframe_index_as_cache_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DictionaryCacheMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DictionaryCacheMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.BasicMatcher" title="mspasspy.db.normalize.BasicMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicMatcher</span></code></a></p>
<p>Matcher implementing a caching method based on a python dictionary.</p>
<p>This is an intermediate class for instances where the database collection
to be matched is small enough that the in-memory model is appropriate.
It should also only be used if the matching algorithm can be reduced
to a single string that can serve as a unique id for each tuple.</p>
<p>The class defines a generic dictionary cache with a string key.   The way that
key is define is abstracted through two virtual methods:
(1) The cache_id method creates a match key from a mspass data object.</p>
<blockquote>
<div><p>That is normally from the Metadata container but it is not
restricted to that. e.g. start time for TimeSeries or
Seismogram objects can be obtained from the t0 attribute
directly.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>The db_make_cache_id is called by the internal method of this
intermediate class (method name is _load_normalization_cache)
to build the cache index from MongoDB documents scanned to
construct the cache.</p></li>
</ol>
<p>Two different methods to define the cache index are necessary as a
generic way to implement aliases.  A type example is the mspass use
of names like “channel_id” to refer to the ObjectId of a specific
document in the channel collection.   When loading channel the name
key is “_id” but data objects would normally have that same data
defined with the key “channel_id”.   Similarly, if data have had
aliases applied a key in the data may not match the name in a
collection to be matched.   The dark side of this is it is very
easy when running subclasses of this to get null results with
all members of a dataset.   As always testing with a subset of
data is strongly recommended before running versions of this on
a large dataset.</p>
<p>This class cannot be instantiated because it is not concrete
(has abstract - virtual - methods that must be defined by subclasses)
See implementations for constructor argument definitions.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DictionaryCacheMatcher.cache_id">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cache_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DictionaryCacheMatcher.cache_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DictionaryCacheMatcher.cache_id" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementations must implement this method to define
how a mspass data object, mspass_object, is to be used to
construct the key to the cache dict container.   It is
distinct from db_make_cache_id to allow differences in naming
or even the algorithm used to construct the key from a datum
relative to the database.  This complicates the interface but
makes it more generic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> – is expected to be a MsPASS object.
Any type restrictions should be implemented in subclasses
that implement the method.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>should always return a valid string and never throw
an exception.  If the algorithm fails the implementation should
return a None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DictionaryCacheMatcher.db_make_cache_id">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">db_make_cache_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DictionaryCacheMatcher.db_make_cache_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DictionaryCacheMatcher.db_make_cache_id" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementation must implement this method to define how
the cache index is to be created from database documents passed
through the arg doc, which pymongo always returns as a python dict.
It is distinct from cache_id to allow differences in naming or
the algorithm for loading the cache compared to accessing it
using attributes of a data object.   If the id string cannot
be created from doc an implementation should return None.
The generic loaders in this class, db_load_normalization_cache
and df_load_normalization_class, handle that situation cleanly
but if a subclass overrides the load methods they should handle
such errors.  “cleanly” in this case means they throw an
exception which is appropriate since they are run during construction
and any invalid key is not acceptable in that situation.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DictionaryCacheMatcher.find">
<span class="sig-name descname"><span class="pre">find</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DictionaryCacheMatcher.find"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DictionaryCacheMatcher.find" title="Permalink to this definition"></a></dt>
<dd><p>Generic implementation of find method for cached tables/collections.</p>
<p>This method is a generalization of the MongoDB database find method.
It differs in two ways. First, it creates the “query” directly from
a MsPASS data object (pymongo find requires a dict as input).
Second, the result is return as a python list of Metadata containers
containing what is (usually) a subset of the data stored in the
original collection (table).   In contrast pymongo database find
returns a database “Cursor” object which is their implementation of
a large list that may exceed the size of memory.  A key point is
the model here makes sense only if the original table itself is small
enough to not cause a memory problem.  Further, find calls that
yield long list may cause efficiency problems as subclasses that
build on this usually will need to do a linear search through the
list if they need to find a particular instance (e.g. call to find_one).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> (<em>must be a valid MsPASS data object.
currently that means TimeSeries</em><em>, </em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><em>Seismogram</em></a><em>, </em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><em>TimeSeriesEnsemble</em></a><em>,
or </em><em>SeismogramEnsemble.   If it is anything else</em><em> (</em><em>e.g. None</em><em>)
</em><em>this method will return a tuple</em><em> [</em><em>None</em><em>, </em><em>elog</em><em>] </em><em>with elog being
a PyErrorLogger with a posted message.</em>) – data object to match against
data in cache (i.e. query).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>tuple with two elements.  0 is either a list of valid Metadata
container(s) or None and 1 is either None or an PyErrorLogger object.
There are only two possible returns from this method:</p>
<blockquote>
<div><p>[None, elog] - find failed.  See/save elog for why it failed.
[ [md1, md2, …, mdn], None] - success with 0 a list of Metadata</p>
<blockquote>
<div><p>containing attributes_to_load and load_if_defined
(if appropriate) in each component.</p>
</div></blockquote>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.DictionaryCacheMatcher.find_one">
<span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#DictionaryCacheMatcher.find_one"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.DictionaryCacheMatcher.find_one" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of find for generic cached method.   It uses the cache_id
method to create the indexing string from mspass_object and then returns
a match to the cache stored in self.  Only subclasses of this
intermediate class can work because the cache_id method is
defined as a pure virtual method in this intermediate class.
That construct is used to simplify writing additional matcher
classes.  All extensions need to do is define the cache_id
and db_make_cache_id algorithms to build that index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> – Any valid MsPASS data object.  That means
TimeSeries, Seismogram, TimeSeriesEnsemble, or SeismogramEnsemble.
This datum is passed to the (abstract) cache_id method to
create an index string and the result is used to fetch the
Metadata container matching that key.   What is required of the
input is dependent on the subclass implementation of cache_id.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>2-component tuple following API specification in BasicMatcher.
Only two possible results are possible from this implementation:</p>
<blockquote>
<div><dl class="simple">
<dt>None ErrorLog - failure with an error message that can be passed on</dt><dd><p>if desired or printed</p>
</dd>
<dt>Metadata None - all is good with no detected errors.  The Metadata</dt><dd><p>container holds all attributes_to_load and any defined
load_if_defined values.</p>
</dd>
</dl>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.EqualityDBMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">EqualityDBMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_keys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#EqualityDBMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.EqualityDBMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DatabaseMatcher" title="mspasspy.db.normalize.DatabaseMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseMatcher</span></code></a></p>
<p>Database equivalent of EqualityMatcher.</p>
<p>param db:  MongoDB database handle  (positional - no default)
:type db: normally a MsPASS Database class but with this algorithm</p>
<blockquote>
<div><p>it can be the superclass from which Database is derived.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be queried.
This arg is required by the constructor and has not default.</p></li>
<li><p><strong>match_keys</strong> (<em>python dictionary</em>) – python dict of keys that are to be used for
the equality match.  The dict is used as an alias mechanism allowing
different keys to be used for the Metadata container in data to
be tested relative to the keys used in the database for the same
attribute.  (a typical common example would be something like
“source_lat” in the data matching “lat” in the source collection).
The key for each entry in this dict is taken as the key for the
data side (mspass_object) and the value assigned to that key
in this input is taken as the mongoDB/DataFrame key.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents.</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find will fail.  There is no default for this class
and the list must be defined as arg3.</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is to add load no
optional data.</p></li>
<li><p><strong>type</strong> – list of strings defining collection keys</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.  Default is False.</p></li>
<li><p><strong>require_unique_match</strong> (<em>boolean</em>) – boolean handling of ambiguous matches.
When True find_one will throw an error if an entry is tries to match
is not unique.  When False find_one returns the first document
found and logs a complaint message.  (default is False)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.EqualityDBMatcher.query_generator">
<span class="sig-name descname"><span class="pre">query_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#EqualityDBMatcher.query_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.EqualityDBMatcher.query_generator" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of required method for this class.  It simply
applies an equality test for all the keys defined by the values
in the self.match_keys dict.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.EqualityMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">EqualityMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_or_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">match_keys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_null_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#EqualityMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.EqualityMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DataFrameCacheMatcher" title="mspasspy.db.normalize.DataFrameCacheMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrameCacheMatcher</span></code></a></p>
<p>Match with an equality test for the values of one or more keys
with possible aliasing between data keys and database keys.</p>
<p>This class can be used for matching a set of keys that together
provide a unique matching capability.   Note the keys are
applied sequentially to reduce the size of internal DataFrame
cache in stages.  If the DataFrame is large it may improve performance
if the most unique key in a series appears first.</p>
<p>A special feature of the implementation is that we allow
what is best thought of as reverse aliasing for the keys to
be used for matching.   That is, the base class of this family
has an attribute self.aliases that allow mapping from collection names
to data object names.  The match_keys parameter here is done in
the reverse order.  That is, the key of the match_keys dictionary
is the data object key while the value associated with that key
is the DataFrame column name to match.  The constructor of the
class does a sanity check to verify the two are consistent.
The constructor will throw an exception if the two dictionaries
are inconstent.  Note that means if you use an actual alias through
match_keys (i.e. the key and value are different) you must define
the aliases dictionary with the same combination reversed.
(e.g.  matchkeys={“KSTA”:”sta”} requires aliases={“sta”:”KSTA”})</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db_or_df</strong> (<em>MongoDB database handle</em><em> or </em><em>pandas DataFrame.</em>) – MongoDB database handle or a pandas DataFrame.
Most users will use the database handle version.   In that case
the collection argument is used to determine what collection is
loaded into the cache.   If using a DataFrame is used the
collection name is only a tag defined by the user.   For a
DataFrame a column index is required that contains at least
the attributes defined in attribute_to_load.</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – When using database input this is expected to be
a string defining a valid MongoDB collection with documents that are
to be scanned and loaded into the internal cache.  With DataFrame input
this string is only a tag.  It is relevant then only if the
prepend_collection_name boolean is set True.  There is no default
for this parameter so it must be specified as arg 1.</p></li>
<li><p><strong>match_keys</strong> (<em>python dictionary</em>) – python dict of keys that are to be used for
the equality match.  The dict is used as an alias mechanism allowing
different keys to be used for the Metadata container in data to
be tested relative to the keys used in the database for the same
attribute.  (a typical common example would be something like
“source_lat” in the data matching “lat” in the source collection).
The key for each entry in this dict is taken as the key for the
data side (mspass_object) and the value assigned to that key
in this input is taken as the mongoDB/DataFrame key.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find will fail.   There is currently no default for
this parameter and it must be defined as arg 3.</p></li>
<li><p><strong>query</strong> (<em>python dictionary.</em>) – optional query to apply to collection before loading
data from the database.  This parameter is ignored if the input
is a DataFrame.  A common use would be to reduce the size of the
cache by using a time range limit on station metadata to only
load records relevant to the dataset being processed.  This
parameter is currently ignored for DataFrame input as we assume
pandas subsetting would be used for the same functionality
in the workflow prior to calling the class constructor for this object.</p></li>
<li><p><strong>load_if_defined</strong> (<em>list</em><em> of </em><em>strings defining collection keys</em>) – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default resolves to an empty list.
Note this parameter is ignored for DataFrame input.</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  Default is
False.</p></li>
<li><p><strong>require_unique_match</strong> (<em>boolean</em>) – boolean handling of ambiguous matches.
When True find_one will throw an error if an entry is tries to match
is not unique.  When False find_one returns the first document
found and logs a complaint message.  (default is True)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.EqualityMatcher.subset">
<span class="sig-name descname"><span class="pre">subset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#EqualityMatcher.subset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.EqualityMatcher.subset" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementation of this virtual method of DataFrameMatcher
for this class.</p>
<p>The subset is done sequentially driven by the order key order
of the self.match_keys dictionary.   i.e. the algorithm uses
the row reduction operation of a dataframe one key at a time.
An implementation detail is that there may be a more clever way
instead create a single conditional clause to pass to the
DataFrame operator [] combining the key matches with “and”.
That would likely improve performance, particulary on large tables.
Note the alias is applied using the self.match_keys.  i.e. one
can have different keys on the left (mspass_data side is the
match_keys dictionary key) than the right (dataframe column name).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> – Any valid mspass data object with a</p>
</dd>
</dl>
<p>Metadata container.  The container must contain all the
required match keys or the function will return an error condition
(see below)
:type mspass_object:  TimeSeries, Seismogram, TimeSeriesEnsemble</p>
<blockquote>
<div><p>or SeismogramEnsemble object</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>DataFrame containing all data satisying the match
series of match conditions defined on construction.  Silently
returns a zero length DataFrame if is no match.   Be warned
two other situations can cause the return to have no data:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>dead input, and (2) match keys missing from mspass_object.</p></li>
</ol>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedDBMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">MiniseedDBMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'channel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['starttime',</span> <span class="pre">'endtime',</span> <span class="pre">'lat',</span> <span class="pre">'lon',</span> <span class="pre">'elev',</span> <span class="pre">'_id']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedDBMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedDBMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DatabaseMatcher" title="mspasspy.db.normalize.DatabaseMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseMatcher</span></code></a></p>
<p>Database implementation of matcher for miniseed data using
SEED keys net:sta:chan(channel only):loc and a time interval test.
Miniseed data uses the exessively complex key that combines four unique
string names (net, sta, chan, and loc) and a time interval
of operation to define a unique set of station metadata for each
channel.  In mspass we also create the site collection without the
chan attribute.  This implementation works for both channel and
site under control of the collection argument.</p>
<p>This case is the complete opposite of something like the ObjectId
matcher above as the match query we need to generate is
excessively long requiring up to 6 fields.</p>
<p>The default collection name is channel which is the only
correct use if applied to data created through readers applied to
wf_miniseed.   The implementation can also work on Seismogram
data if and only if the channel argument is then set to “site”.
The difference is that for Seismogram data “chan” is a
undefined concept.  In both cases the keys and content assume the mspass
schema for the channel or site collections.  The constructor will
throw a MsPASSError exception if the collection argument is
anything but “channel” or “site” to enforce this limitation.
If you use a schema other than the mspass schema the methods in
this class will fail if you change any of the following keys:</p>
<blockquote>
<div><p>net, sta, chan, loc, starttime, endtime, hang, vang</p>
</div></blockquote>
<p>Users should only call
the find_one method for this application.   The find_one algorithm
first queries for any matches of net:sta:chan(channel only):loc(optional) and
data t0 within the startime and endtime of the channel document
attributes (an interval match).  That combination should yield
either 1 or no matches if the channel collection is clean.
However, there are known issues with station metadata that can
cause multiple matches in unusual cases (Most notably overlapping
time intervals defined for the same channel.)  The find_one method
will handle that case returning the first one found and posting an
error message that should be handled by the caller.</p>
<p>Instantiation of this class is a call to the superclass
constructor with specialized defaults and wrapper code to
automatically handle potential mismatches between site and channel.
The arguments for the constructor follow:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be queried
The default is “channel”.  Use “site” for Seismogram data.
Use anything else at your own risk
as the algorithm depends heavily on mspass schema definition
and properties guaranteed by using the converter from obspy
Inventory class loaded through web services or stationml files.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – <p>list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find will fail.
Default [“_id”,”lat”,”lon”,”elev”,”hang”,”vang”]</p>
<blockquote>
<div><p>”hang”,”vang”,”starttime”,”endtime”]</p>
</div></blockquote>
<p>when collection is set as channel.  Smaller list of
[“_id”,”lat”,”lon”,”elev”] is</p>
<blockquote>
<div><p>default when collection is set as “site”.</p>
</div></blockquote>
</p></li>
<li><p><strong>load_if_defined</strong> (<em>list</em><em> of </em><em>strings defining collection keys</em>) – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is [“loc”].   A common
addition here may be response data (see schema definition for keys)</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedDBMatcher.find_one">
<span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedDBMatcher.find_one"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedDBMatcher.find_one" title="Permalink to this definition"></a></dt>
<dd><p>We overload find_one to provide the unique match needed.
Most of the work is done by the query_generator method in
this case.  This method is little more than a wrapper to
run the find method and translating the output into the
slightly different form required by find_one.   More important
is the fact that the wrapper implements two safties to make the
code more robust:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>It immediately tests that mspass_object is a valid TimeSeries
or Seismogram object. It will raise a TypeError exception
if that is not true.  That is enforced because find_one
in this context make sense only for atomic objects.</p></li>
<li><p>It handles dead data cleanly logging a message complaining
that the data was already marked dead.</p></li>
</ol>
</div></blockquote>
<p>In addition note the find method this calls is assumed to handle
the case of failures in the query_generator function if any of the
required net, sta, chan keys are missing from mspass_object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedDBMatcher.query_generator">
<span class="sig-name descname"><span class="pre">query_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedDBMatcher.query_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedDBMatcher.query_generator" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementation of (required) abstract method defined
in superclass DatabaseMatcher.  It generates the complex query
for matching net, sta, chan, and optional loc along with the
time interval match of data start time between the channel
defined “starttime” and “endtime” attributes.</p>
<p>This method provides one safety for a common data problem.
A common current issue is that if miniseed data are saved
to wf_TimeSeries and then read back in a later workflow
the default schema will alter the keys for net, sta, chan,
and loc to add the prefix “<a href="#id12"><span class="problematic" id="id13">READONLY_</span></a>” (e.g. READONLY_net).
The query automatically tries to recover any of the
station name keys using that recipe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> – <p>assumed to be a TimeSeries object
with net, sta, chan, and (optional) loc defined.
The time for the time interval test is translation to
MongoDB syntax of:</p>
<blockquote>
<div><p>channel[“starttime”] &lt;= mspass_object.to &lt;= channel[“endtime”]
This algorithm will abort if the statement mspass_object.t0
does not resolve, which means the caller should assure
the input is a TimeSeries object.</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>normal return is a string defining the query.
If any required station name keys are not defined the
method will silently return a None.  Caller should handle
a None condition.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">MiniseedMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'channel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['starttime',</span> <span class="pre">'endtime',</span> <span class="pre">'lat',</span> <span class="pre">'lon',</span> <span class="pre">'elev',</span> <span class="pre">'_id']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DictionaryCacheMatcher" title="mspasspy.db.normalize.DictionaryCacheMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DictionaryCacheMatcher</span></code></a></p>
<p>Cached version of matcher for miniseed station/channel Metadata.</p>
<p>Miniseed data require 6 keys to uniquely define a single channel
of data (5 at the Seismogram level where the channels are merged).
A further complication for using the DictionaryCacheMatcher interface is
that part of the definition is a UTC time interval defining when the
metadata is valid.  We handle that in this implementation by
implementing a two stage search algorithm for the find_one method.
First, the cache index is defined by a unique string created from
the four string keys of miniseed that the MsPASS default schema
refers to with the keywords net, sta, chan, and loc.
At this point in time we know of no examples of a seismic instrument
where the number of distinct time intervals with different Metadata
are huge so the secondary search is a simple linear search through
the python list return by the generic find method using only the
net, sta, chan, and loc keys as the index.</p>
<p>The default collection name is channel which is the only
correct use if applied to data created through readers applied to
wf_miniseed.   The implementation can also work on Seismogram
data if and only if the channel argument is then set to “site”.
The difference is that for Seismogram data “chan” is a
undefined concept.  In both cases the keys and content assume the mspass
schema for the channel or site collections.  The constructor will
throw a MsPASSError exception if the collection argument is
anything but “channel” or “site” to enforce this limitation.
If you use a schema other than the mspass schema the methods in
this class will fail if you change any of the following keys:</p>
<blockquote>
<div><p>net, sta, chan, loc, starttime, endtime, hang, vang</p>
</div></blockquote>
<p>Users should only call the find_one method for this application.
The find_one method here overrides the generic find_one in the
superclass DictionaryCacheMatcher.  It implements the linear search for a
matching time interval test as noted above.  Note also this
class does not support Ensembles directly.   Matching instrument
data is by definition what we call atomic. If you are processing
ensembles you will need to write a small wrapper function that
would run find_one and handle the out looping over each member of
the ensemble.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>mspass Database handle</em><em>(</em><a class="reference internal" href="#mspasspy.db.database.Database" title="mspasspy.db.database.Database"><em>mspasspy.db.database.Database</em></a><em>)</em><em>.</em>) – MongoDB database handle containing collection to be loaded.</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be queried
The default is “channel”.  Use “site” for Seismogram data.
Use anything else at your own risk
as the algorithm depends heavily on the mspass schema definition
and properties guaranteed by using the converter from obspy
Inventory class loaded through web services or stationml files.</p></li>
<li><p><strong>query</strong> (<em>python dictionary.</em>) – optional query to apply to collection before loading
data from the database.  This parameter is ignored if the input
is a DataFrame.  A common use would be to reduce the size of the
cache by using a time range limit on station metadata to only
load records relevant to the dataset being processed.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – <p>list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find will fail.
Default [“_id”,”lat”,”lon”,”elev”,”hang”,”vang”]</p>
<blockquote>
<div><p>”hang”,”vang”,”starttime”,”endtime”]</p>
</div></blockquote>
<p>when collection is set as channel.  Smaller list of
[“_id”,”lat”,”lon”,”elev”] is
default when collection is set as “site”.  In either case the
list MUST contain “starttime” and “endtime”.  The reason is the
linear search step will always use those two fields in the linear
search for a time interval match. Be careful in how endtime is defined
that resolves to an epoch time in the distant future and not some
null database attribute; a possible scenario with DataFrame
input but not a concern if using mspass loaders from StationML data.</p>
<p>Note there is also an implicit assumption that the keys “net” and
“sta” are always defined.  “chan” must also be defined if the
collection name is “channel”.  “loc” is handled as optional for
database input but required if the input is via a Dataframe
because we use the same cache id generator for all cases.</p>
</p></li>
<li><p><strong>load_if_defined</strong> (<em>list</em><em> of </em><em>strings defining collection keys</em>) – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is [“loc”].   A common
addition here may be response data (see schema definition for keys)</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedMatcher.cache_id">
<span class="sig-name descname"><span class="pre">cache_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedMatcher.cache_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedMatcher.cache_id" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementations of this required method.  The cache_id
in this algorithm is a composite key made from net, sta, chan, and
loc with a fixed separator string of “_”.  A typical example
is <a href="#id14"><span class="problematic" id="id15">IU_AAK_BHZ_00_</span></a>.</p>
<p>An added feature to mesh with MsPASS conventions is a safety
for attributes that are automatically renamed when saved
that are marked readonly in the schema.   Such attributes
have a prepended tag, (at this time “<a href="#id16"><span class="problematic" id="id17">READONLYERROR_</span></a>”).  If
one of the required keys for the index is missing (e.g. “net”)
the function tries to then fetch the modified name
(e.g. “READONLYERROR_net”).  If that also fails it returns
a None as specified by the API.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> – mspass object to be matched with cache.
Must contain net, sta fpr site matching and net, sta, and
chan for the channel collection. If loc is not defined for
any case an emtpy string in defined an the key has two
trailing separator characters (e.g. <a href="#id5"><span class="problematic" id="id6">IU_AAK_BHZ__</span></a>)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>normal return is a string that can be used as an index string.
If any of the required keys is missing it will return a None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedMatcher.db_make_cache_id">
<span class="sig-name descname"><span class="pre">db_make_cache_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedMatcher.db_make_cache_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedMatcher.db_make_cache_id" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementations of this required method.  The cache_id
in this algorithm is a composite key made from net, sta, chan, and
loc with a fixed separator string of “_”.  A typical example
is <a href="#id18"><span class="problematic" id="id19">IU_AAK_BHZ_00_</span></a>.  This method creates this string from
a MongoDB document assumed passed through a python dictionary
as argument doc.  Unlike the cache_id method this function
does not have a safety for readonly errors.  The reason is that
it is designed to be used only while loading the cache from
site or channel documents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>doc</strong> – python dict containing a site or channel document.
Must contain net, sta fpr site matching and net, sta, and
chan for the channel collection. If loc is not defined for
any case an emtpy string in defined an the key has two
trailing separator characters (e.g. <a href="#id5"><span class="problematic" id="id7">IU_AAK_BHZ__</span></a>)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>normal return is a string that can be used as an index string.
If any of the required keys is missing it will return a None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedMatcher.find_doc">
<span class="sig-name descname"><span class="pre">find_doc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wfdoc_starttime_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'starttime'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedMatcher.find_doc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedMatcher.find_doc" title="Permalink to this definition"></a></dt>
<dd><p>Optional function to support application to bulk_normalize to
set channel_id or site_id.  Acts like find_one but without support
for readonly recovery.   The bigger difference is that this
method accepts a python dict retrieved in a cursor loop for
bulk_normalize.   Returns the Metadata container that is matched
from the cache.   This uses the same algorithm as the overloaded
find_one above where a linear search is used to handle the time
interval matching.  Here, however, the time field is extracted
from doc with the key defined by starttime.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>doc</strong> (<em>python dictionary - document from MongoDB</em>) – document (pretty much assumed to be from wf_miniseed)
to be matched with channel or site.</p></li>
<li><p><strong>wfdoc_starttime_key</strong> (<em>string</em>) – optional parameter to change the
key used to fetch the start time of waveform data from doc.
Default is “starttime”/</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>matching Metadata container if successful. None if
matching fails for any reason.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.MiniseedMatcher.find_one">
<span class="sig-name descname"><span class="pre">find_one</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#MiniseedMatcher.find_one"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.MiniseedMatcher.find_one" title="Permalink to this definition"></a></dt>
<dd><p>We overload find_one to provide the unique match needed.
The algorithm does a linear search for the first time interval
for which the start time of mspass_object is within the
startime &lt;= t0 &lt;= endtime range of a record stored in
the cache.  This works only if starttime and endtime are
defined in the set of attributes loaded so the constructor
of this class enforces that restriction.   The times in
starttime and endtime are assumed to be defined as epoch
times as the algorithm uses a simple numeric test of the
data start time with the two times.  An issue to watch out
for is endtime not being set to a valid distant time but some
null field that resolves to something that doesn’t work in
a numerical test for &lt; endtime.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> – data to be used for matching against the</p>
</dd>
</dl>
<p>cache.  It must contain the required keys or the matching will
fail.  If the datum is marked dead the algorithm will return
immediately with a None response and an error message that
would usually be dropped by the call in that situation.
:type mspass_object:  must be one of the atomic data types of</p>
<blockquote>
<div><p>mspass (currently TimeSeries and Seismogram) with t0
defined as an epoch time computed from a UTC time stamp.</p>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ObjectIdDBMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">ObjectIdDBMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'channel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['_id',</span> <span class="pre">'lat',</span> <span class="pre">'lon',</span> <span class="pre">'elev',</span> <span class="pre">'hang',</span> <span class="pre">'vang']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ObjectIdDBMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ObjectIdDBMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DatabaseMatcher" title="mspasspy.db.normalize.DatabaseMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseMatcher</span></code></a></p>
<p>Implementation of DatabaseMatcher for ObjectIds.  In this class the virtual
method query_generator uses the mspass convention of using the
collection name and the magic string “_id” as the data object
key (e.g. channel_id) but runs the query using the “_id” magic
string used in MongoDB for the  ObjectId of each document.</p>
<p>Users should only utilize the find_one method of this class as find,
by definition, will always return only one record or None.
The find method, in fact, is overloaded and attempts to use it will
result in raising a MsPASSError exception.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be queried
(default “channel”).</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find_one will fail.
Default [“_id”,”lat”,”lon”,”elev”,”hang”,”vang”].</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.</p></li>
<li><p><strong>type</strong> – list of strings defining collection keys</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ObjectIdDBMatcher.query_generator">
<span class="sig-name descname"><span class="pre">query_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ObjectIdDBMatcher.query_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ObjectIdDBMatcher.query_generator" title="Permalink to this definition"></a></dt>
<dd><p>Subclasses of this intermediate class MUST implement this
method.  It should extract content from mspass_object and
use that content to generate a MongoDB query that is
passed directly to the find method of the MongoDB database
handle stored within this object (self) during
the class construction.  Since pymongo uses a
python dict for that purpose it must return a valid
query dict.  Implementations should return None if no
query could be generated.  Common, for example, if a key
required to generate the query is missing from mspass_object.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ObjectIdMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">ObjectIdMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'channel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['_id',</span> <span class="pre">'lat',</span> <span class="pre">'lon',</span> <span class="pre">'elev',</span> <span class="pre">'hang',</span> <span class="pre">'vang']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ObjectIdMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ObjectIdMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DictionaryCacheMatcher" title="mspasspy.db.normalize.DictionaryCacheMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DictionaryCacheMatcher</span></code></a></p>
<p>Implement an ObjectId match with caching.  Most of the code for
this class is derived from the superclass DictionaryCacheMatcher.
It adds only a concrete implementation of the cache_id method
used to construct a key for the cache defined by a python dict
(self.normcache).  In this case the cache key is simply the
string representation of the ObjectId of each document in
the collection defined in construction.   The cache is
then created by the superclass generic method _load_normalization_cache.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be loaded
and cached to memory inside this object (default “channel”)</p></li>
<li><p><strong>query</strong> (<em>python dict with content that defines a valid query
when be passed to MongoDB the MongoDB find method.  If query is
a type other than a None type</em><em> or </em><em>dict the constructor will
throw a TypeError.</em>) – optional query to apply to collection before loading
document attributes into the cache.   A typical example would be
a time range limit for the channel or site collection to
avoid loading instruments not operational during the time span
of a data set.  Default is None which causes the entire collection
to be parsed.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find will fail.
Default [“_id”,”lat”,”lon”,”elev”,”hang”,”vang”]</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.</p></li>
<li><p><strong>type</strong> – list of strings defining collection keys</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – <p>when set true all attributes loaded
from the normalizing collection will have the channel name prepended.
That is essential if the collection contains generic names like “lat”
or “depth” that would produce ambiguous keys if used directly.
(e.g. lat is used for source, channel, and site collections in the</p>
<blockquote>
<div><p>default schema.)</p>
</div></blockquote>
</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ObjectIdMatcher.cache_id">
<span class="sig-name descname"><span class="pre">cache_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ObjectIdMatcher.cache_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ObjectIdMatcher.cache_id" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of virtual method with this name for this matcher.
It implements the MsPASS approach of defining the key for a
normalizing collection as the collection name and the magic
string “_id”  (e.g. channel_id or site_id).   It assumes
the collection name is define as self.collection by the
constructor of the class when it is instantiated.  It attempts
to extract the expanded _id name (e.g. channel_id) from the
input mspass_object.  If successful it returns the string
representation of the resulting (assumed) ObjectId.  If the
key is not defined it returns None as specified by the
superclass api.</p>
<p>It is important to note the class attribute,
self.prepend_collection_name, is indendent of the definition of the
cache_id.  i.e. what we attempt to extract as the id ALWAYS
used the collection name as a prefix (channel_id and not “_id”).
The internal boolean controls if the attributes returned by find_one
will have the collection name prepended.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> (<em>Normally this is expected to be a mspass
data object</em><em> (</em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><em>TimeSeries</em></a><em>, </em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><em>Seismogram</em></a><em>, or </em><em>ensembles</em><em> of </em><em>same</em><em>) </em><em>but
it can be as simple as a python dict</em><em> or </em><em>Metadata with the required
key defined.</em>) – key-value pair container containing an id that is to
be extracted.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string representation of an ObjectId to be used
to matching the cache index stored internally - find method.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.ObjectIdMatcher.db_make_cache_id">
<span class="sig-name descname"><span class="pre">db_make_cache_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">doc</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#ObjectIdMatcher.db_make_cache_id"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.ObjectIdMatcher.db_make_cache_id" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of virtual methods with this name for this matcher.
It does nothing more than extract the magic “_id” value from doc
and returns its string representation.  With MongoDB that means
the string representation of the ObjectId of each collection
document is used as the key for the cache.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>doc</strong> (<em>python dict container returned by pymongo - usually a
cursor component.</em>) – python dict defining a document return by MongoDB.
Only the “_id” value is used.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.OriginTimeDBMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">OriginTimeDBMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'source'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['lat',</span> <span class="pre">'lon',</span> <span class="pre">'depth',</span> <span class="pre">'time']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['magnitude']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_time_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_time_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#OriginTimeDBMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.OriginTimeDBMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DatabaseMatcher" title="mspasspy.db.normalize.DatabaseMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseMatcher</span></code></a></p>
<p>Generic class to match data by comparing a time defined in data to an
origin time using a database query algorithm.</p>
<p>The default behavior of this matcher class is to match data to
source documents based on origin time with an optional time offset.
Conceptually the data model for this matching is identical to conventional
multichannel shot gathers where the start time is usually the origin time.
It is also a common model for downloaded source oriented waveform
segments from FDSN web services with obspy.  Obspy has an example
in their documentation for how to download data defined exactly this way.
In that mode we match each source document that matches a projected
origin time within a specified tolerance. Specifically, let t0
be the start time extracted from the data.  We then compute the
projected, test origin time as test_otime = t0 - t0offset.
Note the sign convention that a positive offset means the time t0
is after the event origin time.   We then select all source
records for which the time field satisifies:</p>
<blockquote>
<div><p>source.time - tolerance &lt;= test_time &lt;= source.time + tolerance</p>
</div></blockquote>
<p>The test_time value for matching from a datum can come through
one of two methods driven by the constructor argument “time_key”.
When time_key is a None (default) the algorithm assumes all input
are mspass atomic data objects that have the start time defined by
the attribute “t0” (mspass_object.t0).  If time_key is a string
it is assumed to be a Metadata key used to fetch an epoch time
to use for the test.   The most likely use of that feature would be
for ensemble processing where test_time is set as a field in the
ensemble Metadata.  Note that form of associating source data to
ensembles that are common source gathers can be much faster than
the atomic version because only one query is needed per ensemble.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be queried
(default “source”).</p></li>
<li><p><strong>t0offset</strong> (<em>float</em>) – constant offset from data start time that is expected
as origin time.  A positive t0offset means the origin time is before
the data start time.  Units are always assumed to be seconds.</p></li>
<li><p><strong>tolerance</strong> (<em>float</em>) – time tolerance to test for match of origin time.
(see formula above for exact use)
If the source estimates are exactly the same as the ones used to
define data start time this number can be a few samples.
Otherwise a few seconds is safter for teleseismic data and
less for local/regional events.  i.e. the choice depends up on
how the source estimates relate to the data.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find_one will fail.   Default is
[“lat”,”lon”,”depth”,”time”]</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is [“magnitude”]</p></li>
<li><p><strong>type</strong> – list of strings defining collection keys</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
<li><p><strong>require_unique_match</strong> (<em>boolean</em>) – boolean handling of ambiguous matches.
When True find_one will throw an error if an entry is tries to match
is not unique.  When False find_one returns the first document
found and logs a complaint message.  (default is False)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.OriginTimeDBMatcher.query_generator">
<span class="sig-name descname"><span class="pre">query_generator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#OriginTimeDBMatcher.query_generator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.OriginTimeDBMatcher.query_generator" title="Permalink to this definition"></a></dt>
<dd><p>Concrete implementation of this required method for a subclass of
DatabaseMatcher.</p>
<p>This algorithm implements the time test described in detail in
docstring for this class.  Note the fundamental change in how the
test time is computed that depends on the internal (self)
attribute time_key.  When None we use the data’s t0 attribute.
Otherwise self.time_key is assumed to be a string key to
fetch the test time from the object’s Metadata container.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mspass_object</strong> (<em>Any valid MsPASS data object.</em>) – MsPASS defined data object that contains
data to be used for this match (t0 attribute or content of
self.time_key).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>query python dictionary on sucess.  Return None if
a query could not be constructed.  That happens two ways here.
(1) If the input is not a valid mspass data object or marked dead.
(2) if the time_key algorithm is used and time_key isn’t defined</p>
<blockquote>
<div><p>in the input datum.</p>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.normalize.OriginTimeMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">OriginTimeMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_or_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'source'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tolerance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attributes_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['lat',</span> <span class="pre">'lon',</span> <span class="pre">'depth',</span> <span class="pre">'time']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_if_defined</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['magnitude']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliases</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_unique_match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prepend_collection_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_time_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_time_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">custom_null_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#OriginTimeMatcher"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.OriginTimeMatcher" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.normalize.DataFrameCacheMatcher" title="mspasspy.db.normalize.DataFrameCacheMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrameCacheMatcher</span></code></a></p>
<p>Generic class to match data by comparing a time defined in data to
an origin time using a cached DataFrame.</p>
<p>The default behavior of this matcher class is to match data to
source documents based on origin time with an optional time offset.
Conceptually the data model for this matching is identical to conventional
multichannel shot gathers where the start time is usually the origin time.
It is also a common model for downloaded source oriented waveform
segments from FDSN web services with obspy.  Obspy has an example
in their documentation for how to download data defined exactly this way.
In that mode we match each source document that matches a projected
origin time within a specified tolerance. Specifically, let t0
be the start time extracted from the data.  We then compute the
projected, test origin time as test_otime = t0 - t0offset.
Note the sign convention that a positive offset means the time t0
is after the event origin time.   We then select all source
records for which the time field satisifies:</p>
<blockquote>
<div><p>source.time - tolerance &lt;= test_time &lt;= source.time + tolerance</p>
</div></blockquote>
<p>The test_time value for matching from a datum can come through
one of two methods driven by the constructor argument “time_key”.
When time_key is a None (default) the algorithm assumes all input
are mspass atomic data objects that have the start time defined by
the attribute “t0” (mspass_object.t0).  If time_key is a string
it is assumed to be a Metadata key used to fetch an epoch time
to use for the test.   The most likely use of that feature would be
for ensemble processing where test_time is set as a field in the
ensemble Metadata.  Note that form of associating source data to
ensembles that are common source gathers can be much faster than
the atomic version because only one query is needed per ensemble.</p>
<p>This implentation should be used only if the catalog of events
is reasonably small.  If the catalog is huge the database version
may be more appropriate.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>db</strong> (<em>normally a MsPASS Database class but with this algorithm
it can be the superclass from which Database is derived.</em>) – MongoDB database handle  (positional - no default)</p></li>
<li><p><strong>collection</strong> (<em>string</em>) – Name of MongoDB collection that is to be queried
(default “source”).</p></li>
<li><p><strong>t0offset</strong> (<em>float</em>) – constant offset from data start time that is expected
as origin time.  A positive t0offset means the origin time is before
the data start time.  Units are always assumed to be seconds.</p></li>
<li><p><strong>tolerance</strong> (<em>float</em>) – time tolerance to test for match of origin time.
(see formula above for exact use)
If the source estimates are exactly the same as the ones used to
define data start time this number can be a few samples.
Otherwise a few seconds is safter for teleseismic data and
less for local/regional events.  i.e. the choice depends up on
how the source estimates relate to the data.</p></li>
<li><p><strong>attributes_to_load</strong> (<em>list</em><em> of </em><em>string defining keys in collection
documents</em>) – list of keys of required attributes that will
be returned in the output of the find method.   The keys listed
must ALL have defined values for all documents in the collection or
some calls to find_one will fail.   Default is
[“lat”,”lon”,”depth”,”time”]</p></li>
<li><p><strong>load_if_defined</strong> – list of keys of optional attributes to be
extracted by find method.  Any data attached to these keys will only
be posted in the find return if they are defined in the database
document retrieved in the query.  Default is [“magnitude”]</p></li>
<li><p><strong>type</strong> – list of strings defining collection keys</p></li>
<li><p><strong>aliases</strong> – python dictionary defining alias names to apply
when fetching from a data object’s Metadata container.   The key sense
of the mapping is important to keep straight.  The key of this
dictionary should match one  of the attributes in attributes_to_load
or load_if_defined.  The value the key defines should be the alias
used to fetch the comparable attribute from the data.</p></li>
<li><p><strong>prepend_collection_name</strong> (<em>boolean</em>) – when True attributes returned in
Metadata containers by the find and find_one method will all have the
collection name prepended with a (fixed) separator.  For example, if
the collection name is “channel” the “lat” attribute in the channel
document would be returned as “channel_lat”.</p></li>
<li><p><strong>require_unique_match</strong> (<em>boolean</em>) – boolean handling of ambiguous matches.
When True find_one will throw an error if an entry is tries to match
is not unique.  When False find_one returns the first document
found and logs a complaint message.  (default is False)</p></li>
<li><p><strong>data_time_key</strong> – data object Metadata key used to fetch</p></li>
</ul>
</dd>
</dl>
<p>time for testing as alternative to data start time.  If set None
(default) the test will use the start time of an atomic data object
for the time test.  If nonzero it is assumed to be a string used
to fetch a time from the data’s Metadata container.  That is the
best way to run this matcher on Ensembles.
:type data_time_key:  string</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source_time_key</strong> – dataframe column name to use as source</p>
</dd>
</dl>
<p>origin time field.   Default is None which is translated to
collection + “_time”  (default default is “source_time”).
:type source_time_key:  string</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.normalize.OriginTimeMatcher.subset">
<span class="sig-name descname"><span class="pre">subset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#OriginTimeMatcher.subset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.OriginTimeMatcher.subset" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.db.normalize.bulk_normalize">
<span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">bulk_normalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wfquery</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wf_col</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf_miniseed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matcher_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#bulk_normalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.bulk_normalize" title="Permalink to this definition"></a></dt>
<dd><p>This function iterates through the collection specified by db and wf_col,
and runs a chain of normalization funtions in serial on each document
defined by the cursor returned by wfquery.  It speeds updates by
using the bulk methods of MongoDB.  The chain also speeds updates
as the all matchers in matcher_list append to the update string
for the same wf_col document.   A typical example would be to
run this function on wf_miniseed data running a matcher to set
channel_id, site_id, and source_id.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>db</strong> – should be a MsPASS database handle containing the wf_col</p>
</dd>
</dl>
<p>and the collections defined by the matcher_list list.
:param wf_col: The collection that need to be normalized, default is
wf_miniseed
:param blockssize:   To speed up updates this function uses the
bulk writer/updater methods of MongoDB that can be orders of
magnitude faster than one-at-a-time updates. A user should not normally
need to alter this parameter.
:param wfquery: is an optional query to apply to wf_col.  The output of this
query defines the list of documents that the algorithm will attempt
to normalize as described above.  The default (None) will process the entire
collection (query set to an emtpy dict).
:param matcher_list: a list of instances of one or more subclasses of BasicMather.</p>
<blockquote>
<div><p>In addition to the required classes all instances passed to through
this interface must contain two required attributes:  (1) collection
which defines the collection name, and (2) prepend_collection_name is
a boolean that determines if the attributes loaded should have
the collection name prepended (e.g. channel_id).  In addition,
all instances must define the find_doc method which is not required
by the BasicMatcher interface.   (find_doc is comparable to find_one
but uses a python dictionary as the container instead of referencing
a mspass data object.  find_one is the core method for inline normalization)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a list with a length of len(matcher_list)+1.  0 is the number of documents</p>
</dd>
</dl>
<p>processed in the collection (output of query), The rest are the numbers of
success normalizations for the corresponding NMF instances, they are mapped
one on one (matcher_list[x] -&gt; ret[x+1]).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.db.normalize.normalize">
<span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">normalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mspass_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matcher</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kill_on_failure</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#normalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.normalize" title="Permalink to this definition"></a></dt>
<dd><p>Generic function to do in line normalization with dask/spark map operator.</p>
<p>In MsPASS we use the normalized data model for receiver and source
metadata.  The normalization can be done during any reads if the
data have cross-referencing ids defined as described in the User’s Manual.
This function provides a generic interface to link to a normalizing
collection within a workflow using a map operator applied to a dask
bag or spark rdd containing a dataset of MsPASS data objects.
The algorithm is made generic through the matcher argument that must
point a concrete implementation of the abstract base class
defined in this module as BasicMatcher.</p>
<p>For example, suppose we create a concrete implementation of the
MiniseedMatcher using all defaults from a database handle db as
follows:</p>
<blockquote>
<div><p>matcher = MiniseedMatcher()</p>
</div></blockquote>
<p>Suppose we then load data from wf_miniseed with read_distributed_data
into the dask bag we will call dataset.  We can normalize
that data within a workflow as follows:</p>
<blockquote>
<div><p>dataset = dataset.map(normalize,matcher)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mspass_object</strong> (<em>For all mspass matchers this
must be one</em><em> of </em><em>the mspass data types</em><em> of </em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><em>TimeSeries</em></a><em>, </em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><em>Seismogram</em></a><em>,
</em><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeriesEnsemble" title="mspasspy.ccore.seismic.TimeSeriesEnsemble"><em>TimeSeriesEnsemble</em></a><em>, or </em><em>SeismogramEnsemble.  Many matchers have
further restrictions.  e.g. the normal use</em><em> of </em><em>the MiniseedMatcher
using the defaults like the example insists the data received are
either TimeSeries</em><em> or </em><em>Seismogram objects.   Read the docstring
carefully for your matcher choice for any limitations.</em>) – data to be normalized</p></li>
<li><p><strong>matcher</strong> (<em>must be a concrete subclass</em><em> of </em><a class="reference internal" href="#mspasspy.db.normalize.BasicMatcher" title="mspasspy.db.normalize.BasicMatcher"><em>BasicMatcher</em></a>) – a generic matching function that is a subclass of
BasicMatcher.   This function only calls the find_one method.</p></li>
<li><p><strong>kill_on_failure</strong> – when True if the call to the find_one</p></li>
</ul>
</dd>
</dl>
<p>method of matcher fails the datum returned will be marked dead.
:type kill_on_failure:  boolean</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>copy of mspass_object.  dead data are returned immediately.</p>
</dd>
</dl>
<p>if kill_on_failure is true the result may be killed on return.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.db.normalize.normalize_mseed">
<span class="sig-prename descclassname"><span class="pre">mspasspy.db.normalize.</span></span><span class="sig-name descname"><span class="pre">normalize_mseed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wfquery</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blocksize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_site</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/normalize.html#normalize_mseed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.normalize.normalize_mseed" title="Permalink to this definition"></a></dt>
<dd><p>In MsPASS the standard support for station information is stored in
two collections called “channel” and “site”.   When normalized
with channel collection data a miniseed record can be associated with
station metadata downloaded by FDSN web services and stored previously
with MsPASS database methods.   The default behavior tries to associate
each wf_miniseed document with an entry in “site”.  In MsPASS site is a
smaller collection intended for use only with data already assembled
into three component bundles we call Seismogram objects.</p>
<p>For both channel and site the association algorithm used assumes
the SEED convention wherein the strings stored with the keys
“net”,”sta”,”chan”, and (optionally) “loc” define a unique channel
of data registered globally through the FDSN.   The algorithm then
need only query for a match of these keys and a time interval
match with the start time of the waveform defined by each wf_miniseed
document.   The only distinction in the algorithm between site and
channel is that “chan” is not used in site since by definition site
data refer to common attributes of one seismic observatory (commonly
also called a “station”).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>db</strong> – should be a MsPASS database handle containing at least</p>
</dd>
</dl>
<p>wf_miniseed and the collections defined by the norm_collection list.
:param blockssize:   To speed up updates this function uses the
bulk writer/updater methods of MongoDB that can be orders of
magnitude faster than one-at-a-time updates for setting
channel_id and site_id.  A user should not normally need to alter this
parameter.
:param wfquery: is a query to apply to wf_miniseed.  The output of this
query defines the list of documents that the algorithm will attempt
to normalize as described above.  The default will process the entire
wf_miniseed collection (query set to an emtpy dict).
:param normalize_channel:  boolean for handling channel collection.
When True (default) matches will be attempted with the channel collection
and when matches are found the associated channel document id will be
set in the associated wf_miniseed document as channel_id.
:param normalize_site:  boolean for handling site collection.
When True (default) matches will be attempted with the site collection
and when matches are found the associated site document id will
be set wf_miniseed document as site_id. Note at least one of
the two booleans normalize_channel and normalize_site must be set True
or the function will immediately abort.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list with three integers.  0 is the number of documents processed in</p>
</dd>
</dl>
<p>wf_miniseed (output of query), 1 is the number with channel ids set,
and 2 contains the number of site documents set.  1 or 2 should
contain 0 if normalization for that collection was set false.</p>
</dd></dl>

</section>
<section id="module-mspasspy.db.schema">
<span id="schema"></span><h2>schema<a class="headerlink" href="#module-mspasspy.db.schema" title="Permalink to this heading"></a></h2>
<p>Tools to define the schema of Metadata.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.schema.DBSchemaDefinition">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.schema.</span></span><span class="sig-name descname"><span class="pre">DBSchemaDefinition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema_dic</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection_str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DBSchemaDefinition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DBSchemaDefinition" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.schema.SchemaDefinitionBase" title="mspasspy.db.schema.SchemaDefinitionBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaDefinitionBase</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DBSchemaDefinition.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DBSchemaDefinition.add"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DBSchemaDefinition.add" title="Permalink to this definition"></a></dt>
<dd><p>Add a new entry to the definitions. Note that because the internal
container is <cite>dict</cite> if attribute for name is already present it
will be silently replaced.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The name of the attribute to be added</p></li>
<li><p><strong>attr</strong> (<em>dict</em>) – A dictionary that defines the property of the added attribute.
Note that the type must be defined.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if type is not defined in attr</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DBSchemaDefinition.data_type">
<span class="sig-name descname"><span class="pre">data_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DBSchemaDefinition.data_type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DBSchemaDefinition.data_type" title="Permalink to this definition"></a></dt>
<dd><p>Return the data type that the collection is used to reference.
If not recognized, it returns None.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>type of data associated with the collection</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DBSchemaDefinition.reference">
<span class="sig-name descname"><span class="pre">reference</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DBSchemaDefinition.reference"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DBSchemaDefinition.reference" title="Permalink to this definition"></a></dt>
<dd><p>Return the collection name that a key is referenced from.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – the name of the key</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the name of the collection</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the key is not defined</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.schema.DatabaseSchema">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.schema.</span></span><span class="sig-name descname"><span class="pre">DatabaseSchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DatabaseSchema"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DatabaseSchema" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.schema.SchemaBase" title="mspasspy.db.schema.SchemaBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaBase</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DatabaseSchema.default">
<span class="sig-name descname"><span class="pre">default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DatabaseSchema.default"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DatabaseSchema.default" title="Permalink to this definition"></a></dt>
<dd><p>Return the schema definition of a default collection.</p>
<p>This method is used when multiple collections of the same concept is defined.
For example, the wf_TimeSeries and wf_Seismogram are both collections that
are used for data objects (characterized by their common wf prefix). The
Database API needs a default wf collection to operate on when no collection
name is explicitly given. In this case, this default_name method can be used.
Note that if requested name has no default collection defined and it is a
defined collection, it will treat that collection itself as the default.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – The requested default collection</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the schema definition of the default collection</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#mspasspy.db.schema.DBSchemaDefinition" title="mspasspy.db.schema.DBSchemaDefinition"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.db.schema.DBSchemaDefinition</span></code></a></p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the name has no default defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DatabaseSchema.default_name">
<span class="sig-name descname"><span class="pre">default_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DatabaseSchema.default_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DatabaseSchema.default_name" title="Permalink to this definition"></a></dt>
<dd><p>Return the name of a default collection.</p>
<p>This method is behaves similar to the default method, but it only returns the
name as a string instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> (<em>str</em>) – The requested default collection</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the name of the default collection</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the name has no default defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DatabaseSchema.set_default">
<span class="sig-name descname"><span class="pre">set_default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">collection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DatabaseSchema.set_default"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DatabaseSchema.set_default" title="Permalink to this definition"></a></dt>
<dd><p>Set a collection as the default.</p>
<p>This method is used to change the default collections (e.g., switching between
wf_TimeSeries and wf_Seismogram). If <code class="docutils literal notranslate"><span class="pre">default</span></code> is not given, it will try to
infer one from <code class="docutils literal notranslate"><span class="pre">collection</span></code> at the first occurrence of “_”
(e.g., wf_TimeSeries will become wf).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>collection</strong> (<em>str</em>) – The name of the targetting collection</p></li>
<li><p><strong>default</strong> (<em>str</em><em>, </em><em>optional</em>) – the default name to be set to</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.DatabaseSchema.unset_default">
<span class="sig-name descname"><span class="pre">unset_default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#DatabaseSchema.unset_default"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.DatabaseSchema.unset_default" title="Permalink to this definition"></a></dt>
<dd><p>Unset a default.</p>
<p>This method does nothing if <code class="docutils literal notranslate"><span class="pre">default</span></code> is not defined.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>default</strong> (<em>str</em>) – the default name to be unset</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.schema.</span></span><span class="sig-name descname"><span class="pre">MDSchemaDefinition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema_dic</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection_str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbschema</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.schema.SchemaDefinitionBase" title="mspasspy.db.schema.SchemaDefinitionBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaDefinitionBase</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.add"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.add" title="Permalink to this definition"></a></dt>
<dd><p>Add a new entry to the definitions. Note that because the internal
container is <cite>dict</cite> if attribute for name is already present it
will be silently replaced.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The name of the attribute to be added</p></li>
<li><p><strong>attr</strong> (<em>dict</em>) – A dictionary that defines the property of the added attribute.
Note that the type must be defined.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if type is not defined in attr</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.collection">
<span class="sig-name descname"><span class="pre">collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.collection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.collection" title="Permalink to this definition"></a></dt>
<dd><p>Return the collection name that a key belongs to</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – the name of the key</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the name of the collection</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.readonly">
<span class="sig-name descname"><span class="pre">readonly</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.readonly"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.readonly" title="Permalink to this definition"></a></dt>
<dd><p>Check if an attribute is marked readonly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the key is readonly or its readonly attribute is not defined, else return <cite>False</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the key is not defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.set_collection">
<span class="sig-name descname"><span class="pre">set_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbschema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.set_collection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.set_collection" title="Permalink to this definition"></a></dt>
<dd><p>Set the collection name that a key belongs to. It optionally takes
a dbschema argument and will set the attribute of that key with the
corresponding one defined in the dbschema.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<em>str</em>) – the name of the key</p></li>
<li><p><strong>collection</strong> (<em>str</em>) – the name of the collection</p></li>
<li><p><strong>dbschema</strong> (<a class="reference internal" href="#mspasspy.db.schema.DatabaseSchema" title="mspasspy.db.schema.DatabaseSchema"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.db.schema.DatabaseSchema</span></code></a>) – the database schema used to set the attributes of the key.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the key is not defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.set_readonly">
<span class="sig-name descname"><span class="pre">set_readonly</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.set_readonly"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.set_readonly" title="Permalink to this definition"></a></dt>
<dd><p>Lock an attribute to assure it will not be saved.</p>
<p>Parameters can be defined readonly. That is a standard feature of this class,
but is normally expected to be set on construction of the object.
There are sometimes reason to lock out a parameter to keep it from being
saved in output. This method allows this. On the other hand, use this feature
only if you fully understand the downstream implications or you may experience
unintended consequences.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – the key for the attribute with properties to be redefined</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the key is not defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.set_writeable">
<span class="sig-name descname"><span class="pre">set_writeable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.set_writeable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.set_writeable" title="Permalink to this definition"></a></dt>
<dd><p>Force an attribute to be writeable.</p>
<p>Normally some parameters are marked readonly on construction to avoid
corrupting the database with inconsistent data defined with a common
key. (e.g. sta) This method overrides such definitions for any key so
marked. This method should be used with caution as it could have
unintended side effects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – the key for the attribute with properties to be redefined</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the key is not defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.swap_collection">
<span class="sig-name descname"><span class="pre">swap_collection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">original_collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_collection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbschema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.swap_collection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.swap_collection" title="Permalink to this definition"></a></dt>
<dd><p>Swap the collection name of all the keys of a matching colletions.
It optionally takes a dbschema argument and will set the attribute
of that key with the corresponding one defined in the dbschema. It
will silently do nothing if no matching collection is defined.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>original_collection</strong> (<em>str</em>) – the name of the collection to be swapped</p></li>
<li><p><strong>new_collection</strong> (<em>str</em>) – the name of the collection to be changed into</p></li>
<li><p><strong>dbschema</strong> (<a class="reference internal" href="#mspasspy.db.schema.DatabaseSchema" title="mspasspy.db.schema.DatabaseSchema"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.db.schema.DatabaseSchema</span></code></a>) – the database schema used to set the attributes of the key.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.MDSchemaDefinition.writeable">
<span class="sig-name descname"><span class="pre">writeable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MDSchemaDefinition.writeable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MDSchemaDefinition.writeable" title="Permalink to this definition"></a></dt>
<dd><p>Check if an attribute is writeable. Inverted logic from the readonly method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the key is not readonly, else or its readonly attribute is not defined return <cite>False</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if the key is not defined</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.schema.MetadataSchema">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.schema.</span></span><span class="sig-name descname"><span class="pre">MetadataSchema</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#MetadataSchema"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.MetadataSchema" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.db.schema.SchemaBase" title="mspasspy.db.schema.SchemaBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchemaBase</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.schema.</span></span><span class="sig-name descname"><span class="pre">SchemaBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaBase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaBase" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.db.schema.</span></span><span class="sig-name descname"><span class="pre">SchemaDefinitionBase</span></span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.add"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.add" title="Permalink to this definition"></a></dt>
<dd><p>Add a new entry to the definitions. Note that because the internal
container is <cite>dict</cite> if attribute for name is already present it
will be silently replaced.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The name of the attribute to be added</p></li>
<li><p><strong>attr</strong> (<em>dict</em>) – A dictionary that defines the property of the added attribute.
Note that the type must be defined.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if type is not defined in attr</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.add_alias">
<span class="sig-name descname"><span class="pre">add_alias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aliasname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.add_alias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.add_alias" title="Permalink to this definition"></a></dt>
<dd><p>Add an alias for key</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<em>str</em>) – key to be added</p></li>
<li><p><strong>aliasname</strong> (<em>str</em>) – aliasname to be added</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.aliases">
<span class="sig-name descname"><span class="pre">aliases</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.aliases"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.aliases" title="Permalink to this definition"></a></dt>
<dd><p>Get a list of aliases for a given key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The unique key that has aliases defined.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of aliases associated to the key.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.apply_aliases">
<span class="sig-name descname"><span class="pre">apply_aliases</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">md</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alias</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.apply_aliases"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.apply_aliases" title="Permalink to this definition"></a></dt>
<dd><p>Apply a set of aliases to a data object.</p>
<p>This method will change the unique keys of a data object into aliases.
The alias argument can either be a path to a valid yaml file of
key:alias pairs or a dict. If the “key” is an alias itself, it will
be converted to its corresponding unique name before being used to
change to the alias. It will also add the applied alias to the schema’s
internal alias container such that the same schema object can be used
to convert the alias back.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>md</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.Metadata" title="mspasspy.ccore.utility.Metadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.utility.Metadata</span></code></a>) – Data object to be altered. Normally a <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>
or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> but can be a raw <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.Metadata" title="mspasspy.ccore.utility.Metadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.utility.Metadata</span></code></a>.</p></li>
<li><p><strong>alias</strong> (<em>dict/str</em>) – a yaml file or a dict that have pairs of key:alias</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.clear_aliases">
<span class="sig-name descname"><span class="pre">clear_aliases</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">md</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.clear_aliases"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.clear_aliases" title="Permalink to this definition"></a></dt>
<dd><p>Restore any aliases to unique names.</p>
<p>Aliases are needed to support legacy packages, but can cause downstream problem
if left intact. This method clears any aliases and sets them to the unique_name
defined by this object. Note that if the unique_name is already defined, it will
silently remove the alias only.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>md</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.Metadata" title="mspasspy.ccore.utility.Metadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.utility.Metadata</span></code></a>) – Data object to be altered. Normally a <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>
or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> but can be a raw <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.Metadata" title="mspasspy.ccore.utility.Metadata"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.utility.Metadata</span></code></a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.concept">
<span class="sig-name descname"><span class="pre">concept</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.concept"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.concept" title="Permalink to this definition"></a></dt>
<dd><p>Return a description of the concept this attribute defines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The name that defines the attribute of interest</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A string with a terse description of the concept this attribute defines</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if concept is not defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.constraint">
<span class="sig-name descname"><span class="pre">constraint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.constraint"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.constraint" title="Permalink to this definition"></a></dt>
<dd><p>Return a description of the constraint this attribute defines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The name that defines the attribute of interest</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A string with a terse description of the constraint this attribute defines</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.has_alias">
<span class="sig-name descname"><span class="pre">has_alias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.has_alias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.has_alias" title="Permalink to this definition"></a></dt>
<dd><p>Test if a key has registered aliases</p>
<p>Sometimes it is helpful to have alias keys to define a common concept.
For instance, if an attribute is loaded from a relational db one might
want to use alias names of the form table.attribute as an alias to
attribute. has_alias should be called first to establish if a name has
an alias. To get a list of aliases call the aliases method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the key has aliases, else or if key is not defined return <cite>False</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.is_alias">
<span class="sig-name descname"><span class="pre">is_alias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.is_alias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.is_alias" title="Permalink to this definition"></a></dt>
<dd><p>Test if a key is a registered alias</p>
<p>This asks the inverse question to has_alias. That is, it yields true of the key is
registered as a valid alias. It returns false if the key is not defined at all. Note
it will yield false if the key is a registered unique name and not an alias.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the key is a alias, else return <cite>False</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.is_defined">
<span class="sig-name descname"><span class="pre">is_defined</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.is_defined"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.is_defined" title="Permalink to this definition"></a></dt>
<dd><p>Test if a key is defined either as a unique key or an alias</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the key is defined</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.is_normal">
<span class="sig-name descname"><span class="pre">is_normal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.is_normal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.is_normal" title="Permalink to this definition"></a></dt>
<dd><p>Test if the constraint of the key is normal to the schema</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the constraint of the key is normal</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.is_optional">
<span class="sig-name descname"><span class="pre">is_optional</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.is_optional"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.is_optional" title="Permalink to this definition"></a></dt>
<dd><p>Test if the constraint of the key is optional to the schema</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the constraint of the key is optional</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.is_required">
<span class="sig-name descname"><span class="pre">is_required</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.is_required"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.is_required" title="Permalink to this definition"></a></dt>
<dd><p>Test if the constraint of the key is required to the schema</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the constraint of the key is required</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.is_xref_key">
<span class="sig-name descname"><span class="pre">is_xref_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.is_xref_key"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.is_xref_key" title="Permalink to this definition"></a></dt>
<dd><p>Test if the constraint of the key is xref_key to the schema</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – key to be tested</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><cite>True</cite> if the constraint of the key is xref_key</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.keys">
<span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.keys" title="Permalink to this definition"></a></dt>
<dd><p>Get a list of all the unique keys defined.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of all the unique keys defined</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.remove_alias">
<span class="sig-name descname"><span class="pre">remove_alias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alias</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.remove_alias"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.remove_alias" title="Permalink to this definition"></a></dt>
<dd><p>Remove an alias. Will silently ignore if alias is not found</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>alias</strong> (<em>str</em>) – alias to be removed</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.required_keys">
<span class="sig-name descname"><span class="pre">required_keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.required_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.required_keys" title="Permalink to this definition"></a></dt>
<dd><p>Return all the required keys in the current collection as a list</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>type of data associated with the collection</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.type">
<span class="sig-name descname"><span class="pre">type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.type" title="Permalink to this definition"></a></dt>
<dd><p>Return the type of an attribute. If not recognized, it returns None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<em>str</em>) – The name that defines the attribute of interest</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>type of the attribute associated with <code class="docutils literal notranslate"><span class="pre">key</span></code></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#mspasspy.db.schema.SchemaDefinitionBase.type" title="mspasspy.db.schema.SchemaDefinitionBase.type"><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.unique_name">
<span class="sig-name descname"><span class="pre">unique_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aliasname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.unique_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.unique_name" title="Permalink to this definition"></a></dt>
<dd><p>Get definitive name for an alias.</p>
<p>This method is used to ask the opposite question as aliases. The aliases method
returns all acceptable alternatives to a definitive name defined as the key to
get said list. This method asks what definitive key should be used to fetch an
attribute. Note that if the input is already the unique name, it will return itself.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>aliasname</strong> (<em>str</em>) – the name of the alias for which we want the definitive key</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the name of the definitive key</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><strong>mspasspy.ccore.utility.MsPASSError</strong></a> – if aliasname is not defined</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.db.schema.SchemaDefinitionBase.xref_keys">
<span class="sig-name descname"><span class="pre">xref_keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/db/schema.html#SchemaDefinitionBase.xref_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.db.schema.SchemaDefinitionBase.xref_keys" title="Permalink to this definition"></a></dt>
<dd><p>Return all the xref keys in the current collection as a list</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>type of data associated with the collection</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code> of <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mspasspy.client.html" class="btn btn-neutral float-left" title="mspasspy.client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mspasspy.global_history.html" class="btn btn-neutral float-right" title="mspasspy.global_history" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Ian Wang.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>