<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mspasspy.algorithms &mdash; MsPASS 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=f6245a2f"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mspasspy.ccore" href="mspasspy.ccore.html" />
    <link rel="prev" title="Python API" href="index.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MsPASS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_start.html">Getting Started in a Nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/run_mspass_with_docker.html">Run MsPASS with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_docker_compose.html">Deploy MsPASS with Docker Compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_conda.html">Deploy MsPASS with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_conda.html#advanced-setup-considerations">Advanced Setup Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_on_HPC.html">Deploying MsPASS on an HPC cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_conda_and_coiled.html">Deploy MsPASS with Conda and Coiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started_overview.html">MsPASS Virtual Cluster Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/database_concepts.html">Database Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/CRUD_operations.html">CRUD Operations in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/mongodb_and_mspass.html">Using MongoDB with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/normalization.html">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_tabular_data.html">Importing Tabular Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seismic Data Objects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_object_design_concepts.html">Data Object Design Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/numpy_scipy_interface.html">Using numpy/scipy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/obspy_interface.html">Using ObsPy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/time_standard_constraints.html">Time Standard Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/processing_history_concepts.html">Processing History Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/continuous_data.html">Continuous Data Handling with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/schema_choices.html">What database schema should I use?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/handling_errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_editing.html">Data Editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/header_math.html">Header (Metadata) Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/graphics.html">Graphics in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/signal_to_noise.html">Signal to Noise Ratio Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/adapting_algorithms.html">Adapting an Existing Algorithm to MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_processing.html">Parallel Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/memory_management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/io.html">I/O in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_io.html">Parallel IO in MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/FAQ.html">Frequency Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/development_strategies.html">How do I develop a new workflow from scratch?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python API</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">mspasspy.algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.RFdeconProcessor">RFdeconProcessor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.RFdeconProcessor.RFdecon"><code class="docutils literal notranslate"><span class="pre">RFdecon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor"><code class="docutils literal notranslate"><span class="pre">RFdeconProcessor</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.basic">basic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.ExtractComponent"><code class="docutils literal notranslate"><span class="pre">ExtractComponent()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.ator"><code class="docutils literal notranslate"><span class="pre">ator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.cosine_taper"><code class="docutils literal notranslate"><span class="pre">cosine_taper()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.free_surface_transformation"><code class="docutils literal notranslate"><span class="pre">free_surface_transformation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.linear_taper"><code class="docutils literal notranslate"><span class="pre">linear_taper()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.rotate"><code class="docutils literal notranslate"><span class="pre">rotate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.rotate_to_standard"><code class="docutils literal notranslate"><span class="pre">rotate_to_standard()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.rtoa"><code class="docutils literal notranslate"><span class="pre">rtoa()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.transform"><code class="docutils literal notranslate"><span class="pre">transform()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.transform_to_LQT"><code class="docutils literal notranslate"><span class="pre">transform_to_LQT()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.transform_to_RTZ"><code class="docutils literal notranslate"><span class="pre">transform_to_RTZ()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.basic.vector_taper"><code class="docutils literal notranslate"><span class="pre">vector_taper()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.bundle">bundle</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.bundle.BundleSEEDGroup"><code class="docutils literal notranslate"><span class="pre">BundleSEEDGroup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.bundle.bundle_seed_data"><code class="docutils literal notranslate"><span class="pre">bundle_seed_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.edit">edit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Add"><code class="docutils literal notranslate"><span class="pre">Add</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Add2"><code class="docutils literal notranslate"><span class="pre">Add2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.ChangeKey"><code class="docutils literal notranslate"><span class="pre">ChangeKey</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Divide"><code class="docutils literal notranslate"><span class="pre">Divide</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Divide2"><code class="docutils literal notranslate"><span class="pre">Divide2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Executioner"><code class="docutils literal notranslate"><span class="pre">Executioner</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.FiringSquad"><code class="docutils literal notranslate"><span class="pre">FiringSquad</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.IntegerDivide"><code class="docutils literal notranslate"><span class="pre">IntegerDivide</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.IntegerDivide2"><code class="docutils literal notranslate"><span class="pre">IntegerDivide2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataDefined"><code class="docutils literal notranslate"><span class="pre">MetadataDefined</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataEQ"><code class="docutils literal notranslate"><span class="pre">MetadataEQ</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataGE"><code class="docutils literal notranslate"><span class="pre">MetadataGE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataGT"><code class="docutils literal notranslate"><span class="pre">MetadataGT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataInterval"><code class="docutils literal notranslate"><span class="pre">MetadataInterval</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataLE"><code class="docutils literal notranslate"><span class="pre">MetadataLE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataLT"><code class="docutils literal notranslate"><span class="pre">MetadataLT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataNE"><code class="docutils literal notranslate"><span class="pre">MetadataNE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator"><code class="docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperatorChain"><code class="docutils literal notranslate"><span class="pre">MetadataOperatorChain</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.MetadataUndefined"><code class="docutils literal notranslate"><span class="pre">MetadataUndefined</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Mod"><code class="docutils literal notranslate"><span class="pre">Mod</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Mod2"><code class="docutils literal notranslate"><span class="pre">Mod2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Multiply"><code class="docutils literal notranslate"><span class="pre">Multiply</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Multiply2"><code class="docutils literal notranslate"><span class="pre">Multiply2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.SetValue"><code class="docutils literal notranslate"><span class="pre">SetValue</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Subtract"><code class="docutils literal notranslate"><span class="pre">Subtract</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.Subtract2"><code class="docutils literal notranslate"><span class="pre">Subtract2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.edit.erase_metadata"><code class="docutils literal notranslate"><span class="pre">erase_metadata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.signals">signals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.correlate"><code class="docutils literal notranslate"><span class="pre">correlate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.correlate_stream_template"><code class="docutils literal notranslate"><span class="pre">correlate_stream_template()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.correlate_template"><code class="docutils literal notranslate"><span class="pre">correlate_template()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.correlation_detector"><code class="docutils literal notranslate"><span class="pre">correlation_detector()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.detrend"><code class="docutils literal notranslate"><span class="pre">detrend()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.filter"><code class="docutils literal notranslate"><span class="pre">filter()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.interpolate"><code class="docutils literal notranslate"><span class="pre">interpolate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.templates_max_similarity"><code class="docutils literal notranslate"><span class="pre">templates_max_similarity()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.xcorr_3c"><code class="docutils literal notranslate"><span class="pre">xcorr_3c()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.xcorr_max"><code class="docutils literal notranslate"><span class="pre">xcorr_max()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.signals.xcorr_pick_correction"><code class="docutils literal notranslate"><span class="pre">xcorr_pick_correction()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.snr">snr</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.snr.FD_snr_estimator"><code class="docutils literal notranslate"><span class="pre">FD_snr_estimator()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.snr.arrival_snr"><code class="docutils literal notranslate"><span class="pre">arrival_snr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.snr.broadband_snr_QC"><code class="docutils literal notranslate"><span class="pre">broadband_snr_QC()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.snr.save_snr_arrival"><code class="docutils literal notranslate"><span class="pre">save_snr_arrival()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.snr.snr"><code class="docutils literal notranslate"><span class="pre">snr()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-mspasspy.algorithms.window">window</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.window.TopMute"><code class="docutils literal notranslate"><span class="pre">TopMute</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.window.WindowData"><code class="docutils literal notranslate"><span class="pre">WindowData()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.window.WindowData_with_duration"><code class="docutils literal notranslate"><span class="pre">WindowData_with_duration()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.window.ensemble_error_post"><code class="docutils literal notranslate"><span class="pre">ensemble_error_post()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.window.merge"><code class="docutils literal notranslate"><span class="pre">merge()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.algorithms.window.scale"><code class="docutils literal notranslate"><span class="pre">scale()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.ccore.html">mspasspy.ccore</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.client.html">mspasspy.client</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.db.html">mspasspy.db</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.global_history.html">mspasspy.global_history</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.graphics.html">mspasspy.graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.history.html">mspasspy.history</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.io.html">mspasspy.io</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.preprocessing.html">mspasspy.preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.reduce.html">mspasspy.reduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.util.html">mspasspy.util</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cxx_api/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mspass_schema/mspass_schema.html">MsPASS Schema</a></li>
</ul>

    <a href= "../genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Python API</a></li>
      <li class="breadcrumb-item active">mspasspy.algorithms</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/mspass-team/mspass/blob/master/docs/source/python_api/mspasspy.algorithms.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mspasspy-algorithms">
<h1>mspasspy.algorithms<a class="headerlink" href="#mspasspy-algorithms" title="Permalink to this heading"></a></h1>
<section id="module-mspasspy.algorithms.RFdeconProcessor">
<span id="rfdeconprocessor"></span><h2>RFdeconProcessor<a class="headerlink" href="#module-mspasspy.algorithms.RFdeconProcessor" title="Permalink to this heading"></a></h2>
<p>This file contains a class definition for a wrapper for
the suite of scalar deconvolution methods supported by mspass.
It demonstrates the concept of a processing object created
by wrapping C code.</p>
<p>Created on Fri Jul 31 06:24:10 2020</p>
<p>&#64;author: Gary Pavlis</p>
<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdecon">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.RFdeconProcessor.</span></span><span class="sig-name descname"><span class="pre">RFdecon</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LeastSquares'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'RFdeconProcessor.pf'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noisedata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wcomp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncomp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'RFdecon'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdecon"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdecon" title="Permalink to this definition"></a></dt>
<dd><p>Use this function to compute conventional receiver functions
from a single three component seismogram. In this function,
an instance of wrapper class RFdeconProcessor will be built and
initialized with alg and pf.</p>
<p>Default assumes d contains all data sections required to do
the deconvolution with the wavelet in component 2 (3 for matlab
and FORTRAN people).  By default the data and noise
(if required by the algorithm) sections will be extracted from
the (assumed larger) data section using time windows defined
internally in the processor pf definition.   For variations (e.g.
adding tapering to one or more of the time series inputs)
use the d, wavelet, and (if required) noise arguments to load
each component separately.  Note d is dogmatically required
to be three component data while optional wavelet and noisedata
series are passed as plain numpy vectors (i.e. without the
decoration of a TimeSeries).</p>
<p>To make use of the extended outputs from RFdeconProcessor
algorithms (e.g. actual output of the computed operator)
call those methods after this function returns successfully
with a three-component seismogram output.  That is possible
because the processor object caches the most recent wavelet
and inverse used for the deconvolution.   An exception is
that all algorithms call their QCmetrics method of processor
and push them to the headers of the deconvolved output.
QCmetric attributes are algorithm dependent.</p>
<p>The ProcessingHistory feature can optionally be enabled by
setting the save_history argument to True.   When enable one should
normally set a unique id for the algid argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>d</strong> – Seismogram input data.  See notes above about</p>
</dd>
</dl>
<p>time span of these data.
:param alg: The algorithm to be applied, used for initializing</p>
<blockquote>
<div><p>a RFdeconProcessor object</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pf</strong> – The pf file to be parsed, used for inititalizing a
RFdeconProcessor</p></li>
<li><p><strong>wavelet</strong> – vector of doubles (numpy array or the
std::vector container internal to TimeSeries object) defining
the wavelet to use to compute deconvolution operator.
Default is None which assumes processor was set up to use
a component of d as the wavelet estimate.</p></li>
<li><p><strong>noisedata</strong> – vector of doubles (numpy array or the
std::vector container internal to TimeSeries object) defining
noise data to use for computing regularization.  Not all RF
estimation algorithms use noise estimators so this parameter
is optional.   It can also be extracted from d depending on
parameter file options.</p></li>
<li><p><strong>wcomp</strong> – <p>When defined from Seismogram d the wavelet
estimate in conventional RFs is one of the components that
are most P wave dominated. That is always one of three
things:  Z, L of LQT, or the L component from the output of
Kennett’s free surface transformation operator.  The
default is 2, which for ccore.Seismogram is always one of
the above.   This parameter would be changed only if the
data has undergone some novel transformation not yet invented
and the best wavelet estimate was on in 2 (3 with FORTRAN
and matlab numbering).
:param ncomp: component number to use to compute noise.  This is used
only if the algorithm in processor requires a noise estimate.
Normally it should be the same as wcomp and is by default (2).
:param object_history: boolean to enable or disable saving object</p>
<blockquote>
<div><p>level history.  Default is False.  Note this functionality is
implemented via the mspass_func_wrapper decorator.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">param alg_name<span class="colon">:</span></dt>
<dd class="field-odd"><p>When history is enabled this is the algorithm name
assigned to the stamp for applying this algorithm.
Default (“WindowData”) should normally be just used.
Note this functionality is implemented via the mspass_func_wrapper decorator.</p>
</dd>
<dt class="field-even">param ald_id<span class="colon">:</span></dt>
<dd class="field-even"><p>algorithm id to assign to history record (used only if
object_history is set True.)
Note this functionality is implemented via the mspass_func_wrapper decorator.</p>
</dd>
<dt class="field-odd">param dryrun<span class="colon">:</span></dt>
<dd class="field-odd"><p>When true only the arguments are checked for validity.
When true nothing is calculated and the original data are returned.
Note this functionality is implemented via the mspass_func_wrapper decorator.</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Seismogram object containing the RF estimates.
The orientations are always the same as the input.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.RFdeconProcessor.</span></span><span class="sig-name descname"><span class="pre">RFdeconProcessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LeastSquares'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'RFdeconProcessor.pf'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class is a wrapper for the suite of receiver function deconvolution
methods we call scalar methods.  That is, the operation is reducable to
two time series:   wavelet signal and the data (TimeSeries) signal.
That is in contrast to three component methods that always treat the
data as vector samples.   The class should be created as a global
processor object to be used in a spark job.  The design assumes the
processor object will be passed as an argument to the RFdecon
function that should appear as a function in a spark map call.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.QCMetrics">
<span class="sig-name descname"><span class="pre">QCMetrics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.QCMetrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.QCMetrics" title="Permalink to this definition"></a></dt>
<dd><p>All decon algorithms compute a set of algorithm dependent quality
control metrics.  This method returns the metrics as a set of fixed
name:value pairs in a mspass.Metadata object.   The details are
algorithm dependent.  See related documentation for metrics computed
by different algorithms.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.actual_output">
<span class="sig-name descname"><span class="pre">actual_output</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.actual_output"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.actual_output" title="Permalink to this definition"></a></dt>
<dd><p>The actual output of a decon operator is the inverse filter applied to
the wavelet.  By design it is an approximation of the shaping wavelet
defined for this operator.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Actual output of the operator as a ccore.TimeSeries object.</p>
</dd>
</dl>
<p>The Metadata of the return is bare bones.  The most important factor
about this result is that because actual output waveforms are normally
a zero phase wavelet of some kind the result is time shifted to be
centered (i.e. t0 is rounded n/2 where n is the length of the vector</p>
<blockquote>
<div><p>returned).</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.apply" title="Permalink to this definition"></a></dt>
<dd><p>Compute the RF estimate using the algorithm defined internally.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>vector of data that are the RF estimate computed from previously loaded data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.change_parameters">
<span class="sig-name descname"><span class="pre">change_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">md</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.change_parameters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.change_parameters" title="Permalink to this definition"></a></dt>
<dd><p>Use this method to change the internal parameter setting of the
processor.  It can be used, for example, to switch from the damped
least square method to the water level method.  Note the input
must be a complete definition for a parameter set defining a
particular algorithm.  i.e. this is not an update method but
t reinitializes the processor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>md</strong> – is a mspass.Metadata object containing required parameters</p>
</dd>
</dl>
<p>for the alternative algorithm.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.dwin">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dwin</span></span><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.dwin" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.ideal_output">
<span class="sig-name descname"><span class="pre">ideal_output</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.ideal_output"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.ideal_output" title="Permalink to this definition"></a></dt>
<dd><p>The ideal output of a decon operator is the same thing we call a
shaping wavelet.  This method returns the ideal output=shaping wavelet
as a TimeSeries object.   Like the actual output method the return
function is circular shifted so the function peaks at 0 time located
at n/2 samples from the start sample.  Graphic displays will then show
the wavelet centered and peaked at time 0.   The prediction error
can be computed as the difference between the actual_output and
ideal_output TimeSeries objects.   The norm of the prediction error
is a helpful metric to display the stability and accuracy of the
inverse.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.inverse_filter">
<span class="sig-name descname"><span class="pre">inverse_filter</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.inverse_filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.inverse_filter" title="Permalink to this definition"></a></dt>
<dd><p>This method returns the actual inverse filter that if convolved with
he original data will produce the RF estimate.  Note the filter is
meaningful only if the source wavelet is minimum phase.  A standard
theorem from time series analysis shows that the inverse of mixed
phase wavelet is usually unstable and a maximum phase wavelet is always
unstable.   Fourier-based methods can still compute a stable solution
even with a mixed phase wavelet because of the implied circular
convolution.</p>
<p>The result is returned as  TimeSeries object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.loaddata">
<span class="sig-name descname"><span class="pre">loaddata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Seismogram'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.loaddata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.loaddata" title="Permalink to this definition"></a></dt>
<dd><p>Loads data for processing.  When window is set true
use the internal pf definition of data time window
and window the data.  The dtype parameter changes the
behavior of this algorithm significantly depending on
the setting.   It can be one of the following:
Seismogram, TimeSeries, or raw_vector.   For the first
two the data to process will be extracted in a
pf specfied window if window is True.  If window is
False TimeSeries data will be passed directly and
Seismogram data will have the data defined by the
component parameter copied to the internal data
vector workspace.   If dtype is set to raw_vector
d is assumed to be a raw numpy vector of doubles or
an the aliased std::vector used in ccore, for example,
in the TimeSeries object s vector.  Setting dtype
to raw_vector and window True will result in this
method throwing a RuntimeError exception as the
combination is not possible since raw_vector data
have no time base.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>d</strong> – input data (contents expected depend upon</p>
</dd>
</dl>
<p>value of dtype parameter).
:param dtype: string defining the form d is expected</p>
<blockquote>
<div><p>to be (see details above)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>component</strong> – component of Seismogram data to
load as data vector.  Ignored if dtype is raw_vector
or TimeSeries.</p></li>
<li><p><strong>window</strong> – boolean controlling internally
defined windowing.  (see details above)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Nothing (not None nothing) is returned</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.loadnoise">
<span class="sig-name descname"><span class="pre">loadnoise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Seismogram'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.loadnoise"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.loadnoise" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.loadwavelet">
<span class="sig-name descname"><span class="pre">loadwavelet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">w</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Seismogram'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/RFdeconProcessor.html#RFdeconProcessor.loadwavelet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.loadwavelet" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.nwin">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nwin</span></span><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.nwin" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.uses_noise">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">uses_noise</span></span><a class="headerlink" href="#mspasspy.algorithms.RFdeconProcessor.RFdeconProcessor.uses_noise" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-mspasspy.algorithms.basic">
<span id="basic"></span><h2>basic<a class="headerlink" href="#module-mspasspy.algorithms.basic" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.ExtractComponent">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">ExtractComponent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#ExtractComponent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.ExtractComponent" title="Permalink to this definition"></a></dt>
<dd><p>Extract single component from three-component data.</p>
<p>The function creates a scalar TimeSeries object from a three component Seismogram object
Or a TimeSeriesEnsemble object from a SeismogramEnsemble object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>
or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">SeismogramEnsemble</span></code></a>) – data object to extract from.</p></li>
<li><p><strong>component</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – the index of component that will be extracted, it can only be 0, 1, or 2</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is set false to
handle exception directly in the function, without passing it to mspass_func_wrapper.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.ator">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">ator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tshift</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#ator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.ator" title="Permalink to this definition"></a></dt>
<dd><p>Absolute to relative time conversion.</p>
<p>Sometimes we want to convert data from absolute time (epoch times)
to a relative time standard.  Examples are conversions to travel
time using an event origin time or shifting to an arrival time
reference frame. This operation simply switches the tref
variable and alters t0 by tshift.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>) – data object to be converted.</p></li>
<li><p><strong>tshift</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – time shift applied to data before switching data to relative time mode.</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.cosine_taper">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">cosine_taper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1tail</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0tail</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#cosine_taper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.cosine_taper" title="Permalink to this definition"></a></dt>
<dd><p>Taper front and/or end of a data object with a half cosine function.</p>
<p>A cosine taper is a common, simple approach to taper data.  When applied at the
front it defnes a half cycle of a cosine curve +1.0 in range -pi to 0.  On
the right it defines the same function for the range 0 to pi.  The period
of the left and right operator can be different.  Turn off left or right by
giving illegal start and end points and the operator will silently be
only one sided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be processed.</p></li>
<li><p><strong>t0head</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t0 of the head taper</p></li>
<li><p><strong>t1head</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t1 of the head taper</p></li>
<li><p><strong>t1tail</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t1 of the tail taper</p></li>
<li><p><strong>t0tail</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t0 of the tail taper</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.free_surface_transformation">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">free_surface_transformation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uvec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vp0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vs0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ux_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ux'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uy_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uy'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vp0_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'vp0'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vs0_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'vs0'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#free_surface_transformation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.free_surface_transformation" title="Permalink to this definition"></a></dt>
<dd><p>Computes and applies the Kennett [1991] free surface transformation matrix.</p>
<p>Kennett [1991] gives the form for a free surface transformation operator
that defines a transformation matrix that provides optimal separation
of P, SV, and SH for a receiver at the free surface of an isotropic medium
with constant P and S velocity.   The transformation is only valid if the
incident wavefield is not evanescent (i.e. at or past the SV critical angle).
It is important to realize the tranformation matrix does not define
an orthogonal transformation.  It is also, of course, only an approximation
since it is strictly correct only for a constant velocity medium.
The tranformation operator requires: (1) a slowness vector, (2) an
estimate of surface P wave velocity, and (3) an estimate of surface
shear wave velocity.   In all cases the input for the slowness
vector uses a local cartesian system with the vector specified as
component ux and uy.  ux is the component of the slowness of
an incident wavefield in the geographic x direction, which means
positive at local east.  uy is the complementary component for the
y direction defined by local north.  The components of the slowness
vector are assumed to be in units of s/km.   (Warning:  obspy’s and
other implementations of the commonly used tau-p calculator return
slowness (ray parameter) in spherical units of s/radian - r sin(theta)/v)</p>
<p>The required parameters (slowness vector and velocities) can be
passed to the function one of two ways.   Because it is much simpler
to implement in a map operator the default expect those parameters to
be set in the data object’s Metadata container.  The default keys for
fetching each attribute are defined by the four arguments
“ux_key”, “uy_key”, “vp0_key”, and “vs0_key”.   All four have
standard defaults defined in the function signature and below.
The Metadata fetching algorithm can be overridden by defining
the same data through the three optional arguments with the key
names “uvec”, “vp0”, and “vs0”.   (see below for detailed descriptions)</p>
<p>The switching between Metadata fetching and a constant arguments
is not all or none.   If a slowness vector is defined through uvec
it will always override metadata.  Handing of vp0 and vs0 is independent.
i.e. you can define uvec and not define vp0 and vs0 or conversely
you can (more commonly) define vp0 and vs0 but not define uvec.
In all cases not defining an arg is a signal to fetch it from
Metadata.</p>
<p>When this function is applied to ensembles and the Metadata fetch
approach is used (default) the function assumes all ensemble members
have the required metadata keys defined.  Any that do not are killed.
The same happens for atomic data passed to this function if any of
the required keys are missing.  In fact, you should realize the
ensemble algorithm simply applies this function in a recursion over all
the members.</p>
<p>The output components are in the order defined in Kennett’s original
paper.  The order is 0=SH, 1=SV, 2=L.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> – data object to be transformed.  For ensembles the transformation</p>
</dd>
</dl>
<p>is applied to all members.  Note the Metadata fetch mechanism is the only
recommended way to handle ensembles.  An elog message will be posted
to the ensemble’s elog container if you try to use a constant slowness
vector passed via uvec. It will not warn about constant vp0 and vs0
as that case is common.
:type data: <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a> or
<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble"><code class="xref py py-class docutils literal notranslate"><span class="pre">SeismogramEnsemble</span></code></a>
:param ux_key:  key to use to fetch EW component of slowness vector
from Metadata container.  Default is “ux”.
:type ux_key:  string
:param uy_key:  key to use to fetch NS component of slowness vector
from Metadata container.  Default is “uy”.
:type uy_key:  string
:param vp0_key:  key to use to fetch free surface P wave velocity
from Metadata container.  Default is “vp0”.
:type vp0_key:  string
:param vs0_key: key to use to fetch free surface S wave velocity
from Metadata container.  Default is “vs0”.
:type vs0_key:  string
:param uvec: slowness vector of the incident wavefield defined via
custom C++ class <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SlownessVector" title="mspasspy.ccore.seismic.SlownessVector"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlownessVector</span></code></a>.
Default is None which is taken as a signal to fetch the slowness vector
components from Metadata using ux_key and uy_key.
:type uvec: <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SlownessVector" title="mspasspy.ccore.seismic.SlownessVector"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlownessVector</span></code></a>
:param vp0: Surface P wave velocity.  Default is None which is taken
as a signal to fetch this quantity from Metadata using the vp0_key.
:type vp0: <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>
:param vs0: Surface S wave velocity.  Default is None which is taken
as a signal to fetch this quantity from Metadata using the vs0_key.
:type vs0: <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>
:param object_history: True to preserve the processing history. For details, refer to</p>
<blockquote>
<div><p><code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.linear_taper">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">linear_taper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1head</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1tail</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0tail</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#linear_taper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.linear_taper" title="Permalink to this definition"></a></dt>
<dd><p>Taper front and/or end of a data object with a linear taper.</p>
<p>Linear tapers are defined here as a time spanning a ramp running from 0 to 1.
Data will be zeroed on each end of a 0 mark and a linear weight applied between
0 points and 1 points.  Postive ramp slope on left and negative slope ramp on
right. Setting t0 == t1 will disable the taper on the specified end (e.g., t0head == t1head).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be processed.</p></li>
<li><p><strong>t0head</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t0 of the head taper</p></li>
<li><p><strong>t1head</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t1 of the head taper</p></li>
<li><p><strong>t1tail</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t1 of the tail taper</p></li>
<li><p><strong>t0tail</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – t0 of the tail taper</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.rotate">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">rotate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotate_param</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#rotate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.rotate" title="Permalink to this definition"></a></dt>
<dd><p>Rotate data using a P wave type coordinate definition.</p>
<p>This function can apply three different types of rotation depending on the type of parameter given.
If a <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.SphericalCoordinate" title="mspasspy.ccore.utility.SphericalCoordinate"><code class="xref py py-class docutils literal notranslate"><span class="pre">SphericalCoordinate</span></code></a> is given, it will rotate the data
into a coordinate system defined by the direction defined by the spherical coordinate.  The data are
rotated such that x1 becomes the transverse component, x2 becomes radial, and x3 becomes longitudinal.</p>
<p>If an unite vector of three components that defines the direction of x3 direction (longitudinal) is give,
it will turn the vector into a <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.SphericalCoordinate" title="mspasspy.ccore.utility.SphericalCoordinate"><code class="xref py py-class docutils literal notranslate"><span class="pre">SphericalCoordinate</span></code></a> object and calles the
related rotate with it.</p>
<p>If a <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code> number is given, it will rotate the horizontal components by this much angle in radians.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be rotated.</p></li>
<li><p><strong>rotate_param</strong> (<em>see above for details.</em>) – the parameter that defines the rotation.</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.rotate_to_standard">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">rotate_to_standard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#rotate_to_standard"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.rotate_to_standard" title="Permalink to this definition"></a></dt>
<dd><p>Apply inverse transformation matrix to return data to cardinal direction components.</p>
<p>It is frequently necessary to make certain a set of three component data are oriented
to the standard reference frame (EW, NS, Vertical).  This function does this.
For efficiency it checks the components_are_cardinal variable and does nothing if
it is set true.  Otherwise, it applies the inverse transformation and then sets this variable true.
Note even if the current transformation matrix is not orthogonal it will be put back into
cardinal coordinates.</p>
<p>If inversion of the transformation matrix is not possible (e.g. two components are colinear)
an error thrown by the C++ function is caught, posted to elog, and the
datum return will be marked dead.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be rotated.</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
<dt class="field-even">Exception<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.utility.MsPASSError" title="mspasspy.ccore.utility.MsPASSError"><code class="xref py py-class docutils literal notranslate"><span class="pre">MsPASSError</span></code></a> thrown if the an inversion of the
transformation matrix is required and that matrix is singular.  This can happen if the
transformation matrix is incorrectly defined or the actual data are coplanar.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.rtoa">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">rtoa</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#rtoa"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.rtoa" title="Permalink to this definition"></a></dt>
<dd><p>Relative to absolute time conversion.</p>
<p>Sometimes we want to convert data from relative time to
to an UTC time standard.  An example would be converting
segy shot data to something that could be processed like earthquake
data in a css3.0 database. This function returns data
previously converted to relative back to UTC using the
internally stored time shift attribute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be converted.</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.transform">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#transform"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.transform" title="Permalink to this definition"></a></dt>
<dd><p>Applies an arbitrary transformation matrix to the data.</p>
<p>i.e. after calling this function the data will have been multiplied by the matrix
and the transformation matrix will be updated.  The later allows cascaded
transformations to data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be transformed.</p></li>
<li><p><strong>matrix</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.array</span></code>) – a 3x3 matrix that defines the transformation.</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.transform_to_LQT">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">transform_to_LQT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seaz_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'seaz'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ema_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ema'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angle_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'degrees'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#transform_to_LQT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.transform_to_LQT" title="Permalink to this definition"></a></dt>
<dd><p>Applies coordinate transform to LQT version of ray coordinates.</p>
<p>LQT is an orthogonal coordinate transformation for Seismogram
objects that cause the output data to have x1-Longitudinal (positive up
normally set to the predicted emergence angle of P particle motion),
x2 - Q a rotated radial direction (in propagation direction but tilted by theta).
and x3 - transverse (T) in direction to define a right handed coordinate
system.  The function produces this transformation
by the product f three transformation:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Uses rotate_to_standard to assure we start from cardinal directions.</p></li>
<li><p>Transformation to what might be called TQL using the Seismogram
C++ method rotate using a SphericalCoordinate definition.</p></li>
<li><p>Transformation to LQT to rearrange the order of the Seismogram
data matrix (also requires a sign change on T to keep the output
right handed)</p></li>
</ol>
</div></blockquote>
<p>The form of the transformation can be specified in one of two
completely different ways.   By default the function attempts to
extract the back azimuth from station to event with using the
metadata key defined by ‘seaz_key’ (default ‘seaz’) and the P
emergence angle with the metadata key defined by the ‘ema_key’
argument (default ‘ema’).   If the arguments ‘phi’ and ‘theta’ are
defined they are assumed angles to be used to defined the
transformation and no attempt will be made to fetch the value from
Metaata (Rarely a good idea with ensemble but can be useful for atomic data.
Using Metadata is strongly preferred because it also preserves what
the angles used where.  They are not if the argument approach is used.)
Metadata values are required to be in degree units.  If the argument
approach is used radian values can to used if you also set
the argument “angle_units” to “radians”.</p>
<p>Note the operation handles the singular case of theta==0.0 where it
simply uses the phi value and rotates the coordinates in a variant of
RTZ (variant because order is different).
:param seaz_key:  key to use to fetch back azimuth value (assumed degrees always)
:type key:  string (default “seaz”)
:param ema_key:  key to use to fetch emergence angle defining L direction
relative to local vertical.
:type ema_key:  string (defautl “ema”)
:param phi:   angle to rotate around vertical to define the transformation
(positive anticlockwise convention NOT azimuth convention)  Default is None
which means ignore this parameter and use key.  Setting this value to
something other than None causes the Metadata fetch method to be overridden.
WARNING:  this is not backazimuth but angle relative to E direction.
Note that is not at all what is expected when using a Metadata key
:type phi:  float
:param theta:   angle relative to local vertical for defining the L
coordinate direction.  It is the same as theta in spherical coordinates
with emergence angle pointing upward.  Default is None which causes the
algorithm to automatically assume the Metadata key method should be used.
:type theta:  float
:param angle_units:  should be either ‘degrees’ (default) or ‘radians’.
An invalid value will be treated as an attempt to switch to radians
but will generate an elog warning message.  This argument is ignored unless
phi is not null (None type)
:type angle_units: string
:param alg_name: alg_name is the name the func we are gonna save while preserving the history.
:type alg_name: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param alg_id: alg_id is a unique id to record the usage of func while preserving the history.
:type alg_id: <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>
:param dryrun: True for dry-run, which return “OK”. Used in the mspass_func_wrapper.
:param inplace_return: True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.
:param function_return_key:  Some functions one might want to wrap with this decorator</p>
<blockquote>
<div><p>return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p>
<dl class="field-list simple">
<dt class="field-odd">return<span class="colon">:</span></dt>
<dd class="field-odd"><p>transformed version of input.  For ensembles the entire ensemble</p>
</dd>
</dl>
<p>is transformed.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.transform_to_RTZ">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">transform_to_RTZ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'seaz'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angle_units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'degrees'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_is_backazimuth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#transform_to_RTZ"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.transform_to_RTZ" title="Permalink to this definition"></a></dt>
<dd><p>Applies coordinate transform to RTZ version of ray coordinates.</p>
<p>RTZ is the simplest transformation for three component data to
what is commonly called ray coordinates.  R-radial (SV), T-transverse
(SH). and Z=vertical (bad measure of longitudinal).  The function
first forces the data to cardinal direction using rotate_to_standard
and then rotates the coordinates around the vertical axis.   The
rotation can be defined in one of two ways.  The default behavior
is to attempt to extract the back azimuth from the station to the
source with the key defined by the “key” argument (defaults to ‘seaz’).
That behavior will be overriden if the “phi” kwarg value is set.
Phi is assumed to be the angle to rotate the coordinates using the
math convention for the phi angle with positive anticlockwise.
The units of the value retrieved with the key argument or the value
passed via the phi argument are by default assumed to be in degrees.
If using the phi argument you specify the angle in radians if you
also set the “angle_units” argument to “radians”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a> or
<code class="xref py py-class docutils literal notranslate"><span class="pre">SeismogramEnsemble</span></code>.) – data object to be transformed</p></li>
<li><p><strong>key</strong> (<em>string</em>) – key to use to fetch back azimuth value (assumed degrees always)</p></li>
<li><p><strong>phi</strong> – angle to rotate around vertical to define the transformation</p></li>
</ul>
</dd>
</dl>
<p>(positive anticlockwise convention NOT azimuth convention)  Default is None
which means ignore this parameter and use key.  Setting this value to
something other than None causes the key method to be overridden.
:type phi:  float
:param angle_units:  should be either ‘degrees’ (default) or ‘radians’.
An invalid value will be treated as an attempt to switch to radians
but will generate an elog warning message.  This argument is ignored unless
phi is not null (None type)
:type angle_units: string
:param key_is_backazimuth: boolean that when True (default) assumes the
angle extrated with the key argument value is a backazimuth in degrees.
If set False, the angle will be assumed to be a rotation angle in
with the anticlockwise positive convention.
:param alg_name: alg_name is the name the func we are gonna save while preserving the history.
:type alg_name: <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>
:param alg_id: alg_id is a unique id to record the usage of func while preserving the history.
:type alg_id: <a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>
:param dryrun: True for dry-run, which return “OK”. Used in the mspass_func_wrapper.
:param inplace_return: True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.
:param function_return_key:  Some functions one might want to wrap with this decorator</p>
<blockquote>
<div><p>return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>transformed version of input.  For ensembles the entire ensemble</p>
</dd>
</dl>
<p>is transformed.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.basic.vector_taper">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.basic.</span></span><span class="sig-name descname"><span class="pre">vector_taper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">taper_array</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/basic.html#vector_taper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.basic.vector_taper" title="Permalink to this definition"></a></dt>
<dd><p>Apply a general taper defined by a vector to the data object.</p>
<p>This method provides a simple way to build a taper from a set of uniformly
spaced points. The apply methods will dogmatically only accept input
data of the same length as the taper defined in the operator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (either <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">Seismogram</span></code></a>) – data object to be processed.</p></li>
<li><p><strong>taper_array</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.array</span></code>) – the array that defines the taper</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper. This is necessary to be used in mapreduce.</p></li>
<li><p><strong>function_return_key</strong> – Some functions one might want to wrap with this decorator
return something that is appropriate to save as Metadata.  If so, use this argument to
define the key used to set that field in the data that is returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-mspasspy.algorithms.bundle">
<span id="bundle"></span><h2>bundle<a class="headerlink" href="#module-mspasspy.algorithms.bundle" title="Permalink to this heading"></a></h2>
<p>This is a set of thin wrappers for C++ code to do a process we call 
“bundling”.   That is, a Seismogram object can be constructed from 
3 TimeSeries objects spanning a common time period and having the 
same sample rate but with orientation pointing in 3 linearly 
independent directions.   There are a lot of complexities to assembling
such data and manipulating the data objects, which is why the 
process was implemented in C++.   The algorithms here are not completely 
generic and will likely need additions at some future data for nonstandard
data.  “standard” in this context means passive array data archived in 
the SEED (Standard Earthquake Exchange Data) format (aka miniseed which is
a standard subset of seed used for archives).  The algorithms here 
depend upon seismic channels being uniquely defined by four metadata keys:
net, sta, chan, and loc.   Bundles are formed by sorting data in the 
following key order:  net, sta, loc, chan.   The algorithms here are 
further limited to applications to ensembles that are the generalization 
of a reflection seismology “shot gather”.   That means an implict assumption
is the ensembles contain data assembled from one and only one event so 
there is a one-to-one relationship between each channel and an event tag.
if data from multiple events or something other than a shot gather 
are to be handled used the BundleGroup function station by station 
sorting the inputs by some other method to create triples of channels 
that can be merged into one Seismogram object.</p>
<p>Created on Mon Jan 11 05:34:10 2021</p>
<p>&#64;author: pavlis</p>
<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.bundle.BundleSEEDGroup">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.bundle.</span></span><span class="sig-name descname"><span class="pre">BundleSEEDGroup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/bundle.html#BundleSEEDGroup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.bundle.BundleSEEDGroup" title="Permalink to this definition"></a></dt>
<dd><p>Combine a grouped set of TimeSeries into one Seismogram.</p>
<p>A Seismogram object is a bundle of TimeSeries objects that define a
nonsingular tranformation matrix that can be used to reconstruct vector
group motion.   That requires three TimeSeries objects that have
define directions that are linearly independent.   This function does not
directly test for linear independence but depends upon channel codes
to assemble one or more bundles needed to build a Seismogram.  The
algorithm used here is simple and ONLY works if the inputs have been
sorted so the channels define a group of three unique channel codes.
For example,</p>
<blockquote>
<div><p>HHE, HHN, HHZ</p>
</div></blockquote>
<p>would form a typical seed channel grouping.</p>
<p>The function will attempt to handle duplicates.  By that I mean
if the group has two of the same channel code like these sequences:</p>
<blockquote>
<div><p>HHE, HHE, HHN, HHZ  or HHE, HHN, HHN, HHZ, HHZ</p>
</div></blockquote>
<p>If the duplicates are pure duplicates there is no complication and
the result will be clean.   If the time spans of the duplicate
channels are different the decision of which to use keys on a simple
idea that is most appropriate for data assembled by event with
mistakes in associations.  That is, it attempts to scans the group for
the earliest start time.  When duplicates are found it uses the one
with a start time closest to the minimum as the one merged to make the
output Seismogram.</p>
<p>The output will be marked as dead data with no valid data in one of
two conditions:  (1)  less than 3 unique channel names or (2) more than
three inputs with an inconsistent set of SEED names.   That “inconsistent”
test is obscure and yet another example that SEED is a four letter word.
Commentary aside, the rules are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The net code must be defined and the same in all TimeSeries passed</p></li>
<li><p>The station (sta) code must also be the same for all inputs</p></li>
<li><p>Similarly the loc code must be the same in all inputs.</p></li>
<li><p>Finally, there is a more obscure test on channel names.  They must</p></li>
</ol>
</div></blockquote>
<p>all have the same first two characters.   That is, BHE, BHN, BHN, BHZ
is ok but BHE, BHN, BHZ, HHE will cause an immediate exit with no
attempt to resolve the ambiguity - that is viewed a usage error in
defining the range of the bundle.</p>
<p>In all cases where the bundling is not possible the function does not
throw an exception but does four things:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Merges the Metadata of all inputs (uses the += operator so only the
last values of duplicate keys will be preserved in the return)</p></li>
<li><p>If ProcessingHistory is defined in the input they history records  are
posted to the returned Seismogram using as if the data were live but the
number of input will always be a number different from 3.</p></li>
<li><p>The return is marked dead.</p></li>
<li><p>The function posts a (hopefully) informative message to elog of the
returned Seismogram.</p></li>
</ol>
</div></blockquote>
<p>ProcessingHistory is handled internally by this function.  If all the
components in a group have a nonempty ProcessingHistory the data to link
the outputs to the inputs will be posted to ProcessingHistory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>d</strong> – This is assumed to be an array like object of TimeSeries data</p>
</dd>
</dl>
<p>that are to be used to build the Seismogram objects.  They must be
sorted as described above or the algorithm will fail.   Two typical
array like objects to use are the member attribute of a TimeSeriesEnsemble
or a python array constructed from a (sorted) collection of TimeSeries
objects.
:param i0:  starting array position for constructing output(s).
The default is 0 which would be the normal request for an full ensemble
or a single grouping assembled by some other mechanism.  A nonzero is
useful to work through a larger container one Seismogram at a time.
:param iend:  end array position.   The function will attempt to
assemble one or more Seismograms from TimeSeries in the range
d[i0] to d[iend].  Default is 2 for a single Seismogram without
duplicates.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.bundle.bundle_seed_data">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.bundle.</span></span><span class="sig-name descname"><span class="pre">bundle_seed_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ensemble</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/bundle.html#bundle_seed_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.bundle.bundle_seed_data" title="Permalink to this definition"></a></dt>
<dd><p>This function can be used to take an (unordered) input ensemble of
TimeSeries objects generated from miniseed data and produce an output
ensemble of Seismograms produced by bundles linked to the seed name
codes net, sta, chan, and loc.   An implicit assumption of the algorithm
used here is that the data are a variant of a shot gather and the
input ensemble defines one net:sta:chan:loc:time_interval for each
record that is to be bundled.   It can only properly handle pure
duplicates for a given net:sta:chan:loc combination.  (i.e. if
the input has the same TimeSeries defined by net:sta:chan:loc AND
a common start and end time).   Data with gaps broken into multiple
net:sta:chan:loc TimeSeries with different start and end times
will produce incomplete results.   That is, Seismograms in the output
associated with such inputs will either be killed with an associated
error log entry or in the best case truncated to the overlap range of
one of the segments with the gap(s) between.</p>
<p>Irregular start times of any set of TimeSeries forming a single
bundle are subject to the same truncation or discard rules described
in the related function Bundle3C.</p>
<p>Note there is not guarantee the Seismogram objects returned
will be in standard coordinates.  In fact, they will never be
with standard channel names because of the internal sorting.
It would normally be highly recommended the user call the
rotate_to_standard method on each Seismogram before any use.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ensemble</strong> – is the input ensemble of TimeSeries to be processed.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ensemble of Seismogram objects made by bundling input data</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.SeismogramEnsemble" title="mspasspy.ccore.seismic.SeismogramEnsemble">SeismogramEnsemble</a></p>
</dd>
<dt class="field-even">Exception<span class="colon">:</span></dt>
<dd class="field-even"><p>Can throw a MsPASSError for a number of conditions.</p>
</dd>
</dl>
<p>Caller should be enclosed in a handler if run on a large data set.</p>
</dd></dl>

</section>
<section id="module-mspasspy.algorithms.edit">
<span id="edit"></span><h2>edit<a class="headerlink" href="#module-mspasspy.algorithms.edit" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_to_add</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement += operator on a specified Metadata key.
Example:  to add 2 to data, d, with key=’icdp’ could use this</p>
<blockquote>
<div><p>op = Add(‘icdp’,2)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the key defined for the operator is defined for d.
Returns true if is defined and false if not.  the method assumes
d is a valid child of Metadata so the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Add2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add2" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement + operator that adds two Metadata attributes
together.  The attributes are feteched with two keys set when
the operator is constructed.  Let a be the value in a datum
associated with key2 (arg1 of constructor) and b be the
value associated with key2 (arg2 of constructor).  The apply
method of this class computes a+b and sets the Metadata attribute
defined by key0 (arg0 of constructor) to that value (a+b)
i.e. d[key0] = d[key1] + d[key2]</p>
<p>Note key0 can be the same as either key1 or key2. The contents of the
left hand side (key0) are always set by this operator unless that
input was previously marked dead.  Further key1 and key2 can be the
same although it is hard to conceive how that could be useful.</p>
<p>Example:  to compute ix as the d[‘sx’] + d[‘chan’] use</p>
<blockquote>
<div><p>op = Add2(‘ix1’,’sx’,’chan’)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add2.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add2.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add2.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add2.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add2.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add2.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the keys required for the operator are defined for d.
If either required key are missing from d return False.  Return
True if both are set in d. The method assumes
d is a valid child of Metadata so that the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Add2.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Add2.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Add2.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.ChangeKey">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">ChangeKey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">oldkey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newkey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">erase_old</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#ChangeKey"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.ChangeKey" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.ChangeKey.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fast_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#ChangeKey.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.ChangeKey.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.ChangeKey.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#ChangeKey.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.ChangeKey.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>All implementation should implement this checker even if all it contains
is a pass.  It should validate the keys are defined in data to be
handled in the apply method.   An early call in apply should always
be to call this method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.ChangeKey.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#ChangeKey.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.ChangeKey.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>there is no operation on a ChangeKey so this method does nothing.
Because it is an abstract base we have to have this stub.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Divide</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_to_divide</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement /= operator on a specified Metadata key.
Example:  to divide metadata in, d, with key=’Pamp’ by 2.0
you could use this</p>
<blockquote>
<div><p>op = Divide(‘Pamp’,2.-)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the key defined for the operator is defined for d.
Returns true if is defined and false if not.  the method assumes
d is a valid child of Metadata so the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Divide2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide2" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement / operator that divides two Metadata attributes.
The attributes are feteched with two keys set when
the operator is constructed.  Let a be the value in a datum
associated with key2 (arg1 of constructor) and b be the
value associated with key2 (arg2 of constructor).  The apply
method of this class computes a/b and sets the Metadata attribute
defined by key0 (arg0 of constructor) to that value (a/b)
i.e. d[key0] = d[key1] / d[key2]</p>
<p>Note key0 can be the same as either key1 or key2. The contents of the
left hand side (key0) are always set by this operator unless that
input was previously marked dead.  Further key1 and key2 can be the
same although it is hard to conceive how that could be useful.</p>
<p>Example:  to compute ix as the d[‘sx’] / d[‘chan’] use</p>
<blockquote>
<div><p>op = Divide2(‘ix1’,’sx’,’chan’)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide2.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide2.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide2.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide2.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide2.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide2.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the keys required for the operator are defined for d.
If either required key are missing from d return False.  Return
True if both are set in d. The method assumes
d is a valid child of Metadata so that the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Divide2.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Divide2.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Divide2.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Executioner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Executioner</span></span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Executioner"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Executioner" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Abstract base class for family of python classes used for killing
mspass data objects failing to pass a particular metric.
It is made abstract to define required methods a particular instance
must create.  As in any good OOP that also means subclasses can
add additional methods.   This class should be used only as base
class as it has no functionality by itself.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Executioner.edit_ensemble_members">
<span class="sig-name descname"><span class="pre">edit_ensemble_members</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ensemble</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Executioner.edit_ensemble_members"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Executioner.edit_ensemble_members" title="Permalink to this definition"></a></dt>
<dd><p>Subclasses should call this method if the input data are an
ensemble.   A trick of inheritance allows the algorithm of self
to then be applied to whole ensemble.  Putting this in the
base class avoids the duplication of duplicate code in all
subclasses.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Executioner.kill_if_true">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Executioner.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Executioner.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>This method should run a test on d that will call the kill method
on MsPASS atomic object d if the test defined by the implementation
fails.  This is the main working method of this class of function
objects.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Executioner.log_kill">
<span class="sig-name descname"><span class="pre">log_kill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">testname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">severity=&lt;ErrorSeverity.Informational:</span> <span class="pre">5&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Executioner.log_kill"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Executioner.log_kill" title="Permalink to this definition"></a></dt>
<dd><p>This base class method is used to standardize the error logging
functionality of all Executioners.   It writes a standardized
message to simplify writing of subclasses - they need only
define the testname (normally the name of the subclass) and
format a specific message to be posted.</p>
<p>Note most subclasses will may want to include a verbose option
(or the reciprocal silent) and only write log messages when
verbose is set true.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – MsPASS data object to which elog message is to be
written.</p></li>
<li><p><strong>testname</strong> – is the string assigned to the “algorithm” field</p></li>
</ul>
</dd>
</dl>
<p>of the message posted to d.elog.
:param message:  specialized message to post - this string is added
to an internal generic message.
:param severity:  ErrorSeverity to assign to elog message
(See ErrorLogger docstring).  Default is Informational</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.FiringSquad">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">FiringSquad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">executioner_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#FiringSquad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.FiringSquad" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Used to apply multiple Executioners in a single pass - hence the name
FiringSquare image; facing more than one thing that could kill you.
The implementation in kill_if_true iterates through a list of
Executioners.  Once the datum is killed it is immediately returned.
If the Executions are running in verbose mode that means some tests
can shadow others.   It is like a firing squad where the guns are fired
in sequence and the body is removed as soon as there is a hit.  The
victim walks away only if all the guns miss.</p>
<p>Note the class has a += operator to allow appending additional
tests to the chain.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.FiringSquad.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#FiringSquad.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.FiringSquad.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of base class method.  In this case failure is
defined as not passing one of the set of tests loaded  when
the object was created.  As noted earlier the tests are performed
in the same order they were passed to the constructor of added on
with the += operator.
:param d: is a mspass data object to be checked</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">IntegerDivide</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement // operator on a specified Metadata key.
The // operator is a bit obscure but it implements the common
need to truncate a division result to an integer.  This will work
on floats but the result will always be close to and integer
value as if the operation were done with integers.  Note
also IntegerDivide is the complement to Mod which returns the remainder
of such a division.</p>
<p>Example:  to apply integer division to metadata in, d, with key=’icdp’ by 5
you could use this</p>
<blockquote>
<div><p>op = IntegerDivide(‘icdp’,5)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the key defined for the operator is defined for d.
Returns true if is defined and false if not.  the method assumes
d is a valid child of Metadata so the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">IntegerDivide2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide2" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement // operator between two Metadata attributes.
The attributes are feteched with two keys set when
the operator is constructed.  Let a be the value in a datum
associated with key2 (arg1 of constructor) and b be the
value associated with key2 (arg2 of constructor).  The apply
method of this class computes a//b and sets the Metadata attribute
defined by key0 (arg0 of constructor) to that value (a+b)
i.e. d[key0] = d[key1] // d[key2]</p>
<p>Note key0 can be the same as either key1 or key2. The contents of the
left hand side (key0) are always set by this operator unless that
input was previously marked dead.  Further key1 and key2 can be the
same although it is hard to conceive how that could be useful.</p>
<p>Example:  to compute ix as the d[‘sx’] // d[‘chan’] use</p>
<blockquote>
<div><p>op = IntegerDivide2(‘ix1’,’sx’,’chan’)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide2.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide2.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide2.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide2.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide2.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide2.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the keys required for the operator are defined for d.
If either required key are missing from d return False.  Return
True if both are set in d. The method assumes
d is a valid child of Metadata so that the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.IntegerDivide2.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#IntegerDivide2.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.IntegerDivide2.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataDefined">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataDefined</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataDefined"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataDefined" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using an existence test.  The
constructor loads only a key string.   The test for the kill_if_true
method is then simply for the existence of a value associated with
the loaded key.   Data will be killed if the defined key exists
in the Metadata (header).</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataDefined.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataDefined.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataDefined.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if self.key is defined for this datum</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataEQ">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataEQ</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataEQ"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataEQ" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using an equality test of a
Metadata attribute.  Both the metadata key and the threshold
for the kill test are set on creation.  This implementation should
work on any value pairs for which the == operator in python works.
That is true for pairs of numeric types, for example, but will fail
if one of the pair is a string (an error anyway for any rational use of this).
It should also work for any pair of pyobjects for which operator &gt;= is defined,
although anything nonstandard should be tested carefully before using
this class for editing data with such nonstandard types.  This was
mostly intended for simple numeric attributes.  It can be used for
booleans even though few would write an if statement testing if two
booleans were equal.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataEQ.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataEQ.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataEQ.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] == value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataGE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataGE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataGE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataGE" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using a greater than or equal test of a
Metadata attribute.  Both the metadata key and the threshold
for the kill test are set on creation.  This implementation should
work on any value pairs for which the &gt;= operator in python works.
That is true for pairs of numeric types, for example, but will fail
if one of the pair is a string (an error anyway for any rational use of this).
It should also work for any pair of pyobjects for which operator &gt;= is defined,
although anything nonstandard should be tested carefully before using
this class for editing data with such nonstandard types.  This was
mostly intended for simple numeric attributes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataGE.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataGE.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataGE.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] &gt;= value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataGT">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataGT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataGT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataGT" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using a greater than test of a
Metadata attribute.  Both the metadata key and the threshold
for the kill test are set on creation.  This implementation should
work on any value pairs for which the &gt; operator in python works.
That is true for pairs of numeric types, for example, but will fail
if one of the pair is a string (an error anyway for any rational use of this).
It should also work for any pair of pyobjects for which operator &gt; is defined,
although anything nonstandard should be tested carefully before using
this class for editing data with such nonstandard types.  This was
mostly intended for simple numeric attributes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataGT.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataGT.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataGT.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] &gt; value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataInterval">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataInterval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lower_endpoint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upper_endpoint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_lower_edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_upper_edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kill_if_outside</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataInterval"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataInterval" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner based on a numeric range of values.
i.e. it tests if a metadata value is in a range defined by
an upper and lower value.   Ranges have a minor complication in
handling the edge condition: should or should the test not include
the edge?   Rather than write different functions for the four possible
combinations of &lt;=, &lt;, &gt;=, and &gt; that define a range we use
constructor arguments (use_lower_edge and use_upper_edge) to
turn inclusion of the boundary on and off.</p>
<p>In this context an interval test also has two logical alternatives.
One may want to keep data inside an interval (most common and default)
or delete data within a specified interval.   That logic is controlled by
the kill_if_outside boolean</p>
<p>Intervals mostly make sense only for numeric types (int and float), but
can be used with strings.  In reality this function should work with any
object for which the operators &gt;, &lt;, &gt;=, and &gt;= are defined but that is
adventure land if you try.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataInterval.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataInterval.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataInterval.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] &lt;= value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataLE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataLE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataLE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataLE" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using a less than or equal test of a
Metadata attribute.  Both the metadata key and the threshold
for the kill test are set on creation.  This implementation should
work on any value pairs for which the &lt;= operator in python works.
That is true for pairs of numeric types, for example, but will fail
if one of the pair is a string (an error anyway for any rational use of this).
It should also work for any pair of pyobjects for which operator &gt;= is defined,
although anything nonstandard should be tested carefully before using
this class for editing data with such nonstandard types.  This was
mostly intended for simple numeric attributes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataLE.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataLE.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataLE.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] &lt;= value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataLT">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataLT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataLT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataLT" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using a lessthan test of a
Metadata attribute.  Both the metadata key and the threshold
for the kill test are set on creation.  This implementation should
work on any value pairs for which the &lt; operator in python works.
That is true for pairs of numeric types, for example, but will fail
if one of the pair is a string (an error anyway for any rational use of this).
It should also work for any pair of pyobjects for which operator &lt; is defined,
although anything nonstandard should be tested carefully before using
this class for editing data with such nonstandard types.  This was
mostly intended for simple numeric attributes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataLT.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataLT.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataLT.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] &gt; value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataNE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataNE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataNE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataNE" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using an not equal (NE) test of a
Metadata attribute.  Both the metadata key and the threshold
for the kill test are set on creation.  This implementation should
work on any value pairs for which the != operator in python works.
That is true for pairs of numeric types, for example, but will fail
if one of the pair is a string (an error anyway for any rational use of this).
It should also work for any pair of pyobjects for which operator &gt;= is defined,
although anything nonstandard should be tested carefully before using
this class for editing data with such nonstandard types.  This was
mostly intended for simple numeric attributes.  It can be used for
booleans even though few would write an if statement testing if two
booleans were equal.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataNE.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataNE.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataNE.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if the d[self.key] != value stored with the class.</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataOperator</span></span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperator" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Base class for a set of inline Metadata editors. That is, there
are many instances where Metadata attributes need to be altered
during a workflow where it is either unnecessary or inappropriate
to access the database.   e.g. we have found updates in MongoDB
can be very slow if done one transaction at a time so it can
streamline processing to edit metadata on the fly.   This base
class defines the API for a suite of tools for editing metadata
on the fly.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperator.apply">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fast_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperator.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperator.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperator.check_keys">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperator.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperator.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>All implementation should implement this checker even if all it contains
is a pass.  It should validate the keys are defined in data to be
handled in the apply method.   An early call in apply should always
be to call this method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperator.check_operation">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperator.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperator.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>All implementations should implement this method even if they choose
to ignore it.   It should be used to guarantee the operator the class
defines will succeed on the datum sent to the apply method.
e.g. any standard arithmetic operations will throw a TypeError if
one of the operands is a string.   This method should be used to
make the operator as bombproof as possible logging a message
to the datum rather than aborting if there is an issue.  Some
classes may want to implement this as pass because it makes
no sense - e.g. setting a constant value.   Those are the
exception, however, so the api dogmatically demands these
be implemented even if they do nothing.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperator.edit_ensemble_members">
<span class="sig-name descname"><span class="pre">edit_ensemble_members</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ensemble</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperator.edit_ensemble_members"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperator.edit_ensemble_members" title="Permalink to this definition"></a></dt>
<dd><p>Subclasses should call this method if the input data are an
ensemble.   A trick of inheritance allows the algorithm of self
to then be applied to whole ensemble.  Putting this in the
base class avoids the duplication of duplicate code in all         subclasses.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperator.log_edit">
<span class="sig-name descname"><span class="pre">log_edit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">testname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">severity=&lt;ErrorSeverity.Informational:</span> <span class="pre">5&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperator.log_edit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperator.log_edit" title="Permalink to this definition"></a></dt>
<dd><p>This base class method is used to standardize the error logging
functionality of all editors.   It writes a standardized
message to simplify writing of subclasses - they need only
define the testname (normally the name of the subclass) and
format a specific message to be posted.</p>
<p>Note most subclasses will may want to include a verbose option
(or the reciprocal silent) and only write log messages when
verbose is set true.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – MsPASS data object to which elog message is to be
written.</p></li>
<li><p><strong>testname</strong> – is the string assigned to the “algorithm” field</p></li>
</ul>
</dd>
</dl>
<p>of the message posted to d.elog.
:param message:  specialized message to post - this string is added
to an internal generic message.
:param severity:  ErrorSeverity to assign to elog message
(See ErrorLogger docstring).  Default is Informational</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperatorChain">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataOperatorChain</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">operator_list</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperatorChain"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperatorChain" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to apply multiple a chain of arithmetic operators to derive
computed metadata attributes.  Very elaborate calculations can be
done through this class by chaining appropriate atomic operators
defined elsewhere in the module (i.e. Add, Subtract, etc.).
The operation chain is defined by a python list of the atomic operators.
When the apply method of this class is called the list of operators
are applied sequentially in list order.</p>
<p>Note the class has a += operator to allow appending additional
operators to the chain.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperatorChain.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperatorChain.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperatorChain.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of base class method.  In this case failure is
defined as not passing one of the set of tests loaded  when
the object was created.  As noted earlier the tests are performed
in the same order they were passed to the constructor of added on
with the += operator.
:param d: is a mspass data object to be checked</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperatorChain.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperatorChain.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperatorChain.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>All implementation should implement this checker even if all it contains
is a pass.  It should validate the keys are defined in data to be
handled in the apply method.   An early call in apply should always
be to call this method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataOperatorChain.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataOperatorChain.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataOperatorChain.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>All implementations should implement this method even if they choose
to ignore it.   It should be used to guarantee the operator the class
defines will succeed on the datum sent to the apply method.
e.g. any standard arithmetic operations will throw a TypeError if
one of the operands is a string.   This method should be used to
make the operator as bombproof as possible logging a message
to the datum rather than aborting if there is an issue.  Some
classes may want to implement this as pass because it makes
no sense - e.g. setting a constant value.   Those are the
exception, however, so the api dogmatically demands these
be implemented even if they do nothing.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataUndefined">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">MetadataUndefined</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataUndefined"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataUndefined" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.Executioner" title="mspasspy.algorithms.edit.Executioner"><code class="xref py py-class docutils literal notranslate"><span class="pre">Executioner</span></code></a></p>
<p>Implementation of Executioner using an nonexistence test.  The
constructor loads only a key string.   The test for the kill_if_true
method is then simply for the existence of a value associated with
the loaded key.   Data will be killed if the defined key does not exists
(Undefined) in the Metadata (header).</p>
<p>This class is a useful prefilter to apply to any algorithm that
requires a particular metadata attribute.  Use FiringSquad to define
a chain of required metadata to prefilter data input to such an algorithm.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.MetadataUndefined.kill_if_true">
<span class="sig-name descname"><span class="pre">kill_if_true</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#MetadataUndefined.kill_if_true"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.MetadataUndefined.kill_if_true" title="Permalink to this definition"></a></dt>
<dd><p>Implementation of this abstract method for this tester.
Kills d if self.key is not defined for this datum</p>
<p>Returns a (potentially edited) copy of the input to allow use in
a parallel map operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Mod</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement % operator on a specified Metadata key.
The % operator is a bit obscure but it implements the common
need return the remainder of a divide operation.   It is commonly
used, for example, in cmp processing where survey flag numbers can
often be converted to channel numbers for simple multichannel cable
geometries.</p>
<p>This operator will work any numeric type but it is most commonly used
for integer attributes.</p>
<p>Example:  to convert the metadata associated with the key ‘ichan’ that
are currently counting by 1 to numbers that cycle from 0 to 23 us this:</p>
<blockquote>
<div><p>op = Mod(‘ix’,24)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the key defined for the operator is defined for d.
Returns true if is defined and false if not.  the method assumes
d is a valid child of Metadata so the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Mod2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod2" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement % operator between two Metadata attributes.
The attributes are feteched with two keys set when
the operator is constructed.  Let a be the value in a datum
associated with key2 (arg1 of constructor) and b be the
value associated with key2 (arg2 of constructor).  The apply
method of this class computes a+b and sets the Metadata attribute
defined by key0 (arg0 of constructor) to that value (a%b)
i.e. d[key0] = d[key1] % d[key2]</p>
<p>Note key0 can be the same as either key1 or key2. The contents of the
left hand side (key0) are always set by this operator unless that
input was previously marked dead.  Further key1 and key2 can be the
same although it is hard to conceive how that could be useful.</p>
<p>Example:  to compute ix as the d[‘sx’] % d[‘chan’] use</p>
<blockquote>
<div><p>op = Mod2(‘ix1’,’sx’,’chan’)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod2.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod2.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod2.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod2.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod2.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod2.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the keys required for the operator are defined for d.
If either required key are missing from d return False.  Return
True if both are set in d. The method assumes
d is a valid child of Metadata so that the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Mod2.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Mod2.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Mod2.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Multiply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_to_multiply</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement <a href="#id1"><span class="problematic" id="id2">*</span></a>= operator on a specified Metadata key.
Example:  to multiple metadata in, d, with key=’Pamp’ by 2.5
you could use this</p>
<blockquote>
<div><p>op = Multiply(‘Pamp’,2.5)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the key defined for the operator is defined for d.
Returns true if is defined and false if not.  the method assumes
d is a valid child of Metadata so the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Multiply2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply2" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement * operator that multiplies two Metadata attributes
together.  The attributes are feteched with two keys set when
the operator is constructed.  Let a be the value in a datum
associated with key2 (arg1 of constructor) and b be the
value associated with key2 (arg2 of constructor).  The apply
method of this class computes a*b and sets the Metadata attribute
defined by key0 (arg0 of constructor) to that value (a*b)
i.e. d[key0] = d[key1] * d[key2]</p>
<p>Note key0 can be the same as either key1 or key2. The contents of the
left hand side (key0) are always set by this operator unless that
input was previously marked dead.  Further key1 and key2 can be the
same although it is hard to conceive how that could be useful.</p>
<p>Example:  to compute ix as the d[‘sx’] * d[‘chan’] use</p>
<blockquote>
<div><p>op = Multiply2(‘ix1’,’sx’,’chan’)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply2.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply2.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply2.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply2.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply2.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply2.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the keys required for the operator are defined for d.
If either required key are missing from d return False.  Return
True if both are set in d. The method assumes
d is a valid child of Metadata so that the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Multiply2.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Multiply2.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Multiply2.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.SetValue">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">SetValue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constant_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#SetValue"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.SetValue" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to set a specified metadata key to a constant value.  Note any
existing value of Metadata associated with the key defined in the
operator always be overwritten.</p>
<p>Example:  to set the value of key = ‘a’ to constant 2.0</p>
<blockquote>
<div><p>op = SetValue(‘a’,2.0)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.SetValue.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#SetValue.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.SetValue.apply" title="Permalink to this definition"></a></dt>
<dd><p>Used to apply this operator to Metadata of a MsPASS data object.
Use of decorator adds common MsPASS arguments as call options.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>d</strong> – datum to which operator is to be applied.  d must be a</p>
</dd>
</dl>
<p>valid MsPASS data object or this method will throw a fatal MsPASSError
exception.  If d is marked dead it will be silently ignored.
:param apply_to_members:  when true and d is an ensemble object the
operator is applied to the members.  When false the metadata for the
ensemble will be altered.  This parameter is ignored for atomic
data types.  Default is False.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>always returns a (usually) edited copy of the input d.</p>
</dd>
</dl>
<p>When the input d is dead the copy will always be unaltered.
Note the copy is a shallow copy which in python means we just return
the equivalent of a pointer to the caller.  Important for efficiency
as d can be very large for some ensembles.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.SetValue.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#SetValue.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.SetValue.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>Useless implementation of required abstract base method.  In this
case all it does is test if the stored value of key is a string.
Returns true if the key is a string and false otherwise.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.SetValue.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#SetValue.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.SetValue.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>All implementations should implement this method even if they choose
to ignore it.   It should be used to guarantee the operator the class
defines will succeed on the datum sent to the apply method.
e.g. any standard arithmetic operations will throw a TypeError if
one of the operands is a string.   This method should be used to
make the operator as bombproof as possible logging a message
to the datum rather than aborting if there is an issue.  Some
classes may want to implement this as pass because it makes
no sense - e.g. setting a constant value.   Those are the
exception, however, so the api dogmatically demands these
be implemented even if they do nothing.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Subtract</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_to_subtract</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement -= operator on a specified Metadata key.
Example:  to subtract 2 from metadata, d, with key=’icdp’ could use this</p>
<blockquote>
<div><p>op = Subtract(‘icdp’,2)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the key defined for the operator is defined for d.
Returns true if is defined and false if not.  the method assumes
d is a valid child of Metadata so the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract2">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">Subtract2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract2" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.algorithms.edit.MetadataOperator" title="mspasspy.algorithms.edit.MetadataOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataOperator</span></code></a></p>
<p>Used to implement - operator that computes the difference of two Metadata
attributes.  The attributes are feteched with two keys set when
the operator is constructed.  Let a be the value in a datum
associated with key2 (arg1 of constructor) and b be the
value associated with key2 (arg2 of constructor).  The apply
method of this class computes a-b and sets the Metadata attribute
defined by key0 (arg0 of constructor) to that value (a-b)
i.e. d[key0] = d[key1] - d[key2]</p>
<p>Note key0 can be the same as either key1 or key2. The contents of the
left hand side (key0) are always set by this operator unless that
input was previously marked dead.  Further key1 and key2 can be the
same although it is hard to conceive how that could be useful.</p>
<p>Example:  to compute ix as the d[‘sx’] - d[‘chan’] use</p>
<blockquote>
<div><p>op = Subtract2(‘ix1’,’sx’,’chan’)
d = op.apply(d)</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract2.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract2.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract2.apply" title="Permalink to this definition"></a></dt>
<dd><p>Implementations are required to implement this method.  It must
accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,
or SeimogramEnsemble) and apply the operator the implementation defines
to the Metadata of d.   It should throw a MsPASSError exception if
d is not one of the expected data types.  It should, on the other
hand, handle d==None gracefully and do nothing if d is None.
Ensemble handlers need to deal with an ambiguity in which metadata
the operation refers to.  Both the overall ensemble container and
individual members have (normally independent) Metadata containers.
Implementations of this method should have a apply_to_members
argument as in the signature for this base class.   When True
the editing is done by a loop over all members while if
False (which should be the default) the ensemble’s container
should be used.</p>
<p>This method must return an (potentially but not guarnateed) edited
version of d.  That is essential to allow this method to be used
as the function in a parallel map operator.</p>
<p>If a required metadata key is missing this method should do nothing
unless a verbose flag is set.  In that case it should log that as
an error.   Best practice for any use of operators based on this
base class is to apply a kill operator for (MetadataDefined) on
all data before running a calculator.    That way you can guarantee
the data needed for all operations is valid before trying to
do calculations on on required metadata.   There is some overhead
in validating metadata so all implementations should include
use of “fast_mode”.  When set true the safeties will be bypassed
for speed.  That includes at least the two requried methods
“check_keys” and “check_operation”.  Implementations may add
other safties.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract2.check_keys">
<span class="sig-name descname"><span class="pre">check_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract2.check_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract2.check_keys" title="Permalink to this definition"></a></dt>
<dd><p>checks that the keys required for the operator are defined for d.
If either required key are missing from d return False.  Return
True if both are set in d. The method assumes
d is a valid child of Metadata so that the is_defined method will
not generate an exception.  that means this method should ALWAYS
be called after a test with _input_is_valid.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.Subtract2.check_operation">
<span class="sig-name descname"><span class="pre">check_operation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#Subtract2.check_operation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.Subtract2.check_operation" title="Permalink to this definition"></a></dt>
<dd><p>This method checks to make sure the value works with the operation
required.  It provides a (required by the base class) standardization
of testing for validity of the operation.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.edit.erase_metadata">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.edit.</span></span><span class="sig-name descname"><span class="pre">erase_metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keylist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to_members</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/edit.html#erase_metadata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.edit.erase_metadata" title="Permalink to this definition"></a></dt>
<dd><p>This editor clears the contents of any data associated with a list of
Metadata keys.   If there is no data for that key it will silently do
nothing.  If the input is an ensemble and apply_to_members is True
all the algorithm will run on the metadata of each member in a loop.
If false only the ensemble (global) metadata are handled.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>d</strong> – must be a valid MsPASS data object. If not the function</p>
</dd>
</dl>
<p>will throw an exception.   If the datum is marked dead it will
silently just return the contents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>keylist</strong> – python list of strings to use as keywords.  Any matching</p>
</dd>
</dl>
<p>keys the metadata of d will be cleared.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>apply_to_members</strong> – is a boolean controlling how the function</p>
</dd>
</dl>
<p>should handle ensembles.  Then set true the erase algorithm will be
applied in a loop over the member vector of an input ensemble.  When
False (default) only the ensemble’s metadata is checked.  This parameter
is ignored if the input is an atomic data type.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>edited copy of d</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-mspasspy.algorithms.signals">
<span id="signals"></span><h2>signals<a class="headerlink" href="#module-mspasspy.algorithms.signals" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.correlate">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">correlate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'correlate'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">demean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'naive'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#correlate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.correlate" title="Permalink to this definition"></a></dt>
<dd><p>Cross-correlation of two signals up to a specified maximal shift.
:param a: first signal
:param b: second signal
:param shift: Number of samples to shift for cross correlation. The cross-correlation will consist of 2*shift+1 or</p>
<blockquote>
<div><p>2*shift samples. The sample with zero shift will be in the middle.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper_multi</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>demean</strong> (<em>bool</em>) – Demean data beforehand.</p></li>
<li><p><strong>normalize</strong> – Method for normalization of cross-correlation. One of ‘naive’ or None (True and False are
supported for backwards compatibility). ‘naive’ normalizes by the overall standard deviation. None does not normalize.</p></li>
<li><p><strong>method</strong> (<em>str</em>) – Method to use to calculate the correlation. ‘direct’: The correlation is determined directly from
sums, the definition of correlation. ‘fft’ The Fast Fourier Transform is used to perform the correlation more
quickly. ‘auto’ Automatically chooses direct or Fourier method based on an estimate of which is faster.
(Only available for SciPy versions &gt;= 0.19. For older Scipy version method defaults to ‘fft’.)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>cross-correlation function.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.correlate_stream_template">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">correlate_stream_template</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stream</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'correlate_stream_template'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'seismogram'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#correlate_stream_template"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.correlate_stream_template" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.correlate_template">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">correlate_template</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'correlate_template'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'valid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'full'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">demean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#correlate_template"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.correlate_template" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.correlation_detector">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">correlation_detector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stream</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">templates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">heights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'correlation_detector'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template_times</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template_magnitudes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">details</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'seismogram'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#correlation_detector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.correlation_detector" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.detrend">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">detrend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dtrend'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'simple'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#detrend"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.detrend" title="Permalink to this definition"></a></dt>
<dd><p>This function removes a trend from the data, which is a mspasspy object. Note it is wrapped by mspass_func_wrapper,
so the processing history and error logs can be preserved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – input data, only mspasspy data objects are accepted, i.e. TimeSeries, Seismogram, Ensemble.</p></li>
<li><p><strong>type</strong> (<em>str</em>) – type of filter, ‘simple’, ‘linear’, ‘constant’, ‘polynomial’, ‘spline’. You can refer to
<cite>Obspy &lt;https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.detrend.html&gt;</cite> for details.</p></li>
<li><p><strong>args</strong> – extra arguments</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper.</p></li>
<li><p><strong>options</strong> – extra kv options</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.filter">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'filter'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">options</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.filter" title="Permalink to this definition"></a></dt>
<dd><p>This function filters the data of mspasspy objects. Note it is wrapped by mspass_func_wrapper, so the processing
history and error logs can be preserved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – input data, only mspasspy data objects are accepted, i.e. TimeSeries, Seismogram, Ensemble.</p></li>
<li><p><strong>type</strong> (<em>str</em>) – type of filter, ‘bandpass’, ‘bandstop’, ‘lowpass’, ‘highpass’, ‘lowpass_cheby_2’, ‘lowpass_fir’,
‘remez_fir’. You can refer to
<cite>Obspy &lt;https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.filter.html&gt;</cite> for details.</p></li>
<li><p><strong>args</strong> – extra arguments</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper.</p></li>
<li><p><strong>options</strong> – extra kv options</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.interpolate">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">interpolate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sampling_rate</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'interpolate'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inplace_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'weighted_average_slopes'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starttime</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#interpolate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.interpolate" title="Permalink to this definition"></a></dt>
<dd><p>This function interpolates data, which is a mspasspy object. Note it is wrapped by mspass_func_wrapper,
so the processing history and error logs can be preserved.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – input data, only mspasspy data objects are accepted, i.e. TimeSeries, Seismogram, Ensemble.</p></li>
<li><p><strong>sampling_rate</strong> – The new sampling rate in Hz.</p></li>
<li><p><strong>args</strong> – extra arguments.</p></li>
<li><p><strong>object_history</strong> – True to preserve the processing history. For details, refer to
<code class="xref py py-class docutils literal notranslate"><span class="pre">mspass_func_wrapper</span></code>.</p></li>
<li><p><strong>alg_name</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – alg_name is the name the func we are gonna save while preserving the history.</p></li>
<li><p><strong>alg_id</strong> (<a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bson.objectid.ObjectId</span></code></a>) – alg_id is a unique id to record the usage of func while preserving the history.</p></li>
<li><p><strong>dryrun</strong> – True for dry-run, which return “OK”. Used in the mspass_func_wrapper.</p></li>
<li><p><strong>inplace_return</strong> – True to return data in mspass_func_wrapper.</p></li>
<li><p><strong>method</strong> (<em>str</em>) – One of “linear”, “nearest”, “zero”, “slinear”, “quadratic”, “cubic”, “lanczos”,
or “weighted_average_slopes”. You can refer to
<cite>Obspy &lt;https://docs.obspy.org/packages/autogen/obspy.core.trace.Trace.interpolate.html&gt;</cite> for details.</p></li>
<li><p><strong>starttime</strong> (<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.utcdatetime.UTCDateTime.html#obspy.core.utcdatetime.UTCDateTime" title="(in ObsPy v1.4.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">UTCDateTime</span></code></a> or int) – The start time (or timestamp) for the new interpolated stream.
Will be set to current start time of the data if not given.</p></li>
<li><p><strong>npts</strong> (<em>int</em>) – The new number of samples. Will be set to the best fitting number to retain the current end time
of the trace if not given.</p></li>
<li><p><strong>time_shift</strong> – Shift the trace by adding time_shift to the starttime. The time shift is always given in seconds.
A positive shift means the data is shifted towards the future, e.g. a positive time delta.
Note that this parameter solely affects the metadata. The actual interpolation of the underlaying data is governed
by the parameters sampling_rate, starttime and npts.</p></li>
<li><p><strong>kwargs</strong> – extra kv arguments</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.templates_max_similarity">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">templates_max_similarity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">st</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">streams_templates</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'templates_max_similarity'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#templates_max_similarity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.templates_max_similarity" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.xcorr_3c">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">xcorr_3c</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">st1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">st2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift_len</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'xcor_3c'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full_xcorr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abs_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#xcorr_3c"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.xcorr_3c" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.xcorr_max">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">xcorr_max</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'xcor_max'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abs_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#xcorr_max"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.xcorr_max" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.signals.xcorr_pick_correction">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.signals.</span></span><span class="sig-name descname"><span class="pre">xcorr_pick_correction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trace1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trace2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pick1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pick2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_before</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t_after</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cc_maxlag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'xcorr_pick_correction'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/signals.html#xcorr_pick_correction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.signals.xcorr_pick_correction" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-mspasspy.algorithms.snr">
<span id="snr"></span><h2>snr<a class="headerlink" href="#module-mspasspy.algorithms.snr" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.snr.FD_snr_estimator">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.snr.</span></span><span class="sig-name descname"><span class="pre">FD_snr_estimator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_spectrum_engine=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_spectrum_engine=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">band_cutoff_snr=2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_detection_minimum_bandwidth=6.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tbp=4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntapers=6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">high_frequency_search_start=2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fix_high_edge=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">poles=3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perc=95.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optional_metrics=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_spectra=False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/snr.html#FD_snr_estimator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.snr.FD_snr_estimator" title="Permalink to this definition"></a></dt>
<dd><p>Estimates one or more amplitude metrics of signal-to-noise from a TimeSeries object.
An implicit assumption is that the analysis is centered on a timeable “phase”
like P, PP, etc.</p>
<p>This is a python function that can be used to compute one or several
signal-to-noise ratio estimates based on an estimated bandwidth using
the C++ function EstimateBandwidth.  The function has a fair number of
options, but the core metrics computed are the bandwidth estimates
computed by that function.  It uses a fairly simple search algorithm
that functions well for most earthquake sources.  For the low end the
algorithm searches from the first frequency indistinguishable from DC to
find the lowest frequency for which the snr exceeds a threshold specified
by the input parameter ‘band_cutoff_snr’.   It does a similar search
from the high end from a point 80% of Nyquist - a good choice for all
modern digital data that use FIR antialias filters.   Both searches are
not just defined with just the first frequency to satisfy the snr
threshold criteria.  Only when a group of frequencies more than 2 times
the time-bandwidth product exceed the threshold is the band edge
defined.   The actual band edge is then defined as the first frequency
exceeding the threshold.  That more elaborate algorithm was used to
prevent pure lines in either the signal or noise spectrum from
corrupting the estimates.</p>
<p>A set of optional metrics can be computed.  All optional metrics use
the bandwidth estimates in one way or another.   Optional metrics are
defined by the following keywords passed through a list (actually
any iterable container will work) of strings defining one or more
of the keywords. The metrics and a brief description of each follow:</p>
<p><em>snr_stats</em> computes what are commonly plotted in box plots for the
snr estimates within the estimated bandwidth:  minimum, maximum,
0.25 (1/4) point, 0.75 (3/4) point, and the median.   These are set
with following dict keys:   ‘snr_band_maximum’,’snr_band_minimum’,
‘snr_band_1/4’, ‘srn_band_3/4’, and ‘snr_band_median’ respectively.</p>
<p><em>filtered_envelope</em>, <em>filtered_L2</em>, <em>filtered_Linf</em>, <em>filtered_perc</em>, and <em>filtered_MAD</em>:
All of these optional metrics first copy the data_object and then
filter the copy with a Butterworth bandpass filter with the number of
poles specified by the npoles argument and corners at the estimated
band edge by the EstimateBandwidth function.   The metrics computed
are time domain snr estimates computed with he filtered data.  They are
actually computed from functions in this same module that can be
used independently and have their own docstring description. The
functions called have the following names in order of the keyword
list above:  <em>snr_envelope</em>, <em>snr_filtered_rms</em>, <em>snr_Linv</em>, and <em>snr_filtered_mad</em>.
When the computed they are set in the output dictionary with the
following (again in order) keys:  ‘snr_envelope’,’snr_filtered_rms’, ‘srn_Linf’,
and ‘snr_filtered_mad’.</p>
<p>It is important to note that all the metrics this function returns
are measures of amplitude NOT power.   You need to be particularly
aware of this if you unpickle the spectra created if you set
save_spectra true as those are power spectra.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data_object</strong> – TimeSeries object to be processed. For Seismogram</p>
</dd>
</dl>
<p>objects the assumption is algorithm would be used for a single
component (e.g longitudinal or vertical for a P phase)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>noise_window</strong> – defines the time window to use for computing the</p>
</dd>
</dl>
<p>spectrum considered noise. The time span can be either relative or
UTC (absolute) time but we do not check for consistency.  This low
level function assumes they are consistent.  If not, the calculations
are nearly guaranteed to fail.  Type must be mspasspy.ccore.TimeWindow.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>signal_window</strong> – defines the time window to use that defines what</p>
</dd>
</dl>
<p>you consider “the signal”.  The time span can be either relative or
UTC (absolute) time but we do not check for consistency.  This low
level function assumes they are consistent.  If not, the calculations
are nearly guaranteed to fail.  Type must be mspasspy.ccore.TimeWindow.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>noise_spectrum_engine</strong> – is expected to either by a None type</p>
</dd>
</dl>
<p>or an instance of a ccore object called an MTPowerSpectralEngine.
When None an instance of MTPowerSpectralEngine is computed for
each call to this function.   That is a convenience for small
jobs or when called with data from mixed sample rates and/or variable
length time windows.   It is very inefficient to use the default
approach for processing large data sets and really for any use in a
map operation with dask or spark.  Normal use should be for the user to
predefine an MtPowerSpectralEngine from the expected window size
for a given data sample rate and include it in the function call.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>signal_spectrum_engine</strong> – is the comparable MTPowerSpectralEngine</p>
</dd>
</dl>
<p>to use to compute the signal power spectrum.   Default is None with the
same caveat as above for the noise_spectrum_engine.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>band_cutoff_snr</strong> – defines the signal-to-noise ratio floor</p>
</dd>
</dl>
<p>used in the search for band edges.  See description of the algorithm
above and in the user’s manual.  Default is 2.0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>signal_detection_minimum_bandwidth</strong> – As noted above this</p>
</dd>
</dl>
<p>algorithm first tries to estimate the bandwidth of data where the
signal level exceeds the noise level defined by the parameter
band_cutoff_snr.  It then computes the bandwidth of the data in
dB computed as log10(f_high/f_low).  For almost any application
if the working bandwidth falls below some threshold the data is
junk to all intends and purpose.  A factor more relevant to this
algorithm is that the “optional parameters”  will all be meaningless
and a waste of computational effort if the bandwidth is too small.
A particular extreme example is zero bandwidth that happens all the
time if no frequency band exceeds the band_cutoff_snr for a range
over that minimum defined by the time-bandwidth product.  The
default is 6.0. (One octave which is roughly the width of the traditional
short-period band) which allows optional metrics to be computed
but may be too small for some applications.  If your application
requires higher snr and wider bandwidth adjust this parameter
and/or band_cutoff_snr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tbp</strong> – time-bandwidth product to use for computing the set of</p>
</dd>
</dl>
<p>Slepian functions used for the multitaper estimator.  This parameter is
used only if the noise_spectrum_engine or signal_spectrum_engine
arguments are set as None.  The default is 4.0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ntapers</strong> – is the number of Slepian functions (tapers) to compute</p>
</dd>
</dl>
<p>for the multitaper estimators. Like tbp it is referenced only if
noise_spectrum_engine or signal_spectrum_engine are set to None.
Note the function will throw an exception if the ntaper parameter is
not consistent with the time-bandwidth product.  That is, the
maximum number of tapers is round(2*tbp-1).   Default is 6 which is
consistent with default tbp=4.0 where the maximum recommended is 8</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>high_frequency_search_start</strong> – Used to specify the upper frequency
used to start the search for the upper end of the bandwidth by
the function EstimateBandwidth.  Default is 2.0 which reasonable for
teleseismic P wave data.  Should be change for usage other than
analysis of teleseimic P phases or you the bandwidth may be
grossly underestimated.</p></li>
<li><p><strong>fix_high_edge</strong> – boolean controlling upper search behavior.
When set True the search from the upper frequency limit is disabled
and the upper band limit edge is set as the value passed as
high_frequency_search_start.  False enables the search.
True is most useful for teleseismic body waves as many stations have
a series of closely enough spaced lines (presumably from electronic
sources) that set the high edge incorrectly.   False would be
more appropriate for most local and regional earthquake data.
The default is True.</p></li>
<li><p><strong>npoles</strong> – defines number of poles to us for the Butterworth</p></li>
</ul>
</dd>
</dl>
<p>bandpass applied for the “filtered” metrics (see above).  Default is 3.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>perc</strong> – used only if ‘filtered_perc’ is in the optional metrics list.</p>
</dd>
</dl>
<p>Specifies the perc parameter as used in seismic unix.  Uses the percentage
point specified of the sorted abs of all amplitudes.  (Not perc=50.0 is
identical to MAD)  Default is 95.0 which is 2 sigma for Gaussian noise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>optional_metrics</strong> – is an iterable container containing one or more</p>
</dd>
</dl>
<p>of the optional snr metrics discussed above.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>store_as_subdocument</strong> – This parameter is included for</p>
</dd>
</dl>
<p>flexibility but should not normally be changed by the user.  As noted
earlier the outputs of this function are best abstracted as Metadata.
When this parameter is False the Metadata members are all posted with
directly to data_object’s Metadata container.  If set True the
internally generated python dict is copied and stored with a key
defined through the subdocument_key argument.  See use below in
function arrival_snr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>subdocument_key</strong> – key for storing results as a subdocument.</p>
</dd>
</dl>
<p>This parameter is ignored unless store_as_subdocument is True.
Default is “snr_data”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>save_spectra</strong> – If set True (default is False) the function</p>
</dd>
</dl>
<p>will pickle the computed noise and signal spectra and save the
strings created along with a set of related metadata defining the
time range to the output python dict (these will be saved in MongoDB
when db is defined - see below).   This option should ONLY be used
for spot checking, discovery of why an snr metric has unexpected
results using graphics, or a research topic where the spectra would
be of interest.  It is a very bad idea to turn this option on if
you are processing a large quantity of data and saving the results
to MongoDB as it will bloat the arrival collection.  Consider a
different strategy if that essential for your work.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>python tuple with two components.  0 is a python dict with</p>
</dd>
</dl>
<p>the computed metrics associated with keys defined above.  1 is a
mspass.ccore.ErrorLogger object. Any errors in computng any of the
metrics will be posted to this logger.  Users should then test this
object using it’s size() method and if it the log is not empty (size &gt;0)
the caller should handle that condition.   For normal use that means
pushing any messages the log contains to the original data object’s
error log.  Component 0 will also be empty with no log entry if
the estimated bandwidth falls below the threshold defined by the
parameter signal_detection_minimum_bandwidth.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.snr.arrival_snr">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.snr.</span></span><span class="sig-name descname"><span class="pre">arrival_snr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data_object,</span> <span class="pre">noise_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;,</span> <span class="pre">noise_spectrum_engine=None,</span> <span class="pre">signal_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;,</span> <span class="pre">signal_spectrum_engine=None,</span> <span class="pre">band_cutoff_snr=2.0,</span> <span class="pre">signal_detection_minimum_bandwidth=6.0,</span> <span class="pre">tbp=4.0,</span> <span class="pre">ntapers=6,</span> <span class="pre">high_frequency_search_start=2.0,</span> <span class="pre">fix_high_edge=True,</span> <span class="pre">poles=3,</span> <span class="pre">perc=95.0,</span> <span class="pre">save_spectra=False,</span> <span class="pre">phase_name='P',</span> <span class="pre">arrival_time_key='Ptime',</span> <span class="pre">metadata_output_key='Parrival',</span> <span class="pre">kill_null_signals=True,</span> <span class="pre">optional_metrics=['snr_stats',</span> <span class="pre">'filtered_envelope',</span> <span class="pre">'filtered_L2',</span> <span class="pre">'filtered_Linf',</span> <span class="pre">'filtered_MAD',</span> <span class="pre">'filtered_perc']</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/snr.html#arrival_snr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.snr.arrival_snr" title="Permalink to this definition"></a></dt>
<dd><p>Specialization of FD_snr_estimator.   A common situation where snr
data is a critical thing to estimate is data windowed around a given
seismic phase.   FD_snr_estimator is a bit more generic.  This function
removes some of the options from the more generic function and
has a frozen structure appropriate for measuring snr of a particular phase.
In particular it always stores the results as a subdocument (python dict)
keyed by the name defined in the metadata_output_key argument.
This function has a close sibling called “broadband_snr_QC” that
has similar behavior but add some additional functionality.   The
most significant limitation of this function relative to broadband_snr_QC
is that this function ONLY accepts TimeSeries data as input.</p>
<p>This function is most appropriate
for QC done within a workflow where the model is to process a large
data set and winnow it down to separate the wheat from the chaff, to
use a cliche consistent with “winnow”.   In that situation the normal
use would be to run this function with a map operator on atomic data
and follow it with a call to filter to remove dead data and/or filter
with tests on the computed metrics.  See User’s Manual for guidance on
this topic.  Because that is the expected normal use of this function
the kill_null_signals boolean defaults to True.</p>
<p>To be more robust the function tries to handle a common error.  That is,
if the input data has a UTC time standard then the noise and signal
windows would need to be shifted to some reference time to make any sense.
Consequently, this algorithm silently handles that situation automatically
with a simple test.  If the data are relative time no test of the
time window range is made.  If the data are UTC, however, it tests if
the signal time window is inside the data range.  If not, it shifts the
time windows by a time it tries to pull from the input with the key
defined by “arrival_time_key”.  If that attribute is not defined a
message is posted to elog of the input datum and it is returned with
no other change.   (i.e. the attribute normally output with the tag
defined by metadata_output_key will not exist in the output).
Large data workflows need to handle this condition,.</p>
<p>Dead inputs are handled the standard way - returned immediately with no change.</p>
<p>Most parameters for this function are described in detail in the
docstring for FD_snr_estimator.  The user is referred there to
see the usage.   The following are added for this specialization:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>phase_name</strong> – Name tag for the seismic phase being analyzed.</p>
</dd>
</dl>
<p>This string is saved to the output subdocument with the key “phase”.
The default is “P”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>arrival_time_key</strong> – key (string) used to fetch an arrival time
if the data are in UTC and the time window received does not overlap
the data range (see above)</p></li>
<li><p><strong>kill_null_signals</strong> – boolean controlling how null snr estimator</p></li>
</ul>
</dd>
</dl>
<p>returns are handled.  When True (default) if FD_snr_estimator returns a null
result (no apparent signal) that input datum is killed before being
returned.  In that situation no snr metrics will be in the output because
null means FD_snr_estimator couldn’t detect a signal and the algorithm
failed.   When False the datum is returned silently but
will have no snr data defined in a dict stored with the key
metadata_output_key (i.e. that attribute will be undefined in output)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metadata_output_key</strong> – is a string used as a key under which the</p>
</dd>
</dl>
<p>subdocument (python dict) created internally is stored.  Default is
“Parrival”.   The idea is if multiple phases are being analyzed
each phase should have a different key set by this argument
(e.g. if PP were also being analyzed in the same workflow you</p>
<blockquote>
<div><p>might use a key like “PParrival”).</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a copy of data_object with the the results stored under</p>
</dd>
</dl>
<p>the key defined by the metadata_output_key argument.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.snr.broadband_snr_QC">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.snr.</span></span><span class="sig-name descname"><span class="pre">broadband_snr_QC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">data_object,</span> <span class="pre">component=2,</span> <span class="pre">noise_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;,</span> <span class="pre">noise_spectrum_engine=None,</span> <span class="pre">signal_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;,</span> <span class="pre">signal_spectrum_engine=None,</span> <span class="pre">band_cutoff_snr=2.0,</span> <span class="pre">signal_detection_minimum_bandwidth=6.0,</span> <span class="pre">tbp=4.0,</span> <span class="pre">ntapers=6,</span> <span class="pre">high_frequency_search_start=2.0,</span> <span class="pre">fix_high_edge=True,</span> <span class="pre">kill_null_signals=False,</span> <span class="pre">poles=3,</span> <span class="pre">perc=95.0,</span> <span class="pre">phase_name='P',</span> <span class="pre">metadata_output_key='Parrival',</span> <span class="pre">optional_metrics=['snr_stats',</span> <span class="pre">'filtered_envelope',</span> <span class="pre">'filtered_L2',</span> <span class="pre">'filtered_Linf',</span> <span class="pre">'filtered_MAD',</span> <span class="pre">'filtered_perc'],</span> <span class="pre">save_spectra=False,</span> <span class="pre">use_measured_arrival_time=False,</span> <span class="pre">measured_arrival_time_key='Ptime',</span> <span class="pre">taup_model=None,</span> <span class="pre">source_collection='source',</span> <span class="pre">receiver_collection=None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/snr.html#broadband_snr_QC"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.snr.broadband_snr_QC" title="Permalink to this definition"></a></dt>
<dd><p>Compute a series of metrics that can be used for quality control
filtering of seismic phase data.</p>
<p>This function is intended as a workhorse to be used for low-level,
automated QC of broadband data when the the data set is defined
by signals linked to a timeable seismic phase.   It can be
thought of as a version of a related function called
“arrival_snr” with some additional features.  See the docstring
for that function for what those base features are.   Features this
function adds not found in arrival_snr are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>This function allows Seismogram inputs.  Only TimeSeries
data are handled by arrival_snr.</p></li>
<li><p>This function provides an option to compute arrival times
from source coordinates, receiver coordinates, and a handle
to an obspy tau-p calculator.</p></li>
</ol>
</div></blockquote>
<p>Otherwise it behaves the same.  Note both functions may or may not
choose to interact with the function save_snr_arrival.   If you want to
save the computed metrics into a form more easily fetched
your workflow should extract the contents of the python dictionary
stored under the metadata_output_key tag and save the result to
MongoDB with the save_snr_arrival function.  That option is most
useful for test runs on a more limited data set to sort out
values of the computed metrics that are appropriate for a secondary
winnowing of the your data.   See User’s Manual for more on
this concept.</p>
<p>The input of arg 0 (data_object) can be either a TimeSeries or
a Seismogram object.  If a Seismogram object is passed the “component”
argument is used to extract the specified single channel from the Seismogram
object and that component is used for processing.  That is necessary
because all the algorithms used are single channel algorithms.  To
use this function on all components use a loop over components BUT
make sure you use a unique value for the argument “metadata_output_key” for
each component.  Note this will also produce multiple documents per
input datum.</p>
<p>The type of the data_object also has a more subtle implication the
user must be aware of.  That is, in the MsPASS schema we store receiver coordinates
in one of two different collections:  “channel” for TimeSeries data and
“site” for Seismogram data.  When such data are loaded the generic keys
like lat are always converted to names like channel_lat or site_lat
for TimeSeries and Seismogram data respectively.   This function uses
the data type to set that naming.  i.e. if the input is TimeSeries
it tries to fetch the latitude data as channel_lat while if it the input
is a Seismogram it tries to fetch site_lat.   That is true of all coordinate
data loaded by normalization from a source and receiver collection.</p>
<p>The following args are passed directly to the function FD_snr_estimator:
noise_window, noise_spectrum_engine, signal_window, signal_spectrum_engine,
band_cutoff_snr, signal_detection_minimum_bandwidth, tbp, ntapers,
high_frequency_search_start, fix_high_edge, npoles, perc, optional_metrics,
and save_spectrum.  Below we only describe arguments added by this
function:</p>
<p>data_object,
phase_name=”P”,
metadata_output_key=”Parrival”,
use_measured_arrival_time=False,
measured_arrival_time_key=”Ptime”,
taup_model=None,
component=2,
source_collection=”source”,
receiver_collection=None,</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data_object</strong> – An atomic MsPASS data object to which the</p>
</dd>
</dl>
<p>algorithms requested should be applied.   Currently that means a
TimeSeries or Seismogram object.   Any other input will result
in a TypeError exception.  As noted above for Seismogram input the
component argument defines which data component is to be used for the
snr computations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>component</strong> – integer (0, 1, or 2) defining which component of a</p>
</dd>
</dl>
<p>Seismogram object to use to compute the requested snr metrics.   This
parameter is ignored if the input is a TimeSeries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>metadata_output_key</strong> – string defining the key where the results</p>
</dd>
</dl>
<p>are to be posted to the returned data_object.   The results are always
posted to a python dictionary and then posted to the returned
data_object with this key.   Default is “Parrival”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>use_measured_arrival_time</strong> – boolean defining the method used to</p>
</dd>
</dl>
<p>define the time reference for windowing used for snr calculations.
When True the function will attempt to fetch a phase arrival time with
the key defined by the “measured_arrival_time_key” argument.  In that
mode if the fetch fails the data_object will be killed and an error
posted to elog.   That somewhat brutal choice was intentional as the
expectation is if you want to use measured arrival times you don’t
want data where there are no picks.   The default is True to make
the defaults consistent.  The reason is that the tau-p calculator
handle is passed to the function when using model-based travel times.
There is no way to default that so it defaults to None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>measured_arrival_time_key</strong> – is the key used to fetch a</p>
</dd>
</dl>
<p>measured arrival time.   This parameter is ignored if use_measured_arrival_time
is False.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>taup_model</strong> – when use_measured_arrival_time is False this argument</p>
</dd>
</dl>
<p>is required.  It defaults as None because there is no way the author
knows to initialize it to anything valid.  If set it MUST be an instance
of the obspy class TauPyModel (<a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.taup.tau.TauPyModel.html#obspy.taup.tau.TauPyModel">https://docs.obspy.org/packages/autogen/obspy.taup.tau.TauPyModel.html#obspy.taup.tau.TauPyModel</a>)
Mistakes in use of this argument can cause a MsPASSError exception to
be thrown (not logged thrown as a fatal error) in one of two ways:
(1)  If use_measured_arrival_time is False this argument must be defined,
and (2) if it is defined it MUST be an instance of TauPyModel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>source_collection</strong> – normalization collection for source data.</p>
</dd>
</dl>
<p>The default is the MsPASS name “source” which means the function will
try to load the source hypocenter coordinates (when required) as
source_lat, source_lon, source_depth, and source_time from the input
data_object.  The id of that document is posted to the output dictionary
stored under metadata_output_key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>receiver_collection</strong> – when set this name will override the</p>
</dd>
</dl>
<p>automatic setting of the expected normalization collection naming
for receiver functions (see above).  The default is None which causes
the automatic switching to be involked.  If it is any other string
the automatic naming will be overridden.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the data_object modified by insertion of the snr QC data</p>
</dd>
</dl>
<p>in the object’s Metadata under the key defined by metadata_output_key.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.snr.save_snr_arrival">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.snr.</span></span><span class="sig-name descname"><span class="pre">save_snr_arrival</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doc_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wfid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wf_collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'wf_Seismogram'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_collection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'arrival'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subdocument_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_update</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validate_wfid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://pymongo.readthedocs.io/en/stable/api/bson/objectid.html#bson.objectid.ObjectId" title="(in PyMongo v4.7.3)"><span class="pre">ObjectId</span></a></span></span><a class="reference internal" href="../_modules/mspasspy/algorithms/snr.html#save_snr_arrival"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.snr.save_snr_arrival" title="Permalink to this definition"></a></dt>
<dd><p>This function is a companion to broadband_snr_QC.   It handles the
situation where the workflow aims to post calculated snr metrics to
an output database (normally in the “arrival” collection but optionally
to a parent waveform collection.  ).   The alternative models as
noted in the User’s Manual is to use the kill option to broadband_snr_QC
followed by a call to the filter method of bag/rdd to remove the
deadwood and reduce the size of data passed downstream in large
parallel workflow.   That case is better handled by using
broadband_snr_QC directly.</p>
<p>How the data are saved is controlled by four parameters:   save_collection,
use_update, update_id and subdocument_key.   They interact in a way
that is best summarized as a set of cases that procuce behavior
you may want:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>If save_collection is not the parent waveform collection,
behavior is driven by use_update combined with subdocument_key.
When use_update is False (default) the contents of doc_to_save
will be used to define a new document in save_collection
with the MongoDB insert_one method.</p></li>
<li><p>When use_update is True the update_id will be assumed to be
defined and point be the ObjectId of an existing document
in save_collection.   Specifically that id will be used as
the query clause for a call the insert_one method.   This
combination is useful if a workflow is being driven by
arrival data stored in save_collection created, for example,
for a css3.0 a event-&gt;origin-&gt;assoc-&gt;arrival catalog of
arrival picks.   A variant of this mode will occur if the
argument subdocument_key is defined (default is None).  If
you define subgdocument_key the contents of doc_to_save will
be stored as a subdocument in save_collection accessible
with the key defined by subdocument_key.</p></li>
<li><p>If save_collection is the same as the parent waveform collection
(defined via the input parameter wf_collection) the
value of use_update will be ignored and only an update will
be attempted.  The reason is that if one tried to save the
contents of doc_to_save to a waveform collection would corrupt
the database by have a bunch of documents that that could not
be used to construct a valid data object (the normal use for
one of the wf collections).</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>db</strong> – MongoDB database handle to use for transactions that</p>
</dd>
</dl>
<p>are the focus of this algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>doc_to_save</strong> – python dictionary containing data to be saved.</p>
</dd>
</dl>
<p>Where and now this is saved is controlled by save_collection,
use_update, and subdocument_key as described above.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wfid</strong> – waveform document id of the parent datum.   It is</p>
</dd>
</dl>
<p>assumed to be an ObjectId of linking the data in doc_to_save to
the parent.   It is ALWAYS saved in the output with the key “wfid”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>wf_collection</strong> – string defining the collection from which the</p>
</dd>
</dl>
<p>datum from which the data stored in doc_to_save are associated.   wfid
is assumed define a valid document in wf_collection.   Default is
“wf_Seismogram”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>save_collection</strong> – string defining the collection name to which</p>
</dd>
</dl>
<p>doc_to_save should be pushed.   See above for how this name interacts
with other parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>subdocument_key</strong> – Optional key for saving doc_to_save as a</p>
</dd>
</dl>
<p>a subdocument in the save_collection.   Default is None which means
the contents of doc_to_save will be saved (or update) as is.
For saves to (default) arrival collection this parameter should
normally be left None, but is allowed.   If save_collection is the
parent waveform collection setting this to some sensible key is
recommended to avoid possible name collisions with waveform
Metadata key-value pairs.    Default is None which means no
subdocuments are created.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>use_update</strong> – boolean controlling whether or not to use</p>
</dd>
</dl>
<p>updates or inserts for the contents of doc_to_save.  See above for
a description of how this interacts with other arguments to this
function.  Default is False.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>update_id</strong> – ObjectId of target document when running in update</p>
</dd>
</dl>
<p>mode.  When save_collection is the same as wf_collection this parameter
is ignored and the required id passed as wfid will be used for the
update key matching.   Also ignored with the default behavior if
inserting doc_to_save as a new document.  Required only if running
with a different collection and updating is desired.  The type example
noted above would be updates to existing arrival informations
created from a css3.0 database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>validate_wfid</strong> – When set True the id defined by the</p>
</dd>
</dl>
<p>required argument wfid will be validated by querying wf_collection.
In this mode if wfid is not found the function will silently return None.
Callers using this mode should handle that condition.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>ObjectId of saved record.  None if something went wrong</p>
</dd>
</dl>
<p>and nothing was saved.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.snr.snr">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.snr.</span></span><span class="sig-name descname"><span class="pre">snr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_object</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_window=&lt;mspasspy.ccore.algorithms.basic.TimeWindow</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_metric='mad'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_metric='mad'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">perc=95.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/snr.html#snr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.snr.snr" title="Permalink to this definition"></a></dt>
<dd><p>Compute time-domain based signal-to-noise ratio with a specified metric.</p>
<p>Signal-to-noise ratio is a fundamental measurement in all forms of
seismic data processing.   There is, however, not a single unified metric
that ideal for all types of signals one may want to analyze.  One class
of metrics used time-domain metrics to use some measure of amplitude in
a signal and noise window cut from a single waveform segment.  A type
example is snr of some particular “seismic phase” (P, S, PP, ScS, etc)
relative to some measure of background noise.  e.g. for P phases it is
nearly universal to try to estimate snr from some window defined by the
arrival time of P and a noise window before the time P arrives (pre-event noise).</p>
<p>This function provides a generic api to measure a large range of metrics
using one of four choices for measuring the norm of the data in the
signal and noise windows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>rms - L2 norm</p></li>
<li><p>mad - median absolute difference, which is essentially the median amplitude in this context</p></li>
<li><p>perc - percentage norm ala seismic unix.  perc is defined at as the
amplitude level were perc percentage of the data have an amplitude
smaller than this value.  It is computed by ranking (sorting) the
data, computing the count of that perctage relative to the number of
amplitude samples, and returning the amplitude of the nearest value
to that position in the ranked data.</p></li>
<li><p>peak - is the peak value which in linear algebra is the L infinity norm</p></li>
</ol>
</div></blockquote>
<p>Note the user can specify a different norm for the signal and noise windows.
The perc metric requires specifying what percentage level to use.  It is
important to recognize that ALL of these metrics are scaled to amplitude
not power (amplitude squared).</p>
<p>This function will throw a MsPASSError exception if the window parameters
do not define a time period inside the range of the data_object. You will
need a custom function if the model of windows insider a larger waveform
segment does not match your data.</p>
<p>There is one final detail about an snr calculation that we handle carefully.
With simulation data it is very common to have error free simulations where
the “noise” window one would use with real data is all zeros.  An snr calculated
with this function in that situation would either return inf or NaN depending
on some picky details.  Neither is good as either can cause downstream
problems.  For that reason we trap any condition where the noise amplitude
measure is computed as zero.  If the signal amplitude is also zero we return
a -1.0.  Otherwise we return a large, constant, positive number.  Neither
condition will cause an exception to be thrown as that condition is considered
somewhat to be anticipated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_object</strong> – MsPASS atomic data object (TimeSeries or Seismogram)
to use for computing the snr.  Note that for Seismogram objects the
metrix always use L2 measures of amplitude of each sample (i.e. vector amplitudes)
If snr for components of a Seismogram are desired use ExtractComponent and
apply this function to each component separately.</p></li>
<li><p><strong>noise_window</strong> – TimeWindow objects defining the time range to extract
from data_object to define the part of the signal considered noise.
Times can be absolute or relative.  Default the range -5 to 120 which
is makes sense only as time relative to some phase arrival time.</p></li>
<li><p><strong>signal_window</strong> – TimeWindow object defining the time range to
extract from data_object to define the part of the signal defines as
signal to use for the required amplitude measure.  Default of -130 to
-5 is consistent with the default noise window (in terms of length) and
is assumes a time relative to a phase arrival time.  For absolute times
each call to this function may need its own time window.</p></li>
<li><p><strong>noise_metric</strong> – string defining one of the four metrics defined above
(‘mad’,’peak’,’perc’ or ‘rms’) to use for noise window measurement.</p></li>
<li><p><strong>signal_metric</strong> – string defining one of the four metrics defined above
(‘mad’,’peak’,’perc’ or ‘rms’) to use for signal window measurement.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>estimated signal-to-noise ratio as a single float.  Note the
special returns noted above for any situation where the noise window
amplitude is 0</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-mspasspy.algorithms.window">
<span id="window"></span><h2>window<a class="headerlink" href="#module-mspasspy.algorithms.window" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.TopMute">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.window.</span></span><span class="sig-name descname"><span class="pre">TopMute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">t0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cosine'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#TopMute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.TopMute" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A top mute is a form of taper applied to the “front” of a signal.
Front in standard jargon means that with the time axis running from
left to right (normal unless your native language is Arabic) the time
period on the left side of a plot.   Data tagged at times less than what we
call the zero time here are always zeroed.  The mute defines a ramp function
running from the zero time to the “one” time.  In the ramp zone the
ramp function multiplies the sample data so it is a form of “taper” as
used in Fourier analysis.  This class should normally only be used on data with the time
reference type set Relative.  It can be applied to UTC time standard data but
with such data one of these objects would often need to be created for
each atomic data object, which would be horribly inefficient.  In most
cases conversion to relative time is an essential step before using
this algorithm.</p>
<p>This implementation uses an “apply” method for processing data.
That means for a parallel construct instead of the symbol for a function
you use the apply method as a function call.  (e.g. if tm is an is an
instance of this class and “d” is a TimeSeries or Seismogram object to be
muted the function call that applies the mute would be ts.apply(d))</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.TopMute.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">instance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#TopMute.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.TopMute.apply" title="Permalink to this definition"></a></dt>
<dd><p>Use thie method to apply the defined top mute to one of the MsPASS
atomic data objects. The method does a sanity check on the input
data range.  If the starttime of the data is greater than t0 for
the mute the datum is killed and an error posted to elog.  The
reason is in that situation the data would be completely zeroed
anyway and it is better to define it dead and leave an error message
than to completely null data.
:param d:  input atomic MsPASS data object (TimeSeries or Seismogram)
:object_history:  It set true the function will add define this</p>
<blockquote>
<div><p>step as an map operation to preserve object level history.
(default is False)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>instance</strong> – string defining the “instance” of this algorithm.
This parameter is needed only if object_history is set True.  It
is used to define which instance of this algrithm is being applied.
(In the C++ api this is what is called the algorithm id).  I can
come from the global history manager or be set manually.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.WindowData">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.window.</span></span><span class="sig-name descname"><span class="pre">WindowData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'scale'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#WindowData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.WindowData" title="Permalink to this definition"></a></dt>
<dd><p>Cut data defined by a TimeWindow object.</p>
<p>Cutting a smaller waveform segment from a larger waveform segment
is a very common seismic data processing task.   The function is
a python wrapper to adapt C++ code that accomplishes that task
to the MsPASS framework.</p>
<p>Note this function uses one model for being bombproof with a map
operation.  Any exception that makes the result invalid will cause
an error message to be posted to the elog attribute of the input
datum AND the data will be marked dead (killed).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – is the input data.  d must be either a <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.TimeSeries</span></code></a> or <a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.Seismogram" title="mspasspy.ccore.seismic.Seismogram"><code class="xref py py-class docutils literal notranslate"><span class="pre">mspasspy.ccore.seismic.Seismogram</span></code></a>
object or the function will log an error to d and return a None.</p></li>
<li><p><strong>twin_start</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – defines the start of timeWindow to be cut</p></li>
<li><p><strong>twin_end</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – defines the end of timeWindow to be cut</p></li>
<li><p><strong>t0shift</strong> – is an optional time shift to apply to the time window.
This parameter is convenient to avoid conversions to relative time.
A typical example would be to set t0shift to an arrival time and let
the window define time relative to that arrival time.  Default is None
which cause the function to assume twin is to be used directly.</p></li>
<li><p><strong>object_history</strong> – boolean to enable or disable saving object
level history.  Default is False.  Note this functionality is
implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>alg_name</strong> – When history is enabled this is the algorithm name
assigned to the stamp for applying this algorithm.
Default (“WindowData”) should normally be just used.
Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>ald_id</strong> – algorithm id to assign to history record (used only if
object_history is set True.)
Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>dryrun</strong> – Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>dryrun</strong> – Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>copy of d with sample range reduced to twin range.  Returns
an empty version of the parent data type (default constructor) if
the input is marked dead</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.WindowData_with_duration">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.window.</span></span><span class="sig-name descname"><span class="pre">WindowData_with_duration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'scale'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#WindowData_with_duration"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.WindowData_with_duration" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.ensemble_error_post">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.window.</span></span><span class="sig-name descname"><span class="pre">ensemble_error_post</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">severity</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#ensemble_error_post"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.ensemble_error_post" title="Permalink to this definition"></a></dt>
<dd><p>This is a small helper function useful for error handlers in except
blocks for ensemble objects.  If a function is called on an ensemble
object that throws an exception this function will post the message
posted to all ensemble members.  It silently does nothing if the
ensemble is empty.
:param d: is the ensemble data to be handled.  It print and error message</p>
<blockquote>
<div><p>and returns doing nothing if d is not one of the known ensemble
objects.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alg</strong> – is the algorithm name posted to elog on each member</p></li>
<li><p><strong>message</strong> – is the string posted to all members</p></li>
<li><p><strong>severity</strong> – is the error severity level</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.merge">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.window.</span></span><span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsvector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">starttime</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">endtime</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fix_overlaps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_gaps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'merge'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="mspasspy.ccore.html#mspasspy.ccore.seismic.TimeSeries" title="mspasspy.ccore.seismic.TimeSeries"><span class="pre">TimeSeries</span></a></span></span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#merge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.merge" title="Permalink to this definition"></a></dt>
<dd><p>Splices a vector of TimeSeries objects together and optionally carves
out a specified time window.  It acts a bit like an obspy function
with the same name, but has completely different options and works
with native MsPASS TimeSeries objects.</p>
<p>This function is a workhorse for handling continuous data that are
universally stored today as a series of files.   The input to this
function is an array of TimeSeries objects that are assummed to be
created from a set of data stored in such files.   The data are assumed
to be from a common stream of a single channel and sorted so the
array index defines a time order.  The algorithm attempts to glue the
segments together into a single time series that is returned.
The algorithm by default assumes the input is “clean” which means
the endtime of each input TimeSeries is 1 sample ahead of the start time
of the next segment (i.e. (segment[i+1].t0()-segment[i].endtime()) == dt).
The actual test is that the time difference is less than dt/2.</p>
<p>This algorithm treats two conditions as a fatal error and will throw
a MsPASSError when the condition occurs:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>It checks that the input array of TimeSeries data are in
time order.</p></li>
<li><p>It checks that the inputs all have the same sample rate.</p></li>
<li><p>If fix_overlaps is False if an overlap is found it
is considered an exception.</p></li>
</ol>
</div></blockquote>
<p>Either of these conditions will cause the function to throw an
exception.  The assumption is that either is a user error created
by failing to reading the directions that emphasize this requirement
for the input.</p>
<p>Other conditions can cause the output to be marked dead with an
error message posted to the output’s elog attribute.  These are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>This algorithm aims to produce an output with data stored in
a continuous vector with a length defined by the total time
span of the input.  Naive use can create enormously long
vectors that would mostly be empty.   (e.g. two random
day files with a 5 year difference in start time)  The
algorithm refuses to try to merge data when the span exceeds
an internal threshold of 10^8 samples.</p></li>
<li><p>If fix_overlaps is false any overlap of successive endtime to
the next starttime of more than 0.5 samples will cause the
output to be killed.   The assumption is such data have a
serious timing problem retained even after any cleaning.</p></li>
</ol>
</div></blockquote>
<p>The above illustrates that this function behaves differently and makes
different assumption if the argument check_overlaps is True or False.
False is faster because it bypasses the algorithm used to fix overlaps,
but is safer if your data is not perfectly clean in the sense of
lacking any timing issues or problem with duplicates.   If the
fix_overlaps boolean is set True, the mspass overlap handler is
involked that is a C++ function with the name “repair_overlaps”.
The function was designed only to handle the following common
situations.  How they are handled is different for each situation.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Duplicate waveform segments spanning a common time interval
can exist in raw data and accidentally by indexing two copies
the same data.   If the samples in the overlapping section
match the algorithm will attempt to remove the overlapping
section.   The algorithm is known to work only for a pair of
pure duplicates and a smaller segment with a start time after
a more complete segment.   It may fail if there are more than
three or more copies of the same waveform in the input or
one of the waveforms spans a smaller time range than the other
but has the same start time.   The first is a gross user error.
The second should be rare an is conceivable only with raw
data where a packet or two was randomly saved twice - something
that shouldn’t happen but could with flakey hardware.</p></li>
<li><p>If an overlap is detected AND the sample data in the overlap
are different the algorithm assumes the data have a timing
problem that created this situation.   Our experience is this
situation only happens when an instrument has a timing problem.
All continuous data generating digitizers we know of use a
timing system slaved to an external reference (usually GPS time).
If the external signal is lost the clock drifts.  When the
signal is restored if the digitizer detects a large time
jump it may reset (time jerk) to tag the next packet of data
with the updated time based on the standard.  If that time
jump is forward it will leave an apparent gap in the data, which
we discuss below, but if the jump is backward it will leave an
apparent overlap with inconsistent samples.   The
repair_overlaps function assumes that is the cause of all overlaps
it detects.</p></li>
</ol>
</div></blockquote>
<p>The final common situation this function needs to handle is gaps.  A
gap is defined in this algorithm as any section where the endtime of
one segment is followed by a start time of the next segment that is
more than 1 sample in duration.  Specifically when</p>
<blockquote>
<div><p>(segment[i+1].t0()-segment[i].endtime()) &gt; 1.5*dt</p>
</div></blockquote>
<p>The result depends on values of the (optional) windowing arguments
starttime and endtime and the boolean “zero_gaps” argument.
If windowing is enabled (done by changing
default None values of starttime and endtime) any gap will be harmless
unless it is present inside the specified time time range.  In all
cases what happens to the output depends upon the boolean zero_gaps.
When zero_gaps is False any gaps detected within the output range of
the result (windowed range if specified but the full time of the input otherwise)
When set True gap sections will be zeroed in the output data vector.
All outputs with gaps that have been zeroed will have the boolean
Metadata attribute “has_gap” set True and undefined otherwise.
When the has_data attribute is set true the tap windows will be
stored as a list of “TimeWindow” objects with the Metadata key “gaps”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tsvector</strong> – array of TimeSeries data that are to be spliced
together to create a single output.   The contents must all have
the same sample rate and be sorted by starttime.</p></li>
<li><p><strong>starttime</strong> (<em>double - assumed to be a UTC time expressed as a unix
epoch time.</em>) – (optional) start time to apply for windowing the
output.  Default is None which means the output will be created
as the merge of all the inputs.  When set WindowData is applied
with this start time.   Note if endtime is defined but starttime
is None windowing is enabled with starttime = earliest segment start time.</p></li>
<li><p><strong>endtime</strong> (<em>double - assumed to be a UTC time expressed as a unix
epoch time.</em>) – (optional) end time to apply for windowing the
output.  Default is None which means the output will be created
as the merge of all the inputs.  When set WindowData is applied
with this end time.   Note if starttime is defined but endtime
is None windowing is enabled with endtime = latest end time of
all segments.</p></li>
<li><p><strong>fix_overlaps</strong> (<em>boolean</em>) – when set True (default is False) if an overlap
is detected the algorithm will attempt to repair the overlap
to yield a continuous time series vectgor if it determined to have
matching data.  See description above for more details.</p></li>
<li><p><strong>zero_gaps</strong> – When set False, which is the default, any gaps
detected in the output window will cause the return to be marked
dead.  When set True, gaps will be zeroed and with a record of
gap positions posted to the Metadata of the output.  See above
for details.</p></li>
<li><p><strong>zero_gaps</strong> – boolean</p></li>
<li><p><strong>object_history</strong> – boolean to enable or disable saving object
level history.  Default is False.  Note this functionality is
implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>alg_name</strong> – When history is enabled this is the algorithm name
assigned to the stamp for applying this algorithm.
Default (“WindowData”) should normally be just used.
Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>ald_id</strong> – algorithm id to assign to history record (used only if
object_history is set True.)
Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>dryrun</strong> – Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
<li><p><strong>dryrun</strong> – Note this functionality is implemented via the mspass_func_wrapper decorator.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>TimeSeries in the range defined by the time span of the input
vector of segments or if starttime or endtime are specified a reduced
time range.  The result may be marked dead for a variety of reasons
with error messages explaining why in the return elog attribute.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.algorithms.window.scale">
<span class="sig-prename descclassname"><span class="pre">mspasspy.algorithms.window.</span></span><span class="sig-name descname"><span class="pre">scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_from_window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'peak'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_by_section</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'scale'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">function_return_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/algorithms/window.html#scale"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.algorithms.window.scale" title="Permalink to this definition"></a></dt>
<dd><p>Top level function interface to data scaling methods.</p>
<p>This function can be used to scale seismic data contained in any of
the four seismic data objects defined in mspass:  TimeSeries, Seismogram,
TimeSeriesEnsemble, and SeismogramEnsemble.   An extensive set of
amplitude estimation metrics are available by selecting one of the
allowed values for the method parameter.   Ensembles can be scaled
at the individual seismogram level or as a whole (scale_by_section=True).</p>
<p>Note all methods preserve the original amplitude by updating the
Metadata parameter calib to include the scaling.  i.e. as always the
amplitude of the data in physical units can be restored by multiplying
the data samples by calib.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d</strong> – is input data object.  If not one of the four mspass seismic
data types noted above the function will throw a RuntimeError exception.</p></li>
<li><p><strong>compute_from_window</strong> – boolean used to compute amplitude and scale
based on a windowed section of the input waveform.   By default (this
boolan False) the amplitude for scaling is computed from the full
waveform.  When True the window argument must contain a valid TimeWindow
that spans a time range smaller than the data range.  In that situation
if the window is inconsistent with the data range the return will be
marked dead and messages will be found posted in elog.  For ensembles
all or only  portion of the group will be killed if this happens.
Note this parameter is also ignored when scale_by_section is true.</p></li>
<li><p><strong>window</strong> – mspass TimeWindow object defining the time range
over which the amplitude for scaling is to be computed.  (see the
compute_from_window parameter description)</p></li>
<li><p><strong>method</strong> – string defining the gain method to use.  Currently supported
method values are:  peak, RMS (rms accepted), perc, and MAD
(also accepts mad or Mad).  Peak uses the largest amplitude for
scaling.  For 3C data that means vector amplitude while for scalar data
it is the largest absolute value. rms is the standard rms measure,
although for 3C data is is rms vector amplitudes so scaling is by the
number of vectors not the total number of samples (3 times number of
vectors).  perc uses a sorted percentage clip level metric as used in
seismic unix.  mad is a variant where the value returned is the
median absolute deviation (mad) that is actual the same as perc=1/2.
Default is peak.  WARNING:  if an invalid value for method is passed the
data will be returned unaltered with a complaint message issue for
very datum (indivually or in ensembles) run that way.</p></li>
<li><p><strong>level</strong> – For all but perc this defines the scale to which the data
are scaled.  For perc it is used to set the percent clip level.
If the value passed is illegal (0 or negative for most methods while
perc must also be positive but less or equal 1) a complain message will
be posted to elog and the level adjusted to 1.0.</p></li>
<li><p><strong>scale_by_section</strong> – is a boolean that controls the scaling
behavior on ensembles only (It is silently ignored for atomic
TimeSeries and Seismogram data).  When true a single gain factor is
applied to all members of an ensemble.  When false each member is
gained individually as if this function were applied in a loop to
each member.</p></li>
<li><p><strong>use_mean</strong> – boolean used only for ensembles and when scale_by_section is
True.   The algorithm used in that case has an option to use the mean
log amplitude for scaling the section instead of the default median
amplitude.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Data scaled to specified level.  Note the scaling always preserves
absolute amplitude by adjusting the value of the calib attribute of the
return so calib*data is the same value before and after the scaling.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>same as input</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Python API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mspasspy.ccore.html" class="btn btn-neutral float-right" title="mspasspy.ccore" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Ian Wang.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>