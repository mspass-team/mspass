<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mspasspy.history &mdash; MsPASS 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=f6245a2f"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mspasspy.reduce" href="mspasspy.reduce.html" />
    <link rel="prev" title="mspasspy.graphics" href="mspasspy.graphics.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MsPASS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_start.html">Getting Started in a Nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/run_mspass_with_docker.html">Run MsPASS with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_docker_compose.html">Deploy MsPASS with Docker Compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_on_HPC.html">Deploying MsPASS on an HPC cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started_overview.html">MsPASS Virtual Cluster Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/database_concepts.html">Database Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/CRUD_operations.html">CRUD Operations in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/mongodb_and_mspass.html">Using MongoDB with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/normalization.html">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_tabular_data.html">Importing Tabular Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seismic Data Objects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_object_design_concepts.html">Data Object Design Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/numpy_scipy_interface.html">Using numpy/scipy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/obspy_interface.html">Using ObsPy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/time_standard_constraints.html">Time Standard Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/processing_history_concepts.html">Processing History Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/continuous_data.html">Continuous Data Handling with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/schema_choices.html">What database schema should I use?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/handling_errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_editing.html">Data Editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/header_math.html">Header (Metadata) Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/graphics.html">Graphics in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/signal_to_noise.html">Signal to Noise Ratio Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/adapting_algorithms.html">Adapting an Existing Algorithm to MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_processing.html">Parallel Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/memory_management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/io.html">I/O in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_io.html">Parallel IO in MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/FAQ.html">Frequency Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/development_strategies.html">How do I develop a new workflow from scratch?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mspasspy.algorithms.html">mspasspy.algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.ccore.html">mspasspy.ccore</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.client.html">mspasspy.client</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.db.html">mspasspy.db</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.global_history.html">mspasspy.global_history</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.graphics.html">mspasspy.graphics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">mspasspy.history</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mspasspy.history.HistoryLogger"><code class="docutils literal notranslate"><span class="pre">HistoryLogger</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.history.HistoryLogger.register"><code class="docutils literal notranslate"><span class="pre">HistoryLogger.register()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.history.HistoryLogger.save"><code class="docutils literal notranslate"><span class="pre">HistoryLogger.save()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mspasspy.history.basic_history_data"><code class="docutils literal notranslate"><span class="pre">basic_history_data</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mspasspy.history.basic_history_data.load_algorithm_args"><code class="docutils literal notranslate"><span class="pre">basic_history_data.load_algorithm_args()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mspasspy.history.get_jobid"><code class="docutils literal notranslate"><span class="pre">get_jobid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#mspasspy.history.pf_history_data"><code class="docutils literal notranslate"><span class="pre">pf_history_data</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#mspasspy.history.pfbranch_to_dict"><code class="docutils literal notranslate"><span class="pre">pfbranch_to_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.reduce.html">mspasspy.reduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.util.html">mspasspy.util</a></li>
<li class="toctree-l2"><a class="reference internal" href="mspasspy.io.html">mspasspy.io</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cxx_api/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mspass_schema/mspass_schema.html">MsPASS Schema</a></li>
</ul>

    <a href= "../genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Python API</a></li>
      <li class="breadcrumb-item active">mspasspy.history</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/mspass-team/mspass/blob/master/docs/source/python_api/mspasspy.history.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-mspasspy.history">
<span id="mspasspy-history"></span><h1>mspasspy.history<a class="headerlink" href="#module-mspasspy.history" title="Permalink to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.history.HistoryLogger">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.history.</span></span><span class="sig-name descname"><span class="pre">HistoryLogger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#HistoryLogger"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.HistoryLogger" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Base class for generic, global history/provenance preservation in MsPASS.
The main concept of this object that a pymongo script to run a processing
job would create this object or one of it’s children to preserve the
global run parameters for the a processing sequence.   We limit that to
mean a sequence of processing algorithms that have a set of predefined
parameters that control their behaviour.  The global parameters are
preserved in a special collection in MongoDB we give the (fixed) name
of “history”.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.history.HistoryLogger.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partype</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#HistoryLogger.register"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.HistoryLogger.register" title="Permalink to this definition"></a></dt>
<dd><p>Register an algorithm’s signature to preserve processing history.
Each algorithm in a processing chains should be registered by this
mechanism before starting a mspass processing chain.  The
register method should be called in the order in which the algorithms are
applied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alg</strong> – is the name of the algorithm that will be run.  Assumed to be
a string.</p></li>
<li><p><strong>partype</strong> – defines the format of the data defining input parameters
to this algorithm (Must be either ‘dict’ or ‘AntelopePf’)</p></li>
<li><p><strong>params</strong> – is the actual input data. Actual type of this data
this arg references will depend up partype.  partype defines
the type of the object expect (dict in this case means a python
dict object)</p></li>
</ul>
</dd>
<dt class="field-even">Raise<span class="colon">:</span></dt>
<dd class="field-even"><p>Throws a RuntimeError with a message if partype is not on the
list of supported parameter types</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.history.HistoryLogger.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#HistoryLogger.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.HistoryLogger.save" title="Permalink to this definition"></a></dt>
<dd><p>Save the contents to the history collection.</p>
<p>The doc created in a save is more or less an image of the
structure of this object translated to a python dict</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.history.basic_history_data">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.history.</span></span><span class="sig-name descname"><span class="pre">basic_history_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#basic_history_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.basic_history_data" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This is a pure data object that if it were written in C could be
defined as a struct.   It holds the data used to define the
parameters for a given algorithm.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mspasspy.history.basic_history_data.load_algorithm_args">
<span class="sig-name descname"><span class="pre">load_algorithm_args</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">argdict</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#basic_history_data.load_algorithm_args"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.basic_history_data.load_algorithm_args" title="Permalink to this definition"></a></dt>
<dd><p>Loads parameters defined to a set of function arguments.</p>
<p>Simple algorithms without a lot of parameters often simply need a
set of argument values.   Here we require this to be defined by
a set of key:value pairs that map to dict.  We also consider this
the lowest common denominator for a parameter definition so make
it a part of the base class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alg</strong> – This should be a string defining the algorithm being registered.</p></li>
<li><p><strong>argdict</strong> – This should be a dict of key:value pairs defining input
parameters.  For algorithms defined at the top level by a python
function this should match the names of parameters in the arg list.
For C++ functions wrapped with pybind11 it should match the arg
keys defined in the wrappers.   The key string will be used for
key:value pair in BSON written to MongoDB.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.history.get_jobid">
<span class="sig-prename descclassname"><span class="pre">mspasspy.history.</span></span><span class="sig-name descname"><span class="pre">get_jobid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#get_jobid"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.get_jobid" title="Permalink to this definition"></a></dt>
<dd><p>Ask MongoDB for the a valid jobid.</p>
<p>All processing jobs should have a call to this function at the beginning
of the job script.  It simply queries MongoDB for the largest current
value of the key “jobid” in the history collection.   If the history
collection is empty it returns 1 under a bias that a jobid of 0 is
illogical.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>db</strong> (<em>top level database handle returned by a call to MongoClient.database</em>) – database handle</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mspasspy.history.pf_history_data">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mspasspy.history.</span></span><span class="sig-name descname"><span class="pre">pf_history_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">job</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pf</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#pf_history_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.pf_history_data" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#mspasspy.history.basic_history_data" title="mspasspy.history.basic_history_data"><code class="xref py py-class docutils literal notranslate"><span class="pre">basic_history_data</span></code></a></p>
<p>Loads history data container with data from an AntelopePf object.</p>
<p>mspasspy.ccore.utility defines the AntelopePf object that is an option for parameter
inputs.  The file structure is identical to the
Antelope Pf file syntax.   The API to an AntelopePF is not, however,
the same as the python bindings in Antelope as it handles Tbl
and Arr sections completely differently more in line with alternatives
like YAML.   This method converts the data in an AntelopePf to a python
dict that can be dumped directly to MongoDB with pymongo’s insert
methods. Converting the MongoDB document back to a pf structure requires
the inverse operator that does not exist, but should eventually be
created if this approach sees extensive use.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mspasspy.history.pfbranch_to_dict">
<span class="sig-prename descclassname"><span class="pre">mspasspy.history.</span></span><span class="sig-name descname"><span class="pre">pfbranch_to_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mspasspy/history.html#pfbranch_to_dict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mspasspy.history.pfbranch_to_dict" title="Permalink to this definition"></a></dt>
<dd><p>Recursive function to convert a single branch in an AntelopePf to a python dict.</p>
<p>This function utilizes recursion to follow a chain of arbitrary length of
branches defined in an AntelopePf object.   Result is a dict with a chain of
dicts of the same length.  i.e. if AntelopePf has 3 levels of branches
the dict will have a 3 levels of associative arrays keyed by the same
branch names as the Arr items in the original Pf file.  Note this should
be called from the top level one branch at a time.  i.e. for the parent
AntelopePf this function should be called once for each returned key by
pf.arr_keys().</p>
<p>Note that at each level Tbl&amp; sections of the original pf are parsed to
be converted to lists of strings with each line of the Tbl section being
one string in the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pf</strong> – is an AntelopePf.  Recursive calls use get_branch outputs
that return one of these.</p></li>
<li><p><strong>key</strong> (<em>string</em>) – key used to access the branch requested</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>python dict translation of AntelopePf branch structure</p>
</dd>
<dt class="field-odd">Raise<span class="colon">:</span></dt>
<dd class="field-odd"><p>RunTime errors are possible from the ccore methods that are called.</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mspasspy.graphics.html" class="btn btn-neutral float-left" title="mspasspy.graphics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mspasspy.reduce.html" class="btn btn-neutral float-right" title="mspasspy.reduce" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Ian Wang.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>