

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Time Standard Constraints &mdash; MsPASS 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=f6245a2f"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Processing History Concepts" href="processing_history_concepts.html" />
    <link rel="prev" title="Using ObsPy with MsPASS" href="obspy_interface.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MsPASS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_start.html">Getting Started in a Nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/run_mspass_with_docker.html">Run MsPASS with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_docker_compose.html">Deploy MsPASS with Docker Compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_conda.html">Deploy MsPASS with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_conda.html#advanced-setup-considerations">Advanced Setup Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_on_HPC.html">Deploying MsPASS on an HPC cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/deploy_mspass_with_conda_and_coiled.html">Deploy MsPASS with Conda and Coiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started_overview.html">MsPASS Virtual Cluster Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="database_concepts.html">Database Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="CRUD_operations.html">CRUD Operations in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongodb_and_mspass.html">Using MongoDB with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="normalization.html">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_tabular_data.html">Importing Tabular Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seismic Data Objects</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_object_design_concepts.html">Data Object Design Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy_scipy_interface.html">Using numpy/scipy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="obspy_interface.html">Using ObsPy with MsPASS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Time Standard Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_history_concepts.html">Processing History Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="continuous_data.html">Continuous Data Handling with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema_choices.html">What database schema should I use?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="handling_errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_editing.html">Data Editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="header_math.html">Header (Metadata) Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphics.html">Graphics in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal_to_noise.html">Signal to Noise Ratio Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="adapting_algorithms.html">Adapting an Existing Algorithm to MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parallel_processing.html">Parallel Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory_management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">I/O in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel_io.html">Parallel IO in MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequency Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="development_strategies.html">How do I develop a new workflow from scratch?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cxx_api/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mspass_schema/mspass_schema.html">MsPASS Schema</a></li>
</ul>

    <a href= "../genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Time Standard Constraints</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/mspass-team/mspass/blob/master/docs/source/user_manual/time_standard_constraints.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="time-standard-constraints">
<span id="id1"></span><h1>Time Standard Constraints<a class="headerlink" href="#time-standard-constraints" title="Permalink to this heading"></a></h1>
<div class="line-block">
<div class="line">The section in the user’s manual on BasicTimeSeries concepts
(This needs a link back to that section) discusses a novel feature of
MsPASS that allows the framework to support both active source and
passive array data.   This section contains additional implementation
details that some users may find important.  The most notable example
is simulation data created for testing or comparison with data
(i.e. traditional synthetic seismogram concepts).</div>
</div>
<blockquote>
<div><p>First, we will state what we define as the finite set of time issues
the framework needed to support:</p>
<ol class="arabic">
<li><p>The data for passive array recording can be assumed to be based on
a global timing standard.  Today that usually means GPS clocks but
older data used a variety of timing instrumentation that has evolved
with time.   The only difference in older data is timing precision.
We lump all such data by tagging them the <code class="code docutils literal notranslate"><span class="pre">TimeReferenceType</span></code> as <code class="code docutils literal notranslate"><span class="pre">UTC</span></code>.
There are other global time standards like GPS time (such data do not
include leap seconds) but we assume such data are converted to UTC
on import.  Data derived from a UTC standard can be in one of two
states:</p>
<ol class="loweralpha simple">
<li><p>Set with time 0 defined as UTC 0 time.   That is, the instant of
New Year in 1970 (Jan. 1, 1970:00:00:00.0).   Time tag for a
given sample (the output of the time method in BasicTimeSeries)
is then a unix epoch seconds since epoch time 0.  Note for obpsy users that
time is identical to the output of the timestamp method of UTCDateTime.</p></li>
<li><p>An algorithm can apply the ator method that will produce an
internal shift of time 0 by a specified number of seconds.  Two
choices of that shift are most common.  First, shifting by the
origin of an event converts time to travel times.  Second,
MsPASS has an algorithm called <code class="code docutils literal notranslate"><span class="pre">ArrivalTimeReference</span></code> that
shifts data so time 0 is the arrival time of a particular phase.
Note that time could be a predicted time from an earth model and
hypocenter estimate or a time measured by picking or correlation
method.  The arrival time reference is commonly used to
improve plotting (visualization) of data or simply to reduce
the volume of data to handle.   That is, algorithms aimed to
process data around a specific section of data defined relative
to a seismic phase nearly always window data using this time
standard.  SAC users may understand the output of ator method
as a generalization of the finite list of time standards supported
in SAC.</p></li>
</ol>
<p>All data loaded originally with a UTC time standard have an internal
boolean attribute (<code class="code docutils literal notranslate"><span class="pre">t0shift_is_valid</span></code>) set true to inform the
system the data have a valid absolute time stamp.  Data loaded from
seed files will always have this set properly, but custom readers for
unusual formats must be aware of this constraint.  BasicTimeSeries
time series has the method <code class="code docutils literal notranslate"><span class="pre">set_tref</span></code> that can be used to force the
time standard.</p>
</li>
<li><p>Active source data are normally best loaded with the TimeReferenceType
set as <code class="code docutils literal notranslate"><span class="pre">Relative</span></code> (TimeReferenceType.Relative in python or
TimeReferenceType::Relative in C++).   Relative time in this context
is nearly always equivalent to having time 0 set to the shot time.
In the design of MsPASS, however, we aimed to support the range of
instrumentation in active source data acquisition with three different
absolute time precisions:</p></li>
</ol>
<blockquote>
<div><blockquote>
<div><ol class="loweralpha simple">
<li><p>Much old data had very imprecise absolute timing or none at all.
It is common, for example, with old SEGY files to find none of
the absolute fields defined. That is the case because in
traditional active source processing like classic seismic reflection
processing all that matters in processing is travel time.  In that case
absolute time tags are baggage useful only for bookkeeping.</p></li>
<li><p>Newer data seismic reflection data loggers always have a system
clock that keeps time but not necessarily with high accuracy.
These data loggers always write a date stamp to their internal file
format, but it cannot be used to converted accurately to absolute
time using that time stamp.</p></li>
<li><p>Many of newer systems record time synchronized with GPS receivers.
IRIS PASSCAL instruments beginning with the old SGR’s through the
most recent (at this writing) Nodal instruments depend upon accurate
internal clocks.   Data from this type of instrumentation is
conceptually identical to data that begins as UTC but is time shifted
so TimeReferenceType is “Relative” and the time is shifted so 0
is the shot time.</p></li>
</ol>
</div></blockquote>
<p>The common denominator for all active source data is that the they should
have TimeReferenceType set to “Relative”.   The first two cases when
the absolute timing is not reliable should have the internal attribute
<code class="code docutils literal notranslate"><span class="pre">t0shift_is_valid</span></code> set to False.  That assures the users won’t make the
mistake of calling the rtoa function and creating a potentially misleading
(at best) data set.  That constraint can be enforced using the <code class="code docutils literal notranslate"><span class="pre">set_tref</span></code>
method that can be called from either TimeSeries or Seismogram objects.
The complete set of methods available to handle this issue are discussed at the
end of this document.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Synthetic seismograms are a special case that have to be handled with
care.   The reason is putting synthetic seismogram signals into this
framework almost always has to be carefully aware of the distinction
between UTC and Relative time.  I know of now synthetic seismogram
generator that internally uses anything other than the equivalent of
a Relative time standard with 0 being source origin time.  Matching
recorded signals, however, may require shifting either the data to
relative time or shifting the synthetics to UTC time.  The two are
completely equivalent but how they impact MsPASS is very different and
must be considered.   Shifting data with a UTC time stamp to relative
time is simplest - it involves only a call to ator.  The inverse
requires some care with the synthetics as you would need to override the
safeties described below.</p></li>
</ol>
</div></blockquote>
<div class="line-block">
<div class="line">With that background, here we summarize the API used to manage time.  All
of these are components of the BasicTimeSeries base class, but there are
some deviations between the C++ and python APIs.</div>
</div>
<blockquote>
<div><ul>
<li><p>The time stamp that is to handle time 0 is managed in C++ by a getter
with he simple name <code class="code docutils literal notranslate"><span class="pre">t0()</span></code> and a setter called <code class="code docutils literal notranslate"><span class="pre">set_t0()</span></code>.  In python
these are merged to a single symbol t0 with decorators in a fairly
standard way to make t0 appear like a class attribute as in the
following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">arrival_time</span>      <span class="c1"># t0 as a setter (alias for set_to(arrival.time)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">t0</span>                 <span class="c1"># t0 as a getter (alias for to())</span>
</pre></div>
</div>
</li>
<li><p>There are several convenience methods that are useful for managing time
as a variable.  The <code class="code docutils literal notranslate"><span class="pre">time(int</span> <span class="pre">i)</span></code> method can be used get the computed
time (Relative or absolute depending on the TimeReferenceType set)
of sample number i.   <code class="code docutils literal notranslate"><span class="pre">endtime()</span></code> is a special case that returns
<code class="code docutils literal notranslate"><span class="pre">time(npts-1)</span></code> where npts is the number of points in the signal.  Finally,
there is the inverse function <code class="code docutils literal notranslate"><span class="pre">sample_number(double</span> <span class="pre">t)</span></code> that returns
the integer sample number computed for time t rounded to the nearest
sample.   Users are cautioned that none of these methods check the
validity of a time or sample number with respect to the data.  e.g. it
would be ill-advised to use the output of <code class="code docutils literal notranslate"><span class="pre">sample_number(t)</span></code> as an
index into the data array without checking the result is &gt;0 and
&lt; npts.</p></li>
<li><p>There are two methods to switch between UTC and Relative time standards.
Use <code class="code docutils literal notranslate"><span class="pre">ator(time_shift)</span></code> to translate the time origin to the time
defined by the epoch time <code class="code docutils literal notranslate"><span class="pre">time_shift</span></code>.   Note a convenient way to
get such a time from a date string is the use obspy’s UTCDateTime
and apply the <code class="code docutils literal notranslate"><span class="pre">timestamp</span></code> method on the UTCDateTime object.  The
inverse of <code class="code docutils literal notranslate"><span class="pre">ator</span></code> is <code class="code docutils literal notranslate"><span class="pre">rtoa()</span></code>.   Note the method has no arguments
and uses the value of time_shift applied when <code class="code docutils literal notranslate"><span class="pre">ator</span></code> is called to
restore time to UTC.  Finally, there is a <code class="code docutils literal notranslate"><span class="pre">shift(delta_time)</span></code>
method intended to be used to tweek time 0.  That method should only
be used if the data are in Relative time created by an earlier call
to the ator method.  The main use of the <code class="code docutils literal notranslate"><span class="pre">shift</span></code> method is for things
like switching between two relative time stamps (e.g. between two
phase arrival times or between source origin time and a phase time).</p></li>
<li><p>The problem of how to define if a relative time standard should be
treated as reliable is managed internally by a private
(technically protected in C++ but private from a python perspective),
boolean attribute called <code class="code docutils literal notranslate"><span class="pre">t0shift_is_valid</span></code> in the C++ code.  That
attribute can be interrogated with the method <code class="code docutils literal notranslate"><span class="pre">shifted()</span></code>.   The
<code class="code docutils literal notranslate"><span class="pre">shifted</span></code> method returns true if the data are in UTC (not shifted
by calling ator) OR they were never defined with respect to UTC
(i.e. active source data like that noted above).  There are a
(dangerous) pair of setter to force a time standard.
First, it may be sometimes necessary to force the time standard
with the method <code class="code docutils literal notranslate"><span class="pre">set_tref(rtype)</span></code> where rtype has the ugly form in python
<code class="code docutils literal notranslate"><span class="pre">TimeReferenceType.UTC</span></code> or <code class="code docutils literal notranslate"><span class="pre">TimeReferenceType.Relative</span></code>.
(At the risk of adding confusion the same symbols would be referred to
as <code class="code docutils literal notranslate"><span class="pre">TimeReferenceType::UTC</span></code> and <code class="code docutils literal notranslate"><span class="pre">TimeReferenceType::Relative</span> <span class="pre">in</span> <span class="pre">C++)</span></code>.
The second dangerous setter has the signature <code class="code docutils literal notranslate"><span class="pre">force_t0_shift(t)</span></code>.  It will
set the data 0 value to t and set <code class="code docutils literal notranslate"><span class="pre">t0_shift_is_valid</span></code> to True.
The primary purpose of these two methods is to match synthetics to
data that are stored with UTC time.   By calling
<code class="code docutils literal notranslate"><span class="pre">set_tref(TimeReferenceType.UTC)</span></code> followed by a call to <code class="code docutils literal notranslate"><span class="pre">force_t0_shift(t)</span></code>
where t is the origin time of an event being simulated, a synthetic can
be compared sample by sample to data.</p></li>
</ul>
</div></blockquote>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="obspy_interface.html" class="btn btn-neutral float-left" title="Using ObsPy with MsPASS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="processing_history_concepts.html" class="btn btn-neutral float-right" title="Processing History Concepts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Ian Wang.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>