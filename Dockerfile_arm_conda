FROM --platform=linux/arm64 mambaorg/micromamba:latest
ENV BASH_ENV=~/.bashrc
SHELL ["/bin/bash", "-c"]

ENV PYTHON_VERSION=3.11
RUN micromamba install conda-build anaconda-client \
    && micromamba config --set anaconda_upload no \
    && config --add channels conda-forge \
    && ANACONDA_API_TOKEN=cx-8248b24a-767b-41de-ab7d-446cdc390b23 \
    && PACKAGE_PATH=$(micromamba build . --python ${{ matrix.python-version }} --output) \
    && micromamba build . --python ${{ matrix.python-version }} \
    && anamicromamba -t $ANACONDA_API_TOKEN upload $PACKAGE_PATH --label py${{ matrix.python-version }} --force
