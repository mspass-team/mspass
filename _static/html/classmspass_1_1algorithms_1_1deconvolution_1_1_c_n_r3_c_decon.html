<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MsPASS C++ API: mspass::algorithms::deconvolution::CNR3CDecon Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script src="striped_bg.js"></script>
<link href="that_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> version
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Defines the C++ API for MsPASS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>mspass</b></li><li class="navelem"><b>algorithms</b></li><li class="navelem"><b>deconvolution</b></li><li class="navelem"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">mspass::algorithms::deconvolution::CNR3CDecon Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Colored Noise Regularized 3C Deconvolution opertor.  
 <a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_c_n_r3_c_decon_8h_source.html">CNR3CDecon.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for mspass::algorithms::deconvolution::CNR3CDecon:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.png" usemap="#mspass::algorithms::deconvolution::CNR3CDecon_map" alt=""/>
  <map id="mspass::algorithms::deconvolution::CNR3CDecon_map" name="mspass::algorithms::deconvolution::CNR3CDecon_map">
<area href="classmspass_1_1algorithms_1_1deconvolution_1_1_base3_c_decon.html" title="Absract base class for algorithms handling full 3C data." alt="mspass::algorithms::deconvolution::Base3CDecon" shape="rect" coords="0,0,318,24"/>
<area href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html" title="Object to hold components needed in all fft based decon algorithms." alt="mspass::algorithms::deconvolution::FFTDeconOperator" shape="rect" coords="328,0,646,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac6c9860a5492d4a526172b9df3bbcffa" id="r_ac6c9860a5492d4a526172b9df3bbcffa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#ac6c9860a5492d4a526172b9df3bbcffa">CNR3CDecon</a> ()</td></tr>
<tr class="separator:ac6c9860a5492d4a526172b9df3bbcffa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd414b6432d322bfb2c7a05a6f3cd725" id="r_acd414b6432d322bfb2c7a05a6f3cd725"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#acd414b6432d322bfb2c7a05a6f3cd725">CNR3CDecon</a> (const <a class="el" href="classmspass_1_1utility_1_1_antelope_pf.html">mspass::utility::AntelopePf</a> &amp;pf)</td></tr>
<tr class="memdesc:acd414b6432d322bfb2c7a05a6f3cd725"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct from a tree of parameters loaded into an AntelopePf object.  <br /></td></tr>
<tr class="separator:acd414b6432d322bfb2c7a05a6f3cd725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a923e4dc68c1c50500a08e0d0c5907489" id="r_a923e4dc68c1c50500a08e0d0c5907489"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a923e4dc68c1c50500a08e0d0c5907489">CNR3CDecon</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a> &amp;parent)</td></tr>
<tr class="separator:a923e4dc68c1c50500a08e0d0c5907489"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0892388be3850c342df4792c662751f5" id="r_a0892388be3850c342df4792c662751f5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a0892388be3850c342df4792c662751f5">~CNR3CDecon</a> ()</td></tr>
<tr class="separator:a0892388be3850c342df4792c662751f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf66a37adf3ab2a38e9b4c4b08a82bb2" id="r_aaf66a37adf3ab2a38e9b4c4b08a82bb2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#aaf66a37adf3ab2a38e9b4c4b08a82bb2">operator=</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a> &amp;parent)</td></tr>
<tr class="separator:aaf66a37adf3ab2a38e9b4c4b08a82bb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab14420b7e2766c58d2846cdc112fabad" id="r_ab14420b7e2766c58d2846cdc112fabad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#ab14420b7e2766c58d2846cdc112fabad">change_parameters</a> (const <a class="el" href="classmspass_1_1utility_1_1_basic_metadata.html">mspass::utility::BasicMetadata</a> &amp;md)</td></tr>
<tr class="memdesc:ab14420b7e2766c58d2846cdc112fabad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change the setup of the operator on the fly.  <br /></td></tr>
<tr class="separator:ab14420b7e2766c58d2846cdc112fabad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88d7fe1143e6459d7accf40e00f8cab2" id="r_a88d7fe1143e6459d7accf40e00f8cab2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a88d7fe1143e6459d7accf40e00f8cab2">loaddata</a> (<a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;d, const int wcomp, const bool loadnoise=false)</td></tr>
<tr class="memdesc:a88d7fe1143e6459d7accf40e00f8cab2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load data with one component used as wavelet estimate.  <br /></td></tr>
<tr class="separator:a88d7fe1143e6459d7accf40e00f8cab2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad3f642e58266d7840d2a1a8897f52c1" id="r_aad3f642e58266d7840d2a1a8897f52c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#aad3f642e58266d7840d2a1a8897f52c1">loaddata</a> (<a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;d, const bool loadnoise=false)</td></tr>
<tr class="memdesc:aad3f642e58266d7840d2a1a8897f52c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load data and optionally load noise.  <br /></td></tr>
<tr class="separator:aad3f642e58266d7840d2a1a8897f52c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d050c0940ada32cc3ddfecff9cade4a" id="r_a9d050c0940ada32cc3ddfecff9cade4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a9d050c0940ada32cc3ddfecff9cade4a">loadnoise_data</a> (const <a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;n)</td></tr>
<tr class="memdesc:a9d050c0940ada32cc3ddfecff9cade4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load noise data directly.  <br /></td></tr>
<tr class="separator:a9d050c0940ada32cc3ddfecff9cade4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd05e4335e689e7fa4ff9fec8dbf3c78" id="r_abd05e4335e689e7fa4ff9fec8dbf3c78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#abd05e4335e689e7fa4ff9fec8dbf3c78">loadnoise_data</a> (const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;n)</td></tr>
<tr class="memdesc:abd05e4335e689e7fa4ff9fec8dbf3c78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load noise estimate directly as a PowerSpectrum object.  <br /></td></tr>
<tr class="separator:abd05e4335e689e7fa4ff9fec8dbf3c78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f0b6ab1ffaf2b0f514341be81b21d7e" id="r_a8f0b6ab1ffaf2b0f514341be81b21d7e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a8f0b6ab1ffaf2b0f514341be81b21d7e">loadwavelet</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;w)</td></tr>
<tr class="memdesc:a8f0b6ab1ffaf2b0f514341be81b21d7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load data defining the wavelet to use for deconvolution.  <br /></td></tr>
<tr class="separator:a8f0b6ab1ffaf2b0f514341be81b21d7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fc0dadf9ce17343244d45e30e14519e" id="r_a3fc0dadf9ce17343244d45e30e14519e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a3fc0dadf9ce17343244d45e30e14519e">loadnoise_wavelet</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;n)</td></tr>
<tr class="memdesc:a3fc0dadf9ce17343244d45e30e14519e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load noise data for wavelet directly.  <br /></td></tr>
<tr class="separator:a3fc0dadf9ce17343244d45e30e14519e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17af91b35a03c0a87a01e6ddb525e6ef" id="r_a17af91b35a03c0a87a01e6ddb525e6ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a17af91b35a03c0a87a01e6ddb525e6ef">loadnoise_wavelet</a> (const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;n)</td></tr>
<tr class="memdesc:a17af91b35a03c0a87a01e6ddb525e6ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load noise estimate for wavelet signal directly as a PowerSpectrum object.  <br /></td></tr>
<tr class="separator:a17af91b35a03c0a87a01e6ddb525e6ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a048f73981dd0c6baf93fe4e6126672aa" id="r_a048f73981dd0c6baf93fe4e6126672aa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a048f73981dd0c6baf93fe4e6126672aa">process</a> ()</td></tr>
<tr class="separator:a048f73981dd0c6baf93fe4e6126672aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37c49917252fd7159e85fd9b3b9be5c9" id="r_a37c49917252fd7159e85fd9b3b9be5c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a37c49917252fd7159e85fd9b3b9be5c9">ideal_output</a> ()</td></tr>
<tr class="separator:a37c49917252fd7159e85fd9b3b9be5c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b7f51d901d32ef5a08e8d0de69f666c" id="r_a0b7f51d901d32ef5a08e8d0de69f666c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a0b7f51d901d32ef5a08e8d0de69f666c">actual_output</a> ()</td></tr>
<tr class="separator:a0b7f51d901d32ef5a08e8d0de69f666c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b2f893beb6c678f31d42ca579d539f3" id="r_a1b2f893beb6c678f31d42ca579d539f3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a1b2f893beb6c678f31d42ca579d539f3">inverse_wavelet</a> (double tshift)</td></tr>
<tr class="memdesc:a1b2f893beb6c678f31d42ca579d539f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a FIR represention of the inverse filter.  <br /></td></tr>
<tr class="separator:a1b2f893beb6c678f31d42ca579d539f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a250882407c9755fc4e3f822833b93ea0" id="r_a250882407c9755fc4e3f822833b93ea0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1utility_1_1_metadata.html">mspass::utility::Metadata</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a250882407c9755fc4e3f822833b93ea0">QCMetrics</a> ()</td></tr>
<tr class="memdesc:a250882407c9755fc4e3f822833b93ea0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return appropriate quality measures.  <br /></td></tr>
<tr class="separator:a250882407c9755fc4e3f822833b93ea0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4ec1e4c89908b92369acc64f8d95197" id="r_ab4ec1e4c89908b92369acc64f8d95197"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#ab4ec1e4c89908b92369acc64f8d95197">wavelet_noise_spectrum</a> ()</td></tr>
<tr class="separator:ab4ec1e4c89908b92369acc64f8d95197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3db168e04d8869485f1b9b9307a016e1" id="r_a3db168e04d8869485f1b9b9307a016e1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a3db168e04d8869485f1b9b9307a016e1">data_noise_spectrum</a> ()</td></tr>
<tr class="separator:a3db168e04d8869485f1b9b9307a016e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5615a2e7adc3f4a49e69362031aa5f83" id="r_a5615a2e7adc3f4a49e69362031aa5f83"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a5615a2e7adc3f4a49e69362031aa5f83">wavelet_spectrum</a> ()</td></tr>
<tr class="separator:a5615a2e7adc3f4a49e69362031aa5f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15a1bb3390af0283e0a57949248f971c" id="r_a15a1bb3390af0283e0a57949248f971c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a15a1bb3390af0283e0a57949248f971c">data_spectrum</a> ()</td></tr>
<tr class="separator:a15a1bb3390af0283e0a57949248f971c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">mspass::algorithms::deconvolution::FFTDeconOperator</a></td></tr>
<tr class="memitem:a6851bec74d3f288eaf1de36cf1d7953b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a6851bec74d3f288eaf1de36cf1d7953b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a6851bec74d3f288eaf1de36cf1d7953b">FFTDeconOperator</a> (const <a class="el" href="classmspass_1_1utility_1_1_metadata.html">mspass::utility::Metadata</a> &amp;md)</td></tr>
<tr class="separator:a6851bec74d3f288eaf1de36cf1d7953b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3df395f4ff5bae8b891bee33f107e46 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_af3df395f4ff5bae8b891bee33f107e46"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#af3df395f4ff5bae8b891bee33f107e46">FFTDeconOperator</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">FFTDeconOperator</a> &amp;parent)</td></tr>
<tr class="separator:af3df395f4ff5bae8b891bee33f107e46 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1040f97ddf7bb7bd2c33ac9a7f99a79 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_ae1040f97ddf7bb7bd2c33ac9a7f99a79"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">FFTDeconOperator</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#ae1040f97ddf7bb7bd2c33ac9a7f99a79">operator=</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">FFTDeconOperator</a> &amp;parent)</td></tr>
<tr class="separator:ae1040f97ddf7bb7bd2c33ac9a7f99a79 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ce6831f67065f17fe7b30aa014eaaf3 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a0ce6831f67065f17fe7b30aa014eaaf3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a0ce6831f67065f17fe7b30aa014eaaf3">changeparameter</a> (const <a class="el" href="classmspass_1_1utility_1_1_metadata.html">mspass::utility::Metadata</a> &amp;md)</td></tr>
<tr class="separator:a0ce6831f67065f17fe7b30aa014eaaf3 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaceb977e9797e483bf3a8ba030743c6 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_aeaceb977e9797e483bf3a8ba030743c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#aeaceb977e9797e483bf3a8ba030743c6">change_size</a> (const int nfft_new)</td></tr>
<tr class="separator:aeaceb977e9797e483bf3a8ba030743c6 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d3f1776e68b20fff386d4bc19e51550 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a3d3f1776e68b20fff386d4bc19e51550"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3d3f1776e68b20fff386d4bc19e51550">change_shift</a> (const int shift)</td></tr>
<tr class="separator:a3d3f1776e68b20fff386d4bc19e51550 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf21bce1d1519ece5e9879d03e7f7e5a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_abf21bce1d1519ece5e9879d03e7f7e5a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#abf21bce1d1519ece5e9879d03e7f7e5a">get_size</a> ()</td></tr>
<tr class="separator:abf21bce1d1519ece5e9879d03e7f7e5a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad63458bb8ad8a04a66de1c140152fc96 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_ad63458bb8ad8a04a66de1c140152fc96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#ad63458bb8ad8a04a66de1c140152fc96">get_shift</a> ()</td></tr>
<tr class="separator:ad63458bb8ad8a04a66de1c140152fc96 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a494e951fb5fceffc545e411a8932d782 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a494e951fb5fceffc545e411a8932d782"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a494e951fb5fceffc545e411a8932d782">operator_size</a> ()</td></tr>
<tr class="separator:a494e951fb5fceffc545e411a8932d782 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f399747b50f4f98f46b643f23af0ee1 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a6f399747b50f4f98f46b643f23af0ee1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a6f399747b50f4f98f46b643f23af0ee1">operator_shift</a> ()</td></tr>
<tr class="separator:a6f399747b50f4f98f46b643f23af0ee1 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf84c339f3b540543ee8c3487997908a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_adf84c339f3b540543ee8c3487997908a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#adf84c339f3b540543ee8c3487997908a">df</a> (const double dt)</td></tr>
<tr class="separator:adf84c339f3b540543ee8c3487997908a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3473dc7f359332dbf5a685efe30a684b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a3473dc7f359332dbf5a685efe30a684b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html">mspass::seismic::CoreTimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">FourierInverse</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_complex_array.html">ComplexArray</a> &amp;winv, const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_complex_array.html">ComplexArray</a> &amp;sw, const double dt, const double t0parent)</td></tr>
<tr class="memdesc:a3473dc7f359332dbf5a685efe30a684b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return inverse wavelet for Fourier methods.  <br /></td></tr>
<tr class="separator:a3473dc7f359332dbf5a685efe30a684b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">mspass::algorithms::deconvolution::FFTDeconOperator</a></td></tr>
<tr class="memitem:aa8619effc38e9e0f3927c73eb9b838f0 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_aa8619effc38e9e0f3927c73eb9b838f0"><td class="memItemLeft" align="right" valign="top">
int&#160;</td><td class="memItemRight" valign="bottom"><b>nfft</b></td></tr>
<tr class="separator:aa8619effc38e9e0f3927c73eb9b838f0 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7034bf16dcf7ea16563a7032ce19b08e inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a7034bf16dcf7ea16563a7032ce19b08e"><td class="memItemLeft" align="right" valign="top">
int&#160;</td><td class="memItemRight" valign="bottom"><b>sample_shift</b></td></tr>
<tr class="separator:a7034bf16dcf7ea16563a7032ce19b08e inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3480b78a08228fc2b2c79809b98335d5 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a3480b78a08228fc2b2c79809b98335d5"><td class="memItemLeft" align="right" valign="top">
gsl_fft_complex_wavetable *&#160;</td><td class="memItemRight" valign="bottom"><b>wavetable</b></td></tr>
<tr class="separator:a3480b78a08228fc2b2c79809b98335d5 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1121967f87437c76cfbb1d8a8fb592e8 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a1121967f87437c76cfbb1d8a8fb592e8"><td class="memItemLeft" align="right" valign="top">
gsl_fft_complex_workspace *&#160;</td><td class="memItemRight" valign="bottom"><b>workspace</b></td></tr>
<tr class="separator:a1121967f87437c76cfbb1d8a8fb592e8 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66026b54b517bc3797a1992ca332bc64 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a66026b54b517bc3797a1992ca332bc64"><td class="memItemLeft" align="right" valign="top">
<a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_complex_array.html">ComplexArray</a>&#160;</td><td class="memItemRight" valign="bottom"><b>winv</b></td></tr>
<tr class="separator:a66026b54b517bc3797a1992ca332bc64 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Colored Noise Regularized 3C Deconvolution opertor. </p>
<p>This algorithm is somewhat of a synthesis of the best features from the various frequency comain methods currently in use for receiver function estimation. Key features are:</p><ol type="1">
<li>Data are tapered by a generic function with a range of options.</li>
<li>The output is always a Seismogram, which in MsPASS means 3C data</li>
<li>The inverse is regularized by a scaled 3C noise estimate.</li>
<li>Perhaps most importantly the shaping wavelet is computed dynamically based on bandwidth estimated from the combination power spectrum estimates of the signal and noise for both the data being deconvolved and the wavelet used to compute the inverse. For array methods the two noise estimates can be drastically different.</li>
</ol>
<p>This object is what might be called a processing object. That is, it does not use the model of construction creating the thing it defines (Seismogram, for example, uses that paradigm). Instead the constructor defines the operator. Data are processed by first calling one of the loaddata and loadnoise methods. Once valid data is loaded call the process method to deconvolve the loaded data. Note this approach assumes the data, wavelet, and noise used for the processing are internally consistent. The user is warned there a limited safeties to validate any consistency because it would be hard to do so without causing more problems that it would solve. In MsPASS we expect to hide this a bit behind some python wrappers to create more safety mechanisms. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac6c9860a5492d4a526172b9df3bbcffa" name="ac6c9860a5492d4a526172b9df3bbcffa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6c9860a5492d4a526172b9df3bbcffa">&#9670;&#160;</a></span>CNR3CDecon() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNR3CDecon::CNR3CDecon </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default constructor. Puts operator in an invalid state. </p>
<div class="fragment"><div class="line"><span class="lineno">   27</span>    : FFTDeconOperator(), signalengine(), waveletengine(), dnoise_engine(),</div>
<div class="line"><span class="lineno">   28</span>      wnoise_engine(), shapingwavelet(), psnoise(), psnoise_data(), decondata(),</div>
<div class="line"><span class="lineno">   29</span>      wavelet() {</div>
<div class="line"><span class="lineno">   30</span>  algorithm = CNR3C_algorithms::undefined;</div>
<div class="line"><span class="lineno">   31</span>  operator_dt = 1.0;</div>
<div class="line"><span class="lineno">   32</span>  winlength = 0;</div>
<div class="line"><span class="lineno">   33</span>  processing_window = TimeWindow(0.0, 1.0);</div>
<div class="line"><span class="lineno">   34</span>  noise_window = TimeWindow(0.0, 1.0);</div>
<div class="line"><span class="lineno">   35</span>  damp = 0.0;</div>
<div class="line"><span class="lineno">   36</span>  noise_floor = 0.0001;</div>
<div class="line"><span class="lineno">   37</span>  snr_regularization_floor = 1.5;</div>
<div class="line"><span class="lineno">   38</span>  taper_data = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   39</span>  fhs = 2.0; <span class="comment">// appropriate for teleseismic P wave data</span></div>
<div class="line"><span class="lineno">   40</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; ++k) {</div>
<div class="line"><span class="lineno">   41</span>    signal_bandwidth_fraction[k] = 0.0;</div>
<div class="line"><span class="lineno">   42</span>    peak_snr[k] = 0.0;</div>
<div class="line"><span class="lineno">   43</span>  }</div>
<div class="line"><span class="lineno">   44</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="acd414b6432d322bfb2c7a05a6f3cd725" name="acd414b6432d322bfb2c7a05a6f3cd725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd414b6432d322bfb2c7a05a6f3cd725">&#9670;&#160;</a></span>CNR3CDecon() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNR3CDecon::CNR3CDecon </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1utility_1_1_antelope_pf.html">mspass::utility::AntelopePf</a> &amp;&#160;</td>
          <td class="paramname"><em>pf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct from a tree of parameters loaded into an AntelopePf object. </p>
<p>There number of inputs to construct this operator are quite large. An AntelelopePf is one way to store this information and the format assumed by this constructor. Note this object could be constructed from a yaml or xml file, in principle, but for the present we use Antelope's pf file \ format. i.e. a typical program would read a pf file and to construct the object passed as pf. </p>
<div class="fragment"><div class="line"><span class="lineno">   46</span>    : FFTDeconOperator(pf), signalengine(), waveletengine(), dnoise_engine(),</div>
<div class="line"><span class="lineno">   47</span>      wnoise_engine(), shapingwavelet(pf), psnoise(), psnoise_data(),</div>
<div class="line"><span class="lineno">   48</span>      decondata(), wavelet() {</div>
<div class="line"><span class="lineno">   49</span>  <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">   50</span>  <span class="comment">// cout &lt;&lt; &quot;Entering pf constructor&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">   51</span>  this-&gt;read_parameters(pf);</div>
<div class="line"><span class="lineno">   52</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a923e4dc68c1c50500a08e0d0c5907489" name="a923e4dc68c1c50500a08e0d0c5907489"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a923e4dc68c1c50500a08e0d0c5907489">&#9670;&#160;</a></span>CNR3CDecon() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNR3CDecon::CNR3CDecon </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a> &amp;&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Standard copy constructor. </p>
<div class="fragment"><div class="line"><span class="lineno">  204</span>    : processing_window(parent.processing_window),</div>
<div class="line"><span class="lineno">  205</span>      noise_window(parent.noise_window), signalengine(parent.signalengine),</div>
<div class="line"><span class="lineno">  206</span>      waveletengine(parent.waveletengine), dnoise_engine(parent.dnoise_engine),</div>
<div class="line"><span class="lineno">  207</span>      wnoise_engine(parent.wnoise_engine),</div>
<div class="line"><span class="lineno">  208</span>      shapingwavelet(parent.shapingwavelet), psnoise(parent.psnoise),</div>
<div class="line"><span class="lineno">  209</span>      psnoise_data(parent.psnoise_data), pssignal(parent.pssignal),</div>
<div class="line"><span class="lineno">  210</span>      pswavelet(parent.pswavelet), decondata(parent.decondata),</div>
<div class="line"><span class="lineno">  211</span>      wavelet(parent.wavelet), wavelet_taper(parent.wavelet_taper),</div>
<div class="line"><span class="lineno">  212</span>      data_taper(parent.data_taper), ao_fft(parent.ao_fft),</div>
<div class="line"><span class="lineno">  213</span>      wavelet_bwd(parent.wavelet_bwd), signal_bwd(parent.signal_bwd),</div>
<div class="line"><span class="lineno">  214</span>      wavelet_snr(parent.wavelet_snr)</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>{</div>
<div class="line"><span class="lineno">  217</span>  algorithm = parent.algorithm;</div>
<div class="line"><span class="lineno">  218</span>  taper_data = parent.taper_data;</div>
<div class="line"><span class="lineno">  219</span>  operator_dt = parent.operator_dt;</div>
<div class="line"><span class="lineno">  220</span>  winlength = parent.winlength;</div>
<div class="line"><span class="lineno">  221</span>  damp = parent.damp;</div>
<div class="line"><span class="lineno">  222</span>  noise_floor = parent.noise_floor;</div>
<div class="line"><span class="lineno">  223</span>  snr_regularization_floor = parent.snr_regularization_floor;</div>
<div class="line"><span class="lineno">  224</span>  snr_bandwidth = parent.snr_bandwidth;</div>
<div class="line"><span class="lineno">  225</span>  band_snr_floor = parent.band_snr_floor;</div>
<div class="line"><span class="lineno">  226</span>  regularization_bandwidth_fraction = parent.regularization_bandwidth_fraction;</div>
<div class="line"><span class="lineno">  227</span>  decon_bandwidth_cutoff = parent.decon_bandwidth_cutoff;</div>
<div class="line"><span class="lineno">  228</span>  fhs = parent.fhs;</div>
<div class="line"><span class="lineno">  229</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; ++k) {</div>
<div class="line"><span class="lineno">  230</span>    signal_bandwidth_fraction[k] = parent.signal_bandwidth_fraction[k];</div>
<div class="line"><span class="lineno">  231</span>    peak_snr[k] = parent.peak_snr[k];</div>
<div class="line"><span class="lineno">  232</span>  }</div>
<div class="line"><span class="lineno">  233</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0892388be3850c342df4792c662751f5" name="a0892388be3850c342df4792c662751f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0892388be3850c342df4792c662751f5">&#9670;&#160;</a></span>~CNR3CDecon()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNR3CDecon::~CNR3CDecon </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Standard destructor. </p>
<div class="fragment"><div class="line"><span class="lineno">  275</span>                        {</div>
<div class="line"><span class="lineno">  276</span>  <span class="comment">// if(wavelet_taper!=NULL) delete wavelet_taper;</span></div>
<div class="line"><span class="lineno">  277</span>  <span class="comment">// if(data_taper!=NULL) delete data_taper;</span></div>
<div class="line"><span class="lineno">  278</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0b7f51d901d32ef5a08e8d0de69f666c" name="a0b7f51d901d32ef5a08e8d0de69f666c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b7f51d901d32ef5a08e8d0de69f666c">&#9670;&#160;</a></span>actual_output()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">TimeSeries</a> mspass::algorithms::deconvolution::CNR3CDecon::actual_output </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>\brif Return the actual output of the deconvolution operator.</p>
<p>The actual output is defined as w^-1*w and is compable to resolution kernels in linear inverse theory. Although not required we would normally expect this function to be peaked at 0. Offsets from 0 would imply a bias. </p>

<p>Implements <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_base3_c_decon.html#aa7d5bfc6e1adfc1bd7af1606bebddf86">mspass::algorithms::deconvolution::Base3CDecon</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  911</span>                                     {</div>
<div class="line"><span class="lineno">  912</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  913</span>    ComplexArray W(FFTDeconOperator::nfft, &amp;(wavelet.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">s</a>[0]));</div>
<div class="line"><span class="lineno">  914</span>    gsl_fft_complex_forward(W.ptr(), 1, FFTDeconOperator::nfft, wavetable,</div>
<div class="line"><span class="lineno">  915</span>                            workspace);</div>
<div class="line"><span class="lineno">  916</span>    ComplexArray ao_fft;</div>
<div class="line"><span class="lineno">  917</span>    ao_fft = winv * W;</div>
<div class="line"><span class="lineno">  918</span>    <span class="comment">/* We always apply the shaping wavelet - this perhaps should be optional</span></div>
<div class="line"><span class="lineno">  919</span><span class="comment">    but probably better done with a none option for the shaping wavelet */</span></div>
<div class="line"><span class="lineno">  920</span>    ao_fft = (*shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">wavelet</a>()) * ao_fft;</div>
<div class="line"><span class="lineno">  921</span>    gsl_fft_complex_inverse(ao_fft.ptr(), 1, FFTDeconOperator::nfft, wavetable,</div>
<div class="line"><span class="lineno">  922</span>                            workspace);</div>
<div class="line"><span class="lineno">  923</span>    vector&lt;double&gt; ao;</div>
<div class="line"><span class="lineno">  924</span>    ao.reserve(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  925</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; ao_fft.size(); ++k)</div>
<div class="line"><span class="lineno">  926</span>      ao.push_back(ao_fft[k].real());</div>
<div class="line"><span class="lineno">  927</span>    <span class="comment">/* We always shift this wavelet to the center of the data vector.</span></div>
<div class="line"><span class="lineno">  928</span><span class="comment">    We handle the time through the CoreTimeSeries object. */</span></div>
<div class="line"><span class="lineno">  929</span>    <span class="keywordtype">int</span> i0 = FFTDeconOperator::nfft / 2;</div>
<div class="line"><span class="lineno">  930</span>    ao = circular_shift(ao, i0);</div>
<div class="line"><span class="lineno">  931</span>    TimeSeries result(</div>
<div class="line"><span class="lineno">  932</span>        wavelet); <span class="comment">// Use this to clone metadata and elog from wavelet</span></div>
<div class="line"><span class="lineno">  933</span>    result.set_npts(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  934</span>    <span class="comment">/* Force these even though they are likely already defined as</span></div>
<div class="line"><span class="lineno">  935</span><span class="comment">    in the parent wavelet TimeSeries. */</span></div>
<div class="line"><span class="lineno">  936</span>    result.set_live();</div>
<div class="line"><span class="lineno">  937</span>    <span class="comment">// result.s=ao;</span></div>
<div class="line"><span class="lineno">  938</span>    result.set_t0(operator_dt * (-(<span class="keywordtype">double</span>)i0));</div>
<div class="line"><span class="lineno">  939</span>    result.set_dt(this-&gt;operator_dt);</div>
<div class="line"><span class="lineno">  940</span>    result.set_tref(TimeReferenceType::Relative);</div>
<div class="line"><span class="lineno">  941</span>    <span class="comment">/* set_npts always initializes the s buffer so it is more efficient to</span></div>
<div class="line"><span class="lineno">  942</span><span class="comment">    copy ao elements rather than what was here before:</span></div>
<div class="line"><span class="lineno">  943</span><span class="comment">      result.s=ao;</span></div>
<div class="line"><span class="lineno">  944</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  945</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; FFTDeconOperator::nfft; ++k)</div>
<div class="line"><span class="lineno">  946</span>      result.s[k] = ao[k];</div>
<div class="line"><span class="lineno">  947</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  948</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  949</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  950</span>  };</div>
<div class="line"><span class="lineno">  951</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet_html_ac922b603ff03a691075724bcd53e396f"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">mspass::algorithms::deconvolution::ShapingWavelet::wavelet</a></div><div class="ttdeci">ComplexArray * wavelet()</div><div class="ttdef"><b>Definition</b> ShapingWavelet.h:75</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_time_series_html_ab044edb3fe5fe734cb577a4434f390a2"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">mspass::seismic::CoreTimeSeries::s</a></div><div class="ttdeci">std::vector&lt; double &gt; s</div><div class="ttdef"><b>Definition</b> CoreTimeSeries.h:27</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">mspass::seismic::CoreTimeSeries::s</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#a97ff6732aa816b0c327c5bf667ffe841">mspass::seismic::CoreTimeSeries::set_dt()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a1ca7ba8bcd8337bd49d438664e74966d">mspass::seismic::BasicTimeSeries::set_live()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#ae538485ac0aed2f8691477dffce6cda8">mspass::seismic::CoreTimeSeries::set_npts()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#ae90b28cff0bc1997aa65a1693d8562d0">mspass::seismic::CoreTimeSeries::set_t0()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#ac3f8c8200710fe0d3ef211c7c758e864">mspass::seismic::BasicTimeSeries::set_tref()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">mspass::algorithms::deconvolution::ShapingWavelet::wavelet()</a>.</p>

</div>
</div>
<a id="ab14420b7e2766c58d2846cdc112fabad" name="ab14420b7e2766c58d2846cdc112fabad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab14420b7e2766c58d2846cdc112fabad">&#9670;&#160;</a></span>change_parameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::change_parameters </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1utility_1_1_basic_metadata.html">mspass::utility::BasicMetadata</a> &amp;&#160;</td>
          <td class="paramname"><em>md</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Change the setup of the operator on the fly. </p>
<p>Sometimes an operator needs to have it's properties adjusted on the fly. this method can be used to redefine its operational properties instead of creating a new instance with the constructor. Use this method with care as it requires the same set of parameters as the AntelopePf constructor. The data are actually passed through the base class for an AntelopePF but currently it is implicitly expected to be data compatible with the pf constructor. </p>
<div class="fragment"><div class="line"><span class="lineno">   54</span>                                                              {</div>
<div class="line"><span class="lineno">   55</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">   56</span>    AntelopePf pf = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>AntelopePf &amp;<span class="keyword">&gt;</span>(basemd);</div>
<div class="line"><span class="lineno">   57</span>    this-&gt;read_parameters(pf);</div>
<div class="line"><span class="lineno">   58</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">   59</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">   60</span>  };</div>
<div class="line"><span class="lineno">   61</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3db168e04d8869485f1b9b9307a016e1" name="a3db168e04d8869485f1b9b9307a016e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3db168e04d8869485f1b9b9307a016e1">&#9670;&#160;</a></span>data_noise_spectrum()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> mspass::algorithms::deconvolution::CNR3CDecon::data_noise_spectrum </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the average 3C power spectrum for the latest loaded noise data. </p>
<div class="fragment"><div class="line"><span class="lineno">  283</span>{ <span class="keywordflow">return</span> psnoise_data; };</div>
</div><!-- fragment -->
</div>
</div>
<a id="a15a1bb3390af0283e0a57949248f971c" name="a15a1bb3390af0283e0a57949248f971c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15a1bb3390af0283e0a57949248f971c">&#9670;&#160;</a></span>data_spectrum()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> mspass::algorithms::deconvolution::CNR3CDecon::data_spectrum </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the power spectrum of the signal loaded for deconvolution. </p>
<div class="fragment"><div class="line"><span class="lineno">  287</span>{ <span class="keywordflow">return</span> pssignal; };</div>
</div><!-- fragment -->
</div>
</div>
<a id="a37c49917252fd7159e85fd9b3b9be5c9" name="a37c49917252fd7159e85fd9b3b9be5c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37c49917252fd7159e85fd9b3b9be5c9">&#9670;&#160;</a></span>ideal_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">TimeSeries</a> mspass::algorithms::deconvolution::CNR3CDecon::ideal_output </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  903</span>                                    {</div>
<div class="line"><span class="lineno">  904</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  905</span>    CoreTimeSeries ideal_tmp = this-&gt;shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#a5d213e187ff91de27d96e65b643bd71b">impulse_response</a>();</div>
<div class="line"><span class="lineno">  906</span>    <span class="keywordflow">return</span> TimeSeries(ideal_tmp, <span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  907</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  908</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  909</span>  };</div>
<div class="line"><span class="lineno">  910</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet_html_a5d213e187ff91de27d96e65b643bd71b"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#a5d213e187ff91de27d96e65b643bd71b">mspass::algorithms::deconvolution::ShapingWavelet::impulse_response</a></div><div class="ttdeci">mspass::seismic::CoreTimeSeries impulse_response()</div><div class="ttdef"><b>Definition</b> ShapingWavelet.cc:265</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1b2f893beb6c678f31d42ca579d539f3" name="a1b2f893beb6c678f31d42ca579d539f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b2f893beb6c678f31d42ca579d539f3">&#9670;&#160;</a></span>inverse_wavelet()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">TimeSeries</a> mspass::algorithms::deconvolution::CNR3CDecon::inverse_wavelet </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tshift</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return a FIR represention of the inverse filter. </p>
<p>After any deconvolution is computed one can sometimes produce a finite impulse response (FIR) respresentation of the inverse filter. <br  />
 </p>

<p>Implements <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_base3_c_decon.html#a8c73971b2670ad41a345a917abb5ef09">mspass::algorithms::deconvolution::Base3CDecon</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  952</span>                                                     {</div>
<div class="line"><span class="lineno">  953</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  954</span>    <span class="comment">/* Using the time shift of wavelet.t0() may be a bad idea here.  Will</span></div>
<div class="line"><span class="lineno">  955</span><span class="comment">    need to sort that out in debugging behaviour*/</span></div>
<div class="line"><span class="lineno">  956</span>    <span class="keywordtype">double</span> timeshift(tshift0);</div>
<div class="line"><span class="lineno">  957</span>    timeshift += wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">t0</a>();</div>
<div class="line"><span class="lineno">  958</span>    <span class="comment">// cout &lt;&lt; &quot;wavelet t0=&quot;&lt;&lt;wavelet.t0()&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  959</span>    timeshift -= operator_dt * ((double)winlength);</div>
<div class="line"><span class="lineno">  960</span>    <span class="comment">// Debug</span></div>
<div class="line"><span class="lineno">  961</span>    <span class="comment">// cout &lt;&lt; &quot;inverse_wavelet - applying time shift=&quot;&lt;&lt;timeshift&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  962</span>    CoreTimeSeries invcore(this-&gt;<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">FFTDeconOperator::FourierInverse</a>(</div>
<div class="line"><span class="lineno">  963</span>        this-&gt;winv, *shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">wavelet</a>(), operator_dt, timeshift));</div>
<div class="line"><span class="lineno">  964</span>    TimeSeries result(invcore, <span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  965</span>    <span class="comment">/* Copy the error log from wavelet and post some information parameters</span></div>
<div class="line"><span class="lineno">  966</span><span class="comment">    to metadata */</span></div>
<div class="line"><span class="lineno">  967</span>    result.elog = wavelet.elog;</div>
<div class="line"><span class="lineno">  968</span>    result.put(<span class="stringliteral">&quot;waveform_type&quot;</span>, <span class="stringliteral">&quot;deconvolution_inverse_wavelet&quot;</span>);</div>
<div class="line"><span class="lineno">  969</span>    result.put(<span class="stringliteral">&quot;decon_type&quot;</span>, <span class="stringliteral">&quot;CNR3CDecon&quot;</span>);</div>
<div class="line"><span class="lineno">  970</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  971</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  972</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  973</span>  };</div>
<div class="line"><span class="lineno">  974</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator_html_a3473dc7f359332dbf5a685efe30a684b"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">mspass::algorithms::deconvolution::FFTDeconOperator::FourierInverse</a></div><div class="ttdeci">mspass::seismic::CoreTimeSeries FourierInverse(const ComplexArray &amp;winv, const ComplexArray &amp;sw, const double dt, const double t0parent)</div><div class="ttdoc">Return inverse wavelet for Fourier methods.</div><div class="ttdef"><b>Definition</b> FFTDeconOperator.cc:115</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_a472074f3074d59f794d18017b010ab81"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">mspass::seismic::BasicTimeSeries::t0</a></div><div class="ttdeci">double t0() const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:174</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">mspass::algorithms::deconvolution::FFTDeconOperator::FourierInverse()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">mspass::seismic::BasicTimeSeries::t0()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">mspass::algorithms::deconvolution::ShapingWavelet::wavelet()</a>.</p>

</div>
</div>
<a id="aad3f642e58266d7840d2a1a8897f52c1" name="aad3f642e58266d7840d2a1a8897f52c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad3f642e58266d7840d2a1a8897f52c1">&#9670;&#160;</a></span>loaddata() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loaddata </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>loadnoise</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load data and optionally load noise. </p>
<p>This method must be called before running process to get a unique result. Input data are windowed by the processing window parameters and inserted into an internal buffer with sufficient padding to avoid fft circular convolution artifacts. Noise can optionally be loaded but use that approach ONLY if the time span of d contains both the processing and noise time windows. Use loadnoise if the input data do not match that model.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>is the input data (see note about time span above) </td></tr>
    <tr><td class="paramname">loadnoise</td><td>when true the function will attempt to load data for the noise based regularization from the noise window defined for the operator. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">MsPASSError</td><td>may be thrown for a number of potential error conditions. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  369</span>                                                         {</div>
<div class="line"><span class="lineno">  370</span>  <span class="keywordflow">if</span> (d.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  371</span>    <span class="keywordflow">throw</span> MsPASSError(<span class="stringliteral">&quot;CNR3CDecon::loaddata method received data marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  372</span>                      ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  373</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  374</span>    <span class="keywordtype">int</span> errcount;</div>
<div class="line"><span class="lineno">  375</span>    <span class="comment">/* The -9999 is a magic number used to signal the test is</span></div>
<div class="line"><span class="lineno">  376</span><span class="comment">    coming from this variant*/</span></div>
<div class="line"><span class="lineno">  377</span>    errcount = TestSeismogramInput(d, -9999, nload);</div>
<div class="line"><span class="lineno">  378</span>    <span class="keywordflow">if</span> (errcount &gt; 0) {</div>
<div class="line"><span class="lineno">  379</span>      stringstream ss;</div>
<div class="line"><span class="lineno">  380</span>      ss &lt;&lt; <span class="stringliteral">&quot;CNR3CDecon::loaddata:  &quot;</span> &lt;&lt; errcount</div>
<div class="line"><span class="lineno">  381</span>         &lt;&lt; <span class="stringliteral">&quot; errors were detected in this call&quot;</span> &lt;&lt; endl</div>
<div class="line"><span class="lineno">  382</span>         &lt;&lt; <span class="stringliteral">&quot;Check error log of input Seismogram for detailed error messages&quot;</span></div>
<div class="line"><span class="lineno">  383</span>         &lt;&lt; endl</div>
<div class="line"><span class="lineno">  384</span>         &lt;&lt; <span class="stringliteral">&quot;Operator does not contain valid data for processing&quot;</span> &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  385</span>      <span class="keywordflow">throw</span> MsPASSError(ss.str(), ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  386</span>    }</div>
<div class="line"><span class="lineno">  387</span>    CoreSeismogram dtmp(WindowData(d, this-&gt;processing_window));</div>
<div class="line"><span class="lineno">  388</span>    this-&gt;decondata = Seismogram(dtmp, <span class="keywordtype">string</span>(<span class="stringliteral">&quot;invalid&quot;</span>));</div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordflow">if</span> (FFTDeconOperator::nfft &lt; (2 * this-&gt;winlength)) {</div>
<div class="line"><span class="lineno">  390</span>      cerr &lt;&lt; <span class="stringliteral">&quot;CNR3CDecon:  coding error in loaddata method&quot;</span> &lt;&lt; endl</div>
<div class="line"><span class="lineno">  391</span>           &lt;&lt; <span class="stringliteral">&quot;fft buffer size=&quot;</span> &lt;&lt; FFTDeconOperator::nfft &lt;&lt; endl</div>
<div class="line"><span class="lineno">  392</span>           &lt;&lt; <span class="stringliteral">&quot;winlength is only &quot;</span> &lt;&lt; this-&gt;winlength &lt;&lt; endl</div>
<div class="line"><span class="lineno">  393</span>           &lt;&lt; <span class="stringliteral">&quot;fft length is required to be at least twice winlength&quot;</span> &lt;&lt; endl</div>
<div class="line"><span class="lineno">  394</span>           &lt;&lt; <span class="stringliteral">&quot;Debug exit to avoid seg fault&quot;</span> &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  395</span>      exit(-1);</div>
<div class="line"><span class="lineno">  396</span>    }</div>
<div class="line"><span class="lineno">  397</span>    <span class="comment">/* In the old api this was necessary - no longer so because set_npts does</span></div>
<div class="line"><span class="lineno">  398</span><span class="comment">    this operation</span></div>
<div class="line"><span class="lineno">  399</span><span class="comment">    decondata.u=dmatrix(3,FFTDeconOperator::nfft);</span></div>
<div class="line"><span class="lineno">  400</span><span class="comment">    decondata.u.zero();</span></div>
<div class="line"><span class="lineno">  401</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  402</span>    decondata.<a class="code hl_function" href="classmspass_1_1seismic_1_1_core_seismogram.html#ae94bac250fe5928ced41babc322c2c79">set_npts</a>(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  403</span>    <span class="keywordtype">double</span> newt0 = (-operator_dt * <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(winlength));</div>
<div class="line"><span class="lineno">  404</span>    decondata.<a class="code hl_function" href="classmspass_1_1seismic_1_1_core_seismogram.html#a7724b7cfa40eebf0b15e0d2b39ae615e">set_t0</a>(newt0);</div>
<div class="line"><span class="lineno">  405</span>    <span class="keywordtype">int</span> k, i, ii;</div>
<div class="line"><span class="lineno">  406</span>    <span class="keywordflow">for</span> (i = 0; i &lt; dtmp.npts(); ++i) {</div>
<div class="line"><span class="lineno">  407</span>      ii = decondata.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">sample_number</a>(dtmp.time(i));</div>
<div class="line"><span class="lineno">  408</span>      <span class="keywordflow">if</span> ((ii &gt;= 0) &amp;&amp; (ii &lt; decondata.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>())) {</div>
<div class="line"><span class="lineno">  409</span>        <span class="keywordflow">for</span> (k = 0; k &lt; 3; ++k)</div>
<div class="line"><span class="lineno">  410</span>          decondata.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_core_seismogram.html#a9ac5c7c060d582b1a399fb066d06779f">u</a>(k, ii) = dtmp.u(k, i);</div>
<div class="line"><span class="lineno">  411</span>      }</div>
<div class="line"><span class="lineno">  412</span>    }</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span>    <span class="comment">/* This was the old code</span></div>
<div class="line"><span class="lineno">  415</span><span class="comment">    int k,i,ii;</span></div>
<div class="line"><span class="lineno">  416</span><span class="comment">    for(k=0;k&lt;3;++k)</span></div>
<div class="line"><span class="lineno">  417</span><span class="comment">        for(i=0,ii=(this-&gt;winlength);i&lt;(this-&gt;winlength);++i,++ii)</span></div>
<div class="line"><span class="lineno">  418</span><span class="comment">        {</span></div>
<div class="line"><span class="lineno">  419</span><span class="comment">            decondata.u(k,ii)=dtmp.u(k,i);</span></div>
<div class="line"><span class="lineno">  420</span><span class="comment">        }</span></div>
<div class="line"><span class="lineno">  421</span><span class="comment">    double newt0=decondata.t0() - operator_dt*static_cast&lt;double&gt;(winlength);</span></div>
<div class="line"><span class="lineno">  422</span><span class="comment">    //Debug</span></div>
<div class="line"><span class="lineno">  423</span><span class="comment">    cout &lt;&lt; &quot;in loaddata; initial t0=&quot;&lt;&lt;decondata.t0()&lt;&lt;endl</span></div>
<div class="line"><span class="lineno">  424</span><span class="comment">      &lt;&lt; &quot;Changed to &quot;&lt;&lt;newt0&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  425</span><span class="comment">    decondata.set_t0(newt0);</span></div>
<div class="line"><span class="lineno">  426</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  427</span>    <span class="comment">/* We need to compute the power spectrum of the signal here.  It is used</span></div>
<div class="line"><span class="lineno">  428</span><span class="comment">    to compute the bandwidth of the shaping wavelet in process.   This is the</span></div>
<div class="line"><span class="lineno">  429</span><span class="comment">    ONLY place right now this is computed.  Caution in order if there are</span></div>
<div class="line"><span class="lineno">  430</span><span class="comment">    changes in implementation later. */</span></div>
<div class="line"><span class="lineno">  431</span>    this-&gt;pssignal = this-&gt;ThreeCPower(dtmp);</div>
<div class="line"><span class="lineno">  432</span>    <span class="keywordflow">if</span> (nload) {</div>
<div class="line"><span class="lineno">  433</span>      Seismogram ntmp(WindowData(d, this-&gt;noise_window), <span class="keywordtype">string</span>(<span class="stringliteral">&quot;Invalid&quot;</span>));</div>
<div class="line"><span class="lineno">  434</span>      this-&gt;<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a9d050c0940ada32cc3ddfecff9cade4a">loadnoise_data</a>(ntmp);</div>
<div class="line"><span class="lineno">  435</span>    }</div>
<div class="line"><span class="lineno">  436</span>    signal_bwd = EstimateBandwidth(</div>
<div class="line"><span class="lineno">  437</span>        FFTDeconOperator::df(this-&gt;operator_dt), pssignal, psnoise_data,</div>
<div class="line"><span class="lineno">  438</span>        snr_bandwidth, signalengine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">time_bandwidth_product</a>(), this-&gt;fhs);</div>
<div class="line"><span class="lineno">  439</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  441</span>  };</div>
<div class="line"><span class="lineno">  442</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon_html_a9d050c0940ada32cc3ddfecff9cade4a"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a9d050c0940ada32cc3ddfecff9cade4a">mspass::algorithms::deconvolution::CNR3CDecon::loadnoise_data</a></div><div class="ttdeci">void loadnoise_data(const mspass::seismic::Seismogram &amp;n)</div><div class="ttdoc">Load noise data directly.</div><div class="ttdef"><b>Definition</b> CNR3CDecon.cc:544</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_accf94d6d1dff859884d9c0aa1719994a"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product</a></div><div class="ttdeci">double time_bandwidth_product() const</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:99</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_a347b349bb4e1f0e65978dfcd45ae3472"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts</a></div><div class="ttdeci">size_t npts() const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:171</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_aa96e795f96b5050996d791f5b6f3867d"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead</a></div><div class="ttdeci">bool dead() const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:145</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_abe28ca2812a2ac21dd2196385ad106ab"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">mspass::seismic::BasicTimeSeries::sample_number</a></div><div class="ttdeci">int sample_number(double t) const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:72</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_seismogram_html_a7724b7cfa40eebf0b15e0d2b39ae615e"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_seismogram.html#a7724b7cfa40eebf0b15e0d2b39ae615e">mspass::seismic::CoreSeismogram::set_t0</a></div><div class="ttdeci">void set_t0(const double t0in)</div><div class="ttdoc">Set the data start time.</div><div class="ttdef"><b>Definition</b> CoreSeismogram.cc:1022</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_seismogram_html_a9ac5c7c060d582b1a399fb066d06779f"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_seismogram.html#a9ac5c7c060d582b1a399fb066d06779f">mspass::seismic::CoreSeismogram::u</a></div><div class="ttdeci">mspass::utility::dmatrix u</div><div class="ttdef"><b>Definition</b> CoreSeismogram.h:52</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_seismogram_html_ae94bac250fe5928ced41babc322c2c79"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_seismogram.html#ae94bac250fe5928ced41babc322c2c79">mspass::seismic::CoreSeismogram::set_npts</a></div><div class="ttdeci">void set_npts(const size_t npts)</div><div class="ttdoc">Set the number of samples attribute for data.</div><div class="ttdef"><b>Definition</b> CoreSeismogram.cc:1039</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a9d050c0940ada32cc3ddfecff9cade4a">loadnoise_data()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">mspass::seismic::BasicTimeSeries::sample_number()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_seismogram.html#ae94bac250fe5928ced41babc322c2c79">mspass::seismic::CoreSeismogram::set_npts()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_seismogram.html#a7724b7cfa40eebf0b15e0d2b39ae615e">mspass::seismic::CoreSeismogram::set_t0()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a438b4f6453a4ff2a46de53dfdf3599c2">mspass::seismic::BasicTimeSeries::time()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product()</a>, and <a class="el" href="classmspass_1_1seismic_1_1_core_seismogram.html#a9ac5c7c060d582b1a399fb066d06779f">mspass::seismic::CoreSeismogram::u</a>.</p>

</div>
</div>
<a id="a88d7fe1143e6459d7accf40e00f8cab2" name="a88d7fe1143e6459d7accf40e00f8cab2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88d7fe1143e6459d7accf40e00f8cab2">&#9670;&#160;</a></span>loaddata() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loaddata </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>wcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>loadnoise</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load data with one component used as wavelet estimate. </p>
<p>Use this method for conventional receiver function data if one of components is to be used as the wavelet estimate (conventionally Z or L). Optionally they can also load preevent noise defined by the noise window parameters defined by Pf constructor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>is the data to be loaded. If loadnoise is true it is assumed to be long enough to span the range of both the signal and noise windows defined in constuction. </td></tr>
    <tr><td class="paramname">wcomp</td><td>is the component that is used as an estimate of the wavelet. In standard P receiver functions this would be the Z component but for S it would be the radial component </td></tr>
    <tr><td class="paramname">loadnoise</td><td>when true method also loads noise data from predefined window.</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Will</td><td>throw an MsPASSError for a number of potential problems that can arise. All such errors will have an invalid condition set. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  347</span>                                                {</div>
<div class="line"><span class="lineno">  348</span>  <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  349</span>  <span class="comment">// cout &lt;&lt; &quot;entering loaddata&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  350</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  351</span>    <span class="keywordflow">if</span> (d.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  352</span>      <span class="keywordflow">throw</span> MsPASSError(<span class="stringliteral">&quot;CNR3CDecon::loaddata method received data marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  353</span>                        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  354</span>    <span class="comment">/* This does everything except load the wavelet from wcomp so we just</span></div>
<div class="line"><span class="lineno">  355</span><span class="comment">     * invoke it here. */</span></div>
<div class="line"><span class="lineno">  356</span>    this-&gt;<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a88d7fe1143e6459d7accf40e00f8cab2">loaddata</a>(d, loadnoise);</div>
<div class="line"><span class="lineno">  357</span>    <span class="comment">/* We need to pull wcomp now because we alter the decondata matrix with</span></div>
<div class="line"><span class="lineno">  358</span><span class="comment">     * padding next.  We don&#39;t want that for the wavelet at this stage as</span></div>
<div class="line"><span class="lineno">  359</span><span class="comment">     * the loadwavelet method handles the padding stuff and we call it after</span></div>
<div class="line"><span class="lineno">  360</span><span class="comment">     * windowing*/</span></div>
<div class="line"><span class="lineno">  361</span>    CoreTimeSeries wtmp(ExtractComponent(decondata, wcomp));</div>
<div class="line"><span class="lineno">  362</span>    wtmp = WindowData(wtmp, this-&gt;processing_window);</div>
<div class="line"><span class="lineno">  363</span>    TimeSeries wtmp2(wtmp, <span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  364</span>    this-&gt;<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a8f0b6ab1ffaf2b0f514341be81b21d7e">loadwavelet</a>(wtmp2);</div>
<div class="line"><span class="lineno">  365</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  366</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  367</span>  };</div>
<div class="line"><span class="lineno">  368</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon_html_a88d7fe1143e6459d7accf40e00f8cab2"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a88d7fe1143e6459d7accf40e00f8cab2">mspass::algorithms::deconvolution::CNR3CDecon::loaddata</a></div><div class="ttdeci">void loaddata(mspass::seismic::Seismogram &amp;d, const int wcomp, const bool loadnoise=false)</div><div class="ttdoc">Load data with one component used as wavelet estimate.</div><div class="ttdef"><b>Definition</b> CNR3CDecon.cc:346</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon_html_a8f0b6ab1ffaf2b0f514341be81b21d7e"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a8f0b6ab1ffaf2b0f514341be81b21d7e">mspass::algorithms::deconvolution::CNR3CDecon::loadwavelet</a></div><div class="ttdeci">void loadwavelet(const mspass::seismic::TimeSeries &amp;w)</div><div class="ttdoc">Load data defining the wavelet to use for deconvolution.</div><div class="ttdef"><b>Definition</b> CNR3CDecon.cc:447</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a88d7fe1143e6459d7accf40e00f8cab2">loaddata()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html#a8f0b6ab1ffaf2b0f514341be81b21d7e">loadwavelet()</a>.</p>

</div>
</div>
<a id="abd05e4335e689e7fa4ff9fec8dbf3c78" name="abd05e4335e689e7fa4ff9fec8dbf3c78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd05e4335e689e7fa4ff9fec8dbf3c78">&#9670;&#160;</a></span>loadnoise_data() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loadnoise_data </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load noise estimate directly as a PowerSpectrum object. </p>
<p>The actual noise regularization is computed by this algorithm from an internally stored PowerSpectrum object. This method allows the power spectrum to be computed by some other method or using previously computed estimates rather than computing it through loadnoise. For instance, one might want to use a robust form of Welch's method to estimate preevent noise that would be immune to spikes and sporatic noise bursts. </p>
<div class="fragment"><div class="line"><span class="lineno">  555</span>                                                      {</div>
<div class="line"><span class="lineno">  556</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  557</span>    psnoise_data = d;</div>
<div class="line"><span class="lineno">  558</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  559</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  560</span>  };</div>
<div class="line"><span class="lineno">  561</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d050c0940ada32cc3ddfecff9cade4a" name="a9d050c0940ada32cc3ddfecff9cade4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d050c0940ada32cc3ddfecff9cade4a">&#9670;&#160;</a></span>loadnoise_data() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loadnoise_data </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load noise data directly. </p>
<p>This method can be used to load noise to be used to compute signal to noise related metrics. The spectrum of the noise is computed from a mutlitaper spectral estimator for the data passed as n. Best results will be obtain if the length of n is larger than the operator size defined by it's internal noise window (defined in constructor by noise_window_start and and parameters). Note for this constructor the actual time of the noise window passed is ignored, but the length it defines is used to define the length of the computed spectrum. It is better to have the input noise slightly larger than the operator length to be consistent with the expectations of the multitaper method. If the noise window is short the spectrum is computed but will be biased to lower amplitudes because of zero padding. That happens because the operator will not recompute Slepian tapers if the data are short. </p>
<div class="fragment"><div class="line"><span class="lineno">  544</span>                                                   {</div>
<div class="line"><span class="lineno">  545</span>  <span class="keywordflow">if</span> (n.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  546</span>    <span class="keywordflow">throw</span> MsPASSError(</div>
<div class="line"><span class="lineno">  547</span>        <span class="stringliteral">&quot;CNR3CDecon::loadnoise_data method received data marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  548</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  549</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  550</span>    this-&gt;psnoise_data = this-&gt;ThreeCPower(n);</div>
<div class="line"><span class="lineno">  551</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  552</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  553</span>  };</div>
<div class="line"><span class="lineno">  554</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>.</p>

</div>
</div>
<a id="a17af91b35a03c0a87a01e6ddb525e6ef" name="a17af91b35a03c0a87a01e6ddb525e6ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17af91b35a03c0a87a01e6ddb525e6ef">&#9670;&#160;</a></span>loadnoise_wavelet() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loadnoise_wavelet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load noise estimate for wavelet signal directly as a PowerSpectrum object. </p>
<p>The actual noise regularization is computed by this algorithm from an internally stored PowerSpectrum object. This method allows the power spectrum to be computed by some other method or using previously computed estimates rather than computing it through loadnoise. </p>
<div class="fragment"><div class="line"><span class="lineno">  586</span>                                                         {</div>
<div class="line"><span class="lineno">  587</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  588</span>    psnoise = d;</div>
<div class="line"><span class="lineno">  589</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  590</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  591</span>  };</div>
<div class="line"><span class="lineno">  592</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3fc0dadf9ce17343244d45e30e14519e" name="a3fc0dadf9ce17343244d45e30e14519e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fc0dadf9ce17343244d45e30e14519e">&#9670;&#160;</a></span>loadnoise_wavelet() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loadnoise_wavelet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load noise data for wavelet directly. </p>
<p>This method can be used to load noise to be used for regularization from an arbitrary time window. The spectrum of the noise is computed from a mutlitaper spectral estimator for the data passed as n. Best results will be obtain if the length of n is larger than the operator size defined by it's internal noise window (defined in constructor by noise_window_start and and parameters). Note for this constructor the actual time of the noise window passed is ignored, but the length it defines is used to define the length of the computed spectrum. It is better to have the input noise slightly larger than the operator length to be consistent with the expectations of the multitaper method. If the noise window is short the spectrum is computed but will be biased to lower amplitudes because of zero padding. That happens because the operator will not recompute Slepian tapers if the data are short. </p>
<div class="fragment"><div class="line"><span class="lineno">  563</span>                                                      {</div>
<div class="line"><span class="lineno">  564</span>  <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  565</span>  <span class="comment">// cout &lt;&lt; &quot;Entering loadnoise_wavelet&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  566</span>  <span class="keywordflow">if</span> (n.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  567</span>    <span class="keywordflow">throw</span> MsPASSError(</div>
<div class="line"><span class="lineno">  568</span>        <span class="stringliteral">&quot;CNR3CDecon::loadnoise_wavelet method received data marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  569</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  570</span>  <span class="keywordflow">if</span> (n.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>() &lt;= 0)</div>
<div class="line"><span class="lineno">  571</span>    <span class="keywordflow">throw</span> MsPASSError(</div>
<div class="line"><span class="lineno">  572</span>        <span class="stringliteral">&quot;CNR3CDecon::loadnoise_wavelet method received an empty data vector.&quot;</span>,</div>
<div class="line"><span class="lineno">  573</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  574</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  575</span>    <span class="keywordflow">if</span> (n.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>() != wnoise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">taper_length</a>()) {</div>
<div class="line"><span class="lineno">  576</span>      wnoise_engine = MTPowerSpectrumEngine(</div>
<div class="line"><span class="lineno">  577</span>          n.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>(), wnoise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">time_bandwidth_product</a>(),</div>
<div class="line"><span class="lineno">  578</span>          wnoise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">number_tapers</a>());</div>
<div class="line"><span class="lineno">  579</span>    }</div>
<div class="line"><span class="lineno">  580</span>    psnoise = this-&gt;wnoise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">apply</a>(n);</div>
<div class="line"><span class="lineno">  581</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  582</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  583</span>  };</div>
<div class="line"><span class="lineno">  584</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_a10d4b650fdedd815652c1e4e86a0e715"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::number_tapers</a></div><div class="ttdeci">int number_tapers() const</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:101</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_a114db709279ea8ab275ba69fbdcbec13"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::taper_length</a></div><div class="ttdeci">int taper_length() const</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:97</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_aa3c10c25ea2c6b82cf8bbe2991f16bfe"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::apply</a></div><div class="ttdeci">mspass::seismic::PowerSpectrum apply(const mspass::seismic::TimeSeries &amp;d)</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.cc:116</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::apply()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::number_tapers()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::taper_length()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product()</a>.</p>

</div>
</div>
<a id="a8f0b6ab1ffaf2b0f514341be81b21d7e" name="a8f0b6ab1ffaf2b0f514341be81b21d7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f0b6ab1ffaf2b0f514341be81b21d7e">&#9670;&#160;</a></span>loadwavelet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNR3CDecon::loadwavelet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load data defining the wavelet to use for deconvolution. </p>
<p>This algorithm assumes a deterministic model for deconvolution. That is, we have an estimate of the source wavelet. In conventional receiver functions this is the vertical or longitudinal component. In current array methods it is always some stack (not necessarily a simple average) of vertical or longitudinal data from an ensemble.</p>
<p>It is VERY IMPORTANT to realize that loadwavelet initiates the calculation of the inverse for the deconvolution. That allows this same processing object to be efficiently used in array deconvolution and single station deconvolution. For single station estimates loadwavelet should be called on each seismogram. For array methods loadwavelet should be called once for the ensemble (common source gather) to which a wavelet is linked. The inverse is then applied to very signal in the ensemble with process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">w</td><td>is the wavelet. Must be in relative time with 0 set to the estimated first break time. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  447</span>                                                {</div>
<div class="line"><span class="lineno">  448</span>  <span class="keywordflow">if</span> (w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  449</span>    <span class="keywordflow">throw</span> MsPASSError(</div>
<div class="line"><span class="lineno">  450</span>        <span class="stringliteral">&quot;CNR3CDecon::loadwavelet method received data marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  451</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  452</span>  <span class="keywordflow">if</span> (w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>() &lt;= 0)</div>
<div class="line"><span class="lineno">  453</span>    <span class="keywordflow">throw</span> MsPASSError(<span class="stringliteral">&quot;CNR3CDecon::loadwavelet method received an empty &quot;</span></div>
<div class="line"><span class="lineno">  454</span>                      <span class="stringliteral">&quot;TimeSeries (number samples &lt;=0)&quot;</span>,</div>
<div class="line"><span class="lineno">  455</span>                      ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  456</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  457</span>    <span class="comment">/* Automatically and silently adjust the window size if input wavelet</span></div>
<div class="line"><span class="lineno">  458</span><span class="comment">    length changes.   We always compute the wavelet spectrum from the full</span></div>
<div class="line"><span class="lineno">  459</span><span class="comment">    signal loaded.   */</span></div>
<div class="line"><span class="lineno">  460</span>    <span class="keywordflow">if</span> (this-&gt;waveletengine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">taper_length</a>() != (w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>())) {</div>
<div class="line"><span class="lineno">  461</span>      this-&gt;waveletengine = MTPowerSpectrumEngine(</div>
<div class="line"><span class="lineno">  462</span>          w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>(), this-&gt;waveletengine.time_bandwidth_product(),</div>
<div class="line"><span class="lineno">  463</span>          this-&gt;waveletengine.number_tapers());</div>
<div class="line"><span class="lineno">  464</span>    }</div>
<div class="line"><span class="lineno">  465</span>    this-&gt;pswavelet = this-&gt;waveletengine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">apply</a>(w);</div>
<div class="line"><span class="lineno">  466</span>    <span class="comment">/* for now use the same snr floor as regularization - may need to be an</span></div>
<div class="line"><span class="lineno">  467</span><span class="comment">    independent parameter */</span></div>
<div class="line"><span class="lineno">  468</span>    this-&gt;wavelet_bwd = EstimateBandwidth(</div>
<div class="line"><span class="lineno">  469</span>        FFTDeconOperator::df(this-&gt;operator_dt), pswavelet, psnoise,</div>
<div class="line"><span class="lineno">  470</span>        snr_bandwidth, waveletengine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">time_bandwidth_product</a>(), this-&gt;fhs);</div>
<div class="line"><span class="lineno">  471</span>    <span class="comment">/* Now load the wavelet into the fft buffer area - there are some tricky</span></div>
<div class="line"><span class="lineno">  472</span><span class="comment">    things to do here to align the data correctly using the relative time</span></div>
<div class="line"><span class="lineno">  473</span><span class="comment">    reference t0 stored with the TimeSeries data */</span></div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordtype">int</span> k, kk;</div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordtype">int</span> ns_to_copy, ntest;</div>
<div class="line"><span class="lineno">  476</span>    this-&gt;wavelet = w;</div>
<div class="line"><span class="lineno">  477</span>    ntest = w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>() - w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">sample_number</a>(0.0);</div>
<div class="line"><span class="lineno">  478</span>    <span class="keywordflow">if</span> (ntest &gt; (this-&gt;winlength)) {</div>
<div class="line"><span class="lineno">  479</span>      ns_to_copy = this-&gt;winlength;</div>
<div class="line"><span class="lineno">  480</span>      stringstream ss;</div>
<div class="line"><span class="lineno">  481</span>      ss &lt;&lt; <span class="stringliteral">&quot;loadwavelet method:  size mismatch.  Wavelet received has &quot;</span></div>
<div class="line"><span class="lineno">  482</span>         &lt;&lt; ntest &lt;&lt; <span class="stringliteral">&quot; samples with time&gt;0.0&quot;</span> &lt;&lt; endl</div>
<div class="line"><span class="lineno">  483</span>         &lt;&lt; <span class="stringliteral">&quot;This is larger than the processing window length of &quot;</span></div>
<div class="line"><span class="lineno">  484</span>         &lt;&lt; this-&gt;winlength &lt;&lt; endl</div>
<div class="line"><span class="lineno">  485</span>         &lt;&lt; <span class="stringliteral">&quot;Wavelet must be contained in the processing window size&quot;</span> &lt;&lt; endl</div>
<div class="line"><span class="lineno">  486</span>         &lt;&lt; <span class="stringliteral">&quot;Truncated on the right to processing window length - results may &quot;</span></div>
<div class="line"><span class="lineno">  487</span>            <span class="stringliteral">&quot;be invalid&quot;</span></div>
<div class="line"><span class="lineno">  488</span>         &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  489</span>      wavelet.elog.<a class="code hl_function" href="classmspass_1_1utility_1_1_error_logger.html#aa69873ba0aebf67e9ba24d01992c0bcf">log_error</a>(<span class="stringliteral">&quot;CNR3CDecon&quot;</span>, ss.str(), ErrorSeverity::Complaint);</div>
<div class="line"><span class="lineno">  490</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  491</span>      ns_to_copy = w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>();</div>
<div class="line"><span class="lineno">  492</span>    <span class="comment">/* These were in the old api but are no longer needed because set_npts</span></div>
<div class="line"><span class="lineno">  493</span><span class="comment">    does this operation</span></div>
<div class="line"><span class="lineno">  494</span><span class="comment">    this-&gt;wavelet.s.clear();</span></div>
<div class="line"><span class="lineno">  495</span><span class="comment">    this-&gt;wavelet.s.reserve(FFTDeconOperator::nfft);</span></div>
<div class="line"><span class="lineno">  496</span><span class="comment">    for(k=0;k&lt;FFTDeconOperator::nfft;++k)this-&gt;wavelet.s.push_back(0.0);</span></div>
<div class="line"><span class="lineno">  497</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  498</span>    this-&gt;wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_core_time_series.html#ae538485ac0aed2f8691477dffce6cda8">set_npts</a>(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  499</span>    this-&gt;wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_core_time_series.html#ae90b28cff0bc1997aa65a1693d8562d0">set_t0</a>(-(this-&gt;winlength) * (this-&gt;operator_dt));</div>
<div class="line"><span class="lineno">  500</span>    <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  501</span>    <span class="comment">// cout &lt;&lt; &quot;t0 of wavelet stored now wavelet data</span></div>
<div class="line"><span class="lineno">  502</span>    <span class="comment">// objec=&quot;&lt;&lt;wavelet.t0()&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  503</span>    <span class="comment">/* We recycle the variable ntest defined above here for convenience only */</span></div>
<div class="line"><span class="lineno">  504</span>    <span class="keywordflow">for</span> (k = 0, ntest = 0; k &lt; w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>(); ++k) {</div>
<div class="line"><span class="lineno">  505</span>      <span class="keywordtype">double</span> t = w.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a438b4f6453a4ff2a46de53dfdf3599c2">time</a>(k);</div>
<div class="line"><span class="lineno">  506</span>      <span class="keywordflow">if</span> (t &gt;= 0.0)</div>
<div class="line"><span class="lineno">  507</span>        ++ntest;</div>
<div class="line"><span class="lineno">  508</span>      <span class="keywordflow">if</span> (ntest &gt; ns_to_copy)</div>
<div class="line"><span class="lineno">  509</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  510</span>      kk = this-&gt;wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">sample_number</a>(t);</div>
<div class="line"><span class="lineno">  511</span>      <span class="keywordflow">if</span> ((kk &gt;= 0) &amp;&amp; (kk &lt; this-&gt;wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>()))</div>
<div class="line"><span class="lineno">  512</span>        this-&gt;wavelet.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">s</a>[kk] = w.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">s</a>[k];</div>
<div class="line"><span class="lineno">  513</span>    }</div>
<div class="line"><span class="lineno">  514</span>    <span class="comment">/* This was the old code fixed Dec 2020 - remove when revision is know to</span></div>
<div class="line"><span class="lineno">  515</span><span class="comment">    work</span></div>
<div class="line"><span class="lineno">  516</span><span class="comment">    for(k=0,kk=this-&gt;winlength;k&lt;ns_to_copy;++k,++kk)this-&gt;wavelet.s[kk]=w.s[k];</span></div>
<div class="line"><span class="lineno">  517</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">  518</span>    <span class="comment">// this-&gt;wavelet.t0 -= operator_dt*static_cast&lt;double&gt;(winlength);</span></div>
<div class="line"><span class="lineno">  519</span>    <span class="comment">// this-&gt;wavelet.ns=FFTDeconOperator::nfft;</span></div>
<div class="line"><span class="lineno">  520</span>    <span class="comment">// double newt0;</span></div>
<div class="line"><span class="lineno">  521</span>    <span class="comment">// newt0=this-&gt;wavelet.t0() - operator_dt*static_cast&lt;double&gt;(winlength);</span></div>
<div class="line"><span class="lineno">  522</span>    <span class="comment">// this-&gt;wavelet.set_t0(newt0);</span></div>
<div class="line"><span class="lineno">  523</span> </div>
<div class="line"><span class="lineno">  524</span>    <span class="comment">// debug</span></div>
<div class="line"><span class="lineno">  525</span>    <span class="comment">/*cout &lt;&lt; &quot;Wavelet t, data&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  526</span><span class="comment">    for(auto kw=0;kw&lt;FFTDeconOperator::nfft;++kw)</span></div>
<div class="line"><span class="lineno">  527</span><span class="comment">      cout &lt;&lt; wavelet.time(kw)&lt;&lt;&quot; &quot;&lt;&lt;wavelet.s[kw]&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  528</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno">  529</span>    <span class="keywordflow">switch</span> (algorithm) {</div>
<div class="line"><span class="lineno">  530</span>    <span class="comment">/* Note all the algorithms here alter wavelet by applying a taper */</span></div>
<div class="line"><span class="lineno">  531</span>    <span class="keywordflow">case</span> CNR3C_algorithms::generalized_water_level:</div>
<div class="line"><span class="lineno">  532</span>      compute_gwl_inverse();</div>
<div class="line"><span class="lineno">  533</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  534</span>    <span class="keywordflow">case</span> CNR3C_algorithms::colored_noise_damping:</div>
<div class="line"><span class="lineno">  535</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  536</span>      compute_gdamp_inverse();</div>
<div class="line"><span class="lineno">  537</span>    };</div>
<div class="line"><span class="lineno">  538</span>    <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  539</span>    <span class="comment">// cout &lt;&lt; &quot;Exiting loadwavelet&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  540</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  541</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  542</span>  };</div>
<div class="line"><span class="lineno">  543</span>}</div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_a438b4f6453a4ff2a46de53dfdf3599c2"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#a438b4f6453a4ff2a46de53dfdf3599c2">mspass::seismic::BasicTimeSeries::time</a></div><div class="ttdeci">double time(const int i) const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:62</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_time_series_html_ae538485ac0aed2f8691477dffce6cda8"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_time_series.html#ae538485ac0aed2f8691477dffce6cda8">mspass::seismic::CoreTimeSeries::set_npts</a></div><div class="ttdeci">void set_npts(const size_t npts)</div><div class="ttdoc">Set the number of samples attribute for data.</div><div class="ttdef"><b>Definition</b> CoreTimeSeries.cc:196</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_time_series_html_ae90b28cff0bc1997aa65a1693d8562d0"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_time_series.html#ae90b28cff0bc1997aa65a1693d8562d0">mspass::seismic::CoreTimeSeries::set_t0</a></div><div class="ttdeci">void set_t0(const double t0in)</div><div class="ttdoc">Set the data start time.</div><div class="ttdef"><b>Definition</b> CoreTimeSeries.cc:180</div></div>
<div class="ttc" id="aclassmspass_1_1utility_1_1_error_logger_html_aa69873ba0aebf67e9ba24d01992c0bcf"><div class="ttname"><a href="classmspass_1_1utility_1_1_error_logger.html#aa69873ba0aebf67e9ba24d01992c0bcf">mspass::utility::ErrorLogger::log_error</a></div><div class="ttdeci">int log_error(const mspass::utility::MsPASSError &amp;merr)</div><div class="ttdef"><b>Definition</b> ErrorLogger.cc:72</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::apply()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>, <a class="el" href="classmspass_1_1utility_1_1_error_logger.html#aa69873ba0aebf67e9ba24d01992c0bcf">mspass::utility::ErrorLogger::log_error()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">mspass::seismic::CoreTimeSeries::s</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">mspass::seismic::BasicTimeSeries::sample_number()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#ae538485ac0aed2f8691477dffce6cda8">mspass::seismic::CoreTimeSeries::set_npts()</a>, <a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html#ae90b28cff0bc1997aa65a1693d8562d0">mspass::seismic::CoreTimeSeries::set_t0()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::taper_length()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a438b4f6453a4ff2a46de53dfdf3599c2">mspass::seismic::BasicTimeSeries::time()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product()</a>.</p>

</div>
</div>
<a id="aaf66a37adf3ab2a38e9b4c4b08a82bb2" name="aaf66a37adf3ab2a38e9b4c4b08a82bb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf66a37adf3ab2a38e9b4c4b08a82bb2">&#9670;&#160;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a> &amp; mspass::algorithms::deconvolution::CNR3CDecon::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r3_c_decon.html">CNR3CDecon</a> &amp;&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  234</span>                                                          {</div>
<div class="line"><span class="lineno">  235</span>  <span class="keywordflow">if</span> (<span class="keyword">this</span> != (&amp;parent)) {</div>
<div class="line"><span class="lineno">  236</span>    algorithm = parent.algorithm;</div>
<div class="line"><span class="lineno">  237</span>    processing_window = parent.processing_window;</div>
<div class="line"><span class="lineno">  238</span>    noise_window = parent.noise_window;</div>
<div class="line"><span class="lineno">  239</span>    signalengine = parent.signalengine;</div>
<div class="line"><span class="lineno">  240</span>    waveletengine = parent.waveletengine;</div>
<div class="line"><span class="lineno">  241</span>    dnoise_engine = parent.dnoise_engine;</div>
<div class="line"><span class="lineno">  242</span>    wnoise_engine = parent.wnoise_engine;</div>
<div class="line"><span class="lineno">  243</span>    psnoise = parent.psnoise;</div>
<div class="line"><span class="lineno">  244</span>    psnoise_data = parent.psnoise_data;</div>
<div class="line"><span class="lineno">  245</span>    pssignal = parent.pssignal;</div>
<div class="line"><span class="lineno">  246</span>    pswavelet = parent.pswavelet;</div>
<div class="line"><span class="lineno">  247</span>    decondata = parent.decondata;</div>
<div class="line"><span class="lineno">  248</span>    wavelet = parent.wavelet;</div>
<div class="line"><span class="lineno">  249</span>    shapingwavelet = parent.shapingwavelet;</div>
<div class="line"><span class="lineno">  250</span>    ao_fft = parent.ao_fft;</div>
<div class="line"><span class="lineno">  251</span>    wavelet_snr = parent.wavelet_snr;</div>
<div class="line"><span class="lineno">  252</span>    taper_data = parent.taper_data;</div>
<div class="line"><span class="lineno">  253</span>    operator_dt = parent.operator_dt;</div>
<div class="line"><span class="lineno">  254</span>    winlength = parent.winlength;</div>
<div class="line"><span class="lineno">  255</span>    damp = parent.damp;</div>
<div class="line"><span class="lineno">  256</span>    noise_floor = parent.noise_floor;</div>
<div class="line"><span class="lineno">  257</span>    snr_regularization_floor = parent.snr_regularization_floor;</div>
<div class="line"><span class="lineno">  258</span>    snr_bandwidth = parent.snr_bandwidth;</div>
<div class="line"><span class="lineno">  259</span>    band_snr_floor = parent.band_snr_floor;</div>
<div class="line"><span class="lineno">  260</span>    regularization_bandwidth_fraction =</div>
<div class="line"><span class="lineno">  261</span>        parent.regularization_bandwidth_fraction;</div>
<div class="line"><span class="lineno">  262</span>    decon_bandwidth_cutoff = parent.decon_bandwidth_cutoff;</div>
<div class="line"><span class="lineno">  263</span>    fhs = parent.fhs;</div>
<div class="line"><span class="lineno">  264</span>    wavelet_bwd = parent.wavelet_bwd;</div>
<div class="line"><span class="lineno">  265</span>    signal_bwd = parent.signal_bwd;</div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; 3; ++k) {</div>
<div class="line"><span class="lineno">  267</span>      signal_bandwidth_fraction[k] = parent.signal_bandwidth_fraction[k];</div>
<div class="line"><span class="lineno">  268</span>      peak_snr[k] = parent.peak_snr[k];</div>
<div class="line"><span class="lineno">  269</span>    }</div>
<div class="line"><span class="lineno">  270</span>    wavelet_taper = parent.wavelet_taper;</div>
<div class="line"><span class="lineno">  271</span>    data_taper = parent.data_taper;</div>
<div class="line"><span class="lineno">  272</span>  }</div>
<div class="line"><span class="lineno">  273</span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  274</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a048f73981dd0c6baf93fe4e6126672aa" name="a048f73981dd0c6baf93fe4e6126672aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a048f73981dd0c6baf93fe4e6126672aa">&#9670;&#160;</a></span>process()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">Seismogram</a> mspass::algorithms::deconvolution::CNR3CDecon::process </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_base3_c_decon.html">mspass::algorithms::deconvolution::Base3CDecon</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  771</span>                               {</div>
<div class="line"><span class="lineno">  772</span>  <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  773</span>  <span class="comment">// cout &lt;&lt; &quot;Entering process method&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  774</span>  <span class="keyword">const</span> <span class="keywordtype">string</span> base_error(<span class="stringliteral">&quot;CNR3CDecon::process method:  &quot;</span>);</div>
<div class="line"><span class="lineno">  775</span>  <span class="keywordtype">int</span> j, k;</div>
<div class="line"><span class="lineno">  776</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  777</span>    <span class="comment">/* Immediately determine the data bandwidth for efficiency.</span></div>
<div class="line"><span class="lineno">  778</span><span class="comment">    If the data have insufficient bandwith return a null Seismogram</span></div>
<div class="line"><span class="lineno">  779</span><span class="comment">    with only Metadata and no data.   Do, however, post a mesage to</span></div>
<div class="line"><span class="lineno">  780</span><span class="comment">    elog in that situation assuming it will be saved to database an</span></div>
<div class="line"><span class="lineno">  781</span><span class="comment">    can be queried to tell what data were deleted for this reason.</span></div>
<div class="line"><span class="lineno">  782</span><span class="comment">    Some of the tests here are more cautious than needed as load</span></div>
<div class="line"><span class="lineno">  783</span><span class="comment">    functions should catch useless data before getting this far. */</span></div>
<div class="line"><span class="lineno">  784</span>    BandwidthData bo;</div>
<div class="line"><span class="lineno">  785</span>    bo = band_overlap(wavelet_bwd, signal_bwd);</div>
<div class="line"><span class="lineno">  786</span>    <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  787</span>    cout &lt;&lt; <span class="stringliteral">&quot;Bandwidth data from wavelet&quot;</span> &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  788</span>    print_bwdata(wavelet_bwd);</div>
<div class="line"><span class="lineno">  789</span>    cout &lt;&lt; <span class="stringliteral">&quot;Bandwidth data from 3D data&quot;</span> &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  790</span>    print_bwdata(signal_bwd);</div>
<div class="line"><span class="lineno">  791</span>    cout &lt;&lt; <span class="stringliteral">&quot;Bandwidth data overlap &quot;</span> &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  792</span>    print_bwdata(bo);</div>
<div class="line"><span class="lineno">  793</span>    <span class="comment">/* Note both of the quantities in this test must be in consistent</span></div>
<div class="line"><span class="lineno">  794</span><span class="comment">    untis of dB */</span></div>
<div class="line"><span class="lineno">  795</span>    <span class="keywordflow">if</span> (bo.bandwidth() &lt; (this-&gt;decon_bandwidth_cutoff)) {</div>
<div class="line"><span class="lineno">  796</span>      <span class="comment">/* this is a bit inefficient to create this work space and immediately</span></div>
<div class="line"><span class="lineno">  797</span><span class="comment">      destroy it but will do it this way until this proves to be a performance</span></div>
<div class="line"><span class="lineno">  798</span><span class="comment">      problem. */</span></div>
<div class="line"><span class="lineno">  799</span>      Seismogram no_can_do(decondata);</div>
<div class="line"><span class="lineno">  800</span>      no_can_do.u = <a class="code hl_class" href="classmspass_1_1utility_1_1dmatrix.html">mspass::utility::dmatrix</a>(1, 1);</div>
<div class="line"><span class="lineno">  801</span>      <span class="comment">/* Be sure this is marked dead */</span></div>
<div class="line"><span class="lineno">  802</span>      no_can_do.kill();</div>
<div class="line"><span class="lineno">  803</span>      stringstream ss;</div>
<div class="line"><span class="lineno">  804</span>      ss &lt;&lt; <span class="stringliteral">&quot;Killed because estimated bandwidth=&quot;</span> &lt;&lt; bo.bandwidth()</div>
<div class="line"><span class="lineno">  805</span>         &lt;&lt; <span class="stringliteral">&quot; dB is below threshold of &quot;</span> &lt;&lt; this-&gt;decon_bandwidth_cutoff</div>
<div class="line"><span class="lineno">  806</span>         &lt;&lt; endl;</div>
<div class="line"><span class="lineno">  807</span>      no_can_do.elog.log_error(<span class="stringliteral">&quot;CNR3CDecon&quot;</span>, ss.str(), ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  808</span>      <span class="keywordflow">return</span> no_can_do;</div>
<div class="line"><span class="lineno">  809</span>    }</div>
<div class="line"><span class="lineno">  810</span>    this-&gt;update_shaping_wavelet(bo);</div>
<div class="line"><span class="lineno">  811</span>    Seismogram rfest(decondata);</div>
<div class="line"><span class="lineno">  812</span>    post_bandwidth_data(rfest, bo);</div>
<div class="line"><span class="lineno">  813</span>    <span class="comment">/* This is used to apply a shift to the fft outputs to put signals</span></div>
<div class="line"><span class="lineno">  814</span><span class="comment">    at relative time 0 */</span></div>
<div class="line"><span class="lineno">  815</span>    <span class="keywordtype">int</span> t0_shift;</div>
<div class="line"><span class="lineno">  816</span>    t0_shift = round((-rfest.t0()) / rfest.dt());</div>
<div class="line"><span class="lineno">  817</span>    <span class="comment">// DEBUG</span></div>
<div class="line"><span class="lineno">  818</span>    <span class="comment">// cout &lt;&lt; &quot;time shift applied to output signal=&quot;&lt;&lt;t0_shift&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  819</span>    vector&lt;double&gt; wvec;</div>
<div class="line"><span class="lineno">  820</span>    wvec.reserve(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  821</span>    <span class="comment">/* This is the proper mspass way to preserve history */</span></div>
<div class="line"><span class="lineno">  822</span>    <span class="comment">// rfest.append_chain(&quot;process_sequence&quot;,&quot;CNR3CDecon&quot;);</span></div>
<div class="line"><span class="lineno">  823</span>    <span class="keywordflow">if</span> (rfest.npts() != FFTDeconOperator::nfft)</div>
<div class="line"><span class="lineno">  824</span>      rfest.u = dmatrix(3, FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  825</span>    <span class="keywordtype">int</span> nhighsnr;</div>
<div class="line"><span class="lineno">  826</span>    <span class="keywordtype">double</span> df;</div>
<div class="line"><span class="lineno">  827</span>    df = 1.0 / (operator_dt * <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(FFTDeconOperator::nfft));</div>
<div class="line"><span class="lineno">  828</span>    <span class="keywordflow">for</span> (k = 0; k &lt; 3; ++k) {</div>
<div class="line"><span class="lineno">  829</span>      TimeSeries work;</div>
<div class="line"><span class="lineno">  830</span>      work = TimeSeries(ExtractComponent(decondata, k), <span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  831</span>      <span class="comment">/* Debug - temporarily remove taper</span></div>
<div class="line"><span class="lineno">  832</span><span class="comment">      if(taper_data) data_taper-&gt;apply(work);</span></div>
<div class="line"><span class="lineno">  833</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  834</span>      wvec.clear();</div>
<div class="line"><span class="lineno">  835</span>      <span class="keywordtype">int</span> ntocopy = FFTDeconOperator::nfft;</div>
<div class="line"><span class="lineno">  836</span>      <span class="keywordflow">if</span> (ntocopy &gt; work.npts())</div>
<div class="line"><span class="lineno">  837</span>        ntocopy = work.npts();</div>
<div class="line"><span class="lineno">  838</span>      <span class="keywordflow">for</span> (j = 0; j &lt; ntocopy; ++j)</div>
<div class="line"><span class="lineno">  839</span>        wvec.push_back(work.s[j]);</div>
<div class="line"><span class="lineno">  840</span>      <span class="keywordflow">for</span> (j = ntocopy; j &lt; FFTDeconOperator::nfft; ++j)</div>
<div class="line"><span class="lineno">  841</span>        wvec.push_back(0.0);</div>
<div class="line"><span class="lineno">  842</span> </div>
<div class="line"><span class="lineno">  843</span>      ComplexArray numerator(FFTDeconOperator::nfft, &amp;(wvec[0]));</div>
<div class="line"><span class="lineno">  844</span>      <span class="comment">// Debug</span></div>
<div class="line"><span class="lineno">  845</span>      <span class="comment">// cout &lt;&lt; &quot;numerator data after taper for component=&quot;&lt;&lt;k&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  846</span>      <span class="comment">// for(j=0;j&lt;FFTDeconOperator::nfft;++j)cout&lt;&lt;real(numerator[j])&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  847</span>      gsl_fft_complex_forward(numerator.ptr(), 1, FFTDeconOperator::nfft,</div>
<div class="line"><span class="lineno">  848</span>                              wavetable, workspace);</div>
<div class="line"><span class="lineno">  849</span>      <span class="comment">/* This loop computes QCMetrics of bandwidth fraction that</span></div>
<div class="line"><span class="lineno">  850</span><span class="comment">      is above a defined snr floor - not necessarily the same as the</span></div>
<div class="line"><span class="lineno">  851</span><span class="comment">      regularization floor used in computing the inverse */</span></div>
<div class="line"><span class="lineno">  852</span>      <span class="keywordtype">double</span> snrmax;</div>
<div class="line"><span class="lineno">  853</span>      snrmax = 1.0;</div>
<div class="line"><span class="lineno">  854</span>      nhighsnr = 0;</div>
<div class="line"><span class="lineno">  855</span>      <span class="comment">// debug</span></div>
<div class="line"><span class="lineno">  856</span>      <span class="comment">// cout &lt;&lt; &quot;Spectrum f, signal, noise, snr&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  857</span>      <span class="keywordflow">for</span> (j = 0; j &lt; FFTDeconOperator::nfft / 2; ++j) {</div>
<div class="line"><span class="lineno">  858</span>        <span class="keywordtype">double</span> f;</div>
<div class="line"><span class="lineno">  859</span>        f = df * <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(j);</div>
<div class="line"><span class="lineno">  860</span>        Complex64 z = numerator[j];</div>
<div class="line"><span class="lineno">  861</span>        <span class="keywordtype">double</span> sigamp = abs(z);</div>
<div class="line"><span class="lineno">  862</span>        <span class="keywordtype">double</span> namp = sqrt(psnoise.<a class="code hl_function" href="classmspass_1_1seismic_1_1_power_spectrum.html#a3d1e72618b8e88c5929839c5e8885859">power</a>(f));</div>
<div class="line"><span class="lineno">  863</span>        <span class="keywordtype">double</span> snr = sigamp / namp;</div>
<div class="line"><span class="lineno">  864</span>        <span class="comment">// Debug</span></div>
<div class="line"><span class="lineno">  865</span>        <span class="comment">// cout &lt;&lt;f&lt;&lt;&quot; &quot;&lt;&lt; sigamp&lt;&lt;&quot; &quot;&lt;&lt;namp&lt;&lt;&quot; &quot;&lt;&lt;snr&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  866</span> </div>
<div class="line"><span class="lineno">  867</span>        <span class="keywordflow">if</span> (snr &gt; snrmax)</div>
<div class="line"><span class="lineno">  868</span>          snrmax = snr;</div>
<div class="line"><span class="lineno">  869</span>        <span class="keywordflow">if</span> (snr &gt; band_snr_floor)</div>
<div class="line"><span class="lineno">  870</span>          ++nhighsnr;</div>
<div class="line"><span class="lineno">  871</span>      }</div>
<div class="line"><span class="lineno">  872</span>      signal_bandwidth_fraction[k] =</div>
<div class="line"><span class="lineno">  873</span>          <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nhighsnr) /</div>
<div class="line"><span class="lineno">  874</span>          <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(FFTDeconOperator::nfft / 2);</div>
<div class="line"><span class="lineno">  875</span>      peak_snr[k] = snrmax;</div>
<div class="line"><span class="lineno">  876</span>      ComplexArray rftmp = numerator * winv;</div>
<div class="line"><span class="lineno">  877</span>      rftmp = (*shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">wavelet</a>()) * rftmp;</div>
<div class="line"><span class="lineno">  878</span>      gsl_fft_complex_inverse(rftmp.ptr(), 1, FFTDeconOperator::nfft, wavetable,</div>
<div class="line"><span class="lineno">  879</span>                              workspace);</div>
<div class="line"><span class="lineno">  880</span>      wvec.clear();</div>
<div class="line"><span class="lineno">  881</span>      <span class="keywordflow">for</span> (j = 0; j &lt; FFTDeconOperator::nfft; ++j)</div>
<div class="line"><span class="lineno">  882</span>        wvec.push_back(rftmp[j].real());</div>
<div class="line"><span class="lineno">  883</span>      <span class="comment">// debug</span></div>
<div class="line"><span class="lineno">  884</span>      <span class="comment">// cout &lt;&lt; &quot;Raw deconvolved data before time shift (re,im)&quot;&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  885</span>      <span class="comment">// for(j=0;j&lt;FFTDeconOperator::nfft;++j) cout &lt;&lt; wvec[j]&lt;&lt;&quot;</span></div>
<div class="line"><span class="lineno">  886</span>      <span class="comment">// &quot;&lt;&lt;rftmp[j].imag()&lt;&lt;endl; cout &lt;&lt; &quot;Function output uses time</span></div>
<div class="line"><span class="lineno">  887</span>      <span class="comment">// shift=&quot;&lt;&lt;t0_shift&lt;&lt;endl;</span></div>
<div class="line"><span class="lineno">  888</span>      <span class="comment">/* Note we used a time domain shift instead of using a linear phase</span></div>
<div class="line"><span class="lineno">  889</span><span class="comment">      shift in the frequency domain because time domain operator has a lower</span></div>
<div class="line"><span class="lineno">  890</span><span class="comment">      operation count than the frequency domain algorithm and is thus more</span></div>
<div class="line"><span class="lineno">  891</span><span class="comment">      efficient.*/</span></div>
<div class="line"><span class="lineno">  892</span>      <span class="comment">/* Debug - temporarily disable this shift*/</span></div>
<div class="line"><span class="lineno">  893</span>      <span class="keywordflow">if</span> (t0_shift != 0)</div>
<div class="line"><span class="lineno">  894</span>        wvec = circular_shift(wvec, -t0_shift);</div>
<div class="line"><span class="lineno">  895</span>      <span class="keywordflow">for</span> (j = 0; j &lt; FFTDeconOperator::nfft; ++j)</div>
<div class="line"><span class="lineno">  896</span>        rfest.u(k, j) = wvec[j];</div>
<div class="line"><span class="lineno">  897</span>    }</div>
<div class="line"><span class="lineno">  898</span>    <span class="keywordflow">return</span> rfest;</div>
<div class="line"><span class="lineno">  899</span>  } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  901</span>  };</div>
<div class="line"><span class="lineno">  902</span>}</div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_power_spectrum_html_a3d1e72618b8e88c5929839c5e8885859"><div class="ttname"><a href="classmspass_1_1seismic_1_1_power_spectrum.html#a3d1e72618b8e88c5929839c5e8885859">mspass::seismic::PowerSpectrum::power</a></div><div class="ttdeci">double power(const double f) const</div><div class="ttdoc">power at a given frequency.</div><div class="ttdef"><b>Definition</b> PowerSpectrum.cc:74</div></div>
<div class="ttc" id="aclassmspass_1_1utility_1_1dmatrix_html"><div class="ttname"><a href="classmspass_1_1utility_1_1dmatrix.html">mspass::utility::dmatrix</a></div><div class="ttdoc">Lightweight, simple matrix object.</div><div class="ttdef"><b>Definition</b> dmatrix.h:104</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a250882407c9755fc4e3f822833b93ea0" name="a250882407c9755fc4e3f822833b93ea0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a250882407c9755fc4e3f822833b93ea0">&#9670;&#160;</a></span>QCMetrics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1utility_1_1_metadata.html">Metadata</a> mspass::algorithms::deconvolution::CNR3CDecon::QCMetrics </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return appropriate quality measures. </p>
<p>The QC values return use two concepts: maximum snr is the largest signal to noise ratio estimated across the band exceeded a specified snr floor for the operator. "bandwidth fraction" is the fraction of the total frequency band (ie. 0 to Nyquist) exceeding the operator snr floor.</p>
<p>This function returns the following key-value pairs: waveletbf - bandwidth fraction for wavelet. maxsnr0,maxsnr1,maxsnr2 - maximum signal to noise ratio on each of the three components of the data being deconvolved. signalbf0,signalbf1,signalbf2 - bandwidth fraction for each of the three components of data deconvolved to produce the latest output. </p>

<p>Implements <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_base3_c_decon.html#a46a3cc2e931b6d5409421237cf06356d">mspass::algorithms::deconvolution::Base3CDecon</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  975</span>                               {</div>
<div class="line"><span class="lineno">  976</span>  Metadata result;</div>
<div class="line"><span class="lineno">  977</span>  result.put(<span class="stringliteral">&quot;waveletbf&quot;</span>, regularization_bandwidth_fraction);</div>
<div class="line"><span class="lineno">  978</span>  result.put(<span class="stringliteral">&quot;maxsnr0&quot;</span>, peak_snr[0]);</div>
<div class="line"><span class="lineno">  979</span>  result.put(<span class="stringliteral">&quot;maxsnr1&quot;</span>, peak_snr[1]);</div>
<div class="line"><span class="lineno">  980</span>  result.put(<span class="stringliteral">&quot;maxsnr2&quot;</span>, peak_snr[2]);</div>
<div class="line"><span class="lineno">  981</span>  result.put(<span class="stringliteral">&quot;signalbf0&quot;</span>, signal_bandwidth_fraction[0]);</div>
<div class="line"><span class="lineno">  982</span>  result.put(<span class="stringliteral">&quot;signalbf1&quot;</span>, signal_bandwidth_fraction[1]);</div>
<div class="line"><span class="lineno">  983</span>  result.put(<span class="stringliteral">&quot;signalbf2&quot;</span>, signal_bandwidth_fraction[2]);</div>
<div class="line"><span class="lineno">  984</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  985</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab4ec1e4c89908b92369acc64f8d95197" name="ab4ec1e4c89908b92369acc64f8d95197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4ec1e4c89908b92369acc64f8d95197">&#9670;&#160;</a></span>wavelet_noise_spectrum()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> mspass::algorithms::deconvolution::CNR3CDecon::wavelet_noise_spectrum </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the power spectrum estimate linked to the wavelet signal. </p>
<div class="fragment"><div class="line"><span class="lineno">  281</span>{ <span class="keywordflow">return</span> psnoise; };</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5615a2e7adc3f4a49e69362031aa5f83" name="a5615a2e7adc3f4a49e69362031aa5f83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5615a2e7adc3f4a49e69362031aa5f83">&#9670;&#160;</a></span>wavelet_spectrum()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> mspass::algorithms::deconvolution::CNR3CDecon::wavelet_spectrum </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the power spectrum of the wavelet signal used for deconvolution. </p>
<div class="fragment"><div class="line"><span class="lineno">  285</span>{ <span class="keywordflow">return</span> pswavelet; };</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/runner/work/mspass/mspass/cxx/include/mspass/algorithms/deconvolution/<a class="el" href="_c_n_r3_c_decon_8h_source.html">CNR3CDecon.h</a></li>
<li>/home/runner/work/mspass/mspass/cxx/src/lib/algorithms/deconvolution/<b>CNR3CDecon.cc</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
