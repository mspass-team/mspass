<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MsPASS C++ API: mspass::algorithms::deconvolution::CNRDeconEngine Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script src="striped_bg.js"></script>
<link href="that_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"> version
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Defines the C++ API for MsPASS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>mspass</b></li><li class="navelem"><b>algorithms</b></li><li class="navelem"><b>deconvolution</b></li><li class="navelem"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">mspass::algorithms::deconvolution::CNRDeconEngine Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for mspass::algorithms::deconvolution::CNRDeconEngine:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.png" usemap="#mspass::algorithms::deconvolution::CNRDeconEngine_map" alt=""/>
  <map id="mspass::algorithms::deconvolution::CNRDeconEngine_map" name="mspass::algorithms::deconvolution::CNRDeconEngine_map">
<area href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html" title="Object to hold components needed in all fft based decon algorithms." alt="mspass::algorithms::deconvolution::FFTDeconOperator" shape="rect" coords="0,0,318,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad14341392e06e116c169da92ba8d2cd0" id="r_ad14341392e06e116c169da92ba8d2cd0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#ad14341392e06e116c169da92ba8d2cd0">CNRDeconEngine</a> (const <a class="el" href="classmspass_1_1utility_1_1_antelope_pf.html">mspass::utility::AntelopePf</a> &amp;pf)</td></tr>
<tr class="separator:ad14341392e06e116c169da92ba8d2cd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8af4a4dc7ffbcdb495ebb59616c77b9" id="r_aa8af4a4dc7ffbcdb495ebb59616c77b9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#aa8af4a4dc7ffbcdb495ebb59616c77b9">CNRDeconEngine</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a> &amp;parent)</td></tr>
<tr class="separator:aa8af4a4dc7ffbcdb495ebb59616c77b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1a2258f2c1e50a9468e2d8b7b73b983" id="r_aa1a2258f2c1e50a9468e2d8b7b73b983"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#aa1a2258f2c1e50a9468e2d8b7b73b983">initialize_inverse_operator</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;wavelet, const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;noise_data)</td></tr>
<tr class="separator:aa1a2258f2c1e50a9468e2d8b7b73b983"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a843ec013a826ac64c9a4806c8fa0c13c" id="r_a843ec013a826ac64c9a4806c8fa0c13c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a843ec013a826ac64c9a4806c8fa0c13c">initialize_inverse_operator</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;wavelet, const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;noise_spectrum)</td></tr>
<tr class="separator:a843ec013a826ac64c9a4806c8fa0c13c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fbb7b10c3cb9875ee4a088bb7fda002" id="r_a7fbb7b10c3cb9875ee4a088bb7fda002"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a7fbb7b10c3cb9875ee4a088bb7fda002">process</a> (const <a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;d, const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;psnoise, const double fl, const double fh)</td></tr>
<tr class="separator:a7fbb7b10c3cb9875ee4a088bb7fda002"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2933aa5528eee5318f07468b0bf913e3" id="r_a2933aa5528eee5318f07468b0bf913e3"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a2933aa5528eee5318f07468b0bf913e3">get_operator_dt</a> () const</td></tr>
<tr class="separator:a2933aa5528eee5318f07468b0bf913e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e13be848c10d8eca118766757f6e703" id="r_a0e13be848c10d8eca118766757f6e703"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a0e13be848c10d8eca118766757f6e703">compute_noise_spectrum</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;d2use)</td></tr>
<tr class="separator:a0e13be848c10d8eca118766757f6e703"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa41b6f260547a11ca73f214d84c3a053" id="r_aa41b6f260547a11ca73f214d84c3a053"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#aa41b6f260547a11ca73f214d84c3a053">compute_noise_spectrum</a> (const <a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;d2use)</td></tr>
<tr class="separator:aa41b6f260547a11ca73f214d84c3a053"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc69ac8bda5709e8f28aeb08f869dcfd" id="r_afc69ac8bda5709e8f28aeb08f869dcfd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#afc69ac8bda5709e8f28aeb08f869dcfd">ideal_output</a> ()</td></tr>
<tr class="separator:afc69ac8bda5709e8f28aeb08f869dcfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a859cd9734d2200e11b4275fe4a2f949d" id="r_a859cd9734d2200e11b4275fe4a2f949d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a859cd9734d2200e11b4275fe4a2f949d">actual_output</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;wavelet)</td></tr>
<tr class="separator:a859cd9734d2200e11b4275fe4a2f949d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a1d1ceb550eea93f5d100337bec0660" id="r_a8a1d1ceb550eea93f5d100337bec0660"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a8a1d1ceb550eea93f5d100337bec0660">inverse_wavelet</a> (const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;wavelet, const double t0shift)</td></tr>
<tr class="separator:a8a1d1ceb550eea93f5d100337bec0660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbaea0375ab6bf31421909243557b21b" id="r_adbaea0375ab6bf31421909243557b21b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1utility_1_1_metadata.html">mspass::utility::Metadata</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#adbaea0375ab6bf31421909243557b21b">QCMetrics</a> ()</td></tr>
<tr class="separator:adbaea0375ab6bf31421909243557b21b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a184de2d6c2b98a820cc905b7c7065e46" id="r_a184de2d6c2b98a820cc905b7c7065e46"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a184de2d6c2b98a820cc905b7c7065e46">operator=</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a> &amp;parent)</td></tr>
<tr class="separator:a184de2d6c2b98a820cc905b7c7065e46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">mspass::algorithms::deconvolution::FFTDeconOperator</a></td></tr>
<tr class="memitem:a6851bec74d3f288eaf1de36cf1d7953b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a6851bec74d3f288eaf1de36cf1d7953b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a6851bec74d3f288eaf1de36cf1d7953b">FFTDeconOperator</a> (const <a class="el" href="classmspass_1_1utility_1_1_metadata.html">mspass::utility::Metadata</a> &amp;md)</td></tr>
<tr class="separator:a6851bec74d3f288eaf1de36cf1d7953b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3df395f4ff5bae8b891bee33f107e46 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_af3df395f4ff5bae8b891bee33f107e46"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#af3df395f4ff5bae8b891bee33f107e46">FFTDeconOperator</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">FFTDeconOperator</a> &amp;parent)</td></tr>
<tr class="separator:af3df395f4ff5bae8b891bee33f107e46 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1040f97ddf7bb7bd2c33ac9a7f99a79 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_ae1040f97ddf7bb7bd2c33ac9a7f99a79"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">FFTDeconOperator</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#ae1040f97ddf7bb7bd2c33ac9a7f99a79">operator=</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">FFTDeconOperator</a> &amp;parent)</td></tr>
<tr class="separator:ae1040f97ddf7bb7bd2c33ac9a7f99a79 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ce6831f67065f17fe7b30aa014eaaf3 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a0ce6831f67065f17fe7b30aa014eaaf3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a0ce6831f67065f17fe7b30aa014eaaf3">changeparameter</a> (const <a class="el" href="classmspass_1_1utility_1_1_metadata.html">mspass::utility::Metadata</a> &amp;md)</td></tr>
<tr class="separator:a0ce6831f67065f17fe7b30aa014eaaf3 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaceb977e9797e483bf3a8ba030743c6 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_aeaceb977e9797e483bf3a8ba030743c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#aeaceb977e9797e483bf3a8ba030743c6">change_size</a> (const int nfft_new)</td></tr>
<tr class="separator:aeaceb977e9797e483bf3a8ba030743c6 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d3f1776e68b20fff386d4bc19e51550 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a3d3f1776e68b20fff386d4bc19e51550"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3d3f1776e68b20fff386d4bc19e51550">change_shift</a> (const int shift)</td></tr>
<tr class="separator:a3d3f1776e68b20fff386d4bc19e51550 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf21bce1d1519ece5e9879d03e7f7e5a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_abf21bce1d1519ece5e9879d03e7f7e5a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#abf21bce1d1519ece5e9879d03e7f7e5a">get_size</a> ()</td></tr>
<tr class="separator:abf21bce1d1519ece5e9879d03e7f7e5a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad63458bb8ad8a04a66de1c140152fc96 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_ad63458bb8ad8a04a66de1c140152fc96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#ad63458bb8ad8a04a66de1c140152fc96">get_shift</a> ()</td></tr>
<tr class="separator:ad63458bb8ad8a04a66de1c140152fc96 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a494e951fb5fceffc545e411a8932d782 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a494e951fb5fceffc545e411a8932d782"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a494e951fb5fceffc545e411a8932d782">operator_size</a> ()</td></tr>
<tr class="separator:a494e951fb5fceffc545e411a8932d782 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f399747b50f4f98f46b643f23af0ee1 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a6f399747b50f4f98f46b643f23af0ee1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a6f399747b50f4f98f46b643f23af0ee1">operator_shift</a> ()</td></tr>
<tr class="separator:a6f399747b50f4f98f46b643f23af0ee1 inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf84c339f3b540543ee8c3487997908a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_adf84c339f3b540543ee8c3487997908a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#adf84c339f3b540543ee8c3487997908a">df</a> (const double dt)</td></tr>
<tr class="separator:adf84c339f3b540543ee8c3487997908a inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3473dc7f359332dbf5a685efe30a684b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a3473dc7f359332dbf5a685efe30a684b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmspass_1_1seismic_1_1_core_time_series.html">mspass::seismic::CoreTimeSeries</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">FourierInverse</a> (const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_complex_array.html">ComplexArray</a> &amp;winv, const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_complex_array.html">ComplexArray</a> &amp;sw, const double dt, const double t0parent)</td></tr>
<tr class="memdesc:a3473dc7f359332dbf5a685efe30a684b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return inverse wavelet for Fourier methods.  <br /></td></tr>
<tr class="separator:a3473dc7f359332dbf5a685efe30a684b inherit pub_methods_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html">mspass::algorithms::deconvolution::FFTDeconOperator</a></td></tr>
<tr class="memitem:aa8619effc38e9e0f3927c73eb9b838f0 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_aa8619effc38e9e0f3927c73eb9b838f0"><td class="memItemLeft" align="right" valign="top">
int&#160;</td><td class="memItemRight" valign="bottom"><b>nfft</b></td></tr>
<tr class="separator:aa8619effc38e9e0f3927c73eb9b838f0 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7034bf16dcf7ea16563a7032ce19b08e inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a7034bf16dcf7ea16563a7032ce19b08e"><td class="memItemLeft" align="right" valign="top">
int&#160;</td><td class="memItemRight" valign="bottom"><b>sample_shift</b></td></tr>
<tr class="separator:a7034bf16dcf7ea16563a7032ce19b08e inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3480b78a08228fc2b2c79809b98335d5 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a3480b78a08228fc2b2c79809b98335d5"><td class="memItemLeft" align="right" valign="top">
gsl_fft_complex_wavetable *&#160;</td><td class="memItemRight" valign="bottom"><b>wavetable</b></td></tr>
<tr class="separator:a3480b78a08228fc2b2c79809b98335d5 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1121967f87437c76cfbb1d8a8fb592e8 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a1121967f87437c76cfbb1d8a8fb592e8"><td class="memItemLeft" align="right" valign="top">
gsl_fft_complex_workspace *&#160;</td><td class="memItemRight" valign="bottom"><b>workspace</b></td></tr>
<tr class="separator:a1121967f87437c76cfbb1d8a8fb592e8 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66026b54b517bc3797a1992ca332bc64 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator" id="r_a66026b54b517bc3797a1992ca332bc64"><td class="memItemLeft" align="right" valign="top">
<a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_complex_array.html">ComplexArray</a>&#160;</td><td class="memItemRight" valign="bottom"><b>winv</b></td></tr>
<tr class="separator:a66026b54b517bc3797a1992ca332bc64 inherit pro_attribs_classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a58acfaf8cec748270f9f59926f919524" name="a58acfaf8cec748270f9f59926f919524"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58acfaf8cec748270f9f59926f919524">&#9670;&#160;</a></span>CNRDeconEngine() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNRDeconEngine::CNRDeconEngine </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   16</span>                               : FFTDeconOperator()</div>
<div class="line"><span class="lineno">   17</span>{</div>
<div class="line"><span class="lineno">   18</span>  <span class="comment">/* This constructor does not initialize everything.  It initializes</span></div>
<div class="line"><span class="lineno">   19</span><span class="comment">  only the simple types and the values are not necessarily reasonable. */</span></div>
<div class="line"><span class="lineno">   20</span>  algorithm = CNR3C_algorithms::colored_noise_damping;</div>
<div class="line"><span class="lineno">   21</span>  damp=1.0;</div>
<div class="line"><span class="lineno">   22</span>  noise_floor = 1.5;</div>
<div class="line"><span class="lineno">   23</span>  band_snr_floor = 1.5;</div>
<div class="line"><span class="lineno">   24</span>  shaping_wavelet_number_poles=3;</div>
<div class="line"><span class="lineno">   25</span>  snr_regularization_floor = 2.0;</div>
<div class="line"><span class="lineno">   26</span>  <span class="comment">/* These are computed private variables - we initialize them all to 0*/</span></div>
<div class="line"><span class="lineno">   27</span>  regularization_bandwidth_fraction = 0.0;</div>
<div class="line"><span class="lineno">   28</span>  <span class="keywordflow">for</span>(<span class="keyword">auto</span> i=0;i&lt;3;++i)</div>
<div class="line"><span class="lineno">   29</span>  {</div>
<div class="line"><span class="lineno">   30</span>    peak_snr[i] = 0.0;</div>
<div class="line"><span class="lineno">   31</span>    signal_bandwidth_fraction[i] = 0.0;</div>
<div class="line"><span class="lineno">   32</span>  }</div>
<div class="line"><span class="lineno">   33</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad14341392e06e116c169da92ba8d2cd0" name="ad14341392e06e116c169da92ba8d2cd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad14341392e06e116c169da92ba8d2cd0">&#9670;&#160;</a></span>CNRDeconEngine() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNRDeconEngine::CNRDeconEngine </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1utility_1_1_antelope_pf.html">mspass::utility::AntelopePf</a> &amp;&#160;</td>
          <td class="paramname"><em>pf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Construct from AntelopePf container.</p>
<p>This is currently the only valid constructor for this object. The operator requires a fair number of parameters for construction that include secondary groups of parameters in a hierarchy. An AntelopePf is one way to handle that with a human readable form. An alternative is yaml but that is not currently supported as an external format. The AntelopePf object API is a generic way to handle parameter data hierarchies that is in MsPASS. Most user's will interact with the object only indirectly via python wrappers. All a user needs to do is define all the required key-value pairs and get the obscure pf format correct. To use this constructor one passes an instance of the object of type AntelopePf that is normally constructed by reading a text file with the "pf" format or retrieved from another AntelopePf with the get_branch method. </p>
<div class="fragment"><div class="line"><span class="lineno">   35</span>  : FFTDeconOperator(<span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span>Metadata&amp;<span class="keyword">&gt;</span>(pf))</div>
<div class="line"><span class="lineno">   36</span>{</div>
<div class="line"><span class="lineno">   37</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">   38</span>    <span class="keywordtype">string</span> stmp;</div>
<div class="line"><span class="lineno">   39</span>    stmp=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#aa56da98a52f03babd67bf9fb55c40f3a">get_string</a>(<span class="stringliteral">&quot;algorithm&quot;</span>);</div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordflow">if</span>(stmp==<span class="stringliteral">&quot;generalized_water_level&quot;</span>)</div>
<div class="line"><span class="lineno">   41</span>    {</div>
<div class="line"><span class="lineno">   42</span>      this-&gt;algorithm=CNR3C_algorithms::generalized_water_level;</div>
<div class="line"><span class="lineno">   43</span>    }</div>
<div class="line"><span class="lineno">   44</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stmp==<span class="stringliteral">&quot;colored_noise_damping&quot;</span>)</div>
<div class="line"><span class="lineno">   45</span>    {</div>
<div class="line"><span class="lineno">   46</span>      this-&gt;algorithm=CNR3C_algorithms::colored_noise_damping;</div>
<div class="line"><span class="lineno">   47</span>    }</div>
<div class="line"><span class="lineno">   48</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   49</span>    {</div>
<div class="line"><span class="lineno">   50</span>      <span class="keywordflow">throw</span> MsPASSError(<span class="stringliteral">&quot;CNRDeconEngine(constructor):  invalid value for parameter algorithm=&quot;</span></div>
<div class="line"><span class="lineno">   51</span>        + stmp,ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">   52</span>    }</div>
<div class="line"><span class="lineno">   53</span>    this-&gt;damp=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;damping_factor&quot;</span>);</div>
<div class="line"><span class="lineno">   54</span>    <span class="comment">/* Note this paramter is used for both the damping method and the</span></div>
<div class="line"><span class="lineno">   55</span><span class="comment">    generalized_water_level */</span></div>
<div class="line"><span class="lineno">   56</span>    this-&gt;noise_floor=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;noise_floor&quot;</span>);</div>
<div class="line"><span class="lineno">   57</span>    this-&gt;snr_regularization_floor=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;snr_regularization_floor&quot;</span>);</div>
<div class="line"><span class="lineno">   58</span>    this-&gt;band_snr_floor = pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;snr_data_bandwidth_floor&quot;</span>);</div>
<div class="line"><span class="lineno">   59</span>    this-&gt;operator_dt=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;target_sample_interval&quot;</span>);</div>
<div class="line"><span class="lineno">   60</span>    <span class="comment">/* These parameters are not cached to the object directly but</span></div>
<div class="line"><span class="lineno">   61</span><span class="comment">    are used to initialize the multitaper engines.   A window is used</span></div>
<div class="line"><span class="lineno">   62</span><span class="comment">    instead of number of samples as it is less error prone to a user than</span></div>
<div class="line"><span class="lineno">   63</span><span class="comment">    requiring them to compute the number from the sample interval. */</span></div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordtype">double</span> ts,te;</div>
<div class="line"><span class="lineno">   65</span>    ts=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;deconvolution_data_window_start&quot;</span>);</div>
<div class="line"><span class="lineno">   66</span>    te=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;deconvolution_data_window_end&quot;</span>);</div>
<div class="line"><span class="lineno">   67</span>    this-&gt;winlength=round((te-ts)/this-&gt;operator_dt)+1;</div>
<div class="line"><span class="lineno">   68</span>    <span class="comment">/* In this algorithm we are very careful to avoid circular convolution</span></div>
<div class="line"><span class="lineno">   69</span><span class="comment">    artifacts that I (glp) suspect may be a problem in some frequency domain</span></div>
<div class="line"><span class="lineno">   70</span><span class="comment">    implementations of rf deconvolution.   Here we set the length of the fft</span></div>
<div class="line"><span class="lineno">   71</span><span class="comment">    (nfft) to a minimum of 3 times the window size.   That allows 1 window</span></div>
<div class="line"><span class="lineno">   72</span><span class="comment">    of padding around both ends of the waveform being deconvolved.  Circular</span></div>
<div class="line"><span class="lineno">   73</span><span class="comment">    shift is used to put the result back in a rational time base. */</span></div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordtype">int</span> minwinsize=3*(this-&gt;winlength);</div>
<div class="line"><span class="lineno">   75</span>    <span class="comment">/* This complicated set of tests to set nfft is needed to mesh with</span></div>
<div class="line"><span class="lineno">   76</span><span class="comment">     * ShapingWavelet constructor and FFTDeconOperator api constraints created by</span></div>
<div class="line"><span class="lineno">   77</span><span class="comment">     * use in other classes in this directory that also use these */</span></div>
<div class="line"><span class="lineno">   78</span>    <span class="keywordtype">int</span> nfftneeded=nextPowerOf2(minwinsize);</div>
<div class="line"><span class="lineno">   79</span>    <span class="comment">/* This compication is needed because FFTDeconOperator(pf) is called</span></div>
<div class="line"><span class="lineno">   80</span><span class="comment">    prior to this function and it requires operator_nfft.   We need to</span></div>
<div class="line"><span class="lineno">   81</span><span class="comment">    be sure it size is consistent with window size that we just computed */</span></div>
<div class="line"><span class="lineno">   82</span>    <span class="keywordflow">if</span>(nfftneeded!=this-&gt;get_size())</div>
<div class="line"><span class="lineno">   83</span>    {</div>
<div class="line"><span class="lineno">   84</span>      FFTDeconOperator::change_size(nfftneeded);</div>
<div class="line"><span class="lineno">   85</span>      Metadata pfcopy(pf);</div>
<div class="line"><span class="lineno">   86</span>      pfcopy.put(<span class="stringliteral">&quot;operator_nfft&quot;</span>,nfftneeded);</div>
<div class="line"><span class="lineno">   87</span>      this-&gt;shapingwavelet=ShapingWavelet(pfcopy);</div>
<div class="line"><span class="lineno">   88</span>    }</div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   90</span>    {</div>
<div class="line"><span class="lineno">   91</span>      this-&gt;shapingwavelet=ShapingWavelet(pf);</div>
<div class="line"><span class="lineno">   92</span>    }</div>
<div class="line"><span class="lineno">   93</span>    <span class="comment">/* ShapingWavelet has more options than can be accepted in this algorithm</span></div>
<div class="line"><span class="lineno">   94</span><span class="comment">    so this test is needed */</span></div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordtype">string</span> swname=this-&gt;shapingwavelet.type();</div>
<div class="line"><span class="lineno">   96</span>    <span class="keywordflow">if</span>( !( (swname == <span class="stringliteral">&quot;ricker&quot;</span>) || (swname == <span class="stringliteral">&quot;butterworth&quot;</span>) ) )</div>
<div class="line"><span class="lineno">   97</span>    {</div>
<div class="line"><span class="lineno">   98</span>      <span class="keywordflow">throw</span> MsPASSError(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;CNRDeconEngine(AntelopePf constructor):  &quot;</span>)</div>
<div class="line"><span class="lineno">   99</span>          + <span class="stringliteral">&quot;Cannot use shaping wavelet type=&quot;</span>+swname</div>
<div class="line"><span class="lineno">  100</span>          + <span class="stringliteral">&quot;\nMust be either ricker or butterworth for this algorithm&quot;</span>,</div>
<div class="line"><span class="lineno">  101</span>          ErrorSeverity::Fatal);</div>
<div class="line"><span class="lineno">  102</span>    }</div>
<div class="line"><span class="lineno">  103</span>    <span class="keywordflow">if</span>(swname == <span class="stringliteral">&quot;butterworth&quot;</span>)</div>
<div class="line"><span class="lineno">  104</span>    {</div>
<div class="line"><span class="lineno">  105</span>      <span class="comment">/* These MUST be consistent with FFTDeconOperator pf constructor</span></div>
<div class="line"><span class="lineno">  106</span><span class="comment">      names.   */</span></div>
<div class="line"><span class="lineno">  107</span>      <span class="keywordtype">int</span> npoles_lo,npoles_hi;</div>
<div class="line"><span class="lineno">  108</span>      npoles_lo=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#a78f3a01e1b1deccd84a0833bea4ef462">get_int</a>(<span class="stringliteral">&quot;npoles_lo&quot;</span>);</div>
<div class="line"><span class="lineno">  109</span>      npoles_hi=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#a78f3a01e1b1deccd84a0833bea4ef462">get_int</a>(<span class="stringliteral">&quot;npoles_hi&quot;</span>);</div>
<div class="line"><span class="lineno">  110</span>      <span class="keywordflow">if</span>(npoles_hi != npoles_lo)</div>
<div class="line"><span class="lineno">  111</span>      {</div>
<div class="line"><span class="lineno">  112</span>        stringstream ss;</div>
<div class="line"><span class="lineno">  113</span>        ss &lt;&lt; <span class="stringliteral">&quot;CNRDeconEngine(Metadata constructor):  &quot;</span></div>
<div class="line"><span class="lineno">  114</span>           &lt;&lt; <span class="stringliteral">&quot;Butterworth filter high and low number of poles must be equal for this operator&quot;</span></div>
<div class="line"><span class="lineno">  115</span>           &lt;&lt; endl</div>
<div class="line"><span class="lineno">  116</span>           &lt;&lt; <span class="stringliteral">&quot;Found npoles_lo=&quot;</span>&lt;&lt;npoles_lo&lt;&lt;<span class="stringliteral">&quot; and npoles_hi=&quot;</span>&lt;&lt;npoles_hi&lt;&lt;endl</div>
<div class="line"><span class="lineno">  117</span>           &lt;&lt; <span class="stringliteral">&quot;Edit parameter file to make those two parameters equal and rerun&quot;</span>&lt;&lt;endl;</div>
<div class="line"><span class="lineno">  118</span>        <span class="keywordflow">throw</span> MsPASSError(ss.str(),ErrorSeverity::Fatal);</div>
<div class="line"><span class="lineno">  119</span>      }</div>
<div class="line"><span class="lineno">  120</span>      this-&gt;shaping_wavelet_number_poles = npoles_lo;</div>
<div class="line"><span class="lineno">  121</span>    }</div>
<div class="line"><span class="lineno">  122</span>    <span class="comment">/* As with signal we use this for initializing the noise engine</span></div>
<div class="line"><span class="lineno">  123</span><span class="comment">    rather than the number of points, which is all the engine cares about. */</span></div>
<div class="line"><span class="lineno">  124</span>    ts=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;noise_window_start&quot;</span>);</div>
<div class="line"><span class="lineno">  125</span>    te=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;noise_window_end&quot;</span>);</div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordtype">int</span> noise_winlength=round((te-ts)/operator_dt)+1;</div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordtype">double</span> tbp=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">get_double</a>(<span class="stringliteral">&quot;time_bandwidth_product&quot;</span>);</div>
<div class="line"><span class="lineno">  128</span>    <span class="keywordtype">long</span> ntapers=pf.<a class="code hl_function" href="classmspass_1_1utility_1_1_metadata.html#a7ace0c05ebb00b3c383cb8cccd225504">get_long</a>(<span class="stringliteral">&quot;number_tapers&quot;</span>);</div>
<div class="line"><span class="lineno">  129</span>    this-&gt;noise_engine=MTPowerSpectrumEngine(noise_winlength,tbp,ntapers,noise_winlength,this-&gt;operator_dt);</div>
<div class="line"><span class="lineno">  130</span>    this-&gt;signal_engine=MTPowerSpectrumEngine(this-&gt;winlength,tbp,ntapers,this-&gt;winlength,this-&gt;operator_dt);</div>
<div class="line"><span class="lineno">  131</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  132</span>}</div>
<div class="ttc" id="aclassmspass_1_1utility_1_1_metadata_html_a78f3a01e1b1deccd84a0833bea4ef462"><div class="ttname"><a href="classmspass_1_1utility_1_1_metadata.html#a78f3a01e1b1deccd84a0833bea4ef462">mspass::utility::Metadata::get_int</a></div><div class="ttdeci">int get_int(const std::string key) const override</div><div class="ttdef"><b>Definition</b> Metadata.h:159</div></div>
<div class="ttc" id="aclassmspass_1_1utility_1_1_metadata_html_a7ace0c05ebb00b3c383cb8cccd225504"><div class="ttname"><a href="classmspass_1_1utility_1_1_metadata.html#a7ace0c05ebb00b3c383cb8cccd225504">mspass::utility::Metadata::get_long</a></div><div class="ttdeci">long get_long(const std::string key) const</div><div class="ttdef"><b>Definition</b> Metadata.h:184</div></div>
<div class="ttc" id="aclassmspass_1_1utility_1_1_metadata_html_aa56da98a52f03babd67bf9fb55c40f3a"><div class="ttname"><a href="classmspass_1_1utility_1_1_metadata.html#aa56da98a52f03babd67bf9fb55c40f3a">mspass::utility::Metadata::get_string</a></div><div class="ttdeci">std::string get_string(const std::string key) const override</div><div class="ttdef"><b>Definition</b> Metadata.h:213</div></div>
<div class="ttc" id="aclassmspass_1_1utility_1_1_metadata_html_ad69a5786d997104df560775f4f688b02"><div class="ttname"><a href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">mspass::utility::Metadata::get_double</a></div><div class="ttdeci">double get_double(const std::string key) const override</div><div class="ttdef"><b>Definition</b> Metadata.h:135</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1utility_1_1_metadata.html#ad69a5786d997104df560775f4f688b02">mspass::utility::Metadata::get_double()</a>, <a class="el" href="classmspass_1_1utility_1_1_metadata.html#a78f3a01e1b1deccd84a0833bea4ef462">mspass::utility::Metadata::get_int()</a>, <a class="el" href="classmspass_1_1utility_1_1_metadata.html#a7ace0c05ebb00b3c383cb8cccd225504">mspass::utility::Metadata::get_long()</a>, and <a class="el" href="classmspass_1_1utility_1_1_metadata.html#aa56da98a52f03babd67bf9fb55c40f3a">mspass::utility::Metadata::get_string()</a>.</p>

</div>
</div>
<a id="aa8af4a4dc7ffbcdb495ebb59616c77b9" name="aa8af4a4dc7ffbcdb495ebb59616c77b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8af4a4dc7ffbcdb495ebb59616c77b9">&#9670;&#160;</a></span>CNRDeconEngine() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mspass::algorithms::deconvolution::CNRDeconEngine::CNRDeconEngine </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a> &amp;&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  135</span>  : FFTDeconOperator(parent),</div>
<div class="line"><span class="lineno">  136</span>     shapingwavelet(parent.shapingwavelet),</div>
<div class="line"><span class="lineno">  137</span>      signal_engine(parent.signal_engine),</div>
<div class="line"><span class="lineno">  138</span>        noise_engine(parent.noise_engine),</div>
<div class="line"><span class="lineno">  139</span>          winv(parent.winv)</div>
<div class="line"><span class="lineno">  140</span>{</div>
<div class="line"><span class="lineno">  141</span>  this-&gt;algorithm = parent.algorithm;</div>
<div class="line"><span class="lineno">  142</span>  this-&gt;damp = parent.damp;</div>
<div class="line"><span class="lineno">  143</span>  this-&gt;noise_floor = parent.noise_floor;</div>
<div class="line"><span class="lineno">  144</span>  this-&gt;band_snr_floor = parent.band_snr_floor;</div>
<div class="line"><span class="lineno">  145</span>  this-&gt;operator_dt = parent.operator_dt;</div>
<div class="line"><span class="lineno">  146</span>  this-&gt;winlength = parent.winlength;</div>
<div class="line"><span class="lineno">  147</span>  this-&gt;shaping_wavelet_number_poles = parent.shaping_wavelet_number_poles;</div>
<div class="line"><span class="lineno">  148</span>  this-&gt;snr_regularization_floor = parent.snr_regularization_floor;</div>
<div class="line"><span class="lineno">  149</span>  this-&gt;regularization_bandwidth_fraction = parent.regularization_bandwidth_fraction;</div>
<div class="line"><span class="lineno">  150</span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;++i)</div>
<div class="line"><span class="lineno">  151</span>  {</div>
<div class="line"><span class="lineno">  152</span>    this-&gt;peak_snr[i] = parent.peak_snr[i];</div>
<div class="line"><span class="lineno">  153</span>    this-&gt;signal_bandwidth_fraction[i] = parent.signal_bandwidth_fraction[i];</div>
<div class="line"><span class="lineno">  154</span>  }</div>
<div class="line"><span class="lineno">  155</span>  winv_t0_lag = parent.winv_t0_lag;</div>
<div class="line"><span class="lineno">  156</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ca522738ca5d00b8ac7fc15808a68f6" name="a1ca522738ca5d00b8ac7fc15808a68f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ca522738ca5d00b8ac7fc15808a68f6">&#9670;&#160;</a></span>~CNRDeconEngine()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual mspass::algorithms::deconvolution::CNRDeconEngine::~CNRDeconEngine </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   72</span>{};</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a859cd9734d2200e11b4275fe4a2f949d" name="a859cd9734d2200e11b4275fe4a2f949d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a859cd9734d2200e11b4275fe4a2f949d">&#9670;&#160;</a></span>actual_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">TimeSeries</a> mspass::algorithms::deconvolution::CNRDeconEngine::actual_output </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>wavelet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  624</span>{</div>
<div class="line"><span class="lineno">  625</span>  <span class="keywordflow">if</span>(wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  626</span>  {</div>
<div class="line"><span class="lineno">  627</span>    TimeSeries badout(wavelet);</div>
<div class="line"><span class="lineno">  628</span>    badout.kill();</div>
<div class="line"><span class="lineno">  629</span>    badout.set_npts(0);</div>
<div class="line"><span class="lineno">  630</span>    badout.elog.log_error(<span class="stringliteral">&quot;CRFDeconEngine::actual_output&quot;</span>,</div>
<div class="line"><span class="lineno">  631</span>       <span class="stringliteral">&quot;received wavelet data via arg0 marked dead - cannot procede&quot;</span>,</div>
<div class="line"><span class="lineno">  632</span>       ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  633</span>    <span class="keywordflow">return</span> badout;</div>
<div class="line"><span class="lineno">  634</span>  }</div>
<div class="line"><span class="lineno">  635</span>  TimeSeries result(wavelet);  <span class="comment">// Use this to clone metadata and elog from wavelet</span></div>
<div class="line"><span class="lineno">  636</span>  result.set_npts(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  637</span>  <span class="comment">/* Force these even though they are likely already defined as</span></div>
<div class="line"><span class="lineno">  638</span><span class="comment">  in the parent wavelet TimeSeries. */</span></div>
<div class="line"><span class="lineno">  639</span>  result.set_live();</div>
<div class="line"><span class="lineno">  640</span>  <span class="comment">/* We always shift this wavelet to the center of the data vector.</span></div>
<div class="line"><span class="lineno">  641</span><span class="comment">  We handle the time through the CoreTimeSeries object. */</span></div>
<div class="line"><span class="lineno">  642</span>  <span class="keywordtype">int</span> i0=FFTDeconOperator::nfft/2;</div>
<div class="line"><span class="lineno">  643</span>  result.set_t0(operator_dt*(-(<span class="keywordtype">double</span>)i0));</div>
<div class="line"><span class="lineno">  644</span>  result.set_dt(this-&gt;operator_dt);</div>
<div class="line"><span class="lineno">  645</span>  result.set_tref(TimeReferenceType::Relative);</div>
<div class="line"><span class="lineno">  646</span>  <span class="comment">/* We need to require that wavelet time range is consistent with</span></div>
<div class="line"><span class="lineno">  647</span><span class="comment">   * operator.   We assume relative time so we demand wavelet t0 be less</span></div>
<div class="line"><span class="lineno">  648</span><span class="comment">   * than or equal to nff2/2 to assure a wavelet signal is in the</span></div>
<div class="line"><span class="lineno">  649</span><span class="comment">   * the range -nfft/2 to nff2/2.  */</span></div>
<div class="line"><span class="lineno">  650</span>  <span class="keywordtype">int</span> w_t0_lag;</div>
<div class="line"><span class="lineno">  651</span>  w_t0_lag = wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">sample_number</a>(0.0);</div>
<div class="line"><span class="lineno">  652</span>  <span class="comment">/* We correct the relative phase of the input wavelet to that</span></div>
<div class="line"><span class="lineno">  653</span><span class="comment">  saved when winv was created. */</span></div>
<div class="line"><span class="lineno">  654</span>  w_t0_lag -= this-&gt;winv_t0_lag;</div>
<div class="line"><span class="lineno">  655</span>  <span class="comment">/* note we handle two extremes differently*/</span></div>
<div class="line"><span class="lineno">  656</span>  <span class="keywordflow">if</span>(w_t0_lag&gt;=FFTDeconOperator::nfft)</div>
<div class="line"><span class="lineno">  657</span>  {</div>
<div class="line"><span class="lineno">  658</span>    stringstream ss;</div>
<div class="line"><span class="lineno">  659</span>    ss &lt;&lt; <span class="stringliteral">&quot;actual_output method received wavelet with t0=&quot;</span></div>
<div class="line"><span class="lineno">  660</span>       &lt;&lt; wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">t0</a>() &lt;&lt; <span class="stringliteral">&quot; that resolves to offset of &quot;</span>&lt;&lt;w_t0_lag&lt;&lt;<span class="stringliteral">&quot; samples&quot;</span></div>
<div class="line"><span class="lineno">  661</span>       &lt;&lt;endl</div>
<div class="line"><span class="lineno">  662</span>       &lt;&lt;<span class="stringliteral">&quot;That exceeds buffer for frequency domain calculation of size=&quot;</span></div>
<div class="line"><span class="lineno">  663</span>       &lt;&lt;FFTDeconOperator::nfft</div>
<div class="line"><span class="lineno">  664</span>       &lt;&lt;endl</div>
<div class="line"><span class="lineno">  665</span>       &lt;&lt;<span class="stringliteral">&quot;Cannot compute actual_output because we assume signal is in range t&gt;0&quot;</span></div>
<div class="line"><span class="lineno">  666</span>       &lt;&lt;endl;</div>
<div class="line"><span class="lineno">  667</span>    result.elog.log_error(<span class="stringliteral">&quot;CNRDeconEngine::actual_output&quot;</span>,</div>
<div class="line"><span class="lineno">  668</span>         ss.str(), ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  669</span>    result.kill();</div>
<div class="line"><span class="lineno">  670</span>    result.set_npts(0);</div>
<div class="line"><span class="lineno">  671</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  672</span>  }</div>
<div class="line"><span class="lineno">  673</span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(w_t0_lag&gt;(FFTDeconOperator::nfft)/2)</div>
<div class="line"><span class="lineno">  674</span>  {</div>
<div class="line"><span class="lineno">  675</span>    stringstream ss;</div>
<div class="line"><span class="lineno">  676</span>    ss &lt;&lt; <span class="stringliteral">&quot;Warning: actual output method received wavelet with t0=&quot;</span></div>
<div class="line"><span class="lineno">  677</span>       &lt;&lt; wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">t0</a>() &lt;&lt; <span class="stringliteral">&quot; that resolves to offset of &quot;</span>&lt;&lt;w_t0_lag&lt;&lt;<span class="stringliteral">&quot; samples&quot;</span></div>
<div class="line"><span class="lineno">  678</span>       &lt;&lt;endl</div>
<div class="line"><span class="lineno">  679</span>       &lt;&lt;<span class="stringliteral">&quot;That exceeds the midpoint of the frequency domain buffer used by this method=&quot;</span></div>
<div class="line"><span class="lineno">  680</span>       &lt;&lt;FFTDeconOperator::nfft/2</div>
<div class="line"><span class="lineno">  681</span>       &lt;&lt;endl</div>
<div class="line"><span class="lineno">  682</span>       &lt;&lt;<span class="stringliteral">&quot;Result may be incorrect as the function assumes the signal is after time 0&quot;</span></div>
<div class="line"><span class="lineno">  683</span>       &lt;&lt;endl;</div>
<div class="line"><span class="lineno">  684</span>    result.elog.log_error(<span class="stringliteral">&quot;CNRDeconEngine::actual_output&quot;</span>,</div>
<div class="line"><span class="lineno">  685</span>         ss.str(), ErrorSeverity::Complaint);</div>
<div class="line"><span class="lineno">  686</span>  }</div>
<div class="line"><span class="lineno">  687</span> </div>
<div class="line"><span class="lineno">  688</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  689</span>      std::vector&lt;double&gt; work;</div>
<div class="line"><span class="lineno">  690</span>      <span class="keywordflow">if</span>(wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>() == FFTDeconOperator::nfft)</div>
<div class="line"><span class="lineno">  691</span>      {</div>
<div class="line"><span class="lineno">  692</span>        work = wavelet.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">s</a>;</div>
<div class="line"><span class="lineno">  693</span>      }</div>
<div class="line"><span class="lineno">  694</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  695</span>      {</div>
<div class="line"><span class="lineno">  696</span>        work.reserve(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  697</span>        <span class="keywordtype">int</span> i,nend;</div>
<div class="line"><span class="lineno">  698</span>        <span class="keywordflow">for</span>(i=0;i&lt;FFTDeconOperator::nfft;++i) work.push_back(0.0);</div>
<div class="line"><span class="lineno">  699</span>        <span class="keywordflow">if</span>(wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>()&gt;FFTDeconOperator::nfft)</div>
<div class="line"><span class="lineno">  700</span>          nend = FFTDeconOperator::nfft;</div>
<div class="line"><span class="lineno">  701</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  702</span>          nend = wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">npts</a>();</div>
<div class="line"><span class="lineno">  703</span>        <span class="keywordflow">for</span>(i=0;i&lt;nend;++i) work[i] = wavelet.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">s</a>[i];</div>
<div class="line"><span class="lineno">  704</span>      }</div>
<div class="line"><span class="lineno">  705</span>      <span class="comment">/* This converts wavelet to zero phase - needed to preserve timing.*/</span></div>
<div class="line"><span class="lineno">  706</span>      work = circular_shift(work,w_t0_lag);</div>
<div class="line"><span class="lineno">  707</span>      ComplexArray W(FFTDeconOperator::nfft,&amp;(work[0]));</div>
<div class="line"><span class="lineno">  708</span>      gsl_fft_complex_forward(W.ptr(),1,FFTDeconOperator::nfft,wavetable,workspace);</div>
<div class="line"><span class="lineno">  709</span>      ComplexArray ao_fft;</div>
<div class="line"><span class="lineno">  710</span>      ao_fft=this-&gt;winv*W;</div>
<div class="line"><span class="lineno">  711</span>      ComplexArray *stmp = this-&gt;shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">wavelet</a>();</div>
<div class="line"><span class="lineno">  712</span>      <span class="comment">/* We always apply the shaping wavelet - this perhaps should be optional</span></div>
<div class="line"><span class="lineno">  713</span><span class="comment">      but probably better done with a none option for the shaping wavelet */</span></div>
<div class="line"><span class="lineno">  714</span>      ao_fft=(*stmp)*ao_fft;</div>
<div class="line"><span class="lineno">  715</span>      gsl_fft_complex_inverse(ao_fft.ptr(),1,FFTDeconOperator::nfft,wavetable,workspace);</div>
<div class="line"><span class="lineno">  716</span>      vector&lt;double&gt; ao;</div>
<div class="line"><span class="lineno">  717</span>      ao.reserve(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  718</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;ao_fft.size(); ++k) ao.push_back(ao_fft[k].real());</div>
<div class="line"><span class="lineno">  719</span>      ao=circular_shift(ao,i0);</div>
<div class="line"><span class="lineno">  720</span>      ao = normalize&lt;double&gt;(ao);</div>
<div class="line"><span class="lineno">  721</span>      <span class="comment">/* set_npts always initializes the s buffer so it is more efficient to</span></div>
<div class="line"><span class="lineno">  722</span><span class="comment">      copy ao elements rather than what was here before:</span></div>
<div class="line"><span class="lineno">  723</span><span class="comment">        result.s=ao;</span></div>
<div class="line"><span class="lineno">  724</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  725</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;FFTDeconOperator::nfft;++k) result.s[k]=ao[k];</div>
<div class="line"><span class="lineno">  726</span>      <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  727</span>  } <span class="keywordflow">catch</span>(...) {</div>
<div class="line"><span class="lineno">  728</span>      <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  729</span>  };</div>
<div class="line"><span class="lineno">  730</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet_html_ac922b603ff03a691075724bcd53e396f"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">mspass::algorithms::deconvolution::ShapingWavelet::wavelet</a></div><div class="ttdeci">ComplexArray * wavelet()</div><div class="ttdef"><b>Definition</b> ShapingWavelet.h:77</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_a347b349bb4e1f0e65978dfcd45ae3472"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts</a></div><div class="ttdeci">size_t npts() const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:188</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_a472074f3074d59f794d18017b010ab81"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">mspass::seismic::BasicTimeSeries::t0</a></div><div class="ttdeci">double t0() const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:191</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_aa96e795f96b5050996d791f5b6f3867d"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead</a></div><div class="ttdeci">bool dead() const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:154</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_time_series_html_abe28ca2812a2ac21dd2196385ad106ab"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_time_series.html#abe28ca2812a2ac21dd2196385ad106ab">mspass::seismic::BasicTimeSeries::sample_number</a></div><div class="ttdeci">int sample_number(double t) const</div><div class="ttdef"><b>Definition</b> BasicTimeSeries.h:74</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_core_time_series_html_ab044edb3fe5fe734cb577a4434f390a2"><div class="ttname"><a href="classmspass_1_1seismic_1_1_core_time_series.html#ab044edb3fe5fe734cb577a4434f390a2">mspass::seismic::CoreTimeSeries::s</a></div><div class="ttdeci">std::vector&lt; double &gt; s</div><div class="ttdef"><b>Definition</b> CoreTimeSeries.h:28</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa41b6f260547a11ca73f214d84c3a053" name="aa41b6f260547a11ca73f214d84c3a053"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa41b6f260547a11ca73f214d84c3a053">&#9670;&#160;</a></span>compute_noise_spectrum() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">PowerSpectrum</a> mspass::algorithms::deconvolution::CNRDeconEngine::compute_noise_spectrum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;&#160;</td>
          <td class="paramname"><em>d2use</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute noise spectrum from three component data.</p>
<p>Overloaded version returns average power spectrum of all three components. Measure of overall 3c power comparable to scalar signal power. Could do sum of component spectra but that would cause a scaling problem for use in regularization. For most data this will tend to be dominated by the component with the highest noise level </p>
<div class="fragment"><div class="line"><span class="lineno">  251</span>{</div>
<div class="line"><span class="lineno">  252</span>  <span class="keywordflow">if</span>(n.dead())</div>
<div class="line"><span class="lineno">  253</span>  {</div>
<div class="line"><span class="lineno">  254</span>    PowerSpectrum badout;</div>
<div class="line"><span class="lineno">  255</span>    badout.elog.log_error(<span class="stringliteral">&quot;CNRDeconEngine:compute_noise&quot;</span>,</div>
<div class="line"><span class="lineno">  256</span>        <span class="stringliteral">&quot;Received noise data segment marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  257</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  258</span>    <span class="keywordflow">return</span> badout;</div>
<div class="line"><span class="lineno">  259</span>  }</div>
<div class="line"><span class="lineno">  260</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">  261</span>    PowerSpectrum avg3c;</div>
<div class="line"><span class="lineno">  262</span>    TimeSeries tswork;</div>
<div class="line"><span class="lineno">  263</span>    <span class="keywordflow">if</span>(n.npts()!=noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">taper_length</a>())</div>
<div class="line"><span class="lineno">  264</span>    {</div>
<div class="line"><span class="lineno">  265</span>      <span class="comment">/* this may change fft size and will set dt wrong so we need the</span></div>
<div class="line"><span class="lineno">  266</span><span class="comment">       * call to set_df afterward to correct that. */</span></div>
<div class="line"><span class="lineno">  267</span>      noise_engine=MTPowerSpectrumEngine(n.npts(),</div>
<div class="line"><span class="lineno">  268</span>         noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">time_bandwidth_product</a>(),noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">number_tapers</a>());</div>
<div class="line"><span class="lineno">  269</span>      noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a1dadcf9ec587fa2d48d04066ba1d55b4">set_df</a>(this-&gt;operator_dt);</div>
<div class="line"><span class="lineno">  270</span>    }</div>
<div class="line"><span class="lineno">  271</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;3;++k)</div>
<div class="line"><span class="lineno">  272</span>    {</div>
<div class="line"><span class="lineno">  273</span>      tswork=TimeSeries(ExtractComponent(n,k),<span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  274</span>      PowerSpectrum psnoise = this-&gt;noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">apply</a>(tswork);</div>
<div class="line"><span class="lineno">  275</span>      <span class="keywordflow">if</span>(psnoise.dead())</div>
<div class="line"><span class="lineno">  276</span>      {</div>
<div class="line"><span class="lineno">  277</span>        <span class="keywordflow">return</span> psnoise;</div>
<div class="line"><span class="lineno">  278</span>      }</div>
<div class="line"><span class="lineno">  279</span>      <span class="keywordflow">if</span>(k==0)</div>
<div class="line"><span class="lineno">  280</span>        avg3c = psnoise;</div>
<div class="line"><span class="lineno">  281</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  282</span>        avg3c += psnoise;</div>
<div class="line"><span class="lineno">  283</span>    }</div>
<div class="line"><span class="lineno">  284</span>    <span class="comment">/* We define total power as the average on all three</span></div>
<div class="line"><span class="lineno">  285</span><span class="comment">    components */</span></div>
<div class="line"><span class="lineno">  286</span>    <span class="keywordtype">double</span> scl=1.0/3.0;</div>
<div class="line"><span class="lineno">  287</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;avg3c.nf();++i)</div>
<div class="line"><span class="lineno">  288</span>         avg3c.<a class="code hl_variable" href="classmspass_1_1seismic_1_1_power_spectrum.html#a924f5b005efdeef3f2da34355821e0c0">spectrum</a>[i]*=scl;</div>
<div class="line"><span class="lineno">  289</span>    <span class="keywordflow">return</span> avg3c;</div>
<div class="line"><span class="lineno">  290</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  291</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_a10d4b650fdedd815652c1e4e86a0e715"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::number_tapers</a></div><div class="ttdeci">int number_tapers() const</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:106</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_a114db709279ea8ab275ba69fbdcbec13"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::taper_length</a></div><div class="ttdeci">int taper_length() const</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:96</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_a1dadcf9ec587fa2d48d04066ba1d55b4"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a1dadcf9ec587fa2d48d04066ba1d55b4">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::set_df</a></div><div class="ttdeci">double set_df(double dt)</div><div class="ttdoc">Putter equivalent of df.</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:134</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_aa3c10c25ea2c6b82cf8bbe2991f16bfe"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::apply</a></div><div class="ttdeci">mspass::seismic::PowerSpectrum apply(const mspass::seismic::TimeSeries &amp;d)</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.cc:124</div></div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine_html_accf94d6d1dff859884d9c0aa1719994a"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product</a></div><div class="ttdeci">double time_bandwidth_product() const</div><div class="ttdef"><b>Definition</b> MTPowerSpectrumEngine.h:101</div></div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_power_spectrum_html_a924f5b005efdeef3f2da34355821e0c0"><div class="ttname"><a href="classmspass_1_1seismic_1_1_power_spectrum.html#a924f5b005efdeef3f2da34355821e0c0">mspass::seismic::PowerSpectrum::spectrum</a></div><div class="ttdeci">std::vector&lt; double &gt; spectrum</div><div class="ttdef"><b>Definition</b> PowerSpectrum.h:22</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::apply()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_spectrum.html#a331f89b8216f9717ac906e922d7c2cff">mspass::seismic::BasicSpectrum::dead()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>, <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html#a920cd0761252df4312168f4571165f2b">mspass::seismic::PowerSpectrum::elog</a>, <a class="el" href="classmspass_1_1utility_1_1_error_logger.html#aa69873ba0aebf67e9ba24d01992c0bcf">mspass::utility::ErrorLogger::log_error()</a>, <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html#a7675c66d7f1aa8d7b4e9437564af4beb">mspass::seismic::PowerSpectrum::nf()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::number_tapers()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a1dadcf9ec587fa2d48d04066ba1d55b4">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::set_df()</a>, <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html#a924f5b005efdeef3f2da34355821e0c0">mspass::seismic::PowerSpectrum::spectrum</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::taper_length()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product()</a>.</p>

</div>
</div>
<a id="a0e13be848c10d8eca118766757f6e703" name="a0e13be848c10d8eca118766757f6e703"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e13be848c10d8eca118766757f6e703">&#9670;&#160;</a></span>compute_noise_spectrum() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">PowerSpectrum</a> mspass::algorithms::deconvolution::CNRDeconEngine::compute_noise_spectrum </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>d2use</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute noise spectrum using internal Multitaper operator. Normally used for noise spectrum but can be used for signal. Necessary to assure consistent scaling between signal and noise spectrum estimators. <br  />
 </p>
<div class="fragment"><div class="line"><span class="lineno">  228</span>{</div>
<div class="line"><span class="lineno">  229</span>  <span class="keywordflow">if</span>(n.dead())</div>
<div class="line"><span class="lineno">  230</span>  {</div>
<div class="line"><span class="lineno">  231</span>    PowerSpectrum badout;</div>
<div class="line"><span class="lineno">  232</span>    badout.elog.log_error(<span class="stringliteral">&quot;CNRDeconEngine:compute_noise&quot;</span>,</div>
<div class="line"><span class="lineno">  233</span>        <span class="stringliteral">&quot;Received noise data segment marked dead&quot;</span>,</div>
<div class="line"><span class="lineno">  234</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">return</span> badout;</div>
<div class="line"><span class="lineno">  236</span>  }</div>
<div class="line"><span class="lineno">  237</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">  238</span>    <span class="keywordflow">if</span>(n.npts()!=noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">taper_length</a>())</div>
<div class="line"><span class="lineno">  239</span>    {</div>
<div class="line"><span class="lineno">  240</span>      <span class="comment">/* use this varaint of the construtor too allow the fft size to</span></div>
<div class="line"><span class="lineno">  241</span><span class="comment">       * be automatically changed if necessary.  */</span></div>
<div class="line"><span class="lineno">  242</span>      this-&gt;noise_engine=MTPowerSpectrumEngine(n.npts(),</div>
<div class="line"><span class="lineno">  243</span>        noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">time_bandwidth_product</a>(),noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">number_tapers</a>());</div>
<div class="line"><span class="lineno">  244</span>      <span class="comment">/* with auto fft we also need this to set the df and dt correctly */</span></div>
<div class="line"><span class="lineno">  245</span>      this-&gt;noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a1dadcf9ec587fa2d48d04066ba1d55b4">set_df</a>(this-&gt;operator_dt);</div>
<div class="line"><span class="lineno">  246</span>    }</div>
<div class="line"><span class="lineno">  247</span>    <span class="keywordflow">return</span> this-&gt;noise_engine.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">apply</a>(n);</div>
<div class="line"><span class="lineno">  248</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  249</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#aa3c10c25ea2c6b82cf8bbe2991f16bfe">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::apply()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">mspass::seismic::BasicTimeSeries::dead()</a>, <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html#a920cd0761252df4312168f4571165f2b">mspass::seismic::PowerSpectrum::elog</a>, <a class="el" href="classmspass_1_1utility_1_1_error_logger.html#aa69873ba0aebf67e9ba24d01992c0bcf">mspass::utility::ErrorLogger::log_error()</a>, <a class="el" href="classmspass_1_1seismic_1_1_basic_time_series.html#a347b349bb4e1f0e65978dfcd45ae3472">mspass::seismic::BasicTimeSeries::npts()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a10d4b650fdedd815652c1e4e86a0e715">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::number_tapers()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a1dadcf9ec587fa2d48d04066ba1d55b4">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::set_df()</a>, <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#a114db709279ea8ab275ba69fbdcbec13">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::taper_length()</a>, and <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_m_t_power_spectrum_engine.html#accf94d6d1dff859884d9c0aa1719994a">mspass::algorithms::deconvolution::MTPowerSpectrumEngine::time_bandwidth_product()</a>.</p>

</div>
</div>
<a id="a2933aa5528eee5318f07468b0bf913e3" name="a2933aa5528eee5318f07468b0bf913e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2933aa5528eee5318f07468b0bf913e3">&#9670;&#160;</a></span>get_operator_dt()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double mspass::algorithms::deconvolution::CNRDeconEngine::get_operator_dt </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   77</span>  {</div>
<div class="line"><span class="lineno">   78</span>    <span class="keywordflow">return</span> this-&gt;operator_dt;</div>
<div class="line"><span class="lineno">   79</span>  }</div>
</div><!-- fragment -->
</div>
</div>
<a id="afc69ac8bda5709e8f28aeb08f869dcfd" name="afc69ac8bda5709e8f28aeb08f869dcfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc69ac8bda5709e8f28aeb08f869dcfd">&#9670;&#160;</a></span>ideal_output()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">TimeSeries</a> mspass::algorithms::deconvolution::CNRDeconEngine::ideal_output </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  617</span>{</div>
<div class="line"><span class="lineno">  618</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">  619</span>    CoreTimeSeries ideal_tmp=this-&gt;shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#a5d213e187ff91de27d96e65b643bd71b">impulse_response</a>();</div>
<div class="line"><span class="lineno">  620</span>    <span class="keywordflow">return</span> TimeSeries(ideal_tmp,<span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  621</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  622</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet_html_a5d213e187ff91de27d96e65b643bd71b"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#a5d213e187ff91de27d96e65b643bd71b">mspass::algorithms::deconvolution::ShapingWavelet::impulse_response</a></div><div class="ttdeci">mspass::seismic::CoreTimeSeries impulse_response()</div><div class="ttdef"><b>Definition</b> ShapingWavelet.cc:271</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a843ec013a826ac64c9a4806c8fa0c13c" name="a843ec013a826ac64c9a4806c8fa0c13c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a843ec013a826ac64c9a4806c8fa0c13c">&#9670;&#160;</a></span>initialize_inverse_operator() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNRDeconEngine::initialize_inverse_operator </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>wavelet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;&#160;</td>
          <td class="paramname"><em>noise_spectrum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  209</span>{</div>
<div class="line"><span class="lineno">  210</span>  <span class="keywordtype">string</span> alg(<span class="stringliteral">&quot;CNRDeconEngine::initialize_inverse_operator&quot;</span>);</div>
<div class="line"><span class="lineno">  211</span>  <span class="keywordflow">if</span>(wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  212</span>  {</div>
<div class="line"><span class="lineno">  213</span>    <span class="keywordtype">string</span> message;</div>
<div class="line"><span class="lineno">  214</span>    message = alg + string(<span class="stringliteral">&quot;Received wavelet signal marked dead&quot;</span>);</div>
<div class="line"><span class="lineno">  215</span>    <span class="keywordflow">throw</span> MsPASSError(message,ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  216</span>  }</div>
<div class="line"><span class="lineno">  217</span>  <span class="keywordflow">if</span>(noise_spectrum.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_spectrum.html#a331f89b8216f9717ac906e922d7c2cff">dead</a>())</div>
<div class="line"><span class="lineno">  218</span>  {</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordtype">string</span> message;</div>
<div class="line"><span class="lineno">  220</span>    message = alg + string(<span class="stringliteral">&quot;Received a PowerSpectrum object marked dead&quot;</span>);</div>
<div class="line"><span class="lineno">  221</span>    <span class="keywordflow">throw</span> MsPASSError(message,ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  222</span>  }</div>
<div class="line"><span class="lineno">  223</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">  224</span>    this-&gt;compute_winv(wavelet,noise_spectrum);</div>
<div class="line"><span class="lineno">  225</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  226</span>}</div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_basic_spectrum_html_a331f89b8216f9717ac906e922d7c2cff"><div class="ttname"><a href="classmspass_1_1seismic_1_1_basic_spectrum.html#a331f89b8216f9717ac906e922d7c2cff">mspass::seismic::BasicSpectrum::dead</a></div><div class="ttdeci">bool dead() const</div><div class="ttdef"><b>Definition</b> BasicSpectrum.h:80</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1a2258f2c1e50a9468e2d8b7b73b983" name="aa1a2258f2c1e50a9468e2d8b7b73b983"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1a2258f2c1e50a9468e2d8b7b73b983">&#9670;&#160;</a></span>initialize_inverse_operator() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mspass::algorithms::deconvolution::CNRDeconEngine::initialize_inverse_operator </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>wavelet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>noise_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  184</span>{</div>
<div class="line"><span class="lineno">  185</span>  <span class="keyword">const</span> <span class="keywordtype">string</span> alg(<span class="stringliteral">&quot;CNRDeconEngine::initialize_inverse_operator&quot;</span>);</div>
<div class="line"><span class="lineno">  186</span>  <span class="keywordflow">if</span>(wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>() || noise_data.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  187</span>  {</div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordtype">string</span> message;</div>
<div class="line"><span class="lineno">  189</span>    message = alg + string(<span class="stringliteral">&quot;:  Received TimeSeries inputs marked dead\n&quot;</span>);</div>
<div class="line"><span class="lineno">  190</span>    <span class="keywordflow">if</span>(wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>()) message += <span class="stringliteral">&quot;wavelet signal input was marked dead\n&quot;</span>;</div>
<div class="line"><span class="lineno">  191</span>    <span class="keywordflow">if</span>(noise_data.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>()) message += <span class="stringliteral">&quot;noise data segment was marked dead\n&quot;</span>;</div>
<div class="line"><span class="lineno">  192</span>    <span class="keywordflow">throw</span> MsPASSError(message,ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  193</span>  }</div>
<div class="line"><span class="lineno">  194</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">  195</span>    <span class="comment">/* Assume wavelet and noise_data have the correct sample rate.</span></div>
<div class="line"><span class="lineno">  196</span><span class="comment">    * python wrapper should guarantee that */</span></div>
<div class="line"><span class="lineno">  197</span>    PowerSpectrum psnoise(this-&gt;<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a0e13be848c10d8eca118766757f6e703">compute_noise_spectrum</a>(noise_data));</div>
<div class="line"><span class="lineno">  198</span>    <span class="keywordflow">if</span>(psnoise.dead())</div>
<div class="line"><span class="lineno">  199</span>    {</div>
<div class="line"><span class="lineno">  200</span>      <span class="keywordtype">string</span> message;</div>
<div class="line"><span class="lineno">  201</span>      message = alg + string(<span class="stringliteral">&quot;compute_noise_spectrum method failed - cannot compute inverse opeator&quot;</span>);</div>
<div class="line"><span class="lineno">  202</span>      <span class="keywordflow">throw</span> MsPASSError(message,ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  203</span>    }</div>
<div class="line"><span class="lineno">  204</span>    this-&gt;initialize_inverse_operator(wavelet,psnoise);</div>
<div class="line"><span class="lineno">  205</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  206</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine_html_a0e13be848c10d8eca118766757f6e703"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html#a0e13be848c10d8eca118766757f6e703">mspass::algorithms::deconvolution::CNRDeconEngine::compute_noise_spectrum</a></div><div class="ttdeci">mspass::seismic::PowerSpectrum compute_noise_spectrum(const mspass::seismic::TimeSeries &amp;d2use)</div><div class="ttdef"><b>Definition</b> CNRDeconEngine.cc:227</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8a1d1ceb550eea93f5d100337bec0660" name="a8a1d1ceb550eea93f5d100337bec0660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a1d1ceb550eea93f5d100337bec0660">&#9670;&#160;</a></span>inverse_wavelet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_time_series.html">TimeSeries</a> mspass::algorithms::deconvolution::CNRDeconEngine::inverse_wavelet </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_time_series.html">mspass::seismic::TimeSeries</a> &amp;&#160;</td>
          <td class="paramname"><em>wavelet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>t0shift</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  732</span>{</div>
<div class="line"><span class="lineno">  733</span>  <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  734</span>    <span class="comment">/* Using the time shift of wavelet.t0() may be a bad idea here.  Will</span></div>
<div class="line"><span class="lineno">  735</span><span class="comment">    need to sort that out in debugging behaviour*/</span></div>
<div class="line"><span class="lineno">  736</span>    <span class="keywordtype">double</span> timeshift(tshift0);</div>
<div class="line"><span class="lineno">  737</span>    timeshift+=wavelet.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#a472074f3074d59f794d18017b010ab81">t0</a>();</div>
<div class="line"><span class="lineno">  738</span>    timeshift -= operator_dt*((double)this-&gt;winlength);</div>
<div class="line"><span class="lineno">  739</span>    CoreTimeSeries invcore(this-&gt;<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">FFTDeconOperator::FourierInverse</a>(this-&gt;winv,</div>
<div class="line"><span class="lineno">  740</span>        *this-&gt;shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">wavelet</a>(),operator_dt,timeshift));</div>
<div class="line"><span class="lineno">  741</span>    TimeSeries result(invcore,<span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  742</span>    <span class="comment">/* Copy the error log from wavelet and post some information parameters</span></div>
<div class="line"><span class="lineno">  743</span><span class="comment">    to metadata */</span></div>
<div class="line"><span class="lineno">  744</span>    result.elog=wavelet.elog;</div>
<div class="line"><span class="lineno">  745</span>    result.put(<span class="stringliteral">&quot;waveform_type&quot;</span>,<span class="stringliteral">&quot;deconvolution_inverse_wavelet&quot;</span>);</div>
<div class="line"><span class="lineno">  746</span>    result.put(<span class="stringliteral">&quot;decon_type&quot;</span>,<span class="stringliteral">&quot;CNRDeconEngine&quot;</span>);</div>
<div class="line"><span class="lineno">  747</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  748</span>  } <span class="keywordflow">catch</span>(...) {</div>
<div class="line"><span class="lineno">  749</span>      <span class="keywordflow">throw</span>;</div>
<div class="line"><span class="lineno">  750</span>  };</div>
<div class="line"><span class="lineno">  751</span>}</div>
<div class="ttc" id="aclassmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator_html_a3473dc7f359332dbf5a685efe30a684b"><div class="ttname"><a href="classmspass_1_1algorithms_1_1deconvolution_1_1_f_f_t_decon_operator.html#a3473dc7f359332dbf5a685efe30a684b">mspass::algorithms::deconvolution::FFTDeconOperator::FourierInverse</a></div><div class="ttdeci">mspass::seismic::CoreTimeSeries FourierInverse(const ComplexArray &amp;winv, const ComplexArray &amp;sw, const double dt, const double t0parent)</div><div class="ttdoc">Return inverse wavelet for Fourier methods.</div><div class="ttdef"><b>Definition</b> FFTDeconOperator.cc:119</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a184de2d6c2b98a820cc905b7c7065e46" name="a184de2d6c2b98a820cc905b7c7065e46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a184de2d6c2b98a820cc905b7c7065e46">&#9670;&#160;</a></span>operator=()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a> &amp; mspass::algorithms::deconvolution::CNRDeconEngine::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1algorithms_1_1deconvolution_1_1_c_n_r_decon_engine.html">CNRDeconEngine</a> &amp;&#160;</td>
          <td class="paramname"><em>parent</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  158</span>{</div>
<div class="line"><span class="lineno">  159</span>  <span class="keywordflow">if</span>(&amp;parent != <span class="keyword">this</span>)</div>
<div class="line"><span class="lineno">  160</span>  {</div>
<div class="line"><span class="lineno">  161</span>    this-&gt;shapingwavelet=parent.shapingwavelet;</div>
<div class="line"><span class="lineno">  162</span>    this-&gt;signal_engine=parent.signal_engine;</div>
<div class="line"><span class="lineno">  163</span>    this-&gt;noise_engine=parent.noise_engine;</div>
<div class="line"><span class="lineno">  164</span>    this-&gt;winv=parent.winv;</div>
<div class="line"><span class="lineno">  165</span>    this-&gt;winv_t0_lag = parent.winv_t0_lag;</div>
<div class="line"><span class="lineno">  166</span>    this-&gt;algorithm = parent.algorithm;</div>
<div class="line"><span class="lineno">  167</span>    this-&gt;damp = parent.damp;</div>
<div class="line"><span class="lineno">  168</span>    this-&gt;noise_floor = parent.noise_floor;</div>
<div class="line"><span class="lineno">  169</span>    this-&gt;band_snr_floor = parent.band_snr_floor;</div>
<div class="line"><span class="lineno">  170</span>    this-&gt;operator_dt = parent.operator_dt;</div>
<div class="line"><span class="lineno">  171</span>    this-&gt;shaping_wavelet_number_poles = parent.shaping_wavelet_number_poles;</div>
<div class="line"><span class="lineno">  172</span>    this-&gt;snr_regularization_floor = parent.snr_regularization_floor;</div>
<div class="line"><span class="lineno">  173</span>    this-&gt;regularization_bandwidth_fraction = parent.regularization_bandwidth_fraction;</div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;3;++i)</div>
<div class="line"><span class="lineno">  175</span>    {</div>
<div class="line"><span class="lineno">  176</span>      this-&gt;peak_snr[i] = parent.peak_snr[i];</div>
<div class="line"><span class="lineno">  177</span>      this-&gt;signal_bandwidth_fraction[i] = parent.signal_bandwidth_fraction[i];</div>
<div class="line"><span class="lineno">  178</span>    }</div>
<div class="line"><span class="lineno">  179</span>  }</div>
<div class="line"><span class="lineno">  180</span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><span class="lineno">  181</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7fbb7b10c3cb9875ee4a088bb7fda002" name="a7fbb7b10c3cb9875ee4a088bb7fda002"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fbb7b10c3cb9875ee4a088bb7fda002">&#9670;&#160;</a></span>process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">Seismogram</a> mspass::algorithms::deconvolution::CNRDeconEngine::process </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_seismogram.html">mspass::seismic::Seismogram</a> &amp;&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmspass_1_1seismic_1_1_power_spectrum.html">mspass::seismic::PowerSpectrum</a> &amp;&#160;</td>
          <td class="paramname"><em>psnoise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>fl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>fh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  505</span>{</div>
<div class="line"><span class="lineno">  506</span>  <span class="keyword">const</span> <span class="keywordtype">string</span> alg(<span class="stringliteral">&quot;CNRDeconEngine::process&quot;</span>);</div>
<div class="line"><span class="lineno">  507</span>  <span class="keywordflow">if</span>(d.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>() || psnoise.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_spectrum.html#a331f89b8216f9717ac906e922d7c2cff">dead</a>())</div>
<div class="line"><span class="lineno">  508</span>  {</div>
<div class="line"><span class="lineno">  509</span>    Seismogram dout(d);</div>
<div class="line"><span class="lineno">  510</span>    dout.set_npts(0);</div>
<div class="line"><span class="lineno">  511</span>    <span class="keywordflow">if</span>(d.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_time_series.html#aa96e795f96b5050996d791f5b6f3867d">dead</a>())</div>
<div class="line"><span class="lineno">  512</span>    {</div>
<div class="line"><span class="lineno">  513</span>      dout.elog.log_error(alg,</div>
<div class="line"><span class="lineno">  514</span>        <span class="stringliteral">&quot;received Seismogram input segment marked dead - cannot process&quot;</span>,</div>
<div class="line"><span class="lineno">  515</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  516</span>    }</div>
<div class="line"><span class="lineno">  517</span>    <span class="keywordflow">if</span>(psnoise.<a class="code hl_function" href="classmspass_1_1seismic_1_1_basic_spectrum.html#a331f89b8216f9717ac906e922d7c2cff">dead</a>())</div>
<div class="line"><span class="lineno">  518</span>    {</div>
<div class="line"><span class="lineno">  519</span>      dout.elog.log_error(alg,</div>
<div class="line"><span class="lineno">  520</span>        <span class="stringliteral">&quot;received PowerSpectrum object marked dead - cannot process&quot;</span>,</div>
<div class="line"><span class="lineno">  521</span>        ErrorSeverity::Invalid);</div>
<div class="line"><span class="lineno">  522</span>    }</div>
<div class="line"><span class="lineno">  523</span>    dout.kill();</div>
<div class="line"><span class="lineno">  524</span>    <span class="keywordflow">return</span> dout;</div>
<div class="line"><span class="lineno">  525</span>  }</div>
<div class="line"><span class="lineno">  526</span>  <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordtype">string</span> base_error(<span class="stringliteral">&quot;CNRDeconEngine::process:  &quot;</span>);</div>
<div class="line"><span class="lineno">  528</span>    this-&gt;update_shaping_wavelet(fl,fh);</div>
<div class="line"><span class="lineno">  529</span>    Seismogram rfest(d);</div>
<div class="line"><span class="lineno">  530</span>    <span class="comment">/* This is used to apply a shift to the fft outputs to put signals</span></div>
<div class="line"><span class="lineno">  531</span><span class="comment">    at relative time 0 */</span></div>
<div class="line"><span class="lineno">  532</span>    <span class="keywordtype">int</span> t0_shift;</div>
<div class="line"><span class="lineno">  533</span>    t0_shift= round((-rfest.t0())/rfest.dt());</div>
<div class="line"><span class="lineno">  534</span>    vector&lt;double&gt; wvec;</div>
<div class="line"><span class="lineno">  535</span>    wvec.reserve(FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  536</span>    <span class="keywordflow">if</span>(rfest.npts()!=FFTDeconOperator::nfft) rfest.u=dmatrix(3,FFTDeconOperator::nfft);</div>
<div class="line"><span class="lineno">  537</span>    <span class="keywordtype">int</span> nhighsnr;</div>
<div class="line"><span class="lineno">  538</span>    <span class="keywordtype">double</span> df;</div>
<div class="line"><span class="lineno">  539</span>    df=1.0/(operator_dt*<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(FFTDeconOperator::nfft));</div>
<div class="line"><span class="lineno">  540</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;3;++k)</div>
<div class="line"><span class="lineno">  541</span>    {</div>
<div class="line"><span class="lineno">  542</span>      TimeSeries work;</div>
<div class="line"><span class="lineno">  543</span>      work=TimeSeries(ExtractComponent(d,k),<span class="stringliteral">&quot;Invalid&quot;</span>);</div>
<div class="line"><span class="lineno">  544</span>      wvec.clear();</div>
<div class="line"><span class="lineno">  545</span>      <span class="keywordtype">int</span> ntocopy=FFTDeconOperator::nfft;</div>
<div class="line"><span class="lineno">  546</span>      <span class="keywordflow">if</span>(ntocopy&gt;work.npts()) ntocopy=work.npts();</div>
<div class="line"><span class="lineno">  547</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;ntocopy;++j) wvec.push_back(work.s[j]);</div>
<div class="line"><span class="lineno">  548</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=ntocopy;j&lt;FFTDeconOperator::nfft;++j)</div>
<div class="line"><span class="lineno">  549</span>                   wvec.push_back(0.0);</div>
<div class="line"><span class="lineno">  550</span> </div>
<div class="line"><span class="lineno">  551</span>      ComplexArray numerator(FFTDeconOperator::nfft,&amp;(wvec[0]));</div>
<div class="line"><span class="lineno">  552</span>      gsl_fft_complex_forward(numerator.ptr(),1,FFTDeconOperator::nfft,</div>
<div class="line"><span class="lineno">  553</span>            wavetable,workspace);</div>
<div class="line"><span class="lineno">  554</span>      <span class="comment">/* This loop computes QCMetrics of bandwidth fraction that</span></div>
<div class="line"><span class="lineno">  555</span><span class="comment">      is above a defined snr floor - not necessarily the same as the</span></div>
<div class="line"><span class="lineno">  556</span><span class="comment">      regularization floor used in computing the inverse */</span></div>
<div class="line"><span class="lineno">  557</span>      <span class="keywordtype">double</span> snrmax;</div>
<div class="line"><span class="lineno">  558</span>      snrmax=1.0;</div>
<div class="line"><span class="lineno">  559</span>      nhighsnr=0;</div>
<div class="line"><span class="lineno">  560</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;FFTDeconOperator::nfft/2;++j)</div>
<div class="line"><span class="lineno">  561</span>      {</div>
<div class="line"><span class="lineno">  562</span>        <span class="keywordtype">double</span> f;</div>
<div class="line"><span class="lineno">  563</span>        f=df*<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(j);</div>
<div class="line"><span class="lineno">  564</span>        Complex64 z=numerator[j];</div>
<div class="line"><span class="lineno">  565</span>        <span class="keywordtype">double</span> sigamp=abs(z);</div>
<div class="line"><span class="lineno">  566</span>        <span class="keywordtype">double</span> namp=sqrt(psnoise.<a class="code hl_function" href="classmspass_1_1seismic_1_1_power_spectrum.html#a3d1e72618b8e88c5929839c5e8885859">power</a>(f));</div>
<div class="line"><span class="lineno">  567</span>        <span class="keywordtype">double</span> snr=sigamp/namp;</div>
<div class="line"><span class="lineno">  568</span> </div>
<div class="line"><span class="lineno">  569</span>        <span class="keywordflow">if</span>(snr &gt; snrmax) snrmax=snr;</div>
<div class="line"><span class="lineno">  570</span>        <span class="keywordflow">if</span>(snr &gt; this-&gt;band_snr_floor) ++nhighsnr;</div>
<div class="line"><span class="lineno">  571</span>      }</div>
<div class="line"><span class="lineno">  572</span>      signal_bandwidth_fraction[k]=<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(nhighsnr)</div>
<div class="line"><span class="lineno">  573</span>                  / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(FFTDeconOperator::nfft/2);</div>
<div class="line"><span class="lineno">  574</span>      peak_snr[k]=snrmax;</div>
<div class="line"><span class="lineno">  575</span>      ComplexArray rftmp=numerator*winv;</div>
<div class="line"><span class="lineno">  576</span>      rftmp=(*this-&gt;shapingwavelet.<a class="code hl_function" href="classmspass_1_1algorithms_1_1deconvolution_1_1_shaping_wavelet.html#ac922b603ff03a691075724bcd53e396f">wavelet</a>())*rftmp;</div>
<div class="line"><span class="lineno">  577</span>      gsl_fft_complex_inverse(rftmp.ptr(), 1, FFTDeconOperator::nfft,</div>
<div class="line"><span class="lineno">  578</span>          wavetable, workspace);</div>
<div class="line"><span class="lineno">  579</span>      wvec.clear();</div>
<div class="line"><span class="lineno">  580</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;FFTDeconOperator::nfft;++j) wvec.push_back(rftmp[j].real());</div>
<div class="line"><span class="lineno">  581</span>      <span class="comment">/* Note we used a time domain shift instead of using a linear phase</span></div>
<div class="line"><span class="lineno">  582</span><span class="comment">      shift in the frequency domain because the time domain operator has a lower</span></div>
<div class="line"><span class="lineno">  583</span><span class="comment">      operation count than the frequency domain algorithm and is thus more</span></div>
<div class="line"><span class="lineno">  584</span><span class="comment">      efficient.*/</span></div>
<div class="line"><span class="lineno">  585</span>      <span class="keywordflow">if</span>(t0_shift!=0)</div>
<div class="line"><span class="lineno">  586</span>        wvec=circular_shift(wvec,-t0_shift);</div>
<div class="line"><span class="lineno">  587</span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;FFTDeconOperator::nfft;++j)rfest.u(k,j)=wvec[j];</div>
<div class="line"><span class="lineno">  588</span>    }</div>
<div class="line"><span class="lineno">  589</span>    <span class="keywordflow">return</span> rfest;</div>
<div class="line"><span class="lineno">  590</span>  }<span class="keywordflow">catch</span>(...){<span class="keywordflow">throw</span>;};</div>
<div class="line"><span class="lineno">  591</span>}</div>
<div class="ttc" id="aclassmspass_1_1seismic_1_1_power_spectrum_html_a3d1e72618b8e88c5929839c5e8885859"><div class="ttname"><a href="classmspass_1_1seismic_1_1_power_spectrum.html#a3d1e72618b8e88c5929839c5e8885859">mspass::seismic::PowerSpectrum::power</a></div><div class="ttdeci">double power(const double f) const</div><div class="ttdoc">power at a given frequency.</div><div class="ttdef"><b>Definition</b> PowerSpectrum.cc:90</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adbaea0375ab6bf31421909243557b21b" name="adbaea0375ab6bf31421909243557b21b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbaea0375ab6bf31421909243557b21b">&#9670;&#160;</a></span>QCMetrics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmspass_1_1utility_1_1_metadata.html">Metadata</a> mspass::algorithms::deconvolution::CNRDeconEngine::QCMetrics </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  754</span>{</div>
<div class="line"><span class="lineno">  755</span>  Metadata result;</div>
<div class="line"><span class="lineno">  756</span>  result.put(<span class="stringliteral">&quot;waveletbf&quot;</span>,this-&gt;regularization_bandwidth_fraction);</div>
<div class="line"><span class="lineno">  757</span>  result.put(<span class="stringliteral">&quot;maxsnr0&quot;</span>,peak_snr[0]);</div>
<div class="line"><span class="lineno">  758</span>  result.put(<span class="stringliteral">&quot;maxsnr1&quot;</span>,peak_snr[1]);</div>
<div class="line"><span class="lineno">  759</span>  result.put(<span class="stringliteral">&quot;maxsnr2&quot;</span>,peak_snr[2]);</div>
<div class="line"><span class="lineno">  760</span>  result.put(<span class="stringliteral">&quot;signalbf0&quot;</span>,signal_bandwidth_fraction[0]);</div>
<div class="line"><span class="lineno">  761</span>  result.put(<span class="stringliteral">&quot;signalbf1&quot;</span>,signal_bandwidth_fraction[1]);</div>
<div class="line"><span class="lineno">  762</span>  result.put(<span class="stringliteral">&quot;signalbf2&quot;</span>,signal_bandwidth_fraction[2]);</div>
<div class="line"><span class="lineno">  763</span>  <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  764</span>}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/runner/work/mspass/mspass/cxx/include/mspass/algorithms/deconvolution/<a class="el" href="_c_n_r_decon_engine_8h_source.html">CNRDeconEngine.h</a></li>
<li>/home/runner/work/mspass/mspass/cxx/src/lib/algorithms/deconvolution/<b>CNRDeconEngine.cc</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
