

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Run MsPASS with Docker &mdash; MsPASS 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=f6245a2f"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MsPASS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Desktop Operation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mspass_desktop.html">Running MsPASS on a Desktop Computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_desktop.html">Command Line Docker Desktop Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_mspass_with_conda.html">Deploy MsPASS with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_setup_considerations.html">Advanced Setup Considerations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cluster Operations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="deploy_mspass_on_HPC.html">Deploying MsPASS on an HPC cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_mspass_with_conda_and_coiled.html">Deploy MsPASS with Conda and Coiled</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_overview.html">MsPASS Virtual Cluster Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/database_concepts.html">Database Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/CRUD_operations.html">CRUD Operations in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/mongodb_and_mspass.html">Using MongoDB with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/normalization.html">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_tabular_data.html">Importing Tabular Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seismic Data Objects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_object_design_concepts.html">Data Object Design Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/numpy_scipy_interface.html">Using numpy/scipy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/obspy_interface.html">Using ObsPy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/time_standard_constraints.html">Time Standard Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/processing_history_concepts.html">Processing History Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/continuous_data.html">Continuous Data Handling with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/schema_choices.html">What database schema should I use?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/handling_errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/data_editing.html">Data Editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/cleaning_metadata.html">Cleaning Inconsistent Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/header_math.html">Header (Metadata) Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/graphics.html">Graphics in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/signal_to_noise.html">Signal to Noise Ratio Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/arrival_time_measurement.html">Arrival Time Measurement Techniques in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/adapting_algorithms.html">Adapting an Existing Algorithm to MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_processing.html">Parallel Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/memory_management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/io.html">I/O in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/parallel_io.html">Parallel IO in MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/FAQ.html">Frequency Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/development_strategies.html">How do I develop a new workflow from scratch?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cxx_api/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mspass_schema/mspass_schema.html">MsPASS Schema</a></li>
</ul>

    <a href= "../genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MsPASS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Run MsPASS with Docker</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/mspass-team/mspass/blob/master/docs/source/getting_started/run_mspass_with_docker.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="run-mspass-with-docker">
<span id="id1"></span><h1>Run MsPASS with Docker<a class="headerlink" href="#run-mspass-with-docker" title="Permalink to this heading"></a></h1>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<p>Docker is required in normal use to run MsPASS on desktop systems.
The alternative is a more complicated installation of the components
built from source as described on
<a class="reference external" href="https://github.com/mspass-team/mspass/wiki/Compiling-MsPASS-from-source-code">this wiki page</a>.
Docker is the piece of software you will use to run and manage
any containers on your desktop system.</p>
<p>Docker is well-supported on all current desktop operating systems and
has simple install procedures described in detail in the
product’s documentation found <a class="reference external" href="https://docs.docker.com/get-docker/">here</a>
The software can currently be downloaded at no cost, but you must have
administrative privileges to install the software.
The remainder of this page assumes you have successfully installed
docker.  For Windows or Apple user’s it may be convenient to launch the
“docker desktop” as an alternative to command line tools.</p>
</section>
<section id="download-mspass-container">
<h2>Download MsPASS Container<a class="headerlink" href="#download-mspass-container" title="Permalink to this heading"></a></h2>
<p>The MsPASS container image is built and hosted on <a class="reference external" href="https://hub.docker.com/r/mspass/mspass">Docker Hub</a>.
It is also available in the <a class="reference external" href="https://github.com/mspass-team/mspass/pkgs/container/mspass">GitHub Container Registry</a>.
Once you have docker setup properly, use the following command in a terminal
to download the MsPASS image from Docker Hub to your local machine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">mspass</span><span class="o">/</span><span class="n">mspass</span>
</pre></div>
</div>
<p>Be patient the first time you issue this command for your systems
as this can take a few minutes depending on your internet speed.
Note you can run this command from anywhere and the files are stored in
a system directory (folder) whose location depends upon the host
operating system.   Be aware that the MsPASS container will consume of the order of
500 Mb of disk space on your system disk so you should be sure you are not
pushing the limits of your system disk.
When you pull the container docker loads data only in a
system dependent data space so you will not see anything happen
in the directory where you run this command.  The recommended way to
manage disk usage is through docker desktop or docker command line
tools.   See docker’s documentation for information now how to do that.</p>
<p>It can be confusing to understand where data is stored in a containerized environment
because file paths are always mapped from local file path names to
container file names.  They are usually different.
In the discussion below files names we reference that reside inside a container will be set in italics.
File names on the physical system will be referred to with a normal font text.</p>
</section>
<section id="run-mspass-container-in-all-in-one-mode">
<h2>Run MsPASS Container in All-in-one Mode<a class="headerlink" href="#run-mspass-container-in-all-in-one-mode" title="Permalink to this heading"></a></h2>
<p>Most MsPASS processing on a desktop begins by running a variant of the
following on the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8888</span><span class="p">:</span><span class="mi">8888</span> <span class="o">--</span><span class="n">mount</span> <span class="n">src</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">myusername</span><span class="o">/</span><span class="n">myproject</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">home</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="n">bind</span> <span class="n">mspass</span><span class="o">/</span><span class="n">mspass</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">8888:8888</span></code> argument maps port <code class="docutils literal notranslate"><span class="pre">8888</span></code> on your system to the container’s <code class="docutils literal notranslate"><span class="pre">8888</span></code> port.
That pair of arguments are needed to allow your local web browser to
connect to the Juypter notebook server running in the container.
<code class="docutils literal notranslate"><span class="pre">8888</span></code> is the default port for the Jupyter Notebook frontend.
If there are collisions with <code class="docutils literal notranslate"><span class="pre">8888</span></code> port on your system (uncommon),
change the first number
to “map” the local system port number to <code class="docutils literal notranslate"><span class="pre">8888</span></code> in the container.
For example,  if you use <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">9999:8888</span></code> the URL you use to connect to the
Jupyter notebook would need to be altered to use <code class="docutils literal notranslate"><span class="pre">9999</span></code> as the port number</p>
<p>The lengthy incantation in the argument following the  <code class="docutils literal notranslate"><span class="pre">--mount</span></code>
argument is used to “map” a local file system path to a
defined mount point in the container.
In this example the local system directory, “/Users/myusername/myproject”,
will be mapped to the directry called <em>/home</em> in the container.
<em>/home</em> is a standard mount point
directory on the unix system the container runs.
An standard alternative is <em>/mnt</em>, but most people prefer
<em>/home</em> as the name makes more sense.
That mapping is necessary
to save your results to your local system.   Without the
<code class="docutils literal notranslate"><span class="pre">--mount</span></code> incantation any results
you produce in a run will disappear when the container exits.</p>
<p>A useful, alternative way to launch docker on a linux or MacOS system
is to use the shell <code class="docutils literal notranslate"><span class="pre">cd</span></code> command in the terminal you are using to make
your project directory the “current directory”.   Then you can
cut-and-paste the following variation of the above into that terminal
window and <em>/home</em> in the container will be mapped to your
“current directory”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -p 8888:8888 --mount src=`pwd`,target=/home,type=bind mspass/mspass
</pre></div>
</div>
<p>When the container boots it splashes a bunch of text to the terminal from
which it was launched announcing successful lauching of
required MsPAS components.
The last part of the output will look something
like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[I 11:02:38.655 NotebookApp] Serving notebooks from local directory: /home
[I 11:02:38.655 NotebookApp] Jupyter Notebook 6.2.0 is running at:
[I 11:02:38.655 NotebookApp] http://7b408535513f:8888/?token=ced2d40475df024c3544e7bd4aa0ea4676e0c88ae85be7db
[I 11:02:38.656 NotebookApp]  or http://127.0.0.1:8888/?token=ced2d40475df024c3544e7bd4aa0ea4676e0c88ae85be7db
[I 11:02:38.656 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
[C 11:02:38.673 NotebookApp]

    To access the notebook, open this file in a browser:
        file:///root/.local/share/jupyter/runtime/nbserver-57-open.html
    Or copy and paste one of these URLs:
        http://7b408535513f:8888/?token=ced2d40475df024c3544e7bd4aa0ea4676e0c88ae85be7db
     or http://127.0.0.1:8888/?token=ced2d40475df024c3544e7bd4aa0ea4676e0c88ae85be7db
</pre></div>
</div>
<p>Use the standard cut-and-paste operation to paste the URL beginning with <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8888</span></code>
to your favorite web browser (Note if you need to use port mapping, which is
not common, you would need to change the 8888 to the mapped value - 9999 in the
example above.).   That URL should resolve and a Jupyter notebook home page
should come up in the browser.
This page assumes you know where to go from here.
If you are not familiar with Jupyter Notebook, refer to the
<a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/stable/ui_components.html">documentation found here</a> .</p>
<p>The root directory of the notebook contains three different directories, <em>db</em>, <em>logs</em>, and <em>work</em>,
that will have been created in your working directory the first time you launch
the mspass container in that directory.
<em>db</em> contains MongoDB’s database files.
<em>logs</em> contains the logs generated by the database, the scheduler, and the worker.
<em>work</em> is a local scratch space used by dask/spark.
Other files in your project data should also show up in the file browser.
(Note if you do not use the <code class="docutils literal notranslate"><span class="pre">--mount</span></code> option everything shown on the home
page will disappear when the contaienr is exited.  The default is what it
is because the majority of “dockerized” applications are run as background
processes and that approach makes cleanup automatic. That mode is
rarely useful on a desktop use with MsPASS.)
Normal use at this point is to open an existing notebook to be run
(double-click the notebook’s file name) or create one with the <cite>New</cite> button
on the notebook home page.</p>
<p>A final point worth noting is that it is often useful when working
interactively with mspass on a desktop to open a “Terminal” in the
container.  The <cite>New</cite> button has a <cite>Terminal</cite> item in addition to the
<cite>Python 3</cite> button that is used to create a new notebook.  If you select
<cite>Terminal</cite> you will get a black web browser window (usually a tab on any
newer browser) with the cryptic <code class="docutils literal notranslate"><span class="pre">#</span></code> prompt of the default Bourne shell.
Most users will want to immediately launch a <code class="docutils literal notranslate"><span class="pre">bash</span></code> (Note we do not currently
have any other advanced shell commands in the mspass container.) shell
instead of the more primitive sh. i.e. we recommend you type <code class="docutils literal notranslate"><span class="pre">bash</span></code> in the
new terminal window as it gives you things like line editing not available with
the old-school Bourne shell.   Be warned that with docker you are running as
root in the container.   You can thus run sysadmin commands.  That can be
useful, but it is a sharp knife that can cut you.   Be sure you know what
you are doing before you alter any files with bash commands in this
terminal.   A more standard use is to run common monitoring commands like
<code class="docutils literal notranslate"><span class="pre">top</span></code> to monitor memory and cpu usage by the container.</p>
<p>If you are using dask on a desktop, we have found many algorithms perform
badly because of a subtle issue with python and threads.   That is, by
default dask uses a “thread pool” for workers with the number of threads
equal to the number of cores defined for the docker container.
Threading with python is subject to poor performance because of
something called the Global Interpreter Lock (GIL) that causes multithread
python functions to not run in parallel at all with dask.  The solution
is to tell dask to run each worker task as a “process” not a thread.
(Note pyspark does this by default.)  A way to do that with dask is to
launch docker with the following variant of above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -p 8888:8888 -e MSPASS_WORKER_ARG=&quot;--nworkers 4 --nthreads 1&quot; --mount src=`pwd`,target=/home,type=bind mspass/mspass
</pre></div>
</div>
<p>where the value after <cite>–nworkers</cite> should be the number of worker tasks
you want to have the container run.   Normally that would be the number of
cores defined for the container which be default is less than the number of
cores for the machine running docker.</p>
<p>Finally, to exit close any notebook windows and the Jupyter notebook
home page.   You will usually need to type a <cite>ctrl-C</cite> in the terminal
window you used to launch mpass via docker.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Ian Wang.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>