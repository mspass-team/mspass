<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mspasspy.algorithms.edit &mdash; MsPASS 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=f6245a2f"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />  

  <style>
    .wy-nav-content { max-width: 1600px; }
  </style>

  
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            MsPASS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/run_mspass_with_docker.html">Run MsPASS with Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/deploy_mspass_with_docker_compose.html">Deploy MsPASS with Docker Compose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/deploy_mspass_on_HPC.html">Deploying MsPASS on an HPC cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started_overview.html">MsPASS Virtual Cluster Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/database_concepts.html">Database Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/CRUD_operations.html">CRUD Operations in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/mongodb_and_mspass.html">Using MongoDB with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/normalization.html">Normalization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Seismic Data Objects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/data_object_design_concepts.html">Data Object Design Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/numpy_scipy_interface.html">Using numpy/scipy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/obspy_interface.html">Using ObsPy with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/time_standard_constraints.html">Time Standard Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/processing_history_concepts.html">Processing History Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/continuous_data.html">Continuous Data Handling with MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/schema_choices.html">What database schema should I use?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/importing_data.html">Importing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/handling_errors.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/data_editing.html">Data Editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/header_math.html">Header (Metadata) Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/graphics.html">Graphics in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/signal_to_noise.html">Signal to Noise Ratio Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/adapting_algorithms.html">Adapting an Existing Algorithm to MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">System Tuning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/parallel_processing.html">Parallel Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/memory_management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/io.html">I/O in MsPASS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/parallel_io.html">Parallel IO in MsPASS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/FAQ.html">Frequency Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user_manual/development_strategies.html">How do I develop a new workflow from scratch?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python_api/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cxx_api/index.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mspass_schema/mspass_schema.html">MsPASS Schema</a></li>
</ul>

    <a href= "../../../genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MsPASS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">mspasspy.algorithms.edit</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mspasspy.algorithms.edit</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">mspasspy.ccore.seismic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TimeSeries</span><span class="p">,</span>
    <span class="n">Seismogram</span><span class="p">,</span>
    <span class="n">TimeSeriesEnsemble</span><span class="p">,</span>
    <span class="n">SeismogramEnsemble</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">mspasspy.ccore.utility</span> <span class="kn">import</span> <span class="n">MsPASSError</span><span class="p">,</span> <span class="n">ErrorSeverity</span>
<span class="kn">from</span> <span class="nn">mspasspy.util.decorators</span> <span class="kn">import</span> <span class="n">mspass_method_wrapper</span>

<span class="c1"># These internals are used throughout this module to reduce redundnacy</span>
<span class="c1"># in the code base.  I&#39;m putting them here because it will be less confusing</span>
<span class="c1"># to a reader where they come from - a common alternative is to put them</span>
<span class="c1"># at the end of the file on interwoven</span>


<span class="k">def</span> <span class="nf">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This internal function standardizes the test to certify the</span>
<span class="sd">    input datum, d, is or is not a valid MsPASS data object.   Putting it</span>
<span class="sd">    in one place makes extending the code base for other data types much</span>
<span class="sd">    easier.  It uses an isinstance tests of d to standardize the test that</span>
<span class="sd">    the input is valid data.  It returns True if d is one a valid data</span>
<span class="sd">    object known to mspass.  Returns false it not.  Caller must decide</span>
<span class="sd">    what to do if the function returns false.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">TimeSeries</span><span class="p">,</span> <span class="n">Seismogram</span><span class="p">,</span> <span class="n">TimeSeriesEnsemble</span><span class="p">,</span> <span class="n">SeismogramEnsemble</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Standardized (simple) test if the data are an ensemble.  Returns true if d is</span>
<span class="sd">    an ensemble.  false otherwise.   Will yield a potentially misleading</span>
<span class="sd">    False if d is anything but one of the MsPASS ensemble objects.</span>
<span class="sd">    e.g. if d is something like a string it will correctly be returned</span>
<span class="sd">    as False, but what happens next depends on the algorithm.  Best practice</span>
<span class="sd">    should be to precede a call to this function with a call to _input_is_valid</span>
<span class="sd">    and trap data that is not a MsPASS data object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">TimeSeriesEnsemble</span><span class="p">,</span> <span class="n">SeismogramEnsemble</span><span class="p">))</span>


<span class="c1"># Use of abstract base class based on:</span>
<span class="c1"># https://python-course.eu/oop/the-abc-of-abstract-base-classes.php</span>


<div class="viewcode-block" id="Executioner"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Executioner">[docs]</a><span class="k">class</span> <span class="nc">Executioner</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for family of python classes used for killing</span>
<span class="sd">    mspass data objects failing to pass a particular metric.</span>
<span class="sd">    It is made abstract to define required methods a particular instance</span>
<span class="sd">    must create.  As in any good OOP that also means subclasses can</span>
<span class="sd">    add additional methods.   This class should be used only as base</span>
<span class="sd">    class as it has no functionality by itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method can make the object callable and easier to use.</span>
<span class="sd">        After an instance is iniated, instead of explicitly calling</span>
<span class="sd">        kill_if_true, one can just call this object.</span>
<span class="sd">        For example, instead of:</span>
<span class="sd">        int_tester.kill_if_true(enscpy, apply_to_members=True)</span>
<span class="sd">        We can just call this:</span>
<span class="sd">        int_tester(enscpy, apply_to_members=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill_if_true</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

<div class="viewcode-block" id="Executioner.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Executioner.kill_if_true">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method should run a test on d that will call the kill method</span>
<span class="sd">        on MsPASS atomic object d if the test defined by the implementation</span>
<span class="sd">        fails.  This is the main working method of this class of function</span>
<span class="sd">        objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Executioner.edit_ensemble_members"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Executioner.edit_ensemble_members">[docs]</a>    <span class="k">def</span> <span class="nf">edit_ensemble_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses should call this method if the input data are an</span>
<span class="sd">        ensemble.   A trick of inheritance allows the algorithm of self</span>
<span class="sd">        to then be applied to whole ensemble.  Putting this in the</span>
<span class="sd">        base class avoids the duplication of duplicate code in all</span>
<span class="sd">        subclasses.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">live</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">member</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kill_if_true</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ensemble</span></div>

<div class="viewcode-block" id="Executioner.log_kill"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Executioner.log_kill">[docs]</a>    <span class="k">def</span> <span class="nf">log_kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">testname</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Informational</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This base class method is used to standardize the error logging</span>
<span class="sd">        functionality of all Executioners.   It writes a standardized</span>
<span class="sd">        message to simplify writing of subclasses - they need only</span>
<span class="sd">        define the testname (normally the name of the subclass) and</span>
<span class="sd">        format a specific message to be posted.</span>

<span class="sd">        Note most subclasses will may want to include a verbose option</span>
<span class="sd">        (or the reciprocal silent) and only write log messages when</span>
<span class="sd">        verbose is set true.</span>

<span class="sd">        :param d:  MsPASS data object to which elog message is to be</span>
<span class="sd">          written.</span>
<span class="sd">        :param testname: is the string assigned to the &quot;algorithm&quot; field</span>
<span class="sd">        of the message posted to d.elog.</span>
<span class="sd">        :param message:  specialized message to post - this string is added</span>
<span class="sd">        to an internal generic message.</span>
<span class="sd">        :param severity:  ErrorSeverity to assign to elog message</span>
<span class="sd">        (See ErrorLogger docstring).  Default is Informational</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">kill_message</span> <span class="o">=</span> <span class="s2">&quot;Killed by kill_if_true method.  Reason:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">kill_message</span> <span class="o">+=</span> <span class="n">message</span>
            <span class="n">d</span><span class="o">.</span><span class="n">elog</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="n">testname</span><span class="p">,</span> <span class="n">kill_message</span><span class="p">,</span> <span class="n">severity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Execution.log_kill method received invalid data;  must be a MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="MetadataGT"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataGT">[docs]</a><span class="k">class</span> <span class="nc">MetadataGT</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using a greater than test of a</span>
<span class="sd">    Metadata attribute.  Both the metadata key and the threshold</span>
<span class="sd">    for the kill test are set on creation.  This implementation should</span>
<span class="sd">    work on any value pairs for which the &gt; operator in python works.</span>
<span class="sd">    That is true for pairs of numeric types, for example, but will fail</span>
<span class="sd">    if one of the pair is a string (an error anyway for any rational use of this).</span>
<span class="sd">    It should also work for any pair of pyobjects for which operator &gt; is defined,</span>
<span class="sd">    although anything nonstandard should be tested carefully before using</span>
<span class="sd">    this class for editing data with such nonstandard types.  This was</span>
<span class="sd">    mostly intended for simple numeric attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param value:  is the threshold value for the test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataGT.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataGT.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] &gt; value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="c1"># because we don&#39;t have an else this logic will silently</span>
                <span class="c1"># do nothing if key is not defined</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">testval</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> is greater than test value=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataGT&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataGT received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataGE"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataGE">[docs]</a><span class="k">class</span> <span class="nc">MetadataGE</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using a greater than or equal test of a</span>
<span class="sd">    Metadata attribute.  Both the metadata key and the threshold</span>
<span class="sd">    for the kill test are set on creation.  This implementation should</span>
<span class="sd">    work on any value pairs for which the &gt;= operator in python works.</span>
<span class="sd">    That is true for pairs of numeric types, for example, but will fail</span>
<span class="sd">    if one of the pair is a string (an error anyway for any rational use of this).</span>
<span class="sd">    It should also work for any pair of pyobjects for which operator &gt;= is defined,</span>
<span class="sd">    although anything nonstandard should be tested carefully before using</span>
<span class="sd">    this class for editing data with such nonstandard types.  This was</span>
<span class="sd">    mostly intended for simple numeric attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param value:  is the threshold value for the test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataGE.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataGE.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] &gt;= value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">testval</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> is &gt;= test value=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataGE&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataGE received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataLT"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataLT">[docs]</a><span class="k">class</span> <span class="nc">MetadataLT</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using a lessthan test of a</span>
<span class="sd">    Metadata attribute.  Both the metadata key and the threshold</span>
<span class="sd">    for the kill test are set on creation.  This implementation should</span>
<span class="sd">    work on any value pairs for which the &lt; operator in python works.</span>
<span class="sd">    That is true for pairs of numeric types, for example, but will fail</span>
<span class="sd">    if one of the pair is a string (an error anyway for any rational use of this).</span>
<span class="sd">    It should also work for any pair of pyobjects for which operator &lt; is defined,</span>
<span class="sd">    although anything nonstandard should be tested carefully before using</span>
<span class="sd">    this class for editing data with such nonstandard types.  This was</span>
<span class="sd">    mostly intended for simple numeric attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param value:  is the threshold value for the test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataLT.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataLT.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] &gt; value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">testval</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> is &lt; than test value=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataLT&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataLT received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataLE"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataLE">[docs]</a><span class="k">class</span> <span class="nc">MetadataLE</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using a less than or equal test of a</span>
<span class="sd">    Metadata attribute.  Both the metadata key and the threshold</span>
<span class="sd">    for the kill test are set on creation.  This implementation should</span>
<span class="sd">    work on any value pairs for which the &lt;= operator in python works.</span>
<span class="sd">    That is true for pairs of numeric types, for example, but will fail</span>
<span class="sd">    if one of the pair is a string (an error anyway for any rational use of this).</span>
<span class="sd">    It should also work for any pair of pyobjects for which operator &gt;= is defined,</span>
<span class="sd">    although anything nonstandard should be tested carefully before using</span>
<span class="sd">    this class for editing data with such nonstandard types.  This was</span>
<span class="sd">    mostly intended for simple numeric attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param value:  is the threshold value for the test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataLE.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataLE.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] &lt;= value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">testval</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> is &lt;= to test value=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataLT&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataLE received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataEQ"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataEQ">[docs]</a><span class="k">class</span> <span class="nc">MetadataEQ</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using an equality test of a</span>
<span class="sd">    Metadata attribute.  Both the metadata key and the threshold</span>
<span class="sd">    for the kill test are set on creation.  This implementation should</span>
<span class="sd">    work on any value pairs for which the == operator in python works.</span>
<span class="sd">    That is true for pairs of numeric types, for example, but will fail</span>
<span class="sd">    if one of the pair is a string (an error anyway for any rational use of this).</span>
<span class="sd">    It should also work for any pair of pyobjects for which operator &gt;= is defined,</span>
<span class="sd">    although anything nonstandard should be tested carefully before using</span>
<span class="sd">    this class for editing data with such nonstandard types.  This was</span>
<span class="sd">    mostly intended for simple numeric attributes.  It can be used for</span>
<span class="sd">    booleans even though few would write an if statement testing if two</span>
<span class="sd">    booleans were equal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param value:  is the threshold value for the test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataEQ.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataEQ.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] == value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">testval</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> is equal to test value=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataEQ&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataEQ received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataNE"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataNE">[docs]</a><span class="k">class</span> <span class="nc">MetadataNE</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using an not equal (NE) test of a</span>
<span class="sd">    Metadata attribute.  Both the metadata key and the threshold</span>
<span class="sd">    for the kill test are set on creation.  This implementation should</span>
<span class="sd">    work on any value pairs for which the != operator in python works.</span>
<span class="sd">    That is true for pairs of numeric types, for example, but will fail</span>
<span class="sd">    if one of the pair is a string (an error anyway for any rational use of this).</span>
<span class="sd">    It should also work for any pair of pyobjects for which operator &gt;= is defined,</span>
<span class="sd">    although anything nonstandard should be tested carefully before using</span>
<span class="sd">    this class for editing data with such nonstandard types.  This was</span>
<span class="sd">    mostly intended for simple numeric attributes.  It can be used for</span>
<span class="sd">    booleans even though few would write an if statement testing if two</span>
<span class="sd">    booleans were equal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param value:  is the threshold value for the test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataNE.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataNE.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] != value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">testval</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> is != to test value=</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataNE&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataNE received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataDefined"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataDefined">[docs]</a><span class="k">class</span> <span class="nc">MetadataDefined</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using an existence test.  The</span>
<span class="sd">    constructor loads only a key string.   The test for the kill_if_true</span>
<span class="sd">    method is then simply for the existence of a value associated with</span>
<span class="sd">    the loaded key.   Data will be killed if the defined key exists</span>
<span class="sd">    in the Metadata (header).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the key used for the existence test.</span>

<span class="sd">        :param key:  key used for existence test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataDefined.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataDefined.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if self.key is defined for this datum</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
                <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Metadata key=</span><span class="si">{key}</span><span class="s2"> is defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataDefined&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataDefined received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataUndefined"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataUndefined">[docs]</a><span class="k">class</span> <span class="nc">MetadataUndefined</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner using an nonexistence test.  The</span>
<span class="sd">    constructor loads only a key string.   The test for the kill_if_true</span>
<span class="sd">    method is then simply for the existence of a value associated with</span>
<span class="sd">    the loaded key.   Data will be killed if the defined key does not exists</span>
<span class="sd">    (Undefined) in the Metadata (header).</span>

<span class="sd">    This class is a useful prefilter to apply to any algorithm that</span>
<span class="sd">    requires a particular metadata attribute.  Use FiringSquad to define</span>
<span class="sd">    a chain of required metadata to prefilter data input to such an algorithm.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the key used for the existence test.</span>

<span class="sd">        :param key:  key used for existence test.</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataUndefined.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataUndefined.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if self.key is not defined for this datum</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
                <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Metadata key=</span><span class="si">{key}</span><span class="s2"> is not defined&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataUndefined&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataUndefined received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetadataInterval"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataInterval">[docs]</a><span class="k">class</span> <span class="nc">MetadataInterval</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of Executioner based on a numeric range of values.</span>
<span class="sd">    i.e. it tests if a metadata value is in a range defined by</span>
<span class="sd">    an upper and lower value.   Ranges have a minor complication in</span>
<span class="sd">    handling the edge condition: should or should the test not include</span>
<span class="sd">    the edge?   Rather than write different functions for the four possible</span>
<span class="sd">    combinations of &lt;=, &lt;, &gt;=, and &gt; that define a range we use</span>
<span class="sd">    constructor arguments (use_lower_edge and use_upper_edge) to</span>
<span class="sd">    turn inclusion of the boundary on and off.</span>

<span class="sd">    In this context an interval test also has two logical alternatives.</span>
<span class="sd">    One may want to keep data inside an interval (most common and default)</span>
<span class="sd">    or delete data within a specified interval.   That logic is controlled by</span>
<span class="sd">    the kill_if_outside boolean</span>

<span class="sd">    Intervals mostly make sense only for numeric types (int and float), but</span>
<span class="sd">    can be used with strings.  In reality this function should work with any</span>
<span class="sd">    object for which the operators &gt;, &lt;, &gt;=, and &gt;= are defined but that is</span>
<span class="sd">    adventure land if you try.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">,</span>
        <span class="n">lower_endpoint</span><span class="p">,</span>
        <span class="n">upper_endpoint</span><span class="p">,</span>
        <span class="n">use_lower_edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_upper_edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">kill_if_outside</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  Sets the parameters that define this</span>
<span class="sd">        tester.</span>

<span class="sd">        :param key:  key used for extracting a Metadata component for test</span>
<span class="sd">        :param lower_endpoint:  value defining the lower bound of the range test</span>
<span class="sd">        :param upper_endpoint:  value defining the upper_bound of the range test</span>
<span class="sd">        :parame use_lower_edge: if true (default) the lower range test uses</span>
<span class="sd">          &gt;= lower_endpoint.  When false uses &gt;.</span>
<span class="sd">        :param use_upper_edge: if true (default) the upper range test uses</span>
<span class="sd">          &lt;= uper_endpoint.  When false uses &lt;.</span>
<span class="sd">        :param kill_if_outside:  boolean controlling logic of how test test</span>
<span class="sd">          is applied.  When true (default) data are killed when data are outside the</span>
<span class="sd">          specified range.  When false data are killed that are inside the</span>
<span class="sd">          specified range.  The default is True because that type of</span>
<span class="sd">          test is much more common than the opposite.  (e.g. retain source-receiver</span>
<span class="sd">          distances within specified range)</span>
<span class="sd">        :param verbose:  if true informational messages will be posted to</span>
<span class="sd">        the elog area of d.  When false (default) kills are silent.  That</span>
<span class="sd">        default is intentioanl to reduce the size of elog data in large data</span>
<span class="sd">        sets that often require extensive editing.  Set true if you need</span>
<span class="sd">        details on why data were killed or for debugging.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower_endpoint</span> <span class="o">=</span> <span class="n">lower_endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_endpoint</span> <span class="o">=</span> <span class="n">upper_endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_lower_edge</span> <span class="o">=</span> <span class="n">use_lower_edge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_upper_edge</span> <span class="o">=</span> <span class="n">use_upper_edge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kill_if_outside</span> <span class="o">=</span> <span class="n">kill_if_outside</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="MetadataInterval.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataInterval.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of this abstract method for this tester.</span>
<span class="sd">        Kills d if the d[self.key] &lt;= value stored with the class.</span>

<span class="sd">        Returns a (potentially edited) copy of the input to allow use in</span>
<span class="sd">        a parallel map operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                <span class="c1"># These two are used to defined boolean result of lower</span>
                <span class="c1"># and upper tests. Truth of result is and of the two</span>
                <span class="c1"># inverting the test (inside_test false) inverts the logic (not)</span>
                <span class="n">upper_range_test</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">lower_range_test</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_lower_edge</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">testval</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_endpoint</span><span class="p">:</span>
                        <span class="n">lower_range_test</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lower_range_test</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">testval</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_endpoint</span><span class="p">:</span>
                        <span class="n">lower_range_test</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lower_range_test</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_upper_edge</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">testval</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_endpoint</span><span class="p">:</span>
                        <span class="n">upper_range_test</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">upper_range_test</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">testval</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_endpoint</span><span class="p">:</span>
                        <span class="n">upper_range_test</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">upper_range_test</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">death_sentence</span> <span class="o">=</span> <span class="n">lower_range_test</span> <span class="ow">and</span> <span class="n">upper_range_test</span>
                <span class="c1"># double negatives are a bit weird here but the logic</span>
                <span class="c1"># requires the logic be inverted if testing outside the</span>
                <span class="c1"># defined interval</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kill_if_outside</span><span class="p">:</span>
                    <span class="n">death_sentence</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">death_sentence</span>

                <span class="k">if</span> <span class="n">death_sentence</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="n">message1</span> <span class="o">=</span> <span class="s2">&quot;Value associated with key=</span><span class="si">{key}</span><span class="s2"> of </span><span class="si">{dval}</span><span class="s2"> failed range test</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">dval</span><span class="o">=</span><span class="n">testval</span>
                        <span class="p">)</span>
                        <span class="n">message2</span> <span class="o">=</span> <span class="s2">&quot;Interval range is </span><span class="si">{lower}</span><span class="s2"> to </span><span class="si">{upper}</span><span class="s2">.  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">lower</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lower_endpoint</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">upper_endpoint</span>
                        <span class="p">)</span>
                        <span class="n">message3</span> <span class="o">=</span> <span class="s2">&quot;Test booleans:  lowerEQ=</span><span class="si">{lower}</span><span class="s2">, upperEQ=</span><span class="si">{upper}</span><span class="s2">, kill_inside=</span><span class="si">{inside}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">lower</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_lower_edge</span><span class="p">,</span>
                            <span class="n">upper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_upper_edge</span><span class="p">,</span>
                            <span class="n">inside</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kill_if_outside</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_kill</span><span class="p">(</span>
                            <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;MetadataInterval&quot;</span><span class="p">,</span> <span class="n">message1</span> <span class="o">+</span> <span class="n">message2</span> <span class="o">+</span> <span class="n">message3</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataInterval received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="FiringSquad"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.FiringSquad">[docs]</a><span class="k">class</span> <span class="nc">FiringSquad</span><span class="p">(</span><span class="n">Executioner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to apply multiple Executioners in a single pass - hence the name</span>
<span class="sd">    FiringSquare image; facing more than one thing that could kill you.</span>
<span class="sd">    The implementation in kill_if_true iterates through a list of</span>
<span class="sd">    Executioners.  Once the datum is killed it is immediately returned.</span>
<span class="sd">    If the Executions are running in verbose mode that means some tests</span>
<span class="sd">    can shadow others.   It is like a firing squad where the guns are fired</span>
<span class="sd">    in sequence and the body is removed as soon as there is a hit.  The</span>
<span class="sd">    victim walks away only if all the guns miss.</span>

<span class="sd">    Note the class has a += operator to allow appending additional</span>
<span class="sd">    tests to the chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">executioner_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  executioner_list does not literally</span>
<span class="sd">        have to be a list container.  It can be any container that is iterable so</span>
<span class="sd">        a list, tuple, or array can be used.   Internally the contents</span>
<span class="sd">        are copied to a python list container so this the contents of</span>
<span class="sd">        executioner_list are treated as immutable.</span>

<span class="sd">        The constructor will throw a MsPASSError exception if any of the</span>
<span class="sd">        contents of executioner_list is not a child of the</span>
<span class="sd">        Executioner class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">executioner_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">Executioner</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                    <span class="s2">&quot;FiringSquad constructor:  invalid input.  Expected array of Executioners&quot;</span><span class="p">,</span>
                    <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># to allow flexibility of the structure used for input we should</span>
        <span class="c1"># copy the executioner_list.  Further, this assure the</span>
        <span class="c1"># result will iterate correctly and allow for append</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executioners</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">executioner_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">executioners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

<div class="viewcode-block" id="FiringSquad.kill_if_true"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.FiringSquad.kill_if_true">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">kill_if_true</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of base class method.  In this case failure is</span>
<span class="sd">        defined as not passing one of the set of tests loaded  when</span>
<span class="sd">        the object was created.  As noted earlier the tests are performed</span>
<span class="sd">        in the same order they were passed to the constructor of added on</span>
<span class="sd">        with the += operator.</span>
<span class="sd">        :param d: is a mspass data object to be checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">killer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">executioners</span><span class="p">:</span>
                    <span class="n">killer</span><span class="o">.</span><span class="n">kill_if_true</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="n">apply_to_members</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;FiringSquad received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the += operator for the class. In that case it means a new</span>
<span class="sd">        test is appended.   Raises a MsPASSError set Fatal other is not a</span>
<span class="sd">        subclass of Executioner.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Executioner</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">executioners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;FiringSquare operator +=  rhs is not an Executioner&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="c1"># Start base class and subclasses for header math operators</span>


<div class="viewcode-block" id="MetadataOperator"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperator">[docs]</a><span class="k">class</span> <span class="nc">MetadataOperator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for a set of inline Metadata editors. That is, there</span>
<span class="sd">    are many instances where Metadata attributes need to be altered</span>
<span class="sd">    during a workflow where it is either unnecessary or inappropriate</span>
<span class="sd">    to access the database.   e.g. we have found updates in MongoDB</span>
<span class="sd">    can be very slow if done one transaction at a time so it can</span>
<span class="sd">    streamline processing to edit metadata on the fly.   This base</span>
<span class="sd">    class defines the API for a suite of tools for editing metadata</span>
<span class="sd">    on the fly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetadataOperator.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperator.apply">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementations are required to implement this method.  It must</span>
<span class="sd">        accept a MsPASS data object, d, (TimeSeries, Seismogram, TimeSeriesEnsemble,</span>
<span class="sd">        or SeimogramEnsemble) and apply the operator the implementation defines</span>
<span class="sd">        to the Metadata of d.   It should throw a MsPASSError exception if</span>
<span class="sd">        d is not one of the expected data types.  It should, on the other</span>
<span class="sd">        hand, handle d==None gracefully and do nothing if d is None.</span>
<span class="sd">        Ensemble handlers need to deal with an ambiguity in which metadata</span>
<span class="sd">        the operation refers to.  Both the overall ensemble container and</span>
<span class="sd">        individual members have (normally independent) Metadata containers.</span>
<span class="sd">        Implementations of this method should have a apply_to_members</span>
<span class="sd">        argument as in the signature for this base class.   When True</span>
<span class="sd">        the editing is done by a loop over all members while if</span>
<span class="sd">        False (which should be the default) the ensemble&#39;s container</span>
<span class="sd">        should be used.</span>

<span class="sd">        This method must return an (potentially but not guarnateed) edited</span>
<span class="sd">        version of d.  That is essential to allow this method to be used</span>
<span class="sd">        as the function in a parallel map operator.</span>

<span class="sd">        If a required metadata key is missing this method should do nothing</span>
<span class="sd">        unless a verbose flag is set.  In that case it should log that as</span>
<span class="sd">        an error.   Best practice for any use of operators based on this</span>
<span class="sd">        base class is to apply a kill operator for (MetadataDefined) on</span>
<span class="sd">        all data before running a calculator.    That way you can guarantee</span>
<span class="sd">        the data needed for all operations is valid before trying to</span>
<span class="sd">        do calculations on on required metadata.   There is some overhead</span>
<span class="sd">        in validating metadata so all implementations should include</span>
<span class="sd">        use of &quot;fast_mode&quot;.  When set true the safeties will be bypassed</span>
<span class="sd">        for speed.  That includes at least the two requried methods</span>
<span class="sd">        &quot;check_keys&quot; and &quot;check_operation&quot;.  Implementations may add</span>
<span class="sd">        other safties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MetadataOperator.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperator.check_keys">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All implementation should implement this checker even if all it contains</span>
<span class="sd">        is a pass.  It should validate the keys are defined in data to be</span>
<span class="sd">        handled in the apply method.   An early call in apply should always</span>
<span class="sd">        be to call this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MetadataOperator.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperator.check_operation">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All implementations should implement this method even if they choose</span>
<span class="sd">        to ignore it.   It should be used to guarantee the operator the class</span>
<span class="sd">        defines will succeed on the datum sent to the apply method.</span>
<span class="sd">        e.g. any standard arithmetic operations will throw a TypeError if</span>
<span class="sd">        one of the operands is a string.   This method should be used to</span>
<span class="sd">        make the operator as bombproof as possible logging a message</span>
<span class="sd">        to the datum rather than aborting if there is an issue.  Some</span>
<span class="sd">        classes may want to implement this as pass because it makes</span>
<span class="sd">        no sense - e.g. setting a constant value.   Those are the</span>
<span class="sd">        exception, however, so the api dogmatically demands these</span>
<span class="sd">        be implemented even if they do nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MetadataOperator.edit_ensemble_members"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperator.edit_ensemble_members">[docs]</a>    <span class="k">def</span> <span class="nf">edit_ensemble_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subclasses should call this method if the input data are an</span>
<span class="sd">        ensemble.   A trick of inheritance allows the algorithm of self</span>
<span class="sd">        to then be applied to whole ensemble.  Putting this in the</span>
<span class="sd">        base class avoids the duplication of duplicate code in all \</span>
<span class="sd">        subclasses.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">live</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">member</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ensemble</span></div>

<div class="viewcode-block" id="MetadataOperator.log_edit"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperator.log_edit">[docs]</a>    <span class="k">def</span> <span class="nf">log_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">testname</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Informational</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This base class method is used to standardize the error logging</span>
<span class="sd">        functionality of all editors.   It writes a standardized</span>
<span class="sd">        message to simplify writing of subclasses - they need only</span>
<span class="sd">        define the testname (normally the name of the subclass) and</span>
<span class="sd">        format a specific message to be posted.</span>

<span class="sd">        Note most subclasses will may want to include a verbose option</span>
<span class="sd">        (or the reciprocal silent) and only write log messages when</span>
<span class="sd">        verbose is set true.</span>

<span class="sd">        :param d:  MsPASS data object to which elog message is to be</span>
<span class="sd">          written.</span>
<span class="sd">        :param testname: is the string assigned to the &quot;algorithm&quot; field</span>
<span class="sd">        of the message posted to d.elog.</span>
<span class="sd">        :param message:  specialized message to post - this string is added</span>
<span class="sd">        to an internal generic message.</span>
<span class="sd">        :param severity:  ErrorSeverity to assign to elog message</span>
<span class="sd">        (See ErrorLogger docstring).  Default is Informational</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">edit_message</span> <span class="o">=</span> <span class="s2">&quot;Altered by apply method of this class.  Details:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">edit_message</span> <span class="o">+=</span> <span class="n">message</span>
            <span class="n">d</span><span class="o">.</span><span class="n">elog</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="n">testname</span><span class="p">,</span> <span class="n">edit_message</span><span class="p">,</span> <span class="n">severity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataOperator.apply method received invalid data;  must be a MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="ChangeKey"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.ChangeKey">[docs]</a><span class="k">class</span> <span class="nc">ChangeKey</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldkey</span><span class="p">,</span> <span class="n">newkey</span><span class="p">,</span> <span class="n">erase_old</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># important to validate type of keys to avoid unexpected exceptions</span>
        <span class="c1"># when used</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldkey</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newkey</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span> <span class="o">=</span> <span class="n">oldkey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newkey</span> <span class="o">=</span> <span class="n">newkey</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">erase_old</span> <span class="o">=</span> <span class="n">erase_old</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;ChangeKey constructor usage error.  ChangeKey(oldkey,newkey)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;oldkey and newkey must be strings defining metadata keys - check types&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">)</span>

<div class="viewcode-block" id="ChangeKey.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.ChangeKey.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fast_mode</span><span class="p">:</span>
                    <span class="n">keysok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">keysok</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span> <span class="o">+</span> <span class="s2">&quot; is not defined&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span>
                                <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;ChangeKey&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span>
                            <span class="p">)</span>
                        <span class="k">return</span> <span class="n">d</span>
            <span class="c1"># from here on we can assume operation is ok</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">member</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                        <span class="k">continue</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span><span class="p">]</span>
                    <span class="n">m</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">erase_old</span><span class="p">:</span>
                        <span class="n">m</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Land here if for all atomic data and if asked</span>
                <span class="c1"># to only modify the ensemble (global) Metadata container.</span>
                <span class="c1"># i.e. when apply_to_member is false.  Makes the logic a</span>
                <span class="c1"># bit confusing but reduces redundant code</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span><span class="p">]</span>
                <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">erase_old</span><span class="p">:</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;ChangeKey.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ChangeKey.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.ChangeKey.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">member</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oldkey</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ChangeKey.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.ChangeKey.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        there is no operation on a ChangeKey so this method does nothing.</span>
<span class="sd">        Because it is an abstract base we have to have this stub.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="SetValue"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.SetValue">[docs]</a><span class="k">class</span> <span class="nc">SetValue</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to set a specified metadata key to a constant value.  Note any</span>
<span class="sd">    existing value of Metadata associated with the key defined in the</span>
<span class="sd">    operator always be overwritten.</span>

<span class="sd">    Example:  to set the value of key = &#39;a&#39; to constant 2.0</span>

<span class="sd">      op = SetValue(&#39;a&#39;,2.0)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">constant_value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for this operator.</span>

<span class="sd">        :param key: string defining key for Metadata to be set.</span>
<span class="sd">        :param constant_value:  is the value to use for setting the</span>
<span class="sd">          attribute linked to the key.  Note we do no type checking so</span>
<span class="sd">          beware of implicit integer conversion (e.g. use 2.0 if you mean</span>
<span class="sd">          want a float 2.0 not 2 which python would auto cast to an int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">constant_value</span>

<div class="viewcode-block" id="SetValue.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.SetValue.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to apply this operator to Metadata of a MsPASS data object.</span>
<span class="sd">        Use of decorator adds common MsPASS arguments as call options.</span>

<span class="sd">        :param d:  datum to which operator is to be applied.  d must be a</span>
<span class="sd">        valid MsPASS data object or this method will throw a fatal MsPASSError</span>
<span class="sd">        exception.  If d is marked dead it will be silently ignored.</span>
<span class="sd">        :param apply_to_members:  when true and d is an ensemble object the</span>
<span class="sd">        operator is applied to the members.  When false the metadata for the</span>
<span class="sd">        ensemble will be altered.  This parameter is ignored for atomic</span>
<span class="sd">        data types.  Default is False.</span>

<span class="sd">        :return:  always returns a (usually) edited copy of the input d.</span>
<span class="sd">        When the input d is dead the copy will always be unaltered.</span>
<span class="sd">        Note the copy is a shallow copy which in python means we just return</span>
<span class="sd">        the equivalent of a pointer to the caller.  Important for efficiency</span>
<span class="sd">        as d can be very large for some ensembles.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;SetValue.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="SetValue.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.SetValue.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Useless implementation of required abstract base method.  In this</span>
<span class="sd">        case all it does is test if the stored value of key is a string.</span>
<span class="sd">        Returns true if the key is a string and false otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="SetValue.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.SetValue.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<span class="c1"># all arithmetic operators need an output key to place result that can be the same as one of the inputs</span>
<span class="c1"># These are unary - operate using a constant value set on constructoin</span>
<div class="viewcode-block" id="Add"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add">[docs]</a><span class="k">class</span> <span class="nc">Add</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement += operator on a specified Metadata key.</span>
<span class="sd">    Example:  to add 2 to data, d, with key=&#39;icdp&#39; could use this</span>

<span class="sd">      op = Add(&#39;icdp&#39;,2)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_to_add</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value_to_add</span>

<div class="viewcode-block" id="Add.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Add Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Required key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The += operator fails on Metadata with key=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">val</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Add.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Add.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the key defined for the operator is defined for d.</span>
<span class="sd">        Returns true if is defined and false if not.  the method assumes</span>
<span class="sd">        d is a valid child of Metadata so the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Add.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Multiply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply">[docs]</a><span class="k">class</span> <span class="nc">Multiply</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement *= operator on a specified Metadata key.</span>
<span class="sd">    Example:  to multiple metadata in, d, with key=&#39;Pamp&#39; by 2.5</span>
<span class="sd">    you could use this</span>

<span class="sd">      op = Multiply(&#39;Pamp&#39;,2.5)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_to_multiply</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value_to_multiply</span>

<div class="viewcode-block" id="Multiply.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Multiply Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Required key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The *= operator fails on Metadata with key=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">val</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Multiply.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Multiply.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the key defined for the operator is defined for d.</span>
<span class="sd">        Returns true if is defined and false if not.  the method assumes</span>
<span class="sd">        d is a valid child of Metadata so the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Multiply.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Subtract"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract">[docs]</a><span class="k">class</span> <span class="nc">Subtract</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement -= operator on a specified Metadata key.</span>
<span class="sd">    Example:  to subtract 2 from metadata, d, with key=&#39;icdp&#39; could use this</span>

<span class="sd">      op = Subtract(&#39;icdp&#39;,2)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_to_subtract</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value_to_subtract</span>

<div class="viewcode-block" id="Subtract.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Subtract Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Required key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The -= operator fails on Metadata with key=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">val</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Subtract.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Subtract.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the key defined for the operator is defined for d.</span>
<span class="sd">        Returns true if is defined and false if not.  the method assumes</span>
<span class="sd">        d is a valid child of Metadata so the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Subtract.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Divide"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide">[docs]</a><span class="k">class</span> <span class="nc">Divide</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement /= operator on a specified Metadata key.</span>
<span class="sd">    Example:  to divide metadata in, d, with key=&#39;Pamp&#39; by 2.0</span>
<span class="sd">    you could use this</span>

<span class="sd">      op = Divide(&#39;Pamp&#39;,2.-)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_to_divide</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value_to_divide</span>

<div class="viewcode-block" id="Divide.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Divide Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Required key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The /= operator fails on Metadata with key=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">val</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Divide.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Divide.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the key defined for the operator is defined for d.</span>
<span class="sd">        Returns true if is defined and false if not.  the method assumes</span>
<span class="sd">        d is a valid child of Metadata so the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Divide.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="IntegerDivide"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide">[docs]</a><span class="k">class</span> <span class="nc">IntegerDivide</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement // operator on a specified Metadata key.</span>
<span class="sd">    The // operator is a bit obscure but it implements the common</span>
<span class="sd">    need to truncate a division result to an integer.  This will work</span>
<span class="sd">    on floats but the result will always be close to and integer</span>
<span class="sd">    value as if the operation were done with integers.  Note</span>
<span class="sd">    also IntegerDivide is the complement to Mod which returns the remainder</span>
<span class="sd">    of such a division.</span>

<span class="sd">    Example:  to apply integer division to metadata in, d, with key=&#39;icdp&#39; by 5</span>
<span class="sd">    you could use this</span>

<span class="sd">      op = IntegerDivide(&#39;icdp&#39;,5)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="IntegerDivide.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata IntegerDivide Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Required key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The // operator fails on Metadata with key=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                    <span class="c1"># there is a //= operator but it is obscure in this context</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;IntegerDivide.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="IntegerDivide.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the key defined for the operator is defined for d.</span>
<span class="sd">        Returns true if is defined and false if not.  the method assumes</span>
<span class="sd">        d is a valid child of Metadata so the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="IntegerDivide.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">testval</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Mod"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod">[docs]</a><span class="k">class</span> <span class="nc">Mod</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement % operator on a specified Metadata key.</span>
<span class="sd">    The % operator is a bit obscure but it implements the common</span>
<span class="sd">    need return the remainder of a divide operation.   It is commonly</span>
<span class="sd">    used, for example, in cmp processing where survey flag numbers can</span>
<span class="sd">    often be converted to channel numbers for simple multichannel cable</span>
<span class="sd">    geometries.</span>

<span class="sd">    This operator will work any numeric type but it is most commonly used</span>
<span class="sd">    for integer attributes.</span>

<span class="sd">    Example:  to convert the metadata associated with the key &#39;ichan&#39; that</span>
<span class="sd">    are currently counting by 1 to numbers that cycle from 0 to 23 us this:</span>

<span class="sd">      op = Mod(&#39;ix&#39;,24)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># note default would zero everything if used</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Mod.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Mod Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Required key=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The </span><span class="si">% o</span><span class="s2">perator fails on Metadata with key=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>

                    <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
                    <span class="c1"># there is a //= operator but it is obscure in this context</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Mod.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Mod.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the key defined for the operator is defined for d.</span>
<span class="sd">        Returns true if is defined and false if not.  the method assumes</span>
<span class="sd">        d is a valid child of Metadata so the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Mod.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">testval</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<span class="c1"># These are binary operators using two keys set in constructor</span>
<div class="viewcode-block" id="Add2"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add2">[docs]</a><span class="k">class</span> <span class="nc">Add2</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement + operator that adds two Metadata attributes</span>
<span class="sd">    together.  The attributes are feteched with two keys set when</span>
<span class="sd">    the operator is constructed.  Let a be the value in a datum</span>
<span class="sd">    associated with key2 (arg1 of constructor) and b be the</span>
<span class="sd">    value associated with key2 (arg2 of constructor).  The apply</span>
<span class="sd">    method of this class computes a+b and sets the Metadata attribute</span>
<span class="sd">    defined by key0 (arg0 of constructor) to that value (a+b)</span>
<span class="sd">    i.e. d[key0] = d[key1] + d[key2]</span>

<span class="sd">    Note key0 can be the same as either key1 or key2. The contents of the</span>
<span class="sd">    left hand side (key0) are always set by this operator unless that</span>
<span class="sd">    input was previously marked dead.  Further key1 and key2 can be the</span>
<span class="sd">    same although it is hard to conceive how that could be useful.</span>

<span class="sd">    Example:  to compute ix as the d[&#39;sx&#39;] + d[&#39;chan&#39;] use</span>

<span class="sd">      op = Add2(&#39;ix1&#39;,&#39;sx&#39;,&#39;chan&#39;)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>

<div class="viewcode-block" id="Add2.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add2.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Add2 Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Required keys key1=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and/or key2=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The + operator failed with Metadata fetched with keys=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">+</span> <span class="n">val2</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Add2.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Add2.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add2.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the keys required for the operator are defined for d.</span>
<span class="sd">        If either required key are missing from d return False.  Return</span>
<span class="sd">        True if both are set in d. The method assumes</span>
<span class="sd">        d is a valid child of Metadata so that the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Add2.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Add2.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">+</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Multiply2"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply2">[docs]</a><span class="k">class</span> <span class="nc">Multiply2</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement * operator that multiplies two Metadata attributes</span>
<span class="sd">    together.  The attributes are feteched with two keys set when</span>
<span class="sd">    the operator is constructed.  Let a be the value in a datum</span>
<span class="sd">    associated with key2 (arg1 of constructor) and b be the</span>
<span class="sd">    value associated with key2 (arg2 of constructor).  The apply</span>
<span class="sd">    method of this class computes a*b and sets the Metadata attribute</span>
<span class="sd">    defined by key0 (arg0 of constructor) to that value (a*b)</span>
<span class="sd">    i.e. d[key0] = d[key1] * d[key2]</span>

<span class="sd">    Note key0 can be the same as either key1 or key2. The contents of the</span>
<span class="sd">    left hand side (key0) are always set by this operator unless that</span>
<span class="sd">    input was previously marked dead.  Further key1 and key2 can be the</span>
<span class="sd">    same although it is hard to conceive how that could be useful.</span>

<span class="sd">    Example:  to compute ix as the d[&#39;sx&#39;] * d[&#39;chan&#39;] use</span>

<span class="sd">      op = Multiply2(&#39;ix1&#39;,&#39;sx&#39;,&#39;chan&#39;)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>

<div class="viewcode-block" id="Multiply2.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply2.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Multiply2 Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Required keys key1=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and/or key2=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The * operator failed with Metadata fetched with keys=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">*</span> <span class="n">val2</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Multiply2.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Multiply2.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply2.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the keys required for the operator are defined for d.</span>
<span class="sd">        If either required key are missing from d return False.  Return</span>
<span class="sd">        True if both are set in d. The method assumes</span>
<span class="sd">        d is a valid child of Metadata so that the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Multiply2.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Multiply2.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">*</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Subtract2"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract2">[docs]</a><span class="k">class</span> <span class="nc">Subtract2</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement - operator that computes the difference of two Metadata</span>
<span class="sd">    attributes.  The attributes are feteched with two keys set when</span>
<span class="sd">    the operator is constructed.  Let a be the value in a datum</span>
<span class="sd">    associated with key2 (arg1 of constructor) and b be the</span>
<span class="sd">    value associated with key2 (arg2 of constructor).  The apply</span>
<span class="sd">    method of this class computes a-b and sets the Metadata attribute</span>
<span class="sd">    defined by key0 (arg0 of constructor) to that value (a-b)</span>
<span class="sd">    i.e. d[key0] = d[key1] - d[key2]</span>

<span class="sd">    Note key0 can be the same as either key1 or key2. The contents of the</span>
<span class="sd">    left hand side (key0) are always set by this operator unless that</span>
<span class="sd">    input was previously marked dead.  Further key1 and key2 can be the</span>
<span class="sd">    same although it is hard to conceive how that could be useful.</span>

<span class="sd">    Example:  to compute ix as the d[&#39;sx&#39;] - d[&#39;chan&#39;] use</span>

<span class="sd">      op = Subtract2(&#39;ix1&#39;,&#39;sx&#39;,&#39;chan&#39;)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>

<div class="viewcode-block" id="Subtract2.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract2.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Subtract2 Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Required keys key1=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and/or key2=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The - operator failed with Metadata fetched with keys=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">-</span> <span class="n">val2</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Subtract2.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Subtract2.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract2.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the keys required for the operator are defined for d.</span>
<span class="sd">        If either required key are missing from d return False.  Return</span>
<span class="sd">        True if both are set in d. The method assumes</span>
<span class="sd">        d is a valid child of Metadata so that the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Subtract2.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Subtract2.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">-</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Divide2"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide2">[docs]</a><span class="k">class</span> <span class="nc">Divide2</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement / operator that divides two Metadata attributes.</span>
<span class="sd">    The attributes are feteched with two keys set when</span>
<span class="sd">    the operator is constructed.  Let a be the value in a datum</span>
<span class="sd">    associated with key2 (arg1 of constructor) and b be the</span>
<span class="sd">    value associated with key2 (arg2 of constructor).  The apply</span>
<span class="sd">    method of this class computes a/b and sets the Metadata attribute</span>
<span class="sd">    defined by key0 (arg0 of constructor) to that value (a/b)</span>
<span class="sd">    i.e. d[key0] = d[key1] / d[key2]</span>

<span class="sd">    Note key0 can be the same as either key1 or key2. The contents of the</span>
<span class="sd">    left hand side (key0) are always set by this operator unless that</span>
<span class="sd">    input was previously marked dead.  Further key1 and key2 can be the</span>
<span class="sd">    same although it is hard to conceive how that could be useful.</span>

<span class="sd">    Example:  to compute ix as the d[&#39;sx&#39;] / d[&#39;chan&#39;] use</span>

<span class="sd">      op = Divide2(&#39;ix1&#39;,&#39;sx&#39;,&#39;chan&#39;)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>

<div class="viewcode-block" id="Divide2.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide2.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Divide2 Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Required keys key1=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and/or key2=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The / operator failed with Metadata fetched with keys=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">/</span> <span class="n">val2</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Divide2.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Divide2.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide2.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the keys required for the operator are defined for d.</span>
<span class="sd">        If either required key are missing from d return False.  Return</span>
<span class="sd">        True if both are set in d. The method assumes</span>
<span class="sd">        d is a valid child of Metadata so that the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Divide2.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Divide2.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">/</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="IntegerDivide2"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide2">[docs]</a><span class="k">class</span> <span class="nc">IntegerDivide2</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement // operator between two Metadata attributes.</span>
<span class="sd">    The attributes are feteched with two keys set when</span>
<span class="sd">    the operator is constructed.  Let a be the value in a datum</span>
<span class="sd">    associated with key2 (arg1 of constructor) and b be the</span>
<span class="sd">    value associated with key2 (arg2 of constructor).  The apply</span>
<span class="sd">    method of this class computes a//b and sets the Metadata attribute</span>
<span class="sd">    defined by key0 (arg0 of constructor) to that value (a+b)</span>
<span class="sd">    i.e. d[key0] = d[key1] // d[key2]</span>

<span class="sd">    Note key0 can be the same as either key1 or key2. The contents of the</span>
<span class="sd">    left hand side (key0) are always set by this operator unless that</span>
<span class="sd">    input was previously marked dead.  Further key1 and key2 can be the</span>
<span class="sd">    same although it is hard to conceive how that could be useful.</span>

<span class="sd">    Example:  to compute ix as the d[&#39;sx&#39;] // d[&#39;chan&#39;] use</span>

<span class="sd">      op = IntegerDivide2(&#39;ix1&#39;,&#39;sx&#39;,&#39;chan&#39;)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>

<div class="viewcode-block" id="IntegerDivide2.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide2.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata IntegerDivide2 Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Required keys key1=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and/or key2=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The // operator failed with Metadata fetched with keys=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">//</span> <span class="n">val2</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;IntegerDivide2.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="IntegerDivide2.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide2.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the keys required for the operator are defined for d.</span>
<span class="sd">        If either required key are missing from d return False.  Return</span>
<span class="sd">        True if both are set in d. The method assumes</span>
<span class="sd">        d is a valid child of Metadata so that the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="IntegerDivide2.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.IntegerDivide2.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">//</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Mod2"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod2">[docs]</a><span class="k">class</span> <span class="nc">Mod2</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to implement % operator between two Metadata attributes.</span>
<span class="sd">    The attributes are feteched with two keys set when</span>
<span class="sd">    the operator is constructed.  Let a be the value in a datum</span>
<span class="sd">    associated with key2 (arg1 of constructor) and b be the</span>
<span class="sd">    value associated with key2 (arg2 of constructor).  The apply</span>
<span class="sd">    method of this class computes a+b and sets the Metadata attribute</span>
<span class="sd">    defined by key0 (arg0 of constructor) to that value (a%b)</span>
<span class="sd">    i.e. d[key0] = d[key1] % d[key2]</span>

<span class="sd">    Note key0 can be the same as either key1 or key2. The contents of the</span>
<span class="sd">    left hand side (key0) are always set by this operator unless that</span>
<span class="sd">    input was previously marked dead.  Further key1 and key2 can be the</span>
<span class="sd">    same although it is hard to conceive how that could be useful.</span>

<span class="sd">    Example:  to compute ix as the d[&#39;sx&#39;] % d[&#39;chan&#39;] use</span>

<span class="sd">      op = Mod2(&#39;ix1&#39;,&#39;sx&#39;,&#39;chan&#39;)</span>
<span class="sd">      d = op.apply(d)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key0</span><span class="p">,</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key0</span> <span class="o">=</span> <span class="n">key0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>

<div class="viewcode-block" id="Mod2.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod2.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">elognametag</span> <span class="o">=</span> <span class="s2">&quot;Metadata Mod2 Operator&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_keys</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;Required keys key1=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and/or key2=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot; not defined&quot;</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_edit</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">elognametag</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Invalid</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_operation</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;The </span><span class="si">% o</span><span class="s2">perator failed with Metadata fetched with keys=&quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span>
                            <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">An incompatible type likely is stored with that key&quot;</span>
                        <span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">d</span>
                    <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
                    <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">%</span> <span class="n">val2</span>
                <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;Mod2.apply:   input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Mod2.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod2.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks that the keys required for the operator are defined for d.</span>
<span class="sd">        If either required key are missing from d return False.  Return</span>
<span class="sd">        True if both are set in d. The method assumes</span>
<span class="sd">        d is a valid child of Metadata so that the is_defined method will</span>
<span class="sd">        not generate an exception.  that means this method should ALWAYS</span>
<span class="sd">        be called after a test with _input_is_valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">is_defined</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Mod2.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.Mod2.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks to make sure the value works with the operation</span>
<span class="sd">        required.  It provides a (required by the base class) standardization</span>
<span class="sd">        of testing for validity of the operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we catch any exception - think we could be explicity with a TypeError</span>
        <span class="c1"># but this is more robust</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">]</span>
            <span class="n">val2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">]</span>
            <span class="n">testval</span> <span class="o">=</span> <span class="n">val1</span> <span class="o">%</span> <span class="n">val2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div></div>


<span class="c1"># Note this class was patterned closely after FiringSquad - the approach</span>
<span class="c1"># is identical.  I did little more than edit a copy of FiringSquad to produce</span>
<span class="c1"># this class</span>
<div class="viewcode-block" id="MetadataOperatorChain"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperatorChain">[docs]</a><span class="k">class</span> <span class="nc">MetadataOperatorChain</span><span class="p">(</span><span class="n">MetadataOperator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to apply multiple a chain of arithmetic operators to derive</span>
<span class="sd">    computed metadata attributes.  Very elaborate calculations can be</span>
<span class="sd">    done through this class by chaining appropriate atomic operators</span>
<span class="sd">    defined elsewhere in the module (i.e. Add, Subtract, etc.).</span>
<span class="sd">    The operation chain is defined by a python list of the atomic operators.</span>
<span class="sd">    When the apply method of this class is called the list of operators</span>
<span class="sd">    are applied sequentially in list order.</span>

<span class="sd">    Note the class has a += operator to allow appending additional</span>
<span class="sd">    operators to the chain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        One and only constructor.  operator_list does not literally</span>
<span class="sd">        have to be a list container.  It can be any container that is iterable so</span>
<span class="sd">        a list, tuple, or array can be used.   Internally the contents</span>
<span class="sd">        are copied to a python list container so this the contents of</span>
<span class="sd">        operator_list sent to the constructor are treated not unintentionally</span>
<span class="sd">        modified.</span>

<span class="sd">        The constructor will throw a MsPASSError exception if any of the</span>
<span class="sd">        contents of operator_list is not a child of the</span>
<span class="sd">        MetadataOperator base class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">operator_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">MetadataOperator</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                    <span class="s2">&quot;MetadataOperatorChain constructor:  invalid input.  Expected iterable container of MetadataOperator objects&quot;</span><span class="p">,</span>
                    <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># to allow flexibility of the structure used for input we should</span>
        <span class="c1"># copy the operator_list.  Further, this assure the</span>
        <span class="c1"># result will iterate correctly and allow for append</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">operator_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

<div class="viewcode-block" id="MetadataOperatorChain.apply"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperatorChain.apply">[docs]</a>    <span class="nd">@mspass_method_wrapper</span>
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implementation of base class method.  In this case failure is</span>
<span class="sd">        defined as not passing one of the set of tests loaded  when</span>
<span class="sd">        the object was created.  As noted earlier the tests are performed</span>
<span class="sd">        in the same order they were passed to the constructor of added on</span>
<span class="sd">        with the += operator.</span>
<span class="sd">        :param d: is a mspass data object to be checked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">edit_ensemble_members</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">oplist</span><span class="p">:</span>
                    <span class="n">op</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="n">apply_to_members</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">dead</span><span class="p">():</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataOperatorChain received invalid input data&quot;</span><span class="p">,</span> <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span>
            <span class="p">)</span></div>

    <span class="c1"># These two virtual methods have to be defined but they do nothing in</span>
    <span class="c1"># this context.  We depend on the atomic operators to implement these</span>
    <span class="c1"># checks</span>
<div class="viewcode-block" id="MetadataOperatorChain.check_keys"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperatorChain.check_keys">[docs]</a>    <span class="k">def</span> <span class="nf">check_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="MetadataOperatorChain.check_operation"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.MetadataOperatorChain.check_operation">[docs]</a>    <span class="k">def</span> <span class="nf">check_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the += operator for the class. In that case it means a new</span>
<span class="sd">        operator is appended.   Raises a MsPASSError set Fatal other is not a</span>
<span class="sd">        subclass of MetadataOperator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MetadataOperator</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
                <span class="s2">&quot;MetadataOperatorChain:   operator +=  rhs is not a child of MetadataOperator&quot;</span><span class="p">,</span>
                <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<span class="c1"># other editors to implement that do not match the abstract base class model</span>


<div class="viewcode-block" id="erase_metadata"><a class="viewcode-back" href="../../../python_api/mspasspy.algorithms.html#mspasspy.algorithms.edit.erase_metadata">[docs]</a><span class="k">def</span> <span class="nf">erase_metadata</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">keylist</span><span class="p">,</span> <span class="n">apply_to_members</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This editor clears the contents of any data associated with a list of</span>
<span class="sd">    Metadata keys.   If there is no data for that key it will silently do</span>
<span class="sd">    nothing.  If the input is an ensemble and apply_to_members is True</span>
<span class="sd">    all the algorithm will run on the metadata of each member in a loop.</span>
<span class="sd">    If false only the ensemble (global) metadata are handled.</span>

<span class="sd">    :param d:  must be a valid MsPASS data object. If not the function</span>
<span class="sd">    will throw an exception.   If the datum is marked dead it will</span>
<span class="sd">    silently just return the contents.</span>

<span class="sd">    :param keylist:  python list of strings to use as keywords.  Any matching</span>
<span class="sd">    keys the metadata of d will be cleared.</span>

<span class="sd">    :param apply_to_members:  is a boolean controlling how the function</span>
<span class="sd">    should handle ensembles.  Then set true the erase algorithm will be</span>
<span class="sd">    applied in a loop over the member vector of an input ensemble.  When</span>
<span class="sd">    False (default) only the ensemble&#39;s metadata is checked.  This parameter</span>
<span class="sd">    is ignored if the input is an atomic data type.</span>

<span class="sd">    :return:  edited copy of d</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_input_is_valid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_is_ensemble</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">apply_to_members</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">member</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                    <span class="c1"># erase silently does nothing if the key is not defined so</span>
                    <span class="c1"># no error handler is needed here</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                <span class="n">d</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MsPASSError</span><span class="p">(</span>
            <span class="s2">&quot;erase_metadata:  input is not a valid MsPASS data object&quot;</span><span class="p">,</span>
            <span class="n">ErrorSeverity</span><span class="o">.</span><span class="n">Fatal</span><span class="p">,</span>
        <span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2021, Ian Wang.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>